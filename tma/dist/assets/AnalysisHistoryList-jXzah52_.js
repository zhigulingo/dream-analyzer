import{d as ht,m as yt,u as _t,c as P,a as U,o as L,n as tt,b as j,e as et,t as Q,F as at,y as ut,A as ot,E as lt,r as it,k as ft}from"./main-CYTcTttl.js";import{g as st,c as rt}from"./_commonjsHelpers-Cpj98o6Y.js";var mt={exports:{}};(function(N,E){(function(l,k){N.exports=k()})(rt,function(){var l=1e3,k=6e4,z=36e5,T="millisecond",v="second",x="minute",f="hour",g="day",D="week",S="month",$="quarter",_="year",i="date",t="Invalid Date",d=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(h){var n=["th","st","nd","rd"],e=h%100;return"["+h+(n[(e-20)%10]||n[e]||n[0])+"]"}},s=function(h,n,e){var a=String(h);return!a||a.length>=n?h:""+Array(n+1-a.length).join(e)+h},u={s,z:function(h){var n=-h.utcOffset(),e=Math.abs(n),a=Math.floor(e/60),r=e%60;return(n<=0?"+":"-")+s(a,2,"0")+":"+s(r,2,"0")},m:function h(n,e){if(n.date()<e.date())return-h(e,n);var a=12*(e.year()-n.year())+(e.month()-n.month()),r=n.clone().add(a,S),m=e-r<0,p=n.clone().add(a+(m?-1:1),S);return+(-(a+(e-r)/(m?r-p:p-r))||0)},a:function(h){return h<0?Math.ceil(h)||0:Math.floor(h)},p:function(h){return{M:S,y:_,w:D,d:g,D:i,h:f,m:x,s:v,ms:T,Q:$}[h]||String(h||"").toLowerCase().replace(/s$/,"")},u:function(h){return h===void 0}},o="en",c={};c[o]=M;var b="$isDayjsObject",C=function(h){return h instanceof V||!(!h||!h[b])},A=function h(n,e,a){var r;if(!n)return o;if(typeof n=="string"){var m=n.toLowerCase();c[m]&&(r=m),e&&(c[m]=e,r=m);var p=n.split("-");if(!r&&p.length>1)return h(p[0])}else{var Y=n.name;c[Y]=n,r=Y}return!a&&r&&(o=r),r||!a&&o},O=function(h,n){if(C(h))return h.clone();var e=typeof n=="object"?n:{};return e.date=h,e.args=arguments,new V(e)},w=u;w.l=A,w.i=C,w.w=function(h,n){return O(h,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var V=function(){function h(e){this.$L=A(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[b]=!0}var n=h.prototype;return n.parse=function(e){this.$d=function(a){var r=a.date,m=a.utc;if(r===null)return new Date(NaN);if(w.u(r))return new Date;if(r instanceof Date)return new Date(r);if(typeof r=="string"&&!/Z$/i.test(r)){var p=r.match(d);if(p){var Y=p[2]-1||0,H=(p[7]||"0").substring(0,3);return m?new Date(Date.UTC(p[1],Y,p[3]||1,p[4]||0,p[5]||0,p[6]||0,H)):new Date(p[1],Y,p[3]||1,p[4]||0,p[5]||0,p[6]||0,H)}}return new Date(r)}(e),this.init()},n.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},n.$utils=function(){return w},n.isValid=function(){return this.$d.toString()!==t},n.isSame=function(e,a){var r=O(e);return this.startOf(a)<=r&&r<=this.endOf(a)},n.isAfter=function(e,a){return O(e)<this.startOf(a)},n.isBefore=function(e,a){return this.endOf(a)<O(e)},n.$g=function(e,a,r){return w.u(e)?this[a]:this.set(r,e)},n.unix=function(){return Math.floor(this.valueOf()/1e3)},n.valueOf=function(){return this.$d.getTime()},n.startOf=function(e,a){var r=this,m=!!w.u(a)||a,p=w.p(e),Y=function(R,W){var B=w.w(r.$u?Date.UTC(r.$y,W,R):new Date(r.$y,W,R),r);return m?B:B.endOf(g)},H=function(R,W){return w.w(r.toDate()[R].apply(r.toDate("s"),(m?[0,0,0,0]:[23,59,59,999]).slice(W)),r)},F=this.$W,I=this.$M,Z=this.$D,G="set"+(this.$u?"UTC":"");switch(p){case _:return m?Y(1,0):Y(31,11);case S:return m?Y(1,I):Y(0,I+1);case D:var J=this.$locale().weekStart||0,K=(F<J?F+7:F)-J;return Y(m?Z-K:Z+(6-K),I);case g:case i:return H(G+"Hours",0);case f:return H(G+"Minutes",1);case x:return H(G+"Seconds",2);case v:return H(G+"Milliseconds",3);default:return this.clone()}},n.endOf=function(e){return this.startOf(e,!1)},n.$set=function(e,a){var r,m=w.p(e),p="set"+(this.$u?"UTC":""),Y=(r={},r[g]=p+"Date",r[i]=p+"Date",r[S]=p+"Month",r[_]=p+"FullYear",r[f]=p+"Hours",r[x]=p+"Minutes",r[v]=p+"Seconds",r[T]=p+"Milliseconds",r)[m],H=m===g?this.$D+(a-this.$W):a;if(m===S||m===_){var F=this.clone().set(i,1);F.$d[Y](H),F.init(),this.$d=F.set(i,Math.min(this.$D,F.daysInMonth())).$d}else Y&&this.$d[Y](H);return this.init(),this},n.set=function(e,a){return this.clone().$set(e,a)},n.get=function(e){return this[w.p(e)]()},n.add=function(e,a){var r,m=this;e=Number(e);var p=w.p(a),Y=function(I){var Z=O(m);return w.w(Z.date(Z.date()+Math.round(I*e)),m)};if(p===S)return this.set(S,this.$M+e);if(p===_)return this.set(_,this.$y+e);if(p===g)return Y(1);if(p===D)return Y(7);var H=(r={},r[x]=k,r[f]=z,r[v]=l,r)[p]||1,F=this.$d.getTime()+e*H;return w.w(F,this)},n.subtract=function(e,a){return this.add(-1*e,a)},n.format=function(e){var a=this,r=this.$locale();if(!this.isValid())return r.invalidDate||t;var m=e||"YYYY-MM-DDTHH:mm:ssZ",p=w.z(this),Y=this.$H,H=this.$m,F=this.$M,I=r.weekdays,Z=r.months,G=r.meridiem,J=function(W,B,X,nt){return W&&(W[B]||W(a,m))||X[B].slice(0,nt)},K=function(W){return w.s(Y%12||12,W,"0")},R=G||function(W,B,X){var nt=W<12?"AM":"PM";return X?nt.toLowerCase():nt};return m.replace(y,function(W,B){return B||function(X){switch(X){case"YY":return String(a.$y).slice(-2);case"YYYY":return w.s(a.$y,4,"0");case"M":return F+1;case"MM":return w.s(F+1,2,"0");case"MMM":return J(r.monthsShort,F,Z,3);case"MMMM":return J(Z,F);case"D":return a.$D;case"DD":return w.s(a.$D,2,"0");case"d":return String(a.$W);case"dd":return J(r.weekdaysMin,a.$W,I,2);case"ddd":return J(r.weekdaysShort,a.$W,I,3);case"dddd":return I[a.$W];case"H":return String(Y);case"HH":return w.s(Y,2,"0");case"h":return K(1);case"hh":return K(2);case"a":return R(Y,H,!0);case"A":return R(Y,H,!1);case"m":return String(H);case"mm":return w.s(H,2,"0");case"s":return String(a.$s);case"ss":return w.s(a.$s,2,"0");case"SSS":return w.s(a.$ms,3,"0");case"Z":return p}return null}(W)||p.replace(":","")})},n.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},n.diff=function(e,a,r){var m,p=this,Y=w.p(a),H=O(e),F=(H.utcOffset()-this.utcOffset())*k,I=this-H,Z=function(){return w.m(p,H)};switch(Y){case _:m=Z()/12;break;case S:m=Z();break;case $:m=Z()/3;break;case D:m=(I-F)/6048e5;break;case g:m=(I-F)/864e5;break;case f:m=I/z;break;case x:m=I/k;break;case v:m=I/l;break;default:m=I}return r?m:w.a(m)},n.daysInMonth=function(){return this.endOf(S).$D},n.$locale=function(){return c[this.$L]},n.locale=function(e,a){if(!e)return this.$L;var r=this.clone(),m=A(e,a,!0);return m&&(r.$L=m),r},n.clone=function(){return w.w(this.$d,this)},n.toDate=function(){return new Date(this.valueOf())},n.toJSON=function(){return this.isValid()?this.toISOString():null},n.toISOString=function(){return this.$d.toISOString()},n.toString=function(){return this.$d.toUTCString()},h}(),ct=V.prototype;return O.prototype=ct,[["$ms",T],["$s",v],["$m",x],["$H",f],["$W",g],["$M",S],["$y",_],["$D",i]].forEach(function(h){ct[h[1]]=function(n){return this.$g(n,h[0],h[1])}}),O.extend=function(h,n){return h.$i||(h(n,V,O),h.$i=!0),O},O.locale=A,O.isDayjs=C,O.unix=function(h){return O(1e3*h)},O.en=c[o],O.Ls=c,O.p={},O})})(mt);var pt=mt.exports;const q=st(pt);var vt={exports:{}};(function(N,E){(function(l,k){N.exports=k()})(rt,function(){return function(l,k,z){l=l||{};var T=k.prototype,v={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function x(g,D,S,$){return T.fromToBase(g,D,S,$)}z.en.relativeTime=v,T.fromToBase=function(g,D,S,$,_){for(var i,t,d,y=S.$locale().relativeTime||v,M=l.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],s=M.length,u=0;u<s;u+=1){var o=M[u];o.d&&(i=$?z(g).diff(S,o.d,!0):S.diff(g,o.d,!0));var c=(l.rounding||Math.round)(Math.abs(i));if(d=i>0,c<=o.r||!o.r){c<=1&&u>0&&(o=M[u-1]);var b=y[o.l];_&&(c=_(""+c)),t=typeof b=="string"?b.replace("%d",c):b(c,D,o.l,d);break}}if(D)return t;var C=d?y.future:y.past;return typeof C=="function"?C(t):C.replace("%s",t)},T.to=function(g,D){return x(g,D,this,!0)},T.from=function(g,D){return x(g,D,this)};var f=function(g){return g.$u?z.utc():z()};T.toNow=function(g){return this.to(f(this),g)},T.fromNow=function(g){return this.from(f(this),g)}}})})(vt);var wt=vt.exports;const xt=st(wt);var gt={exports:{}};(function(N,E){(function(l,k){N.exports=k()})(rt,function(){var l="minute",k=/[+-]\d\d(?::?\d\d)?/g,z=/([+-]|\d\d)/g;return function(T,v,x){var f=v.prototype;x.utc=function(t){var d={date:t,utc:!0,args:arguments};return new v(d)},f.utc=function(t){var d=x(this.toDate(),{locale:this.$L,utc:!0});return t?d.add(this.utcOffset(),l):d},f.local=function(){return x(this.toDate(),{locale:this.$L,utc:!1})};var g=f.parse;f.parse=function(t){t.utc&&(this.$u=!0),this.$utils().u(t.$offset)||(this.$offset=t.$offset),g.call(this,t)};var D=f.init;f.init=function(){if(this.$u){var t=this.$d;this.$y=t.getUTCFullYear(),this.$M=t.getUTCMonth(),this.$D=t.getUTCDate(),this.$W=t.getUTCDay(),this.$H=t.getUTCHours(),this.$m=t.getUTCMinutes(),this.$s=t.getUTCSeconds(),this.$ms=t.getUTCMilliseconds()}else D.call(this)};var S=f.utcOffset;f.utcOffset=function(t,d){var y=this.$utils().u;if(y(t))return this.$u?0:y(this.$offset)?S.call(this):this.$offset;if(typeof t=="string"&&(t=function(o){o===void 0&&(o="");var c=o.match(k);if(!c)return null;var b=(""+c[0]).match(z)||["-",0,0],C=b[0],A=60*+b[1]+ +b[2];return A===0?0:C==="+"?A:-A}(t),t===null))return this;var M=Math.abs(t)<=16?60*t:t,s=this;if(d)return s.$offset=M,s.$u=t===0,s;if(t!==0){var u=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(s=this.local().add(M+u,l)).$offset=M,s.$x.$localOffset=u}else s=this.utc();return s};var $=f.format;f.format=function(t){var d=t||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return $.call(this,d)},f.valueOf=function(){var t=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*t},f.isUTC=function(){return!!this.$u},f.toISOString=function(){return this.toDate().toISOString()},f.toString=function(){return this.toDate().toUTCString()};var _=f.toDate;f.toDate=function(t){return t==="s"&&this.$offset?x(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():_.call(this)};var i=f.diff;f.diff=function(t,d,y){if(t&&this.$u===t.$u)return i.call(this,t,d,y);var M=this.local(),s=x(t).local();return i.call(M,s,d,y)}}})})(gt);var Mt=gt.exports;const Dt=st(Mt);var $t={exports:{}};(function(N,E){(function(l,k){N.exports=k()})(rt,function(){var l={year:0,month:1,day:2,hour:3,minute:4,second:5},k={};return function(z,T,v){var x,f=function($,_,i){i===void 0&&(i={});var t=new Date($),d=function(y,M){M===void 0&&(M={});var s=M.timeZoneName||"short",u=y+"|"+s,o=k[u];return o||(o=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:y,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:s}),k[u]=o),o}(_,i);return d.formatToParts(t)},g=function($,_){for(var i=f($,_),t=[],d=0;d<i.length;d+=1){var y=i[d],M=y.type,s=y.value,u=l[M];u>=0&&(t[u]=parseInt(s,10))}var o=t[3],c=o===24?0:o,b=t[0]+"-"+t[1]+"-"+t[2]+" "+c+":"+t[4]+":"+t[5]+":000",C=+$;return(v.utc(b).valueOf()-(C-=C%1e3))/6e4},D=T.prototype;D.tz=function($,_){$===void 0&&($=x);var i,t=this.utcOffset(),d=this.toDate(),y=d.toLocaleString("en-US",{timeZone:$}),M=Math.round((d-new Date(y))/1e3/60),s=15*-Math.round(d.getTimezoneOffset()/15)-M;if(!Number(s))i=this.utcOffset(0,_);else if(i=v(y,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(s,!0),_){var u=i.utcOffset();i=i.add(t-u,"minute")}return i.$x.$timezone=$,i},D.offsetName=function($){var _=this.$x.$timezone||v.tz.guess(),i=f(this.valueOf(),_,{timeZoneName:$}).find(function(t){return t.type.toLowerCase()==="timezonename"});return i&&i.value};var S=D.startOf;D.startOf=function($,_){if(!this.$x||!this.$x.$timezone)return S.call(this,$,_);var i=v(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return S.call(i,$,_).tz(this.$x.$timezone,!0)},v.tz=function($,_,i){var t=i&&_,d=i||_||x,y=g(+v(),d);if(typeof $!="string")return v($).tz(d);var M=function(c,b,C){var A=c-60*b*1e3,O=g(A,C);if(b===O)return[A,b];var w=g(A-=60*(O-b)*1e3,C);return O===w?[A,O]:[c-60*Math.min(O,w)*1e3,Math.max(O,w)]}(v.utc($,t).valueOf(),y,d),s=M[0],u=M[1],o=v(s).utcOffset(u);return o.$x.$timezone=d,o},v.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},v.tz.setDefault=function($){x=$}}})})($t);var St=$t.exports;const bt=st(St);var kt={exports:{}};(function(N,E){(function(l,k){N.exports=k(pt)})(rt,function(l){function k(i){return i&&typeof i=="object"&&"default"in i?i:{default:i}}var z=k(l),T="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),v="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),x="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),f="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),g=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function D(i,t,d){var y,M;return d==="m"?t?"минута":"минуту":i+" "+(y=+i,M={mm:t?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[d].split("_"),y%10==1&&y%100!=11?M[0]:y%10>=2&&y%10<=4&&(y%100<10||y%100>=20)?M[1]:M[2])}var S=function(i,t){return g.test(t)?T[i.month()]:v[i.month()]};S.s=v,S.f=T;var $=function(i,t){return g.test(t)?x[i.month()]:f[i.month()]};$.s=f,$.f=x;var _={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:S,monthsShort:$,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:D,mm:D,h:"час",hh:D,d:"день",dd:D,M:"месяц",MM:D,y:"год",yy:D},ordinal:function(i){return i},meridiem:function(i){return i<4?"ночи":i<12?"утра":i<17?"дня":"вечера"}};return z.default.locale(_,null,!0),_})})(kt);const Tt={class:"flex justify-between items-center py-2 min-h-[2.5rem]"},Ot={class:"truncate"},Yt={class:"bg-white/10 rounded-full px-2 py-1 text-sm min-w-[3rem] text-center whitespace-nowrap"},Ht={key:0,class:"mt-4 space-y-4 text-sm fade-seq is-open"},Ct={key:0,class:"flex flex-wrap gap-2"},Lt={class:"leading-snug opacity-90"},zt={class:"leading-snug opacity-90"},At={class:"mt-6 flex gap-2"},dt=ht({__name:"DreamCard",props:{dream:{},active:{type:Boolean}},emits:["toggle"],setup(N,{emit:E}){q.extend(xt),q.locale("ru"),q.extend(Dt),q.extend(bt);const l=N,k=E,z=()=>{k("toggle"),window.triggerHaptic&&window.triggerHaptic("light")},T=yt(),v=_t(),x=P({get:()=>{var s,u,o;return((s=l.dream)==null?void 0:s.user_feedback)??((o=(u=l.dream)==null?void 0:u.deep_source)==null?void 0:o.user_feedback)??0},set:s=>{l.dream&&(l.dream.user_feedback=s,l.dream.deep_source||(l.dream.deep_source={}),l.dream.deep_source.user_feedback=s)}}),f={like:!1,dislike:!1,delete:!1},g=async s=>{if(f.like||f.dislike)return;const u=s===1?x.value===1?0:1:x.value===2?0:2,o=x.value;x.value=u;try{window.triggerHaptic&&window.triggerHaptic("medium"),s===1?f.like=!0:f.dislike=!0,await lt.postAnalysisFeedback(l.dream.id,u),u===0?v.info("Оценка снята"):u===1?v.success("Добавлено: нравится"):u===2&&v.success("Добавлено: не нравится")}catch(c){x.value=o,console.error("Feedback error",c),v.error("Не удалось сохранить оценку")}finally{f.like=f.dislike=!1}},D=()=>g(1),S=()=>g(2),$=async()=>{var o;if(f.delete)return;const s=(o=window.Telegram)==null?void 0:o.WebApp;if(await new Promise(c=>{s!=null&&s.showPopup?s.showPopup({title:"Удалить запись?",message:"Действие необратимо",buttons:[{id:"yes",type:"destructive",text:"Удалить"},{id:"no",type:"cancel",text:"Отмена"}]},b=>c(b==="yes")):c(window.confirm("Удалить запись?"))}))try{f.delete=!0,window.triggerHaptic&&window.triggerHaptic("heavy"),await lt.deleteAnalysis(l.dream.id);const c=T.history.findIndex(b=>b.id===l.dream.id);c>-1&&T.history.splice(c,1),T.fetchProfile(),v.success("Запись удалена")}catch(c){console.error("Delete error",c),v.error("Не удалось удалить запись")}finally{f.delete=!1}},_=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]);function i(s){return s.replace(/\s+/g," ").trim().split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" ")}function t(s){if(!s)return"";const u=String(s).split(/[.!?\n]/)[0],c=u.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(b=>b&&!_.has(b)&&b.length>3).slice(0,3);return c.length===0?u.slice(0,40):i(c.join(" "))}const d=P(()=>{var c,b,C,A,O,w;const s=l.dream&&(l.dream.title||((b=(c=l.dream)==null?void 0:c.deep_source)==null?void 0:b.title))||"";if(s)return s;if(!!((C=l.dream)!=null&&C.is_deep_analysis)||((A=l.dream)==null?void 0:A.dream_text)==="[DEEP_ANALYSIS_SOURCE]"){const V=t((O=l.dream)==null?void 0:O.analysis);return V||"Глубокий анализ"}return t((w=l.dream)==null?void 0:w.dream_text)||"Без названия"}),y=P(()=>{var u,o;const s=(o=(u=l.dream)==null?void 0:u.deep_source)==null?void 0:o.tags;return Array.isArray(s)?s.slice(0,5):[]}),M=P(()=>{if(!l.dream.created_at)return"";try{const s=Intl.DateTimeFormat().resolvedOptions().timeZone||q.tz.guess(),u=q.utc(l.dream.created_at).tz(s).startOf("day"),c=q().tz(s).startOf("day").diff(u,"day"),b=Math.floor(c/7),C=Math.floor(c/30),A=Math.floor(c/365);return c===0?"сегодня":c===1?"вчера":c<7?`${c} д`:c<30?`${b} н`:c<365?`${C} м`:`${A} г`}catch{return l.dream.created_at}});return(s,u)=>(L(),U("article",{class:tt(["rounded-xl bg-gradient-to-br from-[#4A58FF] to-[#5664FF] text-white px-8 md:px-16 transition-all overflow-hidden cursor-pointer py-6",[s.active?"":"min-h-[4.5rem]"]]),onClick:z},[j("div",Tt,[j("h3",Ot,Q(d.value),1),j("span",Yt,Q(M.value),1)]),s.active?(L(),U("div",Ht,[y.value.length?(L(),U("div",Ct,[(L(!0),U(at,null,ut(y.value,o=>(L(),U("span",{key:o,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},Q(o),1))),128))])):et("",!0),j("div",null,[u[0]||(u[0]=j("h4",{class:"font-semibold mb-1"},"Сон:",-1)),j("p",Lt,Q(s.dream.dream_text),1)]),j("div",null,[u[1]||(u[1]=j("h4",{class:"font-semibold mb-1"},"Анализ:",-1)),j("p",zt,Q(s.dream.analysis),1)]),j("div",At,[j("button",{class:tt(["flex-1 rounded-xl py-2 text-sm font-medium transition-colors",x.value===1?"bg-green-500/30 text-white ring-2 ring-green-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:ot(D,["stop"])}," 👍 Нравится ",2),j("button",{class:tt(["flex-1 rounded-xl py-2 text-sm font-medium transition-colors",x.value===2?"bg-red-500/30 text-white ring-2 ring-red-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:ot(S,["stop"])}," 👎 Не нравится ",2),j("button",{class:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-white rounded-xl py-2 text-sm font-medium transition-colors",onClick:ot($,["stop"])}," 🗑️ Удалить ")])])):et("",!0)],2))}}),Ft={class:"flex items-center mb-4 gap-4"},Ut={key:0,class:"text-center text-white/60 py-8"},Nt={key:1,class:"text-center text-red-400 py-8"},It={key:2},jt={key:0,class:"text-center text-white/60 py-8"},Wt={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Zt={key:3},Et={key:0,class:"text-center text-white/60 py-8"},Pt={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Jt=ht({__name:"AnalysisHistoryList",props:["userStore"],setup(N){const E=N,l=it(null),k=it(5),z=it(5),T=it("history"),v=P(()=>{var t;return(t=E.userStore)!=null&&t.history?E.userStore.history.filter(d=>!d.is_deep_analysis):[]}),x=P(()=>{var t;return(t=E.userStore)!=null&&t.history?E.userStore.history.filter(d=>d.is_deep_analysis):[]}),f=P(()=>v.value.slice(0,k.value)),g=P(()=>x.value.slice(0,z.value)),D=P(()=>v.value.length>k.value),S=P(()=>x.value.length>z.value),$=()=>{window.triggerHaptic&&window.triggerHaptic("light"),k.value+=5},_=()=>{window.triggerHaptic&&window.triggerHaptic("light"),z.value+=5},i=t=>{window.triggerHaptic&&window.triggerHaptic("light"),T.value=t,l.value=null};return(t,d)=>{var y,M,s,u;return L(),U("div",null,[j("div",Ft,[j("h2",{class:tt(["text-2xl font-semibold text-white cursor-pointer transition-opacity",{"opacity-100":T.value==="history","opacity-60":T.value!=="history"}]),onClick:d[0]||(d[0]=o=>i("history"))}," История снов ",2),j("h3",{class:tt(["text-lg font-medium text-white cursor-pointer transition-opacity",{"opacity-100":T.value==="deep","opacity-60":T.value!=="deep"}]),onClick:d[1]||(d[1]=o=>i("deep"))}," Глубокий анализ ",2)]),(y=N.userStore)!=null&&y.isLoadingHistory?(L(),U("div",Ut," Загрузка истории... ")):(M=N.userStore)!=null&&M.errorHistory?(L(),U("div",Nt," Ошибка загрузки: "+Q(N.userStore.errorHistory),1)):T.value==="history"?(L(),U("div",It,[(s=v.value)!=null&&s.length?(L(),U("div",Wt,[(L(!0),U(at,null,ut(f.value,o=>(L(),ft(dt,{key:o.id,dream:o,active:l.value===o.id,onToggle:c=>l.value=l.value===o.id?null:o.id},null,8,["dream","active","onToggle"]))),128)),D.value?(L(),U("button",{key:0,class:"self-center bg-white/10 rounded-full px-4 py-2 text-sm font-medium text-white hover:bg-white/20 transition-colors my-2",onClick:$}," Загрузить ещё ")):et("",!0)])):(L(),U("div",jt," У вас пока нет сохраненных анализов "))])):T.value==="deep"?(L(),U("div",Zt,[(u=x.value)!=null&&u.length?(L(),U("div",Pt,[(L(!0),U(at,null,ut(g.value,o=>(L(),ft(dt,{key:o.id,dream:o,active:l.value===o.id,onToggle:c=>l.value=l.value===o.id?null:o.id},null,8,["dream","active","onToggle"]))),128)),S.value?(L(),U("button",{key:0,class:"self-center bg-white/10 rounded-full px-4 py-2 text-sm font-medium text-white hover:bg-white/20 transition-colors my-2",onClick:_}," Загрузить ещё ")):et("",!0)])):(L(),U("div",Et," Пока нет глубоких анализов "))])):et("",!0)])}}});export{Jt as default};

import{d as H,c as k,a,o as s,n as v,i as E,b as i,j as W,F as b,y as P,r as O,k as B,e as x,t as w,q as p,w as j,l as $,A as R}from"./main-m3XtP3uI.js";import{_ as q}from"./Badge.vue_vue_type_script_setup_true_lang-Di_mCXIB.js";import{L as N}from"./PersonalAccount-BF3WSFtj.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./DebugInfo-iAuqIVKj.js";const G={key:0,class:"flex items-center space-x-4 p-4"},J={key:1,class:"space-y-4 p-4"},K={key:2,class:"space-y-3"},Q={key:3,class:"space-y-2"},X=H({__name:"SkeletonLoader",props:{type:{default:"line"},width:{},height:{},size:{},lines:{},count:{},animated:{type:Boolean,default:!0},rounded:{type:Boolean,default:!0}},setup(r){const n=r,d={xs:"w-4 h-4",sm:"w-6 h-6",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"},F=k(()=>{const l=["skeleton-container"];return n.animated&&l.push("animate-pulse"),l.join(" ")}),D=k(()=>n.size?d[n.size]:""),z=k(()=>n.height?typeof n.height=="number"?`h-${n.height}`:n.height.startsWith("h-")?n.height:`h-[${n.height}]`:"h-4"),M=k(()=>n.width?typeof n.width=="number"?`w-${n.width}`:n.width.startsWith("w-")?n.width:`w-[${n.width}]`:"w-full"),U=(l,t)=>{const e=["w-full","w-5/6","w-4/5","w-3/4","w-2/3"];return l===t?e[Math.min(l+1,e.length-1)]:e[l%e.length]||"w-full"};return(l,t)=>(s(),a("div",{class:v(["skeleton-loader",F.value])},[l.type==="user-card"?(s(),a("div",G,t[0]||(t[0]=[i("div",{class:"skeleton-circle w-10 h-10"},null,-1),i("div",{class:"flex-1 space-y-2"},[i("div",{class:"skeleton-line h-4 w-3/4"}),i("div",{class:"skeleton-line h-3 w-1/2"})],-1)]))):l.type==="dream-card"?(s(),a("div",J,t[1]||(t[1]=[W('<div class="flex justify-between items-center" data-v-2d56e570><div class="skeleton-line h-4 w-1/4" data-v-2d56e570></div><div class="skeleton-line h-3 w-16" data-v-2d56e570></div></div><div class="space-y-2" data-v-2d56e570><div class="skeleton-line h-3 w-full" data-v-2d56e570></div><div class="skeleton-line h-3 w-5/6" data-v-2d56e570></div><div class="skeleton-line h-3 w-4/5" data-v-2d56e570></div></div><div class="skeleton-line h-6 w-1/3" data-v-2d56e570></div>',3)]))):l.type==="history-list"?(s(),a("div",K,[(s(!0),a(b,null,P(l.count||3,e=>(s(),a("div",{key:e,class:"border rounded-lg p-3"},t[2]||(t[2]=[W('<div class="flex justify-between items-center mb-2" data-v-2d56e570><div class="skeleton-line h-4 w-24" data-v-2d56e570></div><div class="skeleton-line h-3 w-8" data-v-2d56e570></div></div><div class="skeleton-line h-3 w-full" data-v-2d56e570></div><div class="skeleton-line h-3 w-3/4 mt-1" data-v-2d56e570></div>',3)])))),128))])):l.type==="text-block"?(s(),a("div",Q,[(s(!0),a(b,null,P(l.lines||3,e=>(s(),a("div",{key:e,class:v(["skeleton-line h-4",U(e,l.lines||3)])},null,2))),128))])):l.type==="custom"?E(l.$slots,"default",{key:4},void 0,!0):(s(),a(b,{key:5},[l.type==="circle"?(s(),a("div",{key:0,class:v(["skeleton-circle",D.value])},null,2)):l.type==="square"?(s(),a("div",{key:1,class:v(["skeleton-square",D.value])},null,2)):(s(),a("div",{key:2,class:v(["skeleton-line",[z.value,M.value]])},null,2))],64))],2))}}),S=I(X,[["__scopeId","data-v-2d56e570"]]),Y={class:"relative"},Z=["src"],ee={class:"ml-4 truncate"},te={key:0,class:"mb-4 flex gap-2 flex-wrap"},se={key:1,class:"flex flex-col gap-2 ml-auto"},ie={key:0,class:"mb-4 flex gap-2 flex-wrap fade-seq is-open seq-offset-0"},ae={key:1,class:"flex flex-col gap-1 ml-auto items-end"},ne={key:2,class:"space-y-2 text-sm fade-seq is-open seq-offset-160"},le={class:"flex justify-between"},oe={class:"flex justify-between"},re={class:"flex justify-between"},de={class:"flex justify-between"},ue=["disabled"],ce=H({__name:"UserInfoCard",props:["userStore"],setup(r){const n=r,d=O(!1),F=k(()=>{var e,u,c;const t=(e=window.Telegram)==null?void 0:e.WebApp;return(c=(u=t==null?void 0:t.initDataUnsafe)==null?void 0:u.user)!=null&&c.photo_url?t.initDataUnsafe.user.photo_url:"https://via.placeholder.com/40/5461FF/ffffff?text=U"}),D=k(()=>{var e,u;const t=(e=window.Telegram)==null?void 0:e.WebApp;if((u=t==null?void 0:t.initDataUnsafe)!=null&&u.user){const c=t.initDataUnsafe.user;return c.first_name+(c.last_name?` ${c.last_name}`:"")}return"Пользователь"}),z=()=>{d.value=!d.value,window.triggerHaptic&&window.triggerHaptic("light")},M=k(()=>{var e,u,c,y;const t=((u=(e=n.userStore)==null?void 0:e.profile)==null?void 0:u.subscription_type)||"Free";if((y=(c=n.userStore)==null?void 0:c.profile)!=null&&y.subscription_end){const g=new Date(n.userStore.profile.subscription_end).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`${t} до ${g}`}return t}),U=k(()=>{var g;const t=(g=n.userStore)==null?void 0:g.history;if(!t||t.length===0)return"недавно";const e=t.reduce((o,_)=>{const C=new Date(_.created_at),L=new Date(o.created_at);return C<L?_:o}),u=new Date(e.created_at),y=Math.abs(new Date-u),f=Math.ceil(y/(1e3*60*60*24));if(f<7)return`${f} дн${f===1?"ень":f<5?"я":"ей"}`;if(f<30){const o=Math.floor(f/7);return`${o} недел${o===1?"ю":o<5?"и":"ь"}`}else if(f<365){const o=Math.floor(f/30);return`${o} месяц${o===1?"":o<5?"а":"ев"}`}else{const o=Math.floor(f/365);return`${o} год${o===1?"":o<5?"а":"ов"}`}}),l=()=>{var t;window.triggerHaptic&&window.triggerHaptic("medium"),(t=n.userStore)==null||t.openSubscriptionModal()};return(t,e)=>{var u,c,y,f,g,o,_,C,L,T,A,V;return s(),a("article",{class:v(["relative rounded-xl bg-gradient-to-br from-[#5461FF] to-[#4857FF] text-white overflow-hidden transition-all duration-500",[d.value?"pb-32":"min-h-[4.5rem]"]]),onClick:z},[(u=r.userStore)!=null&&u.isLoadingProfile&&!d.value?(s(),B(N,{key:0,overlay:"",variant:"white",size:"sm",label:"Загрузка профиля..."})):x("",!0),i("div",{class:v(["px-8 md:px-16 py-4",[d.value?"fade-seq is-open seq-offset-0":"flex items-center justify-between"]])},[i("div",{class:v(["flex items-center",[d.value?"mb-4":"mb-0 flex-1"]])},[i("div",Y,[i("img",{class:"w-10 h-10 rounded-full object-cover",src:F.value},null,8,Z),(c=r.userStore)!=null&&c.isLoadingProfile?(s(),B(N,{key:0,class:"absolute inset-0",size:"sm",variant:"white"})):x("",!0)]),i("span",ee,w(D.value),1)],2),(y=r.userStore)!=null&&y.isLoadingProfile?(s(),a(b,{key:0},[d.value?(s(),a("div",te,[p(S,{type:"line",width:"w-20",height:"h-6"}),p(S,{type:"line",width:"w-24",height:"h-6"})])):x("",!0),d.value?x("",!0):(s(),a("div",se,[p(S,{type:"line",width:"w-16",height:"h-5"}),p(S,{type:"line",width:"w-12",height:"h-5"})]))],64)):(s(),a(b,{key:1},[d.value?(s(),a("div",ie,[p(q,{class:"whitespace-nowrap"},{default:j(()=>{var h,m;return[$(w(`Токенов: ${((m=(h=r.userStore)==null?void 0:h.profile)==null?void 0:m.tokens)||0}`),1)]}),_:1}),p(q,{class:"whitespace-nowrap"},{default:j(()=>[$(w(M.value),1)]),_:1})])):(s(),a("div",ae,[p(q,{class:"whitespace-nowrap"},{default:j(()=>{var h,m;return[$(w(`Токенов: ${((m=(h=r.userStore)==null?void 0:h.profile)==null?void 0:m.tokens)||0}`),1)]}),_:1}),p(q,{class:"whitespace-nowrap"},{default:j(()=>{var h,m;return[$(w(((m=(h=r.userStore)==null?void 0:h.profile)==null?void 0:m.subscription_type)||"Free"),1)]}),_:1})]))],64)),d.value?(s(),a("div",ne,[(f=r.userStore)!=null&&f.isLoadingProfile?(s(),a(b,{key:0},P(4,h=>i("div",{key:h,class:"flex justify-between"},[p(S,{type:"line",width:"w-24",height:"h-4"}),p(S,{type:"line",width:"w-8",height:"h-4"})])),64)):(s(),a(b,{key:1},[i("div",le,[e[0]||(e[0]=i("span",{class:"opacity-80"},"Пользователь уже:",-1)),i("span",null,w(U.value),1)]),i("div",oe,[e[1]||(e[1]=i("span",{class:"opacity-80"},"Проанализировано снов:",-1)),i("span",null,w(((o=(g=r.userStore)==null?void 0:g.profile)==null?void 0:o.total_dreams_count)||0),1)]),i("div",re,[e[2]||(e[2]=i("span",{class:"opacity-80"},"Глубоких анализов:",-1)),i("span",null,w(((C=(_=r.userStore)==null?void 0:_.profile)==null?void 0:C.deep_analyses_count)||0),1)]),i("div",de,[e[3]||(e[3]=i("span",{class:"opacity-80"},"Приглашено друзей:",-1)),i("span",null,w(((T=(L=r.userStore)==null?void 0:L.profile)==null?void 0:T.invited_friends_count)||0),1)])],64))])):x("",!0)],2),i("div",{class:v(["absolute left-4 right-4 bottom-4 space-y-2 transition-opacity duration-200 ease-out fade-seq is-open seq-offset-320",d.value?"opacity-100":"opacity-0 pointer-events-none"])},[i("button",{class:"w-full bg-white/20 hover:bg-white/30 text-white rounded-xl py-3 font-semibold transition-colors flex items-center justify-center",onClick:R(l,["stop"]),disabled:(A=r.userStore)==null?void 0:A.isLoadingProfile},[(V=r.userStore)!=null&&V.isLoadingProfile?(s(),B(N,{key:0,size:"xs",variant:"white",class:"mr-2"})):x("",!0),e[4]||(e[4]=$(" Сменить тариф ",-1))],8,ue),e[5]||(e[5]=i("button",{class:"w-full bg-white/10 text-white/60 rounded-xl py-3 font-semibold cursor-not-allowed",disabled:""}," Получить токены ",-1))],2)],2)}}}),ye=I(ce,[["__scopeId","data-v-50623370"]]);export{ye as default};

import{d as Ie,r as ae,c as M,a,o as r,b as n,s as ot,w as at,t as Y,F as Q,A as se,M as lt,n as le,m as ct,u as ut,N as dt,e as K,k as Le,C as oe,l as Se,f as Re,D as ft,z as Ne,O as ht,P as pt,j as mt}from"./main-CxKJ7x_A.js";import{c as Te,g as je}from"./_commonjsHelpers-Cpj98o6Y.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Ue={exports:{}},Ve;function Ee(){return Ve||(Ve=1,function(E,re){(function(c,N){E.exports=N()})(Te,function(){var c=1e3,N=6e4,J=36e5,A="millisecond",y="second",L="minute",_="hour",b="day",D="week",z="month",C="quarter",O="year",h="date",i="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(g){var d=["th","st","nd","rd"],l=g%100;return"["+g+(d[(l-20)%10]||d[l]||d[0])+"]"}},U=function(g,d,l){var v=String(g);return!v||v.length>=d?g:""+Array(d+1-v.length).join(l)+g},P={s:U,z:function(g){var d=-g.utcOffset(),l=Math.abs(d),v=Math.floor(l/60),u=l%60;return(d<=0?"+":"-")+U(v,2,"0")+":"+U(u,2,"0")},m:function g(d,l){if(d.date()<l.date())return-g(l,d);var v=12*(l.year()-d.year())+(l.month()-d.month()),u=d.clone().add(v,z),w=l-u<0,x=d.clone().add(v+(w?-1:1),z);return+(-(v+(l-u)/(w?u-x:x-u))||0)},a:function(g){return g<0?Math.ceil(g)||0:Math.floor(g)},p:function(g){return{M:z,y:O,w:D,d:b,D:h,h:_,m:L,s:y,ms:A,Q:C}[g]||String(g||"").toLowerCase().replace(/s$/,"")},u:function(g){return g===void 0}},H="en",S={};S[H]=k;var I="$isDayjsObject",te=function(g){return g instanceof ge||!(!g||!g[I])},G=function g(d,l,v){var u;if(!d)return H;if(typeof d=="string"){var w=d.toLowerCase();S[w]&&(u=w),l&&(S[w]=l,u=w);var x=d.split("-");if(!u&&x.length>1)return g(x[0])}else{var B=d.name;S[B]=d,u=B}return!v&&u&&(H=u),u||!v&&H},W=function(g,d){if(te(g))return g.clone();var l=typeof d=="object"?d:{};return l.date=g,l.args=arguments,new ge(l)},j=P;j.l=G,j.i=te,j.w=function(g,d){return W(g,{locale:d.$L,utc:d.$u,x:d.$x,$offset:d.$offset})};var ge=function(){function g(l){this.$L=G(l.locale,null,!0),this.parse(l),this.$x=this.$x||l.x||{},this[I]=!0}var d=g.prototype;return d.parse=function(l){this.$d=function(v){var u=v.date,w=v.utc;if(u===null)return new Date(NaN);if(j.u(u))return new Date;if(u instanceof Date)return new Date(u);if(typeof u=="string"&&!/Z$/i.test(u)){var x=u.match(p);if(x){var B=x[2]-1||0,R=(x[7]||"0").substring(0,3);return w?new Date(Date.UTC(x[1],B,x[3]||1,x[4]||0,x[5]||0,x[6]||0,R)):new Date(x[1],B,x[3]||1,x[4]||0,x[5]||0,x[6]||0,R)}}return new Date(u)}(l),this.init()},d.init=function(){var l=this.$d;this.$y=l.getFullYear(),this.$M=l.getMonth(),this.$D=l.getDate(),this.$W=l.getDay(),this.$H=l.getHours(),this.$m=l.getMinutes(),this.$s=l.getSeconds(),this.$ms=l.getMilliseconds()},d.$utils=function(){return j},d.isValid=function(){return this.$d.toString()!==i},d.isSame=function(l,v){var u=W(l);return this.startOf(v)<=u&&u<=this.endOf(v)},d.isAfter=function(l,v){return W(l)<this.startOf(v)},d.isBefore=function(l,v){return this.endOf(v)<W(l)},d.$g=function(l,v,u){return j.u(l)?this[v]:this.set(u,l)},d.unix=function(){return Math.floor(this.valueOf()/1e3)},d.valueOf=function(){return this.$d.getTime()},d.startOf=function(l,v){var u=this,w=!!j.u(v)||v,x=j.p(l),B=function(me,ie){var ue=j.w(u.$u?Date.UTC(u.$y,ie,me):new Date(u.$y,ie,me),u);return w?ue:ue.endOf(b)},R=function(me,ie){return j.w(u.toDate()[me].apply(u.toDate("s"),(w?[0,0,0,0]:[23,59,59,999]).slice(ie)),u)},q=this.$W,ee=this.$M,ne=this.$D,ye="set"+(this.$u?"UTC":"");switch(x){case O:return w?B(1,0):B(31,11);case z:return w?B(1,ee):B(0,ee+1);case D:var pe=this.$locale().weekStart||0,xe=(q<pe?q+7:q)-pe;return B(w?ne-xe:ne+(6-xe),ee);case b:case h:return R(ye+"Hours",0);case _:return R(ye+"Minutes",1);case L:return R(ye+"Seconds",2);case y:return R(ye+"Milliseconds",3);default:return this.clone()}},d.endOf=function(l){return this.startOf(l,!1)},d.$set=function(l,v){var u,w=j.p(l),x="set"+(this.$u?"UTC":""),B=(u={},u[b]=x+"Date",u[h]=x+"Date",u[z]=x+"Month",u[O]=x+"FullYear",u[_]=x+"Hours",u[L]=x+"Minutes",u[y]=x+"Seconds",u[A]=x+"Milliseconds",u)[w],R=w===b?this.$D+(v-this.$W):v;if(w===z||w===O){var q=this.clone().set(h,1);q.$d[B](R),q.init(),this.$d=q.set(h,Math.min(this.$D,q.daysInMonth())).$d}else B&&this.$d[B](R);return this.init(),this},d.set=function(l,v){return this.clone().$set(l,v)},d.get=function(l){return this[j.p(l)]()},d.add=function(l,v){var u,w=this;l=Number(l);var x=j.p(v),B=function(ee){var ne=W(w);return j.w(ne.date(ne.date()+Math.round(ee*l)),w)};if(x===z)return this.set(z,this.$M+l);if(x===O)return this.set(O,this.$y+l);if(x===b)return B(1);if(x===D)return B(7);var R=(u={},u[L]=N,u[_]=J,u[y]=c,u)[x]||1,q=this.$d.getTime()+l*R;return j.w(q,this)},d.subtract=function(l,v){return this.add(-1*l,v)},d.format=function(l){var v=this,u=this.$locale();if(!this.isValid())return u.invalidDate||i;var w=l||"YYYY-MM-DDTHH:mm:ssZ",x=j.z(this),B=this.$H,R=this.$m,q=this.$M,ee=u.weekdays,ne=u.months,ye=u.meridiem,pe=function(ie,ue,de,we){return ie&&(ie[ue]||ie(v,w))||de[ue].slice(0,we)},xe=function(ie){return j.s(B%12||12,ie,"0")},me=ye||function(ie,ue,de){var we=ie<12?"AM":"PM";return de?we.toLowerCase():we};return w.replace(m,function(ie,ue){return ue||function(de){switch(de){case"YY":return String(v.$y).slice(-2);case"YYYY":return j.s(v.$y,4,"0");case"M":return q+1;case"MM":return j.s(q+1,2,"0");case"MMM":return pe(u.monthsShort,q,ne,3);case"MMMM":return pe(ne,q);case"D":return v.$D;case"DD":return j.s(v.$D,2,"0");case"d":return String(v.$W);case"dd":return pe(u.weekdaysMin,v.$W,ee,2);case"ddd":return pe(u.weekdaysShort,v.$W,ee,3);case"dddd":return ee[v.$W];case"H":return String(B);case"HH":return j.s(B,2,"0");case"h":return xe(1);case"hh":return xe(2);case"a":return me(B,R,!0);case"A":return me(B,R,!1);case"m":return String(R);case"mm":return j.s(R,2,"0");case"s":return String(v.$s);case"ss":return j.s(v.$s,2,"0");case"SSS":return j.s(v.$ms,3,"0");case"Z":return x}return null}(ie)||x.replace(":","")})},d.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},d.diff=function(l,v,u){var w,x=this,B=j.p(v),R=W(l),q=(R.utcOffset()-this.utcOffset())*N,ee=this-R,ne=function(){return j.m(x,R)};switch(B){case O:w=ne()/12;break;case z:w=ne();break;case C:w=ne()/3;break;case D:w=(ee-q)/6048e5;break;case b:w=(ee-q)/864e5;break;case _:w=ee/J;break;case L:w=ee/N;break;case y:w=ee/c;break;default:w=ee}return u?w:j.a(w)},d.daysInMonth=function(){return this.endOf(z).$D},d.$locale=function(){return S[this.$L]},d.locale=function(l,v){if(!l)return this.$L;var u=this.clone(),w=G(l,v,!0);return w&&(u.$L=w),u},d.clone=function(){return j.w(this.$d,this)},d.toDate=function(){return new Date(this.valueOf())},d.toJSON=function(){return this.isValid()?this.toISOString():null},d.toISOString=function(){return this.$d.toISOString()},d.toString=function(){return this.$d.toUTCString()},g}(),Me=ge.prototype;return W.prototype=Me,[["$ms",A],["$s",y],["$m",L],["$H",_],["$W",b],["$M",z],["$y",O],["$D",h]].forEach(function(g){Me[g[1]]=function(d){return this.$g(d,g[0],g[1])}}),W.extend=function(g,d){return g.$i||(g(d,ge,W),g.$i=!0),W},W.locale=G,W.isDayjs=te,W.unix=function(g){return W(1e3*g)},W.en=S[H],W.Ls=S,W.p={},W})}(Ue)),Ue.exports}var vt=Ee();const be=je(vt);var Je={exports:{}};(function(E,re){(function(c,N){E.exports=N()})(Te,function(){return function(c,N,J){c=c||{};var A=N.prototype,y={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function L(b,D,z,C){return A.fromToBase(b,D,z,C)}J.en.relativeTime=y,A.fromToBase=function(b,D,z,C,O){for(var h,i,p,m=z.$locale().relativeTime||y,k=c.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],U=k.length,P=0;P<U;P+=1){var H=k[P];H.d&&(h=C?J(b).diff(z,H.d,!0):z.diff(b,H.d,!0));var S=(c.rounding||Math.round)(Math.abs(h));if(p=h>0,S<=H.r||!H.r){S<=1&&P>0&&(H=k[P-1]);var I=m[H.l];O&&(S=O(""+S)),i=typeof I=="string"?I.replace("%d",S):I(S,D,H.l,p);break}}if(D)return i;var te=p?m.future:m.past;return typeof te=="function"?te(i):te.replace("%s",i)},A.to=function(b,D){return L(b,D,this,!0)},A.from=function(b,D){return L(b,D,this)};var _=function(b){return b.$u?J.utc():J()};A.toNow=function(b){return this.to(_(this),b)},A.fromNow=function(b){return this.from(_(this),b)}}})})(Je);var yt=Je.exports;const gt=je(yt);var qe={exports:{}};(function(E,re){(function(c,N){E.exports=N()})(Te,function(){var c="minute",N=/[+-]\d\d(?::?\d\d)?/g,J=/([+-]|\d\d)/g;return function(A,y,L){var _=y.prototype;L.utc=function(i){var p={date:i,utc:!0,args:arguments};return new y(p)},_.utc=function(i){var p=L(this.toDate(),{locale:this.$L,utc:!0});return i?p.add(this.utcOffset(),c):p},_.local=function(){return L(this.toDate(),{locale:this.$L,utc:!1})};var b=_.parse;_.parse=function(i){i.utc&&(this.$u=!0),this.$utils().u(i.$offset)||(this.$offset=i.$offset),b.call(this,i)};var D=_.init;_.init=function(){if(this.$u){var i=this.$d;this.$y=i.getUTCFullYear(),this.$M=i.getUTCMonth(),this.$D=i.getUTCDate(),this.$W=i.getUTCDay(),this.$H=i.getUTCHours(),this.$m=i.getUTCMinutes(),this.$s=i.getUTCSeconds(),this.$ms=i.getUTCMilliseconds()}else D.call(this)};var z=_.utcOffset;_.utcOffset=function(i,p){var m=this.$utils().u;if(m(i))return this.$u?0:m(this.$offset)?z.call(this):this.$offset;if(typeof i=="string"&&(i=function(H){H===void 0&&(H="");var S=H.match(N);if(!S)return null;var I=(""+S[0]).match(J)||["-",0,0],te=I[0],G=60*+I[1]+ +I[2];return G===0?0:te==="+"?G:-G}(i),i===null))return this;var k=Math.abs(i)<=16?60*i:i;if(k===0)return this.utc(p);var U=this.clone();if(p)return U.$offset=k,U.$u=!1,U;var P=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(U=this.local().add(k+P,c)).$offset=k,U.$x.$localOffset=P,U};var C=_.format;_.format=function(i){var p=i||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return C.call(this,p)},_.valueOf=function(){var i=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*i},_.isUTC=function(){return!!this.$u},_.toISOString=function(){return this.toDate().toISOString()},_.toString=function(){return this.toDate().toUTCString()};var O=_.toDate;_.toDate=function(i){return i==="s"&&this.$offset?L(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():O.call(this)};var h=_.diff;_.diff=function(i,p,m){if(i&&this.$u===i.$u)return h.call(this,i,p,m);var k=this.local(),U=L(i).local();return h.call(k,U,p,m)}}})})(qe);var xt=qe.exports;const _t=je(xt);var Xe={exports:{}};(function(E,re){(function(c,N){E.exports=N()})(Te,function(){var c={year:0,month:1,day:2,hour:3,minute:4,second:5},N={};return function(J,A,y){var L,_=function(C,O,h){h===void 0&&(h={});var i=new Date(C),p=function(m,k){k===void 0&&(k={});var U=k.timeZoneName||"short",P=m+"|"+U,H=N[P];return H||(H=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:m,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:U}),N[P]=H),H}(O,h);return p.formatToParts(i)},b=function(C,O){for(var h=_(C,O),i=[],p=0;p<h.length;p+=1){var m=h[p],k=m.type,U=m.value,P=c[k];P>=0&&(i[P]=parseInt(U,10))}var H=i[3],S=H===24?0:H,I=i[0]+"-"+i[1]+"-"+i[2]+" "+S+":"+i[4]+":"+i[5]+":000",te=+C;return(y.utc(I).valueOf()-(te-=te%1e3))/6e4},D=A.prototype;D.tz=function(C,O){C===void 0&&(C=L);var h,i=this.utcOffset(),p=this.toDate(),m=p.toLocaleString("en-US",{timeZone:C}),k=Math.round((p-new Date(m))/1e3/60),U=15*-Math.round(p.getTimezoneOffset()/15)-k;if(!Number(U))h=this.utcOffset(0,O);else if(h=y(m,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(U,!0),O){var P=h.utcOffset();h=h.add(i-P,"minute")}return h.$x.$timezone=C,h},D.offsetName=function(C){var O=this.$x.$timezone||y.tz.guess(),h=_(this.valueOf(),O,{timeZoneName:C}).find(function(i){return i.type.toLowerCase()==="timezonename"});return h&&h.value};var z=D.startOf;D.startOf=function(C,O){if(!this.$x||!this.$x.$timezone)return z.call(this,C,O);var h=y(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return z.call(h,C,O).tz(this.$x.$timezone,!0)},y.tz=function(C,O,h){var i=h&&O,p=h||O||L,m=b(+y(),p);if(typeof C!="string")return y(C).tz(p);var k=function(S,I,te){var G=S-60*I*1e3,W=b(G,te);if(I===W)return[G,I];var j=b(G-=60*(W-I)*1e3,te);return W===j?[G,W]:[S-60*Math.min(W,j)*1e3,Math.max(W,j)]}(y.utc(C,i).valueOf(),m,p),U=k[0],P=k[1],H=y(U).utcOffset(P);return H.$x.$timezone=p,H},y.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},y.tz.setDefault=function(C){L=C}}})})(Xe);var bt=Xe.exports;const wt=je(bt);var $t={exports:{}};(function(E,re){(function(c,N){E.exports=N(Ee())})(Te,function(c){function N(h){return h&&typeof h=="object"&&"default"in h?h:{default:h}}var J=N(c),A="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),y="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),L="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),_="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),b=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function D(h,i,p){var m,k;return p==="m"?i?"минута":"минуту":h+" "+(m=+h,k={mm:i?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[p].split("_"),m%10==1&&m%100!=11?k[0]:m%10>=2&&m%10<=4&&(m%100<10||m%100>=20)?k[1]:k[2])}var z=function(h,i){return b.test(i)?A[h.month()]:y[h.month()]};z.s=y,z.f=A;var C=function(h,i){return b.test(i)?L[h.month()]:_[h.month()]};C.s=_,C.f=L;var O={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:z,monthsShort:C,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:D,mm:D,h:"час",hh:D,d:"день",dd:D,M:"месяц",MM:D,y:"год",yy:D},ordinal:function(h){return h},meridiem:function(h){return h<4?"ночи":h<12?"утра":h<17?"дня":"вечера"}};return J.default.locale(O,null,!0),O})})($t);const kt={class:"dynamics-chart-container"},Mt={class:"text-sm font-semibold mb-2 flex items-center justify-between"},Dt={class:"text-xs opacity-70"},St={class:"chart-svg-container"},Ct={class:"chart-svg-wrapper"},Tt=["viewBox"],Ot=["y1","y2"],Ht=["points"],Lt=["cx","cy"],jt={class:"mt-3 text-xs opacity-80 leading-relaxed"},Yt={class:"pagination-dots"},At=["onClick"],He=300,ke=80,zt=Ie({__name:"DynamicsChart",props:{dynamics:{}},setup(E){const re=E,c=ae(0),N=ae(0),J=ae(0),A=ae("slide-left"),y=M(()=>re.dynamics[c.value]||{metric:"",values:[],interpretation:""}),L=M(()=>y.value.values||[]),_=M(()=>{const i=L.value;if(i.length===0)return[];const p=He/Math.max(1,i.length-1);return i.map((m,k)=>({x:k*p,y:ke-m/10*ke}))}),b=M(()=>_.value.map(i=>`${i.x},${i.y}`).join(" "));function D(i){N.value=i.touches[0].clientX}function z(i){J.value=i.touches[0].clientX}function C(){const i=N.value-J.value;Math.abs(i)>50&&(i>0&&c.value<re.dynamics.length-1?(A.value="slide-left",c.value++,h()):i<0&&c.value>0&&(A.value="slide-right",c.value--,h())),N.value=0,J.value=0}function O(i){i!==c.value&&(A.value=i>c.value?"slide-left":"slide-right",c.value=i,h())}function h(){window.triggerHaptic&&window.triggerHaptic("light")}return(i,p)=>(r(),a("div",kt,[n("div",{class:"chart-wrapper",onTouchstart:D,onTouchmove:z,onTouchend:C},[ot(lt,{name:A.value,mode:"out-in"},{default:at(()=>[(r(),a("div",{key:c.value,class:"chart-content"},[n("div",Mt,[n("span",null,Y(y.value.metric),1),n("span",Dt,Y(L.value[L.value.length-1])+"/10",1)]),n("div",St,[p[0]||(p[0]=n("div",{class:"y-axis-labels"},[n("span",{class:"y-label"},"10"),n("span",{class:"y-label"},"5"),n("span",{class:"y-label"},"0")],-1)),n("div",Ct,[(r(),a("svg",{viewBox:`0 0 ${He} ${ke}`,width:He,height:ke,class:"chart-svg",preserveAspectRatio:"none"},[(r(),a(Q,null,se(3,m=>n("line",{key:`grid-${m}`,x1:0,x2:He,y1:ke/2*(m-1),y2:ke/2*(m-1),stroke:"white","stroke-opacity":"0.15","stroke-width":"1"},null,8,Ot)),64)),n("polyline",{points:b.value,fill:"none",stroke:"white","stroke-width":"2.5","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Ht),(r(!0),a(Q,null,se(_.value,(m,k)=>(r(),a("circle",{key:`point-${k}`,cx:m.x,cy:m.y,r:"4",fill:"white"},null,8,Lt))),128))],8,Tt))])]),n("div",jt,Y(y.value.interpretation),1)]))]),_:1},8,["name"])],32),n("div",Yt,[(r(!0),a(Q,null,se(E.dynamics,(m,k)=>(r(),a("button",{key:`dot-${k}`,class:le(["dot",{active:k===c.value}]),onClick:U=>O(k)},null,10,At))),128))])]))}}),Ft=Be(zt,[["__scopeId","data-v-1a6d8a07"]]),Nt={class:"flex justify-between items-center py-2 min-h-[2.5rem]"},Ut={class:"truncate"},It={class:"bg-white/10 rounded-full px-2 py-1 text-sm min-w-[3rem] text-center whitespace-nowrap"},Bt={key:0,class:"mt-4 space-y-4 text-sm fade-seq is-open"},Wt={key:0,class:"flex flex-wrap gap-2"},Pt={key:1,class:"rounded-lg bg-white/10"},Rt={class:"px-3 py-2 font-semibold flex items-center gap-2 flex-wrap"},Vt={class:"px-3 pb-3 text-white/90 leading-snug"},Zt={key:0,class:"space-y-3"},Et={key:0,class:"space-y-2"},Jt={key:0,class:"space-y-1"},qt={class:"text-xs opacity-80"},Xt={key:1,class:"space-y-1"},Gt={class:"text-xs opacity-80"},Kt={key:2,class:"space-y-1"},Qt={class:"text-xs opacity-80"},es=["innerHTML"],ts={key:2,class:"pt-2 space-y-2"},ss={class:"flex items-center justify-between"},ns={class:"font-medium text-xs"},is={class:"text-xs opacity-70"},rs={class:"text-xs opacity-80"},os={key:3,class:"pt-2"},as={class:"flex flex-wrap gap-2"},ls={key:1},cs={key:1,class:"space-y-3"},us={class:"text-xs opacity-80 flex justify-between"},ds=["viewBox"],fs=["points","stroke-opacity"],hs=["cx","cy","fill-opacity"],ps=["x2","y1","y2"],ms={class:"text-xs opacity-70"},vs={key:2,class:"text-xs opacity-80"},ys={key:2,class:"space-y-2"},gs={class:"flex items-start gap-2"},xs={class:"inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/20 text-xs font-semibold shrink-0 mt-0.5"},_s={class:"text-xs opacity-90 leading-relaxed"},bs={key:3,class:"space-y-3"},ws={class:"flex items-start gap-2"},$s={class:"inline-flex items-center justify-center w-5 h-5 rounded-full bg-white/25 text-xs font-semibold shrink-0"},ks={class:"space-y-1"},Ms={class:"font-semibold text-xs"},Ds={class:"text-xs opacity-85 leading-relaxed"},Ss={class:"text-xs opacity-70 leading-relaxed italic"},Cs={class:"rounded-lg bg-white/10 border-l-4 border-pink-400"},Ts={class:"px-3 pb-3 text-white/90 leading-snug"},Os={class:"mt-2 flex justify-end"},Hs={class:"space-y-2"},Ls=["onClick"],js={class:"opacity-80 inline-block",style:{fontSize:"130%"}},Ys={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},As=["innerHTML"],zs={key:0,class:"space-y-2"},Fs={class:"flex justify-between text-xs opacity-80"},Ns={class:"relative h-2 w-full bg-white/10 rounded overflow-hidden"},Us={class:"pt-2 text-xs opacity-80 flex flex-wrap items-center gap-4"},Is={class:"inline-flex items-center gap-2"},Bs={class:"mt-4 flex gap-2"},Ws={key:3,class:"mt-3 text-xs bg-black/20 rounded-lg p-2 font-mono whitespace-pre-wrap break-words"},Ps={class:"mt-2 flex justify-end"},Rs={key:0,class:"space-y-3"},Vs={class:"grid grid-cols-2 gap-2"},Zs=["onClick"],Es={class:"flex justify-end gap-2 pt-2"},Js=["disabled"],qs={key:1,class:"space-y-3"},Xs={class:"grid grid-cols-2 gap-2"},Gs={class:"flex justify-end gap-2 pt-2"},Ks=["disabled"],Ce=48,Qs=Ie({__name:"DreamCard",props:{dream:{},active:{type:Boolean}},emits:["toggle"],setup(E,{emit:re}){be.extend(gt),be.locale("ru"),be.extend(_t),be.extend(wt);const c=E,N=re,J=()=>{N("toggle"),window.triggerHaptic&&window.triggerHaptic("light")},A=ct(),y=ut(),L=ae(!0),_=M(()=>{var e;return!!((e=c.dream)!=null&&e.is_deep_analysis)}),b=M({get:()=>{var e,t,s;return((e=c.dream)==null?void 0:e.user_feedback)??((s=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:s.user_feedback)??0},set:e=>{c.dream&&(c.dream.user_feedback=e,c.dream.deep_source||(c.dream.deep_source={}),c.dream.deep_source.user_feedback=e)}}),D={like:!1,dislike:!1,delete:!1},z=async e=>{if(D.like||D.dislike)return;const t=e===1?b.value===1?0:1:b.value===2?0:2,s=b.value;b.value=t;try{window.triggerHaptic&&window.triggerHaptic("medium"),e===1?D.like=!0:D.dislike=!0,await Ne.postAnalysisFeedback(c.dream.id,t),t===0?y.info("Оценка снята"):t===1?y.success("Добавлено: нравится"):t===2&&y.success("Добавлено: не нравится")}catch(o){b.value=s,console.error("Feedback error",o),y.error("Не удалось сохранить оценку")}finally{D.like=D.dislike=!1}},C=()=>z(1),O=()=>z(2),h=async()=>{var s;if(D.delete)return;const e=(s=window.Telegram)==null?void 0:s.WebApp;if(await new Promise(o=>{e!=null&&e.showPopup?e.showPopup({title:"Удалить запись?",message:"Действие необратимо",buttons:[{id:"yes",type:"destructive",text:"Удалить"},{id:"no",type:"cancel",text:"Отмена"}]},f=>o(f==="yes")):o(window.confirm("Удалить запись?"))}))try{D.delete=!0,window.triggerHaptic&&window.triggerHaptic("heavy"),await Ne.deleteAnalysis(c.dream.id);const o=A.history.findIndex(f=>f.id===c.dream.id);o>-1&&A.history.splice(o,1),A.fetchProfile(),y.success("Запись удалена")}catch(o){console.error("Delete error",o),y.error("Не удалось удалить запись")}finally{D.delete=!1}},i=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]);function p(e){return e.replace(/\s+/g," ").trim().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function m(e){if(!e)return"";const t=String(e).split(/[.!?\n]/)[0],o=t.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(f=>f&&!i.has(f)&&f.length>3).slice(0,3);return o.length===0?t.slice(0,40):p(o.join(" "))}function k(e){if(!e)return"";let t=String(e).toLowerCase().replace(/["'«»]/g,"").trim();t=t.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),t=t.replace(/\s+/g," ").trim();const s=t.split(" ").filter(Boolean).slice(0,3);return s.length?s.join(" "):""}function U(e){if(!e)return"";const t=String(e).toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}const P=M(()=>{var $,F,T,V,X;const e=k((F=($=c.dream)==null?void 0:$.deep_source)==null?void 0:F.title);if(e)return U(e);const t=(((V=(T=c.dream)==null?void 0:T.deep_source)==null?void 0:V.tags)||[]).filter(Boolean),s=fe=>{var he;let ce=String(fe||"").trim();return ce=((he=ce.split(/[\\/,(;:—–-]/)[0])==null?void 0:he.trim())||"",ce?ce.charAt(0).toUpperCase()+ce.slice(1).toLowerCase():""},o=t.map(s).filter(Boolean);if(o.length){const fe=o.slice(0,2).join(" и ");return U(fe||"Без названия")}const f=k(m((X=c.dream)==null?void 0:X.dream_text));return U(f||"Без названия")}),H=M(()=>{var s,o;const e=(o=(s=c.dream)==null?void 0:s.deep_source)==null?void 0:o.tags;if(!Array.isArray(e))return[];const t=f=>{var F;let $=String(f||"").trim();return $=((F=$.split(/[\\/,(;:—–-]/)[0])==null?void 0:F.trim())||"",$?$.charAt(0).toUpperCase()+$.slice(1).toLowerCase():""};return e.map(t).filter(Boolean).slice(0,5)});function S(e){return String(e||"").replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").replace(/\(\s*\d+\s*\)/g,"").replace(/\s\[\s*\d+\s*\]/g,"").replace(/[\u00B9\u00B2\u00B3\u2070-\u2079]/g,"")}const I=ae("context"),te=M(()=>{var e;return S(((e=c.dream)==null?void 0:e.analysis)||"")}),G=M(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.overallContext)||{}}),W=M(()=>{const e=G.value;return!!(e!=null&&e.narrative||e!=null&&e.psychologicalFunction||e!=null&&e.emotionalJourney)}),j=M(()=>{var t,s;const e=(s=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:s.recurringSymbols;return Array.isArray(e)?e:[]}),ge=M(()=>{var t,s;const e=(s=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:s.dynamics;return Array.isArray(e)&&e.length>0?e:[]}),Me=M(()=>ge.value.length>0),g=M(()=>{var t,s;const e=(s=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:s.conclusions;return Array.isArray(e)&&e.length>0?e:[]}),d=M(()=>g.value.length>0),l=M(()=>{var F,T;const e=(T=(F=c.dream)==null?void 0:F.deep_source)==null?void 0:T.recommendations;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="object")return e;if(Array.isArray(e)&&e.length>0)return e.map((V,X)=>({title:`Рекомендация ${X+1}`,description:String(V),rationale:""}));const t=R.value;if(t.length===0)return[];const s=[0,0,0,0];for(const V of t)for(let X=0;X<4;X++)s[X]+=V[X];const o=Math.max(1,t.length);for(let V=0;V<4;V++)s[V]=Math.round(s[V]/o);const f=[["Персонажи","Обрати внимание на отношения и роли; практикуй честную коммуникацию."],["Эмоции","Добавь ежедневную регуляцию эмоций (дыхание, дневник, прогулка)."],["Действия","Определи 1 маленький шаг на неделю и заверши его."],["Сцены","Проверь границы и режим: место/время, где тебе спокойнее."]],$=s.map((V,X)=>({i:X,v:V})).sort((V,X)=>X.v-V.v).map(V=>V.i);return[{title:f[$[0]][0],description:f[$[0]][1],rationale:""},{title:f[$[1]][0],description:f[$[1]][1],rationale:""}]}),v=M(()=>l.value.length>0);function u(e,t){var s;try{let o=e;const f=Array.from(new Set((t||[]).filter(Boolean))).sort(($,F)=>F.length-$.length);for(const $ of f){const F=(s=String($).split(/[\\/,(;:—–-]/)[0])==null?void 0:s.trim();if(!F)continue;const T=new RegExp(`(\b${F.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\b)`,"gi");o=o.replace(T,'<mark class="bg-white/20 px-1 rounded">$1</mark>')}return o.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1")}catch{return e}}const w=M(()=>{var e,t;return u(te.value,((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.tags)||[])});function x(e){try{return new Date(e).getTime()||0}catch{return 0}}const B=M(()=>(A.history||[]).filter(e=>{var t;return!e.is_deep_analysis&&((t=e==null?void 0:e.deep_source)==null?void 0:t.hvdc)&&(e==null?void 0:e.created_at)}).sort((e,t)=>x(e.created_at)>x(t.created_at)?-1:1)),R=M(()=>{var o;const e=x(((o=c.dream)==null?void 0:o.created_at)||""),t=B.value.filter(f=>!_.value||(e?x(f.created_at)<=e:!0)).slice(0,5).reverse(),s=["characters","emotions","actions","settings"];return t.map(f=>s.map($=>{var F,T;return Number(((T=(F=f.deep_source.hvdc)==null?void 0:F.distribution)==null?void 0:T[$])||0)}))}),q=M(()=>R.value.length),ee=M(()=>q.value>=2),ne=M(()=>Math.max(60,(q.value-1)*28+8));function ye(e){const t=e.length,s=ne.value,o=Ce,f=t>1?(s-8)/(t-1):0,$=[];for(let T=0;T<t;T++){const V=T*f,X=o-Math.round(e[T]/100*o);$.push({x:V,y:X})}return{str:$.map(T=>`${T.x},${T.y}`).join(" "),pts:$}}const pe=M(()=>{const e=[{key:"characters",label:"Персонажи",idx:0,opacity:.95},{key:"emotions",label:"Эмоции",idx:1,opacity:.75},{key:"actions",label:"Действия",idx:2,opacity:.55},{key:"settings",label:"Сцены",idx:3,opacity:.35}],t=[],s=R.value;for(const o of e){const f=s.map(T=>T[o.idx]),{str:$,pts:F}=ye(f);t.push({key:o.key,label:o.label,values:f,points:$,pointList:F,opacity:o.opacity})}return t});function xe(e){try{const t=String(e||"").toLowerCase(),s=_e=>_e.reduce((Fe,rt)=>Fe+(t.includes(rt)?1:0),0),o=["страх","ужас","паник","тревог","стыд","гнев","плак","слез","кошмар","тоска","грусть"],f=["экзам","выступл","собесед","защит","проект","подготов","завтра","ожидан","волнен","поездк","путешеств","нов","интервью"],$=["вчера","сегодня","работ","школ","универ","дом","улиц","друг","родител","коллег","город"],F=s(o),T=s(f),V=s($);let X=F>0?Math.min(1,F/3):0,fe=T>0?Math.min(1,T/3):0,ce=V>0?Math.min(1,.5+V/5):0;X===0&&fe===0&&ce===0&&(ce=.6,X=.2,fe=.2);const he={schema:"dream_type_v1",scores:{memory:+ce.toFixed(2),emotion:+X.toFixed(2),anticipation:+fe.toFixed(2)}},Z=[["memory",he.scores.memory],["emotion",he.scores.emotion],["anticipation",he.scores.anticipation]];Z.sort((_e,Fe)=>Fe[1]-_e[1]);const ve=+Math.max(0,Z[0][1]-Z[1][1]).toFixed(2);return{...he,dominant:Z[0][0],confidence:ve}}catch{return null}}const me=M(()=>{var e,t,s;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.dream_type)||xe((s=c.dream)==null?void 0:s.dream_text)||null});function ie(){const e=me.value;if(!e||!e.dominant)return['<div class="space-y-2">','<div class="font-semibold">🛠 Небольшая работа со сном</div>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Заметь:</span> Какие 2–3 образа из сна самые сильные? Запиши их коротко.</li>','<li><span class="font-semibold">Шаг:</span> Выбери один маленький шаг в реальности, который поддержит тебя по теме сна.</li>',"</ol>","</div>"].join("");const t=String(e.dominant).toLowerCase();return t==="memory"?['<div class="space-y-2">','<div class="font-semibold">🌙 Сон-Память</div>','<p class="opacity-90">Переработка недавнего опыта, соединение нового с прошлым.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Отрази:</span> Вспомни, что происходило последние 1–2 дня. Какие события могли попасть в сон?</li>','<li><span class="font-semibold">Соедини:</span> Отметь, какие элементы сна перекликаются с реальностью — это завершает «архивацию» опыта.</li>',"</ol>","</div>"].join(""):t==="emotion"?['<div class="space-y-2">','<div class="font-semibold">⚡️ Сон-Эмоция</div>','<p class="opacity-90">Проживание и нейтрализация сильных чувств.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Почувствуй:</span> Определи, какая эмоция была самой сильной во сне. Где она чувствуется в теле сейчас?</li>','<li><span class="font-semibold">Услышь:</span> Представь, что главный персонаж сна говорит тебе что-то. Что он хочет, чтобы ты понял?</li>',"</ol>","</div>"].join(""):['<div class="space-y-2">','<div class="font-semibold">🔮 Сон-Предвосхищение</div>','<p class="opacity-90">Тренировка будущих ситуаций и реакций.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Представь:</span> Как бы ты хотел повести себя, если бы это произошло в реальности?</li>','<li><span class="font-semibold">Расшифруй:</span> Какой символ кажется ключевым? Что он может говорить о твоих страхах или намерениях?</li>',"</ol>","</div>"].join("")}const ue=M(()=>{var fe,ce,he;const e=S(((fe=c.dream)==null?void 0:fe.analysis)||"");if(!e)return[];const t={arch:{key:"arch",title:"Архетипическая история",text:""},func:{key:"func",title:"Возможная функция сна",text:""},freud:{key:"freud",title:"По Фрейду",text:""},jung:{key:"jung",title:"По Юнгу",text:""}},s=[],o=/\*\*([^*]+)\*\*/g;let f;for(;f=o.exec(e);)s.push({title:f[1].trim(),start:f.index,end:f.index+f[0].length});const $=((ce=s[0])==null?void 0:ce.start)??e.length;t.arch.text=e.slice(0,$).trim();for(let Z=0;Z<s.length;Z++){const ve=s[Z].title.toLowerCase(),_e=e.slice(s[Z].end,((he=s[Z+1])==null?void 0:he.start)??e.length).trim();ve.includes("возможная функция")?t.func.text=_e:ve.includes("по фрейду")?t.freud.text=_e:ve.includes("по юнгу")&&(t.jung.text=_e)}const F=Z=>Z.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1"),T=Object.values(t).map(Z=>({...Z,html:F(Z.text||"")}));T.some(Z=>Z.key==="func")||T.push({key:"func",title:"Возможная функция сна",text:"",html:""});const V=T.findIndex(Z=>Z.key==="arch");V!==-1&&T.splice(V+1,0,{key:"hvdc",title:"Контент анализ",text:"",html:""});const X=ie();if(X){const Z=T.findIndex(ve=>ve.key==="func");if(Z!==-1){const ve=['<div class="mt-3 pt-2 border-t border-white/10 space-y-1">','<div class="font-semibold">Функциональное упражнение</div>',X,"</div>"].join("");T[Z].html=(T[Z].html||"")+ve}}return T}),de=dt({arch:!0,hvdc:!1,func:!1,freud:!1,jung:!1});function we(e){de[e]=!de[e]}const We=M(()=>{try{return new URLSearchParams(window.location.search).get("debug")==="1"||localStorage.getItem("da_debug")==="1"}catch{return!1}});function Ge(){var e,t,s,o,f;try{const $=JSON.stringify(Ye.value,null,2);(e=navigator.clipboard)==null||e.writeText($),(t=y==null?void 0:y.success)==null||t.call(y,"Скопировано")}catch{try{(f=(o=(s=window.Telegram)==null?void 0:s.WebApp)==null?void 0:o.showPopup)==null||f.call(o,{title:"Debug",message:"Скопируйте из блока ниже вручную",buttons:[{id:"ok",type:"default",text:"OK"}]})}catch{}}}function Ke(e){var s;let t=String(e||"").trim();return t=((s=t.split(/[\\/,(;:—–-]/)[0])==null?void 0:s.trim())||"",t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}const Ye=M(()=>{var s,o,f,$;if(!We.value)return null;const e=c.dream||{},t=Array.isArray((s=e==null?void 0:e.deep_source)==null?void 0:s.tags)?e.deep_source.tags:[];return{id:e.id,created_at:e.created_at,is_deep_analysis:!!e.is_deep_analysis,title_raw:((o=e==null?void 0:e.deep_source)==null?void 0:o.title)||null,tags_raw:t,tags_norm:t.map(Ke),dream_type:((f=e==null?void 0:e.deep_source)==null?void 0:f.dream_type)||null,hvdc_present:!!(($=e==null?void 0:e.deep_source)!=null&&$.hvdc)}}),Ae=ae(!1),Pe=ae(1),Qe=["0-20","20-30","30-40","40-50","50+"],Oe=ae(""),$e=ae("");function ze(){Ae.value=!1}async function et(){try{await Ne.setDemographics(Oe.value,$e.value);try{await A.fetchProfile()}catch{}y.success("Готово! Дальнейшие анализы будут учитывать эти данные"),Ae.value=!1}catch{y.error("Не удалось сохранить")}}M(()=>{const e=A.profile||{};return!!(e.age_range&&e.gender)});const De=M(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.hvdc)||null}),tt=M(()=>{var f,$,F;const e=[{key:"characters",label:"Персонажи"},{key:"emotions",label:"Эмоции"},{key:"actions",label:"Действия"},{key:"settings",label:"Сцены"}],t=((f=De.value)==null?void 0:f.distribution)||{},s=(($=De.value)==null?void 0:$.norm)||null,o=((F=De.value)==null?void 0:F.comparison)||null;return e.map(T=>({key:T.key,label:T.label,value:Number(t[T.key]??0),norm:s?Number(s[T.key]??0):null,delta:o?Number(o[T.key]??0):null}))}),st=M(()=>{var F;const e=((F=De.value)==null?void 0:F.norm_group)||null;if(!e)return"общая статистика";const t=String(e.gender||"").toLowerCase(),s=t==="male"?"муж.":t==="female"?"жен.":"",o=e.age_range||"",f=o?`${o} лет`:"",$=[s,f].filter(Boolean).join(" ");return $?`общая статистика* для ${$}`:"общая статистика"}),nt=M(()=>{if(!c.dream.created_at)return"";try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone||be.tz.guess(),t=be.utc(c.dream.created_at).tz(e).startOf("day"),o=be().tz(e).startOf("day").diff(t,"day"),f=Math.floor(o/7),$=Math.floor(o/30),F=Math.floor(o/365);return o===0?"сегодня":o===1?"вчера":o<7?`${o} д`:o<30?`${f} н`:o<365?`${$} м`:`${F} г`}catch{return c.dream.created_at}}),it=M(()=>{var e;return(e=c.dream)!=null&&e.is_deep_analysis?"from-[#9C41FF] to-[#C03AFF]":"from-[#4A58FF] to-[#5664FF]"});return(e,t)=>(r(),a("article",{class:le(["rounded-xl bg-gradient-to-br text-white px-8 md:px-16 transition-all overflow-hidden cursor-pointer py-6",[E.active?"":"min-h-[4.5rem]",it.value]]),onClick:J},[n("div",Nt,[n("h3",Ut,Y(P.value),1),n("span",It,Y(nt.value),1)]),E.active?(r(),a("div",Bt,[H.value.length?(r(),a("div",Wt,[(r(!0),a(Q,null,se(H.value,s=>(r(),a("span",{key:s,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},Y(s),1))),128))])):K("",!0),_.value?(r(),a("div",Pt,[n("div",Rt,[n("button",{class:le(["px-3 py-1 rounded text-xs bg-white/10 transition-colors",I.value==="context"?"bg-white/25":""]),onClick:t[0]||(t[0]=oe(s=>I.value="context",["stop"]))}," Контекст ",2),Me.value||ee.value?(r(),a("button",{key:0,class:le(["px-3 py-1 rounded text-xs bg-white/10 transition-colors",I.value==="dynamics"?"bg-white/25":""]),onClick:t[1]||(t[1]=oe(s=>I.value="dynamics",["stop"]))}," Динамика ",2)):K("",!0),d.value?(r(),a("button",{key:1,class:le(["px-3 py-1 rounded text-xs bg-white/10 transition-colors",I.value==="conclusions"?"bg-white/25":""]),onClick:t[2]||(t[2]=oe(s=>I.value="conclusions",["stop"]))}," Выводы ",2)):K("",!0),v.value?(r(),a("button",{key:2,class:le(["px-3 py-1 rounded text-xs bg-white/10 transition-colors",I.value==="recommendations"?"bg-white/25":""]),onClick:t[3]||(t[3]=oe(s=>I.value="recommendations",["stop"]))}," Рекомендации ",2)):K("",!0)]),n("div",Vt,[I.value==="context"?(r(),a("div",Zt,[W.value?(r(),a("div",Et,[G.value.narrative?(r(),a("div",Jt,[t[11]||(t[11]=n("div",{class:"text-xs font-semibold opacity-90"},"История серии",-1)),n("p",qt,Y(G.value.narrative),1)])):K("",!0),G.value.psychologicalFunction?(r(),a("div",Xt,[t[12]||(t[12]=n("div",{class:"text-xs font-semibold opacity-90"},"Психологическая функция",-1)),n("p",Gt,Y(G.value.psychologicalFunction),1)])):K("",!0),G.value.emotionalJourney?(r(),a("div",Kt,[t[13]||(t[13]=n("div",{class:"text-xs font-semibold opacity-90"},"Эмоциональное путешествие",-1)),n("p",Qt,Y(G.value.emotionalJourney),1)])):K("",!0)])):te.value?(r(),a("div",{key:1,innerHTML:w.value},null,8,es)):K("",!0),j.value.length?(r(),a("div",ts,[t[14]||(t[14]=n("div",{class:"text-xs font-semibold opacity-90"},"Повторяющиеся символы",-1)),(r(!0),a(Q,null,se(j.value,s=>(r(),a("div",{key:s.symbol,class:"bg-white/10 rounded px-2 py-1.5 space-y-0.5"},[n("div",ss,[n("span",ns,Y(s.symbol),1),n("span",is,Y(s.occurrences)+"×",1)]),n("p",rs,Y(s.interpretation),1)]))),128))])):H.value.length?(r(),a("div",os,[t[15]||(t[15]=n("div",{class:"text-xs opacity-80 mb-1"},"Повторяющиеся символы",-1)),n("div",as,[(r(!0),a(Q,null,se(H.value,s=>(r(),a("span",{key:"deep-"+s,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},Y(s),1))),128))])])):K("",!0)])):I.value==="dynamics"?(r(),a("div",ls,[Me.value?(r(),Le(Ft,{key:0,dynamics:ge.value},null,8,["dynamics"])):ee.value?(r(),a("div",cs,[(r(!0),a(Q,null,se(pe.value,s=>(r(),a("div",{key:s.key,class:"space-y-1"},[n("div",us,[n("span",null,Y(s.label),1),n("span",null,Y(s.values[s.values.length-1])+"%",1)]),(r(),a("svg",{viewBox:"0 0 "+ne.value+" "+Ce,width:"100%",height:Ce,class:"block"},[n("polyline",{points:s.points,fill:"none",stroke:"white","stroke-opacity":s.opacity,"stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,fs),(r(!0),a(Q,null,se(s.pointList,(o,f)=>(r(),a("circle",{key:f,cx:o.x,cy:o.y,r:"2.8",fill:"white","fill-opacity":s.opacity},null,8,hs))),128)),(r(),a(Q,null,se(4,o=>n("line",{key:"g"+o,x1:0,x2:ne.value,y1:Ce/4*o,y2:Ce/4*o,stroke:"white","stroke-opacity":"0.08","stroke-width":"1"},null,8,ps)),64))],8,ds))]))),128)),n("div",ms,"Динамика по последним "+Y(q.value)+" снам.",1)])):(r(),a("div",vs,"Недостаточно данных для отображения динамики."))])):I.value==="conclusions"?(r(),a("div",ys,[(r(!0),a(Q,null,se(g.value,(s,o)=>(r(),a("div",{key:"concl-"+o,class:"space-y-1"},[n("div",gs,[n("span",xs,Y(o+1),1),n("p",_s,Y(s),1)])]))),128))])):I.value==="recommendations"?(r(),a("div",bs,[(r(!0),a(Q,null,se(l.value,(s,o)=>(r(),a("div",{key:"rec-"+o,class:"bg-white/10 rounded px-2.5 py-2 space-y-1"},[n("div",ws,[n("span",$s,Y(o+1),1),n("div",ks,[n("div",Ms,Y(s.title),1),n("p",Ds,Y(s.description),1),n("p",Ss,Y(s.rationale),1)])])]))),128))])):K("",!0)])])):(r(),a(Q,{key:2},[n("div",Cs,[t[16]||(t[16]=n("div",{class:"px-3 py-2 font-semibold flex items-center justify-between"},[n("span",null,"Сон"),n("span",{class:"opacity-80 text-pink-400",style:{"font-size":"130%","font-family":"ui-rounded, -apple-system, system-ui, 'SF Pro Rounded', 'Segoe UI', Roboto, Arial"}},"“")],-1)),n("div",Ts,[n("p",{class:le(["opacity-90",L.value?"clamp-5":""])},Y(E.dream.dream_text),3),n("div",Os,[n("button",{class:"text-sm font-semibold opacity-80 hover:opacity-100",onClick:t[4]||(t[4]=oe(s=>L.value=!L.value,["stop"]))},Y(L.value?"+":"−"),1)])])]),n("div",Hs,[(r(!0),a(Q,null,se(ue.value,(s,o)=>(r(),a("div",{key:s.key,class:"rounded-lg bg-white/10"},[n("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:oe(f=>we(s.key),["stop"])},[n("span",null,Y(s.title),1),n("span",js,Y(de[s.key]?"−":"+"),1)],8,Ls),de[s.key]?(r(),a("div",Ys,[s.key!=="hvdc"?(r(),a("div",{key:0,innerHTML:s.html},null,8,As)):(r(),a(Q,{key:1},[De.value?(r(),a("div",zs,[(r(!0),a(Q,null,se(tt.value,f=>(r(),a("div",{key:f.key},[n("div",Fs,[n("span",null,Y(f.label),1),n("span",null,[Se(Y(f.value)+"% ",1),f.norm!==null?(r(),a(Q,{key:0},[Se(" / "+Y(f.norm)+"%",1)],64)):K("",!0),f.delta!==null?(r(),a("span",{key:1,class:le(f.delta>0?"text-green-300":f.delta<0?"text-red-300":"text-white/70")}," ("+Y(f.delta>0?"+"+f.delta:f.delta)+"pp) ",3)):K("",!0)])]),n("div",Ns,[f.norm!==null?(r(),a("div",{key:0,class:"absolute inset-y-0 left-0 bg-white/20",style:Re({width:f.norm+"%"})},null,4)):K("",!0),n("div",{class:"relative h-full bg-white/70",style:Re({width:f.value+"%"})},null,4)])]))),128)),n("div",Us,[t[18]||(t[18]=n("span",{class:"inline-flex items-center gap-2"},[n("span",{class:"w-2 h-2 rounded-full inline-block bg-white/70 shrink-0"}),Se(" ваш сон")],-1)),n("span",Is,[t[17]||(t[17]=n("span",{class:"w-2 h-2 rounded-full inline-block bg-white/20 shrink-0"},null,-1)),Se(" "+Y(st.value),1)])]),t[19]||(t[19]=n("div",{class:"text-xs opacity-70 flex items-start gap-2"},[n("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-white/20 text-white text-[10px]"},"i"),n("span",null,"Контент‑анализ по схеме HVdC; сравнение с демографическими нормами (DreamBank, SDDB).")],-1))])):K("",!0)],64))])):K("",!0)]))),128))])],64)),n("div",Bs,[n("button",{class:le(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",b.value===1?"bg-green-500/30 text-white ring-2 ring-green-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:oe(C,["stop"])}," 👍 ",2),n("button",{class:le(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",b.value===2?"bg-red-500/30 text-white ring-2 ring-red-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:oe(O,["stop"])}," 👎 ",2),n("button",{class:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-white rounded-xl py-2 text-sm font-medium text-center transition-colors",onClick:oe(h,["stop"])}," 🗑️ ")]),We.value&&Ye.value?(r(),a("div",Ws,[t[20]||(t[20]=n("div",{class:"mb-2 opacity-80"},"Debug payload",-1)),Se(" "+Y(JSON.stringify(Ye.value,null,2))+" ",1),n("div",Ps,[n("button",{class:"px-3 py-1 rounded bg-white/10 hover:bg-white/20",onClick:oe(Ge,["stop"])},"Скопировать")])])):K("",!0),(r(),Le(ft,{to:"body"},[Ae.value?(r(),a("div",{key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70",onClick:oe(ze,["self"]),onWheel:t[9]||(t[9]=oe(()=>{},["prevent"])),onTouchmove:t[10]||(t[10]=oe(()=>{},["prevent"]))},[n("div",{class:"w-[92vw] max-w-[440px] rounded-2xl bg-[var(--tg-theme-secondary-bg-color,#0c110c)] text-white p-4 shadow-2xl border border-white/10",onClick:t[8]||(t[8]=oe(()=>{},["stop"]))},[t[23]||(t[23]=n("h3",{class:"text-lg font-semibold mb-2"},"Уточнить данные",-1)),Pe.value===1?(r(),a("div",Rs,[t[21]||(t[21]=n("p",{class:"opacity-90"},"Ваш возрастной диапазон:",-1)),n("div",Vs,[(r(),a(Q,null,se(Qe,s=>n("button",{key:s,class:le(["px-4 py-3 rounded-xl text-sm",Oe.value===s?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:o=>Oe.value=s},Y(s),11,Zs)),64))]),n("div",Es,[n("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:ze},"Отмена"),n("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Oe.value,onClick:t[5]||(t[5]=s=>Pe.value=2)},"Далее",8,Js)])])):(r(),a("div",qs,[t[22]||(t[22]=n("p",{class:"opacity-90"},"Ваш пол:",-1)),n("div",Xs,[n("button",{class:le(["px-4 py-3 rounded-xl text-sm",$e.value==="male"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[6]||(t[6]=s=>$e.value="male")},"Мужской",2),n("button",{class:le(["px-4 py-3 rounded-xl text-sm",$e.value==="female"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[7]||(t[7]=s=>$e.value="female")},"Женский",2)]),n("div",Gs,[n("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:ze},"Отмена"),n("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!$e.value,onClick:et},"Сохранить",8,Ks)])]))])],32)):K("",!0)]))])):K("",!0)],2))}}),Ze=Be(Qs,[["__scopeId","data-v-a31dde00"]]),en={class:"flex items-center justify-between mb-4"},tn={class:"inline-flex items-center gap-2 rounded-full px-3 py-1 themed-badge"},sn={key:0,class:"flex flex-col gap-4 pb-[5vh]"},nn={key:1,class:"text-center text-red-400 py-8"},rn={key:2},on={key:0,class:"text-center text-white/60 py-8"},an={key:1,class:"flex flex-col gap-4 pb-[5vh]"},ln={key:3},cn={key:0,class:"text-center text-white/60 py-8"},un={key:1,class:"flex flex-col gap-4 pb-[5vh]"},dn=Ie({__name:"AnalysisHistoryList",props:["userStore"],setup(E){const re=E,c=ae(null),N=ae(5),J=ae(5),A=ae("history"),y=M({get:()=>A.value,set:p=>i(p)}),L=M(()=>{var p;return(p=re.userStore)!=null&&p.history?re.userStore.history.filter(m=>!m.is_deep_analysis):[]}),_=M(()=>{var p;return(p=re.userStore)!=null&&p.history?re.userStore.history.filter(m=>m.is_deep_analysis):[]}),b=M(()=>L.value.slice(0,N.value)),D=M(()=>_.value.slice(0,J.value)),z=M(()=>L.value.length>N.value),C=M(()=>_.value.length>J.value),O=()=>{window.triggerHaptic&&window.triggerHaptic("light"),N.value+=5},h=()=>{window.triggerHaptic&&window.triggerHaptic("light"),J.value+=5},i=p=>{window.triggerHaptic&&window.triggerHaptic("light"),A.value=p,c.value=null};return(p,m)=>{var k,U,P,H;return r(),a("div",null,[n("div",en,[m[2]||(m[2]=n("h2",{class:"text-3xl font-bold"},"История",-1)),n("div",tn,[ht(n("select",{"aria-label":"Режим истории","onUpdate:modelValue":m[0]||(m[0]=S=>y.value=S),class:"bg-transparent focus:outline-none themed-select"},[...m[1]||(m[1]=[n("option",{value:"history"},"Дневник снов",-1),n("option",{value:"deep"},"Глубокий анализ",-1)])],512),[[pt,y.value]])])]),(k=E.userStore)!=null&&k.isLoadingHistory?(r(),a("div",sn,[(r(),a(Q,null,se(3,S=>n("div",{key:S,class:"rounded-xl bg-white/10 px-8 md:px-16 py-6"},[...m[3]||(m[3]=[mt('<div class="flex justify-between items-center py-2 min-h-[2.5rem]" data-v-14de94bb><div class="shimmer h-4 w-32 rounded" data-v-14de94bb></div><div class="shimmer h-4 w-12 rounded" data-v-14de94bb></div></div><div class="mt-4 space-y-2" data-v-14de94bb><div class="shimmer h-3 w-full rounded" data-v-14de94bb></div><div class="shimmer h-3 w-5/6 rounded" data-v-14de94bb></div><div class="shimmer h-3 w-2/3 rounded" data-v-14de94bb></div></div><div class="mt-4 grid grid-cols-3 gap-2" data-v-14de94bb><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div></div>',3)])])),64))])):(U=E.userStore)!=null&&U.errorHistory?(r(),a("div",nn," Ошибка загрузки: "+Y(E.userStore.errorHistory),1)):A.value==="history"?(r(),a("div",rn,[(P=L.value)!=null&&P.length?(r(),a("div",an,[(r(!0),a(Q,null,se(b.value,S=>(r(),Le(Ze,{key:S.id,dream:S,active:c.value===S.id,onToggle:I=>c.value=c.value===S.id?null:S.id},null,8,["dream","active","onToggle"]))),128)),z.value?(r(),a("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:O}," Загрузить ещё ")):K("",!0)])):(r(),a("div",on," У вас пока нет сохраненных анализов "))])):A.value==="deep"?(r(),a("div",ln,[(H=_.value)!=null&&H.length?(r(),a("div",un,[(r(!0),a(Q,null,se(D.value,S=>(r(),Le(Ze,{key:S.id,dream:S,active:c.value===S.id,onToggle:I=>c.value=c.value===S.id?null:S.id},null,8,["dream","active","onToggle"]))),128)),C.value?(r(),a("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:h}," Загрузить ещё ")):K("",!0)])):(r(),a("div",cn," Пока нет глубоких анализов "))])):K("",!0)])}}}),mn=Be(dn,[["__scopeId","data-v-14de94bb"]]);export{mn as default};

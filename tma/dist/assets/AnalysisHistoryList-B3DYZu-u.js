import{d as Ne,r as oe,c as b,a,o as r,b as s,s as Oe,M as xt,w as _t,e as z,t as S,F as Q,A as re,n as fe,m as bt,u as wt,N as kt,C as ie,f as Be,k as Fe,q as ze,l as be,D as Xe,z as Ze,h as $t,H as Mt,G as St,j as Dt}from"./main-DRlnF-U_.js";import{g as Ie,c as Ae}from"./_commonjsHelpers-Cpj98o6Y.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Ke={exports:{}};(function(Z,q){(function(u,U){Z.exports=U()})(Ae,function(){var u=1e3,U=6e4,G=36e5,B="millisecond",_="second",W="minute",D="hour",N="day",I="week",F="month",C="quarter",h="year",n="date",l="Invalid Date",x=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(T){var p=["th","st","nd","rd"],f=T%100;return"["+T+(p[(f-20)%10]||p[f]||p[0])+"]"}},w=function(T,p,f){var v=String(T);return!v||v.length>=p?T:""+Array(p+1-v.length).join(f)+T},k={s:w,z:function(T){var p=-T.utcOffset(),f=Math.abs(p),v=Math.floor(f/60),m=f%60;return(p<=0?"+":"-")+w(v,2,"0")+":"+w(m,2,"0")},m:function T(p,f){if(p.date()<f.date())return-T(f,p);var v=12*(f.year()-p.year())+(f.month()-p.month()),m=p.clone().add(v,F),L=f-m<0,Y=p.clone().add(v+(L?-1:1),F);return+(-(v+(f-m)/(L?m-Y:Y-m))||0)},a:function(T){return T<0?Math.ceil(T)||0:Math.floor(T)},p:function(T){return{M:F,y:h,w:I,d:N,D:n,h:D,m:W,s:_,ms:B,Q:C}[T]||String(T||"").toLowerCase().replace(/s$/,"")},u:function(T){return T===void 0}},g="en",j={};j[g]=i;var O="$isDayjsObject",V=function(T){return T instanceof $e||!(!T||!T[O])},ee=function T(p,f,v){var m;if(!p)return g;if(typeof p=="string"){var L=p.toLowerCase();j[L]&&(m=L),f&&(j[L]=f,m=L);var Y=p.split("-");if(!m&&Y.length>1)return T(Y[0])}else{var P=p.name;j[P]=p,m=P}return!v&&m&&(g=m),m||!v&&g},R=function(T,p){if(V(T))return T.clone();var f=typeof p=="object"?p:{};return f.date=T,f.args=arguments,new $e(f)},E=k;E.l=ee,E.i=V,E.w=function(T,p){return R(T,{locale:p.$L,utc:p.$u,x:p.$x,$offset:p.$offset})};var $e=function(){function T(f){this.$L=ee(f.locale,null,!0),this.parse(f),this.$x=this.$x||f.x||{},this[O]=!0}var p=T.prototype;return p.parse=function(f){this.$d=function(v){var m=v.date,L=v.utc;if(m===null)return new Date(NaN);if(E.u(m))return new Date;if(m instanceof Date)return new Date(m);if(typeof m=="string"&&!/Z$/i.test(m)){var Y=m.match(x);if(Y){var P=Y[2]-1||0,J=(Y[7]||"0").substring(0,3);return L?new Date(Date.UTC(Y[1],P,Y[3]||1,Y[4]||0,Y[5]||0,Y[6]||0,J)):new Date(Y[1],P,Y[3]||1,Y[4]||0,Y[5]||0,Y[6]||0,J)}}return new Date(m)}(f),this.init()},p.init=function(){var f=this.$d;this.$y=f.getFullYear(),this.$M=f.getMonth(),this.$D=f.getDate(),this.$W=f.getDay(),this.$H=f.getHours(),this.$m=f.getMinutes(),this.$s=f.getSeconds(),this.$ms=f.getMilliseconds()},p.$utils=function(){return E},p.isValid=function(){return this.$d.toString()!==l},p.isSame=function(f,v){var m=R(f);return this.startOf(v)<=m&&m<=this.endOf(v)},p.isAfter=function(f,v){return R(f)<this.startOf(v)},p.isBefore=function(f,v){return this.endOf(v)<R(f)},p.$g=function(f,v,m){return E.u(f)?this[v]:this.set(m,f)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(f,v){var m=this,L=!!E.u(v)||v,Y=E.p(f),P=function(ye,ne){var me=E.w(m.$u?Date.UTC(m.$y,ne,ye):new Date(m.$y,ne,ye),m);return L?me:me.endOf(N)},J=function(ye,ne){return E.w(m.toDate()[ye].apply(m.toDate("s"),(L?[0,0,0,0]:[23,59,59,999]).slice(ne)),m)},se=this.$W,te=this.$M,ae=this.$D,ue="set"+(this.$u?"UTC":"");switch(Y){case h:return L?P(1,0):P(31,11);case F:return L?P(1,te):P(0,te+1);case I:var de=this.$locale().weekStart||0,_e=(se<de?se+7:se)-de;return P(L?ae-_e:ae+(6-_e),te);case N:case n:return J(ue+"Hours",0);case D:return J(ue+"Minutes",1);case W:return J(ue+"Seconds",2);case _:return J(ue+"Milliseconds",3);default:return this.clone()}},p.endOf=function(f){return this.startOf(f,!1)},p.$set=function(f,v){var m,L=E.p(f),Y="set"+(this.$u?"UTC":""),P=(m={},m[N]=Y+"Date",m[n]=Y+"Date",m[F]=Y+"Month",m[h]=Y+"FullYear",m[D]=Y+"Hours",m[W]=Y+"Minutes",m[_]=Y+"Seconds",m[B]=Y+"Milliseconds",m)[L],J=L===N?this.$D+(v-this.$W):v;if(L===F||L===h){var se=this.clone().set(n,1);se.$d[P](J),se.init(),this.$d=se.set(n,Math.min(this.$D,se.daysInMonth())).$d}else P&&this.$d[P](J);return this.init(),this},p.set=function(f,v){return this.clone().$set(f,v)},p.get=function(f){return this[E.p(f)]()},p.add=function(f,v){var m,L=this;f=Number(f);var Y=E.p(v),P=function(te){var ae=R(L);return E.w(ae.date(ae.date()+Math.round(te*f)),L)};if(Y===F)return this.set(F,this.$M+f);if(Y===h)return this.set(h,this.$y+f);if(Y===N)return P(1);if(Y===I)return P(7);var J=(m={},m[W]=U,m[D]=G,m[_]=u,m)[Y]||1,se=this.$d.getTime()+f*J;return E.w(se,this)},p.subtract=function(f,v){return this.add(-1*f,v)},p.format=function(f){var v=this,m=this.$locale();if(!this.isValid())return m.invalidDate||l;var L=f||"YYYY-MM-DDTHH:mm:ssZ",Y=E.z(this),P=this.$H,J=this.$m,se=this.$M,te=m.weekdays,ae=m.months,ue=m.meridiem,de=function(ne,me,we,ge){return ne&&(ne[me]||ne(v,L))||we[me].slice(0,ge)},_e=function(ne){return E.s(P%12||12,ne,"0")},ye=ue||function(ne,me,we){var ge=ne<12?"AM":"PM";return we?ge.toLowerCase():ge};return L.replace(y,function(ne,me){return me||function(we){switch(we){case"YY":return String(v.$y).slice(-2);case"YYYY":return E.s(v.$y,4,"0");case"M":return se+1;case"MM":return E.s(se+1,2,"0");case"MMM":return de(m.monthsShort,se,ae,3);case"MMMM":return de(ae,se);case"D":return v.$D;case"DD":return E.s(v.$D,2,"0");case"d":return String(v.$W);case"dd":return de(m.weekdaysMin,v.$W,te,2);case"ddd":return de(m.weekdaysShort,v.$W,te,3);case"dddd":return te[v.$W];case"H":return String(P);case"HH":return E.s(P,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return ye(P,J,!0);case"A":return ye(P,J,!1);case"m":return String(J);case"mm":return E.s(J,2,"0");case"s":return String(v.$s);case"ss":return E.s(v.$s,2,"0");case"SSS":return E.s(v.$ms,3,"0");case"Z":return Y}return null}(ne)||Y.replace(":","")})},p.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},p.diff=function(f,v,m){var L,Y=this,P=E.p(v),J=R(f),se=(J.utcOffset()-this.utcOffset())*U,te=this-J,ae=function(){return E.m(Y,J)};switch(P){case h:L=ae()/12;break;case F:L=ae();break;case C:L=ae()/3;break;case I:L=(te-se)/6048e5;break;case N:L=(te-se)/864e5;break;case D:L=te/G;break;case W:L=te/U;break;case _:L=te/u;break;default:L=te}return m?L:E.a(L)},p.daysInMonth=function(){return this.endOf(F).$D},p.$locale=function(){return j[this.$L]},p.locale=function(f,v){if(!f)return this.$L;var m=this.clone(),L=ee(f,v,!0);return L&&(m.$L=L),m},p.clone=function(){return E.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},T}(),De=$e.prototype;return R.prototype=De,[["$ms",B],["$s",_],["$m",W],["$H",D],["$W",N],["$M",F],["$y",h],["$D",n]].forEach(function(T){De[T[1]]=function(p){return this.$g(p,T[0],T[1])}}),R.extend=function(T,p){return T.$i||(T(p,$e,R),T.$i=!0),R},R.locale=ee,R.isDayjs=V,R.unix=function(T){return R(1e3*T)},R.en=j[g],R.Ls=j,R.p={},R})})(Ke);var Qe=Ke.exports;const le=Ie(Qe);var et={exports:{}};(function(Z,q){(function(u,U){Z.exports=U()})(Ae,function(){return function(u,U,G){u=u||{};var B=U.prototype,_={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function W(N,I,F,C){return B.fromToBase(N,I,F,C)}G.en.relativeTime=_,B.fromToBase=function(N,I,F,C,h){for(var n,l,x,y=F.$locale().relativeTime||_,i=u.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],w=i.length,k=0;k<w;k+=1){var g=i[k];g.d&&(n=C?G(N).diff(F,g.d,!0):F.diff(N,g.d,!0));var j=(u.rounding||Math.round)(Math.abs(n));if(x=n>0,j<=g.r||!g.r){j<=1&&k>0&&(g=i[k-1]);var O=y[g.l];h&&(j=h(""+j)),l=typeof O=="string"?O.replace("%d",j):O(j,I,g.l,x);break}}if(I)return l;var V=x?y.future:y.past;return typeof V=="function"?V(l):V.replace("%s",l)},B.to=function(N,I){return W(N,I,this,!0)},B.from=function(N,I){return W(N,I,this)};var D=function(N){return N.$u?G.utc():G()};B.toNow=function(N){return this.to(D(this),N)},B.fromNow=function(N){return this.from(D(this),N)}}})})(et);var Ct=et.exports;const Tt=Ie(Ct);var tt={exports:{}};(function(Z,q){(function(u,U){Z.exports=U()})(Ae,function(){var u="minute",U=/[+-]\d\d(?::?\d\d)?/g,G=/([+-]|\d\d)/g;return function(B,_,W){var D=_.prototype;W.utc=function(l){var x={date:l,utc:!0,args:arguments};return new _(x)},D.utc=function(l){var x=W(this.toDate(),{locale:this.$L,utc:!0});return l?x.add(this.utcOffset(),u):x},D.local=function(){return W(this.toDate(),{locale:this.$L,utc:!1})};var N=D.parse;D.parse=function(l){l.utc&&(this.$u=!0),this.$utils().u(l.$offset)||(this.$offset=l.$offset),N.call(this,l)};var I=D.init;D.init=function(){if(this.$u){var l=this.$d;this.$y=l.getUTCFullYear(),this.$M=l.getUTCMonth(),this.$D=l.getUTCDate(),this.$W=l.getUTCDay(),this.$H=l.getUTCHours(),this.$m=l.getUTCMinutes(),this.$s=l.getUTCSeconds(),this.$ms=l.getUTCMilliseconds()}else I.call(this)};var F=D.utcOffset;D.utcOffset=function(l,x){var y=this.$utils().u;if(y(l))return this.$u?0:y(this.$offset)?F.call(this):this.$offset;if(typeof l=="string"&&(l=function(g){g===void 0&&(g="");var j=g.match(U);if(!j)return null;var O=(""+j[0]).match(G)||["-",0,0],V=O[0],ee=60*+O[1]+ +O[2];return ee===0?0:V==="+"?ee:-ee}(l),l===null))return this;var i=Math.abs(l)<=16?60*l:l;if(i===0)return this.utc(x);var w=this.clone();if(x)return w.$offset=i,w.$u=!1,w;var k=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(w=this.local().add(i+k,u)).$offset=i,w.$x.$localOffset=k,w};var C=D.format;D.format=function(l){var x=l||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return C.call(this,x)},D.valueOf=function(){var l=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*l},D.isUTC=function(){return!!this.$u},D.toISOString=function(){return this.toDate().toISOString()},D.toString=function(){return this.toDate().toUTCString()};var h=D.toDate;D.toDate=function(l){return l==="s"&&this.$offset?W(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():h.call(this)};var n=D.diff;D.diff=function(l,x,y){if(l&&this.$u===l.$u)return n.call(this,l,x,y);var i=this.local(),w=W(l).local();return n.call(i,w,x,y)}}})})(tt);var jt=tt.exports;const st=Ie(jt);var nt={exports:{}};(function(Z,q){(function(u,U){Z.exports=U()})(Ae,function(){var u={year:0,month:1,day:2,hour:3,minute:4,second:5},U={};return function(G,B,_){var W,D=function(C,h,n){n===void 0&&(n={});var l=new Date(C),x=function(y,i){i===void 0&&(i={});var w=i.timeZoneName||"short",k=y+"|"+w,g=U[k];return g||(g=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:y,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:w}),U[k]=g),g}(h,n);return x.formatToParts(l)},N=function(C,h){for(var n=D(C,h),l=[],x=0;x<n.length;x+=1){var y=n[x],i=y.type,w=y.value,k=u[i];k>=0&&(l[k]=parseInt(w,10))}var g=l[3],j=g===24?0:g,O=l[0]+"-"+l[1]+"-"+l[2]+" "+j+":"+l[4]+":"+l[5]+":000",V=+C;return(_.utc(O).valueOf()-(V-=V%1e3))/6e4},I=B.prototype;I.tz=function(C,h){C===void 0&&(C=W);var n,l=this.utcOffset(),x=this.toDate(),y=x.toLocaleString("en-US",{timeZone:C}),i=Math.round((x-new Date(y))/1e3/60),w=15*-Math.round(x.getTimezoneOffset()/15)-i;if(!Number(w))n=this.utcOffset(0,h);else if(n=_(y,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(w,!0),h){var k=n.utcOffset();n=n.add(l-k,"minute")}return n.$x.$timezone=C,n},I.offsetName=function(C){var h=this.$x.$timezone||_.tz.guess(),n=D(this.valueOf(),h,{timeZoneName:C}).find(function(l){return l.type.toLowerCase()==="timezonename"});return n&&n.value};var F=I.startOf;I.startOf=function(C,h){if(!this.$x||!this.$x.$timezone)return F.call(this,C,h);var n=_(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return F.call(n,C,h).tz(this.$x.$timezone,!0)},_.tz=function(C,h,n){var l=n&&h,x=n||h||W,y=N(+_(),x);if(typeof C!="string")return _(C).tz(x);var i=function(j,O,V){var ee=j-60*O*1e3,R=N(ee,V);if(O===R)return[ee,O];var E=N(ee-=60*(R-O)*1e3,V);return R===E?[ee,R]:[j-60*Math.min(R,E)*1e3,Math.max(R,E)]}(_.utc(C,l).valueOf(),y,x),w=i[0],k=i[1],g=_(w).utcOffset(k);return g.$x.$timezone=x,g},_.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},_.tz.setDefault=function(C){W=C}}})})(nt);var Ot=nt.exports;const it=Ie(Ot);var At={exports:{}};(function(Z,q){(function(u,U){Z.exports=U(Qe)})(Ae,function(u){function U(n){return n&&typeof n=="object"&&"default"in n?n:{default:n}}var G=U(u),B="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),_="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),W="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),D="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),N=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function I(n,l,x){var y,i;return x==="m"?l?"минута":"минуту":n+" "+(y=+n,i={mm:l?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[x].split("_"),y%10==1&&y%100!=11?i[0]:y%10>=2&&y%10<=4&&(y%100<10||y%100>=20)?i[1]:i[2])}var F=function(n,l){return N.test(l)?B[n.month()]:_[n.month()]};F.s=_,F.f=B;var C=function(n,l){return N.test(l)?W[n.month()]:D[n.month()]};C.s=D,C.f=W;var h={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:F,monthsShort:C,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:I,mm:I,h:"час",hh:I,d:"день",dd:I,M:"месяц",MM:I,y:"год",yy:I},ordinal:function(n){return n},meridiem:function(n){return n<4?"ночи":n<12?"утра":n<17?"дня":"вечера"}};return G.default.locale(h,null,!0),h})})(At);const Ht={class:"dynamics-chart-container"},Lt={class:"text-sm font-semibold mb-2 flex items-center justify-between"},Yt={class:"text-xs opacity-70"},zt={class:"chart-svg-container"},Bt={class:"y-axis-labels"},Ft={class:"y-label"},Nt={class:"y-label"},It={class:"y-label"},Ut={class:"chart-svg-wrapper"},Wt=["viewBox"],Et=["y1","y2"],Pt=["y"],Zt=["y1","y2"],Rt=["points"],Vt=["cx","cy"],qt={key:0,class:"mt-4"},Gt={class:"dynamics-analysis"},Jt={class:"analysis-text"},Xt={key:0,class:"insight-box"},Kt={class:"insight-text"},Qt={key:1,class:"mt-3 text-xs opacity-80 leading-relaxed"},es={class:"pagination-dots"},ts=["onClick"],Te=300,je=80,Se=6,ss=Ne({__name:"DynamicsChart",props:{dynamics:{},userAge:{},userGender:{}},setup(Z){const q=Z,u=oe(0),U=oe(0),G=oe(0),B=oe("slide-left"),_=b(()=>q.dynamics[u.value]||{metric:"",values:[],interpretation:""}),W=b(()=>_.value.values||[]),D=b(()=>{if(!q.dynamics||q.dynamics.length===0)return{min:0,max:10,labels:[10,5,0]};const i=[];if(q.dynamics.forEach(j=>{Array.isArray(j.values)&&i.push(...j.values)}),i.length===0)return{min:0,max:10,labels:[10,5,0]};const w=Math.floor(Math.min(...i)),k=Math.ceil(Math.max(...i)),g=[k,Math.round((k+w)/2),w];return{min:w,max:k,labels:g}}),N=b(()=>{var j;const i=_.value.metric;if(!q.userAge||!q.userGender)return null;const k=(j={Персонажи:{"18-24":{male:6.5,female:7},"25-34":{male:6,female:6.5},"35-44":{male:5.5,female:6},"45+":{male:5,female:5.5}},Эмоции:{"18-24":{male:6,female:7},"25-34":{male:5.5,female:6.5},"35-44":{male:5,female:6},"45+":{male:4.5,female:5.5}},Действия:{"18-24":{male:7,female:6.5},"25-34":{male:6.5,female:6},"35-44":{male:6,female:5.5},"45+":{male:5.5,female:5}},Сцены:{"18-24":{male:6.5,female:6.5},"25-34":{male:6,female:6},"35-44":{male:5.5,female:5.5},"45+":{male:5,female:5}}}[i])==null?void 0:j[q.userAge];if(!k)return null;const g=k[q.userGender];return g===void 0?null:g}),I=b(()=>{const i=N.value;if(i===null)return null;const{min:w,max:k}=D.value,g=je-Se*2,j=(i-w)/(k-w);return Se+g-j*g}),F=b(()=>{const i=W.value;if(i.length===0)return[];const{min:w,max:k}=D.value,g=Te-Se*2,j=je-Se*2,O=i.length>1?g/(i.length-1):0;return i.map((V,ee)=>{const R=(V-w)/(k-w);return{x:Se+ee*O,y:Se+j-R*j}})}),C=b(()=>F.value.map(i=>`${i.x},${i.y}`).join(" "));function h(i){U.value=i.touches[0].clientX}function n(i){G.value=i.touches[0].clientX}function l(){const i=U.value-G.value;Math.abs(i)>50&&(i>0&&u.value<q.dynamics.length-1?(B.value="slide-left",u.value++,y()):i<0&&u.value>0&&(B.value="slide-right",u.value--,y())),U.value=0,G.value=0}function x(i){i!==u.value&&(B.value=i>u.value?"slide-left":"slide-right",u.value=i,y())}function y(){window.triggerHaptic&&window.triggerHaptic("light")}return(i,w)=>(r(),a("div",Ht,[s("div",{class:"chart-wrapper",onTouchstart:h,onTouchmove:n,onTouchend:l},[Oe(xt,{name:B.value,mode:"out-in"},{default:_t(()=>[(r(),a("div",{key:u.value,class:"chart-content"},[s("div",Lt,[s("span",null,S(_.value.category||_.value.metric),1),s("span",Yt,S(W.value[W.value.length-1]),1)]),s("div",zt,[s("div",Bt,[s("span",Ft,S(D.value.labels[0]),1),s("span",Nt,S(D.value.labels[1]),1),s("span",It,S(D.value.labels[2]),1)]),s("div",Ut,[(r(),a("svg",{viewBox:`0 0 ${Te} ${je}`,class:"chart-svg",preserveAspectRatio:"xMidYMid meet"},[(r(),a(Q,null,re(3,k=>s("line",{key:`grid-${k}`,x1:0,x2:Te,y1:je/2*(k-1),y2:je/2*(k-1),stroke:"white","stroke-opacity":"0.15","stroke-width":"1"},null,8,Et)),64)),I.value!==null?(r(),a("rect",{key:0,x:0,y:I.value-8,width:Te,height:16,fill:"yellow",opacity:"0.15"},null,8,Pt)):z("",!0),I.value!==null?(r(),a("line",{key:1,x1:0,x2:Te,y1:I.value,y2:I.value,stroke:"yellow","stroke-opacity":"0.6","stroke-width":"1.5","stroke-dasharray":"4,3"},null,8,Zt)):z("",!0),s("polyline",{points:C.value,fill:"none",stroke:"white","stroke-width":"2.5","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Rt),(r(!0),a(Q,null,re(F.value,(k,g)=>(r(),a("circle",{key:`point-${g}`,cx:k.x,cy:k.y,r:"4",fill:"white","vector-effect":"non-scaling-stroke"},null,8,Vt))),128))],8,Wt))])]),_.value.analysis?(r(),a("div",qt,[s("div",Gt,[s("p",Jt,S(_.value.analysis),1),_.value.insight?(r(),a("div",Xt,[w[0]||(w[0]=s("span",{class:"insight-icon"},"💡",-1)),s("p",Kt,S(_.value.insight),1)])):z("",!0)])])):_.value.interpretation?(r(),a("div",Qt,S(_.value.interpretation),1)):z("",!0)]))]),_:1},8,["name"])],32),s("div",es,[(r(!0),a(Q,null,re(Z.dynamics,(k,g)=>(r(),a("button",{key:`dot-${g}`,class:fe(["dot",{active:g===u.value}]),onClick:j=>x(g)},null,10,ts))),128))])]))}}),Je=Ve(ss,[["__scopeId","data-v-ac484404"]]),ns=[{keys:["вода","море","река","волна","дожд","океан"],emoji:"🌊"},{keys:["лет","полет","полетать","летать","небо","птиц","самолет"],emoji:"🕊️"},{keys:["погон","убег","догон","преслед"],emoji:"🏃‍♂️"},{keys:["экзам","контрол","тест","урок","школ","учеб","универ"],emoji:"📝"},{keys:["деньг","кошелек","кошель","кошелёк","банк","кредит"],emoji:"💰"},{keys:["любов","поцел","роман","пар","серд"],emoji:"❤️"},{keys:["дом","квартир","комнат","двор","жиль"],emoji:"🏠"},{keys:["работ","офис","началь","коллег"],emoji:"💼"},{keys:["школ","класс","урок"],emoji:"🏫"},{keys:["кот","кошка"],emoji:"🐱"},{keys:["собак","пёс","пес"],emoji:"🐶"},{keys:["зуб","зубы"],emoji:"🦷"},{keys:["темнот","ноч","тьма"],emoji:"🌑"},{keys:["смерт","похорон","кладбищ"],emoji:"🕯️"},{keys:["рожд","младен","ребен","малыш","дет"],emoji:"👶"},{keys:["лес","дерев","парк","природ"],emoji:"🌲"},{keys:["огонь","пожар","жар"],emoji:"🔥"},{keys:["зме","дракон"],emoji:"🐍"},{keys:["путешеств","дорог","путь","троп"],emoji:"🧭"}];function is(Z){try{const q=String(Z||"").toLowerCase();for(const u of ns)if(u.keys.some(U=>q.includes(U)))return u.emoji;return"💤"}catch{return"💤"}}const rs={key:0,class:"flex items-center gap-3 py-1 min-h-[2.5rem]"},os={class:"text-2xl shrink-0"},as={class:"flex-1 min-w-0"},ls={class:"truncate font-semibold leading-tight"},cs={class:"text-xs opacity-80 leading-tight"},us={key:1,class:"mt-4 space-y-4 text-sm fade-seq is-open"},ds={key:0,class:"space-y-1"},fs={class:"text-2xl font-semibold leading-tight"},ms={class:"text-sm opacity-80"},ps={key:1,class:"flex flex-wrap gap-2"},hs={key:0,class:"rounded-lg bg-white/10"},vs={class:"opacity-80 inline-block",style:{fontSize:"130%"}},ys={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-4"},gs={key:0,class:"text-sm opacity-90 leading-relaxed pb-2 border-b border-white/10"},xs={class:"flex items-baseline gap-2"},_s={class:"font-semibold text-sm"},bs={class:"text-xs opacity-70 bg-white/15 px-2 py-0.5 rounded-full"},ws={class:"text-xs opacity-90 leading-relaxed"},ks={class:"text-xs opacity-75 italic leading-relaxed bg-white/5 rounded px-2 py-1"},$s={key:1,class:"rounded-lg bg-white/10"},Ms={class:"opacity-80 inline-block",style:{fontSize:"130%"}},Ss={key:0,class:"px-3 pb-3 text-white/90 leading-snug"},Ds={key:2,class:"rounded-lg bg-white/10"},Cs={class:"opacity-80 inline-block",style:{fontSize:"130%"}},Ts={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-3"},js={key:0,class:"text-sm opacity-90 leading-relaxed"},Os={key:1,class:"text-sm opacity-90 leading-relaxed"},As={key:2,class:"text-sm opacity-90 leading-relaxed"},Hs={key:3,class:"bg-white/10 rounded-lg p-3 space-y-2 mt-4"},Ls={class:"font-semibold opacity-95 flex items-center gap-2"},Ys={class:"text-sm opacity-90 leading-relaxed"},zs={key:0,class:"text-xs opacity-75 italic leading-relaxed"},Bs={class:"rounded-lg bg-white/10"},Fs={class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},Ns=["innerHTML"],Is={key:0,class:"rounded-lg bg-white/10"},Us={class:"px-3 pb-3"},Ws={class:"flex flex-wrap gap-2"},Es={key:1,class:"rounded-lg bg-white/10"},Ps={class:"px-3 pb-3 text-white/90 leading-snug"},Zs={key:2,class:"rounded-lg bg-white/10"},Rs={class:"px-3 pb-3 text-white/90 leading-snug"},Vs={class:"list-decimal pl-5 space-y-2"},qs={key:3,class:"rounded-lg bg-white/10"},Gs={class:"px-3 pb-3 text-white/90 leading-snug"},Js={class:"list-decimal pl-5 space-y-3"},Xs={key:0},Ks={class:"font-semibold mb-1"},Qs={class:"opacity-90"},en={key:0,class:"opacity-80 mt-1 italic"},tn={key:1},sn={key:0,class:"rounded-lg bg-white/10"},nn={class:"px-3 pb-3 text-white/90 leading-snug"},rn={class:"list-decimal pl-5 space-y-2"},on={key:1,class:"rounded-lg bg-white/10"},an={class:"px-3 pb-3 text-white/90 leading-snug"},ln={class:"list-decimal pl-5 space-y-3"},cn={key:0},un={class:"font-semibold mb-1"},dn={class:"opacity-90"},fn={key:0,class:"opacity-80 mt-1 italic"},mn={key:1},pn={class:"rounded-lg bg-white/10 border-l-4 border-pink-400"},hn={class:"px-3 pb-3 text-white/90 leading-snug"},vn={class:"mt-2 flex justify-end"},yn={class:"space-y-2"},gn=["onClick"],xn={class:"opacity-80 inline-block",style:{fontSize:"130%"}},_n={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},bn=["innerHTML"],wn={key:0,class:"space-y-2"},kn={class:"flex justify-between text-xs opacity-80"},$n={class:"relative h-2 w-full bg-white/10 rounded overflow-hidden"},Mn={class:"pt-2 text-xs opacity-80 flex flex-wrap items-center gap-4"},Sn={class:"inline-flex items-center gap-2"},Dn={class:"mt-4 flex gap-2"},Cn={key:4,class:"mt-3 text-xs bg-black/20 rounded-lg p-2 font-mono whitespace-pre-wrap break-words"},Tn={class:"mt-2 flex justify-end"},jn={key:0,class:"space-y-3"},On={class:"grid grid-cols-2 gap-2"},An=["onClick"],Hn={class:"flex justify-end gap-2 pt-2"},Ln=["disabled"],Yn={key:1,class:"space-y-3"},zn={class:"grid grid-cols-2 gap-2"},Bn={class:"flex justify-end gap-2 pt-2"},Fn=["disabled"],Nn=48,In=Ne({__name:"DreamCard",props:{dream:{},active:{type:Boolean},overlayMode:{type:Boolean}},emits:["toggle","open"],setup(Z,{emit:q}){le.extend(Tt),le.locale("ru"),le.extend(st),le.extend(it);const u=Z,U=q,G=()=>{u.overlayMode||(U("open"),window.triggerHaptic&&window.triggerHaptic("light"))},B=bt(),_=wt(),W=oe(!0),D=b(()=>{var e;return!!((e=u.dream)!=null&&e.is_deep_analysis)}),N=b(()=>is(j.value)),I=b(()=>({backgroundColor:"currentColor",WebkitMask:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M9 6l6 6-6 6"/></svg>') no-repeat center / contain`,mask:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M9 6l6 6-6 6"/></svg>') no-repeat center / contain`})),F=b({get:()=>{var e,t,o;return((e=u.dream)==null?void 0:e.user_feedback)??((o=(t=u.dream)==null?void 0:t.deep_source)==null?void 0:o.user_feedback)??0},set:e=>{u.dream&&(u.dream.user_feedback=e,u.dream.deep_source||(u.dream.deep_source={}),u.dream.deep_source.user_feedback=e)}}),C={like:!1,dislike:!1,delete:!1},h=async e=>{if(C.like||C.dislike)return;const t=e===1?F.value===1?0:1:F.value===2?0:2,o=F.value;F.value=t;try{window.triggerHaptic&&window.triggerHaptic("medium"),e===1?C.like=!0:C.dislike=!0,await Ze.postAnalysisFeedback(u.dream.id,t),t===0?_.info("Оценка снята"):t===1?_.success("Добавлено: нравится"):t===2&&_.success("Добавлено: не нравится")}catch(d){F.value=o,console.error("Feedback error",d),_.error("Не удалось сохранить оценку")}finally{C.like=C.dislike=!1}},n=()=>h(1),l=()=>h(2),x=async()=>{var o;if(C.delete)return;const e=(o=window.Telegram)==null?void 0:o.WebApp;if(await new Promise(d=>{e!=null&&e.showPopup?e.showPopup({title:"Удалить запись?",message:"Действие необратимо",buttons:[{id:"yes",type:"destructive",text:"Удалить"},{id:"no",type:"cancel",text:"Отмена"}]},$=>d($==="yes")):d(window.confirm("Удалить запись?"))}))try{C.delete=!0,window.triggerHaptic&&window.triggerHaptic("heavy"),await Ze.deleteAnalysis(u.dream.id);const d=B.history.findIndex($=>$.id===u.dream.id);d>-1&&B.history.splice(d,1),B.fetchProfile(),_.success("Запись удалена")}catch(d){console.error("Delete error",d),_.error("Не удалось удалить запись")}finally{C.delete=!1}},y=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]);function i(e){return e.replace(/\s+/g," ").trim().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function w(e){if(!e)return"";const t=String(e).split(/[.!?\n]/)[0],d=t.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter($=>$&&!y.has($)&&$.length>3).slice(0,3);return d.length===0?t.slice(0,40):i(d.join(" "))}function k(e){if(!e)return"";let t=String(e).toLowerCase().replace(/["'«»]/g,"").trim();t=t.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),t=t.replace(/\s+/g," ").trim();const o=t.split(" ").filter(Boolean).slice(0,3);return o.length?o.join(" "):""}function g(e){if(!e)return"";const t=String(e).toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}const j=b(()=>{var A,c,M,H,K;const e=k((c=(A=u.dream)==null?void 0:A.deep_source)==null?void 0:c.title);if(e)return g(e);const t=(((H=(M=u.dream)==null?void 0:M.deep_source)==null?void 0:H.tags)||[]).filter(Boolean),o=he=>{var ve;let ce=String(he||"").trim();return ce=((ve=ce.split(/[\\/,(;:—–-]/)[0])==null?void 0:ve.trim())||"",ce?ce.charAt(0).toUpperCase()+ce.slice(1).toLowerCase():""},d=t.map(o).filter(Boolean);if(d.length){const he=d.slice(0,2).join(" и ");return g(he||"Без названия")}const $=k(w((K=u.dream)==null?void 0:K.dream_text));return g($||"Без названия")}),O=b(()=>{var o,d;const e=(d=(o=u.dream)==null?void 0:o.deep_source)==null?void 0:d.tags;if(!Array.isArray(e))return[];const t=$=>{var c;let A=String($||"").trim();return A=((c=A.split(/[\\/,(;:—–-]/)[0])==null?void 0:c.trim())||"",A?A.charAt(0).toUpperCase()+A.slice(1).toLowerCase():""};return e.map(t).filter(Boolean).slice(0,5)});function V(e){return String(e||"").replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").replace(/\(\s*\d+\s*\)/g,"").replace(/\s\[\s*\d+\s*\]/g,"").replace(/[\u00B9\u00B2\u00B3\u2070-\u2079]/g,"")}oe("context");const ee=b(()=>{var e;return V(((e=u.dream)==null?void 0:e.analysis)||"")}),R=b(()=>{var e,t;return((t=(e=u.dream)==null?void 0:e.deep_source)==null?void 0:t.overallContext)||{}});b(()=>{const e=R.value;return!!(e!=null&&e.narrative||e!=null&&e.psychologicalFunction||e!=null&&e.emotionalJourney)});const E=b(()=>{var e,t;return((t=(e=u.dream)==null?void 0:e.deep_source)==null?void 0:t.symbolsIntro)||""}),$e=b(()=>{var t,o;const e=(o=(t=u.dream)==null?void 0:t.deep_source)==null?void 0:o.recurringSymbols;return Array.isArray(e)?e:[]}),De=b(()=>$e.value.filter(e=>e.frequency>=2)),T=b(()=>De.value.length>0),p=b(()=>{var t,o;const e=(o=(t=u.dream)==null?void 0:t.deep_source)==null?void 0:o.dynamicsContext;return Array.isArray(e)?e:[]}),f=b(()=>p.value.length>0),v=b(()=>{var e,t;return((t=(e=u.dream)==null?void 0:e.deep_source)==null?void 0:t.conclusion)||{}}),m=b(()=>{const e=v.value;return!!(e!=null&&e.periodThemes||e!=null&&e.dreamFunctionsAnalysis||e!=null&&e.psychologicalSupport||e!=null&&e.integrationExercise)}),L=b(()=>{var t,o;const e=(o=(t=u.dream)==null?void 0:t.deep_source)==null?void 0:o.dynamics;return Array.isArray(e)&&e.length>0?e:[]});b(()=>L.value.length>0);const Y=b(()=>{var t,o;const e=(o=(t=u.dream)==null?void 0:t.deep_source)==null?void 0:o.conclusions;return Array.isArray(e)&&e.length>0?e:[]});b(()=>Y.value.length>0);const P=b(()=>{var c,M;const e=(M=(c=u.dream)==null?void 0:c.deep_source)==null?void 0:M.recommendations;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="object")return e;if(Array.isArray(e)&&e.length>0)return e.map((H,K)=>({title:`Рекомендация ${K+1}`,description:String(H),rationale:""}));const t=ue.value;if(t.length===0)return[];const o=[0,0,0,0];for(const H of t)for(let K=0;K<4;K++)o[K]+=H[K];const d=Math.max(1,t.length);for(let H=0;H<4;H++)o[H]=Math.round(o[H]/d);const $=[["Персонажи","Обрати внимание на отношения и роли; практикуй честную коммуникацию."],["Эмоции","Добавь ежедневную регуляцию эмоций (дыхание, дневник, прогулка)."],["Действия","Определи 1 маленький шаг на неделю и заверши его."],["Сцены","Проверь границы и режим: место/время, где тебе спокойнее."]],A=o.map((H,K)=>({i:K,v:H})).sort((H,K)=>K.v-H.v).map(H=>H.i);return[{title:$[A[0]][0],description:$[A[0]][1],rationale:""},{title:$[A[1]][0],description:$[A[1]][1],rationale:""}]});b(()=>P.value.length>0);function J(e,t){var o;try{let d=e;const $=Array.from(new Set((t||[]).filter(Boolean))).sort((A,c)=>c.length-A.length);for(const A of $){const c=(o=String(A).split(/[\\/,(;:—–-]/)[0])==null?void 0:o.trim();if(!c)continue;const M=new RegExp(`(\b${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\b)`,"gi");d=d.replace(M,'<mark class="bg-white/20 px-1 rounded">$1</mark>')}return d.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1")}catch{return e}}const se=b(()=>{var e,t;return J(ee.value,((t=(e=u.dream)==null?void 0:e.deep_source)==null?void 0:t.tags)||[])});function te(e){try{return new Date(e).getTime()||0}catch{return 0}}const ae=b(()=>(B.history||[]).filter(e=>{var t;return!e.is_deep_analysis&&((t=e==null?void 0:e.deep_source)==null?void 0:t.hvdc)&&(e==null?void 0:e.created_at)}).sort((e,t)=>te(e.created_at)>te(t.created_at)?-1:1)),ue=b(()=>{var d;const e=te(((d=u.dream)==null?void 0:d.created_at)||""),t=ae.value.filter($=>!D.value||(e?te($.created_at)<=e:!0)).slice(0,5).reverse(),o=["characters","emotions","actions","settings"];return t.map($=>o.map(A=>{var c,M;return Number(((M=(c=$.deep_source.hvdc)==null?void 0:c.distribution)==null?void 0:M[A])||0)}))}),de=b(()=>ue.value.length),_e=b(()=>de.value>=2),ye=b(()=>Math.max(60,(de.value-1)*28+8));function ne(e){const t=e.length,o=ye.value,d=Nn,$=t>1?(o-8)/(t-1):0,A=[];for(let M=0;M<t;M++){const H=M*$,K=d-Math.round(e[M]/100*d);A.push({x:H,y:K})}return{str:A.map(M=>`${M.x},${M.y}`).join(" "),pts:A}}b(()=>{const e=[{key:"characters",label:"Персонажи",idx:0,opacity:.95},{key:"emotions",label:"Эмоции",idx:1,opacity:.75},{key:"actions",label:"Действия",idx:2,opacity:.55},{key:"settings",label:"Сцены",idx:3,opacity:.35}],t=[],o=ue.value;for(const d of e){const $=o.map(M=>M[d.idx]),{str:A,pts:c}=ne($);t.push({key:d.key,label:d.label,values:$,points:A,pointList:c,opacity:d.opacity})}return t});const me=b(()=>{if(!_e.value)return[];if(f.value)return p.value.map(o=>({metric:o.category||o.metric,values:o.values||[],interpretation:o.analysis||o.interpretation||"",insight:o.insight||""}));const e=[{key:"characters",label:"Персонажи",idx:0},{key:"emotions",label:"Эмоции",idx:1},{key:"actions",label:"Действия",idx:2},{key:"settings",label:"Сцены",idx:3}],t=ue.value;return e.map(o=>({metric:o.label,values:t.map(d=>d[o.idx]),interpretation:`Динамика "${o.label}" по последним ${de.value} снам`}))});function we(e){const o=e.split(/\n+/).map(d=>d.trim()).filter(Boolean).filter(d=>/^\d+\./.test(d)).map(d=>d.replace(/^\d+\.\s*/,"")).slice(0,3);return o.length?o:e.split(/[.!?]\s+/).map(d=>d.trim()).filter(Boolean).slice(0,3)}const ge=b(()=>we(ee.value));function rt(e){try{const t=String(e||"").toLowerCase(),o=ke=>ke.reduce((Pe,gt)=>Pe+(t.includes(gt)?1:0),0),d=["страх","ужас","паник","тревог","стыд","гнев","плак","слез","кошмар","тоска","грусть"],$=["экзам","выступл","собесед","защит","проект","подготов","завтра","ожидан","волнен","поездк","путешеств","нов","интервью"],A=["вчера","сегодня","работ","школ","универ","дом","улиц","друг","родител","коллег","город"],c=o(d),M=o($),H=o(A);let K=c>0?Math.min(1,c/3):0,he=M>0?Math.min(1,M/3):0,ce=H>0?Math.min(1,.5+H/5):0;K===0&&he===0&&ce===0&&(ce=.6,K=.2,he=.2);const ve={schema:"dream_type_v1",scores:{memory:+ce.toFixed(2),emotion:+K.toFixed(2),anticipation:+he.toFixed(2)}},X=[["memory",ve.scores.memory],["emotion",ve.scores.emotion],["anticipation",ve.scores.anticipation]];X.sort((ke,Pe)=>Pe[1]-ke[1]);const xe=+Math.max(0,X[0][1]-X[1][1]).toFixed(2);return{...ve,dominant:X[0][0],confidence:xe}}catch{return null}}const ot=b(()=>{var e,t,o;return((t=(e=u.dream)==null?void 0:e.deep_source)==null?void 0:t.dream_type)||rt((o=u.dream)==null?void 0:o.dream_text)||null});function at(){const e=ot.value;if(!e||!e.dominant)return['<div class="space-y-2">','<div class="font-semibold">🛠 Небольшая работа со сном</div>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Заметь:</span> Какие 2–3 образа из сна самые сильные? Запиши их коротко.</li>','<li><span class="font-semibold">Шаг:</span> Выбери один маленький шаг в реальности, который поддержит тебя по теме сна.</li>',"</ol>","</div>"].join("");const t=String(e.dominant).toLowerCase();return t==="memory"?['<div class="space-y-2">','<div class="font-semibold">🌙 Сон-Память</div>','<p class="opacity-90">Переработка недавнего опыта, соединение нового с прошлым.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Отрази:</span> Вспомни, что происходило последние 1–2 дня. Какие события могли попасть в сон?</li>','<li><span class="font-semibold">Соедини:</span> Отметь, какие элементы сна перекликаются с реальностью — это завершает «архивацию» опыта.</li>',"</ol>","</div>"].join(""):t==="emotion"?['<div class="space-y-2">','<div class="font-semibold">⚡️ Сон-Эмоция</div>','<p class="opacity-90">Проживание и нейтрализация сильных чувств.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Почувствуй:</span> Определи, какая эмоция была самой сильной во сне. Где она чувствуется в теле сейчас?</li>','<li><span class="font-semibold">Услышь:</span> Представь, что главный персонаж сна говорит тебе что-то. Что он хочет, чтобы ты понял?</li>',"</ol>","</div>"].join(""):['<div class="space-y-2">','<div class="font-semibold">🔮 Сон-Предвосхищение</div>','<p class="opacity-90">Тренировка будущих ситуаций и реакций.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Представь:</span> Как бы ты хотел повести себя, если бы это произошло в реальности?</li>','<li><span class="font-semibold">Расшифруй:</span> Какой символ кажется ключевым? Что он может говорить о твоих страхах или намерениях?</li>',"</ol>","</div>"].join("")}const lt=b(()=>{var he,ce,ve;const e=V(((he=u.dream)==null?void 0:he.analysis)||"");if(!e)return[];const t={arch:{key:"arch",title:"Архетипическая история",text:""},func:{key:"func",title:"Возможная функция сна",text:""},freud:{key:"freud",title:"По Фрейду",text:""},jung:{key:"jung",title:"По Юнгу",text:""}},o=[],d=/\*\*([^*]+)\*\*/g;let $;for(;$=d.exec(e);)o.push({title:$[1].trim(),start:$.index,end:$.index+$[0].length});const A=((ce=o[0])==null?void 0:ce.start)??e.length;t.arch.text=e.slice(0,A).trim();for(let X=0;X<o.length;X++){const xe=o[X].title.toLowerCase(),ke=e.slice(o[X].end,((ve=o[X+1])==null?void 0:ve.start)??e.length).trim();xe.includes("возможная функция")?t.func.text=ke:xe.includes("по фрейду")?t.freud.text=ke:xe.includes("по юнгу")&&(t.jung.text=ke)}const c=X=>X.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1"),M=Object.values(t).map(X=>({...X,html:c(X.text||"")}));M.some(X=>X.key==="func")||M.push({key:"func",title:"Возможная функция сна",text:"",html:""});const H=M.findIndex(X=>X.key==="arch");H!==-1&&M.splice(H+1,0,{key:"hvdc",title:"Контент анализ",text:"",html:""});const K=at();if(K){const X=M.findIndex(xe=>xe.key==="func");if(X!==-1){const xe=['<div class="mt-3 pt-2 border-t border-white/10 space-y-1">','<div class="font-semibold">Функциональное упражнение</div>',K,"</div>"].join("");M[X].html=(M[X].html||"")+xe}}return M}),pe=kt({arch:!0,hvdc:!1,func:!1,freud:!1,jung:!1,symbols:!0,dynamics:!0,conclusion:!0});function He(e){pe[e]=!pe[e]}const qe=b(()=>{try{return new URLSearchParams(window.location.search).get("debug")==="1"||localStorage.getItem("da_debug")==="1"}catch{return!1}});function ct(){var e,t,o,d,$;try{const A=JSON.stringify(Ue.value,null,2);(e=navigator.clipboard)==null||e.writeText(A),(t=_==null?void 0:_.success)==null||t.call(_,"Скопировано")}catch{try{($=(d=(o=window.Telegram)==null?void 0:o.WebApp)==null?void 0:d.showPopup)==null||$.call(d,{title:"Debug",message:"Скопируйте из блока ниже вручную",buttons:[{id:"ok",type:"default",text:"OK"}]})}catch{}}}function ut(e){var o;let t=String(e||"").trim();return t=((o=t.split(/[\\/,(;:—–-]/)[0])==null?void 0:o.trim())||"",t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}const Ue=b(()=>{var o,d,$,A;if(!qe.value)return null;const e=u.dream||{},t=Array.isArray((o=e==null?void 0:e.deep_source)==null?void 0:o.tags)?e.deep_source.tags:[];return{id:e.id,created_at:e.created_at,is_deep_analysis:!!e.is_deep_analysis,title_raw:((d=e==null?void 0:e.deep_source)==null?void 0:d.title)||null,tags_raw:t,tags_norm:t.map(ut),dream_type:(($=e==null?void 0:e.deep_source)==null?void 0:$.dream_type)||null,hvdc_present:!!((A=e==null?void 0:e.deep_source)!=null&&A.hvdc)}}),We=oe(!1),Ge=oe(1),dt=["0-20","20-30","30-40","40-50","50+"],Le=oe(""),Me=oe("");function Ee(){We.value=!1}async function ft(){try{await Ze.setDemographics(Le.value,Me.value);try{await B.fetchProfile()}catch{}_.success("Готово! Дальнейшие анализы будут учитывать эти данные"),We.value=!1}catch{_.error("Не удалось сохранить")}}b(()=>{const e=B.profile||{};return!!(e.age_range&&e.gender)});const Ce=b(()=>{var e,t;return((t=(e=u.dream)==null?void 0:e.deep_source)==null?void 0:t.hvdc)||null}),mt=b(()=>{var $,A,c;const e=[{key:"characters",label:"Персонажи"},{key:"emotions",label:"Эмоции"},{key:"actions",label:"Действия"},{key:"settings",label:"Сцены"}],t=(($=Ce.value)==null?void 0:$.distribution)||{},o=((A=Ce.value)==null?void 0:A.norm)||null,d=((c=Ce.value)==null?void 0:c.comparison)||null;return e.map(M=>({key:M.key,label:M.label,value:Number(t[M.key]??0),norm:o?Number(o[M.key]??0):null,delta:d?Number(d[M.key]??0):null}))}),pt=b(()=>{var c;const e=((c=Ce.value)==null?void 0:c.norm_group)||null;if(!e)return"общая статистика";const t=String(e.gender||"").toLowerCase(),o=t==="male"?"муж.":t==="female"?"жен.":"",d=e.age_range||"",$=d?`${d} лет`:"",A=[o,$].filter(Boolean).join(" ");return A?`общая статистика* для ${A}`:"общая статистика"});function Ye(e,t){const o=Math.abs(e)%100,d=o%10;return o>10&&o<20?t[2]:d>1&&d<5?t[1]:d===1?t[0]:t[2]}const ht=b(()=>{if(!u.dream.created_at)return"";try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone||le.tz.guess(),t=le.utc(u.dream.created_at).tz(e).startOf("day"),d=le().tz(e).startOf("day").diff(t,"day");if(d===0)return"сегодня";if(d===1)return"вчера";if(d<7){const H=Ye(d,["день","дня","дней"]);return`${d} ${H} назад`}const $=Math.floor(d/7);if(d<30){const H=Ye($,["неделя","недели","недель"]);return`${$} ${H} назад`}const A=Math.floor(d/30);if(d<365){const H=Ye(A,["месяц","месяца","месяцев"]);return`${A} ${H} назад`}const c=Math.floor(d/365),M=Ye(c,["год","года","лет"]);return`${c} ${M} назад`}catch{return u.dream.created_at}}),vt=b(()=>{var t;const e=(t=u.dream)==null?void 0:t.created_at;if(!e)return"";try{const o=Intl.DateTimeFormat().resolvedOptions().timeZone||le.tz.guess();return le.utc(e).tz(o).format("D MMMM YYYY, HH:mm")}catch{return e}}),yt=b(()=>{var e;return(e=u.dream)!=null&&e.is_deep_analysis?"from-[#9C41FF] to-[#C03AFF]":"from-[#4A58FF] to-[#5664FF]"});return(e,t)=>{var o,d,$,A;return r(),a("article",{class:fe(["rounded-xl bg-gradient-to-br text-white px-8 md:px-16 transition-all overflow-hidden py-4",[yt.value,Z.overlayMode?"":"cursor-pointer min-h-[4.5rem]"]]),onClick:G},[Z.overlayMode?z("",!0):(r(),a("div",rs,[s("div",os,S(N.value),1),s("div",as,[s("div",ls,S(j.value),1),s("div",cs,S(ht.value),1)]),s("button",{class:"shrink-0 w-6 h-6 opacity-80 hover:opacity-100",onClick:t[0]||(t[0]=ie(c=>U("open"),["stop"])),"aria-label":"Открыть"},[s("span",{class:"inline-block w-6 h-6",style:Be(I.value)},null,4)])])),Z.active?(r(),a("div",us,[Z.overlayMode?(r(),a("div",ds,[s("h2",fs,S(j.value),1),s("div",ms,S(vt.value),1)])):z("",!0),O.value.length&&!D.value?(r(),a("div",ps,[(r(!0),a(Q,null,re(O.value,c=>(r(),a("span",{key:c,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},S(c),1))),128))])):z("",!0),D.value?(r(),a(Q,{key:2},[T.value?(r(),a("div",hs,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[1]||(t[1]=ie(c=>He("symbols"),["stop"]))},[t[11]||(t[11]=s("span",null,"Повторяющиеся символы",-1)),s("span",vs,S(pe.symbols?"−":"+"),1)]),pe.symbols?(r(),a("div",ys,[E.value?(r(),a("p",gs,S(E.value),1)):z("",!0),(r(!0),a(Q,null,re(De.value,(c,M)=>(r(),a("div",{key:`symbol-${M}`,class:"space-y-1"},[s("div",xs,[s("h4",_s,S(c.symbol),1),s("span",bs,"×"+S(c.frequency),1)]),s("p",ws,S(c.description),1),s("div",ks,[t[12]||(t[12]=s("span",{class:"font-medium"},"В ваших снах:",-1)),be(" "+S(c.userContext),1)])]))),128))])):z("",!0)])):z("",!0),f.value?(r(),a("div",$s,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[2]||(t[2]=ie(c=>He("dynamics"),["stop"]))},[t[13]||(t[13]=s("span",null,"Динамика контекста",-1)),s("span",Ms,S(pe.dynamics?"−":"+"),1)]),pe.dynamics?(r(),a("div",Ss,[Oe(Je,{dynamics:p.value,userAge:(o=ze(B).profile)==null?void 0:o.age_range,userGender:(d=ze(B).profile)==null?void 0:d.gender},null,8,["dynamics","userAge","userGender"])])):z("",!0)])):z("",!0),m.value?(r(),a("div",Ds,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[3]||(t[3]=ie(c=>He("conclusion"),["stop"]))},[t[14]||(t[14]=s("span",null,"Заключение",-1)),s("span",Cs,S(pe.conclusion?"−":"+"),1)]),pe.conclusion?(r(),a("div",Ts,[v.value.periodThemes?(r(),a("p",js,S(v.value.periodThemes),1)):z("",!0),v.value.dreamFunctionsAnalysis?(r(),a("p",Os,S(v.value.dreamFunctionsAnalysis),1)):z("",!0),v.value.psychologicalSupport?(r(),a("p",As,S(v.value.psychologicalSupport),1)):z("",!0),v.value.integrationExercise?(r(),a("div",Hs,[s("h4",Ls,[t[15]||(t[15]=s("span",null,"💫",-1)),s("span",null,S(v.value.integrationExercise.title||"Практическое упражнение"),1)]),s("p",Ys,S(v.value.integrationExercise.description),1),v.value.integrationExercise.rationale?(r(),a("p",zs,S(v.value.integrationExercise.rationale),1)):z("",!0)])):z("",!0)])):z("",!0)])):z("",!0),!T.value&&!f.value&&!m.value?(r(),a(Q,{key:3},[s("div",Bs,[t[16]||(t[16]=s("div",{class:"px-3 py-2 font-semibold"},"Общий контекст серии",-1)),s("div",Fs,[s("div",{innerHTML:se.value},null,8,Ns)])]),O.value.length?(r(),a("div",Is,[t[17]||(t[17]=s("div",{class:"px-3 py-2 font-semibold"},"Повторяющиеся символы",-1)),s("div",Us,[s("div",Ws,[(r(!0),a(Q,null,re(O.value,c=>(r(),a("span",{key:"deep-"+c,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},S(c),1))),128))])])])):z("",!0),_e.value?(r(),a("div",Es,[t[18]||(t[18]=s("div",{class:"px-3 py-2 font-semibold"},"Динамика",-1)),s("div",Ps,[Oe(Je,{dynamics:me.value,userAge:($=ze(B).profile)==null?void 0:$.age_range,userGender:(A=ze(B).profile)==null?void 0:A.gender},null,8,["dynamics","userAge","userGender"])])])):z("",!0),ge.value.length?(r(),a("div",Zs,[t[19]||(t[19]=s("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),s("div",Rs,[s("ol",Vs,[(r(!0),a(Q,null,re(ge.value,(c,M)=>(r(),a("li",{key:"in"+M,class:"text-xs leading-relaxed"},S(c),1))),128))])])])):z("",!0),P.value.length?(r(),a("div",qs,[t[20]||(t[20]=s("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),s("div",Gs,[s("ol",Js,[(r(!0),a(Q,null,re(P.value,(c,M)=>(r(),a("li",{key:"rec"+M,class:"text-xs leading-relaxed"},[typeof c=="object"&&c.title?(r(),a("div",Xs,[s("div",Ks,S(c.title),1),s("div",Qs,S(c.description),1),c.rationale?(r(),a("div",en,S(c.rationale),1)):z("",!0)])):(r(),a("div",tn,S(typeof c=="string"?c:c.title),1))]))),128))])])])):z("",!0)],64)):z("",!0),(T.value||f.value)&&!m.value?(r(),a(Q,{key:4},[ge.value.length?(r(),a("div",sn,[t[21]||(t[21]=s("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),s("div",nn,[s("ol",rn,[(r(!0),a(Q,null,re(ge.value,(c,M)=>(r(),a("li",{key:"in"+M,class:"text-xs leading-relaxed"},S(c),1))),128))])])])):z("",!0),P.value.length?(r(),a("div",on,[t[22]||(t[22]=s("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),s("div",an,[s("ol",ln,[(r(!0),a(Q,null,re(P.value,(c,M)=>(r(),a("li",{key:"rec"+M,class:"text-xs leading-relaxed"},[typeof c=="object"&&c.title?(r(),a("div",cn,[s("div",un,S(c.title),1),s("div",dn,S(c.description),1),c.rationale?(r(),a("div",fn,S(c.rationale),1)):z("",!0)])):(r(),a("div",mn,S(typeof c=="string"?c:c.title),1))]))),128))])])])):z("",!0)],64)):z("",!0)],64)):(r(),a(Q,{key:3},[s("div",pn,[t[23]||(t[23]=s("div",{class:"px-3 py-2 font-semibold flex items-center justify-between"},[s("span",null,"Сон"),s("span",{class:"opacity-80 text-pink-400",style:{"font-size":"130%","font-family":"ui-rounded, -apple-system, system-ui, 'SF Pro Rounded', 'Segoe UI', Roboto, Arial"}},"“")],-1)),s("div",hn,[s("p",{class:fe(["opacity-90",W.value?"clamp-5":""])},S(Z.dream.dream_text),3),s("div",vn,[s("button",{class:"text-sm font-semibold opacity-80 hover:opacity-100",onClick:t[4]||(t[4]=ie(c=>W.value=!W.value,["stop"]))},S(W.value?"+":"−"),1)])])]),s("div",yn,[(r(!0),a(Q,null,re(lt.value,(c,M)=>(r(),a("div",{key:c.key,class:"rounded-lg bg-white/10"},[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:ie(H=>He(c.key),["stop"])},[s("span",null,S(c.title),1),s("span",xn,S(pe[c.key]?"−":"+"),1)],8,gn),pe[c.key]?(r(),a("div",_n,[c.key!=="hvdc"?(r(),a("div",{key:0,innerHTML:c.html},null,8,bn)):(r(),a(Q,{key:1},[Ce.value?(r(),a("div",wn,[(r(!0),a(Q,null,re(mt.value,H=>(r(),a("div",{key:H.key},[s("div",kn,[s("span",null,S(H.label),1),s("span",null,[be(S(H.value)+"% ",1),H.norm!==null?(r(),a(Q,{key:0},[be(" / "+S(H.norm)+"%",1)],64)):z("",!0),H.delta!==null?(r(),a("span",{key:1,class:fe(H.delta>0?"text-green-300":H.delta<0?"text-red-300":"text-white/70")}," ("+S(H.delta>0?"+"+H.delta:H.delta)+"pp) ",3)):z("",!0)])]),s("div",$n,[H.norm!==null?(r(),a("div",{key:0,class:"absolute inset-y-0 left-0 bg-white/20",style:Be({width:H.norm+"%"})},null,4)):z("",!0),s("div",{class:"relative h-full bg-white/70",style:Be({width:H.value+"%"})},null,4)])]))),128)),s("div",Mn,[t[25]||(t[25]=s("span",{class:"inline-flex items-center gap-2"},[s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/70 shrink-0"}),be(" ваш сон")],-1)),s("span",Sn,[t[24]||(t[24]=s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/20 shrink-0"},null,-1)),be(" "+S(pt.value),1)])]),t[26]||(t[26]=s("div",{class:"text-xs opacity-70 flex items-start gap-2"},[s("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-white/20 text-white text-[10px]"},"i"),s("span",null,"Контент‑анализ по схеме HVdC; сравнение с демографическими нормами (DreamBank, SDDB).")],-1))])):z("",!0)],64))])):z("",!0)]))),128))])],64)),s("div",Dn,[s("button",{class:fe(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",F.value===1?"bg-green-500/30 text-white ring-2 ring-green-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:ie(n,["stop"])}," 👍 ",2),s("button",{class:fe(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",F.value===2?"bg-red-500/30 text-white ring-2 ring-red-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:ie(l,["stop"])}," 👎 ",2),s("button",{class:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-white rounded-xl py-2 text-sm font-medium text-center transition-colors",onClick:ie(x,["stop"])}," 🗑️ ")]),qe.value&&Ue.value?(r(),a("div",Cn,[t[27]||(t[27]=s("div",{class:"mb-2 opacity-80"},"Debug payload",-1)),be(" "+S(JSON.stringify(Ue.value,null,2))+" ",1),s("div",Tn,[s("button",{class:"px-3 py-1 rounded bg-white/10 hover:bg-white/20",onClick:ie(ct,["stop"])},"Скопировать")])])):z("",!0),(r(),Fe(Xe,{to:"body"},[We.value?(r(),a("div",{key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70",onClick:ie(Ee,["self"]),onWheel:t[9]||(t[9]=ie(()=>{},["prevent"])),onTouchmove:t[10]||(t[10]=ie(()=>{},["prevent"]))},[s("div",{class:"w-[92vw] max-w-[440px] rounded-2xl bg-[var(--tg-theme-secondary-bg-color,#0c110c)] text-white p-4 shadow-2xl border border-white/10",onClick:t[8]||(t[8]=ie(()=>{},["stop"]))},[t[30]||(t[30]=s("h3",{class:"text-lg font-semibold mb-2"},"Уточнить данные",-1)),Ge.value===1?(r(),a("div",jn,[t[28]||(t[28]=s("p",{class:"opacity-90"},"Ваш возрастной диапазон:",-1)),s("div",On,[(r(),a(Q,null,re(dt,c=>s("button",{key:c,class:fe(["px-4 py-3 rounded-xl text-sm",Le.value===c?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:M=>Le.value=c},S(c),11,An)),64))]),s("div",Hn,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:Ee},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Le.value,onClick:t[5]||(t[5]=c=>Ge.value=2)},"Далее",8,Ln)])])):(r(),a("div",Yn,[t[29]||(t[29]=s("p",{class:"opacity-90"},"Ваш пол:",-1)),s("div",zn,[s("button",{class:fe(["px-4 py-3 rounded-xl text-sm",Me.value==="male"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[6]||(t[6]=c=>Me.value="male")},"Мужской",2),s("button",{class:fe(["px-4 py-3 rounded-xl text-sm",Me.value==="female"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[7]||(t[7]=c=>Me.value="female")},"Женский",2)]),s("div",Bn,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:Ee},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Me.value,onClick:ft},"Сохранить",8,Fn)])]))])],32)):z("",!0)]))])):z("",!0)],2)}}}),Re=Ve(In,[["__scopeId","data-v-d9b89be8"]]),Un={key:0,class:"fixed inset-0 z-[9998] bg-black/70"},Wn=Ne({__name:"DreamOverlay",props:{dream:{}},emits:["close"],setup(Z,{emit:q}){le.locale("ru"),le.extend(st),le.extend(it);const u=Z,U=q,G=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]),B=h=>String(h||"").replace(/\s+/g," ").trim().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),_=h=>{if(!h)return"";const n=String(h).split(/[.!?\n]/)[0],x=n.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(y=>y&&!G.has(y)&&y.length>3).slice(0,3);return x.length===0?n.slice(0,40):B(x.join(" "))},W=h=>{if(!h)return"";let n=String(h).toLowerCase().replace(/["'«»]/g,"").trim();n=n.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),n=n.replace(/\s+/g," ").trim();const l=n.split(" ").filter(Boolean).slice(0,3);return l.length?l.join(" "):""},D=h=>{if(!h)return"";const n=String(h).toLowerCase();return n.charAt(0).toUpperCase()+n.slice(1)};b(()=>{var i,w,k,g,j;const h=W(String(((w=(i=u.dream)==null?void 0:i.deep_source)==null?void 0:w.title)||""));if(h)return D(h);const n=(((g=(k=u.dream)==null?void 0:k.deep_source)==null?void 0:g.tags)||[]).filter(Boolean),l=O=>{var ee;let V=String(O||"").trim();return V=((ee=V.split(/[\\/,(;:—–-]/)[0])==null?void 0:ee.trim())||"",V?V.charAt(0).toUpperCase()+V.slice(1).toLowerCase():""},x=n.map(l).filter(Boolean);if(x.length){const O=x.slice(0,2).join(" и ");return D(O||"Без названия")}const y=W(_(String(((j=u.dream)==null?void 0:j.dream_text)||"")));return D(y||"Без названия")}),b(()=>{var n;const h=(n=u.dream)==null?void 0:n.created_at;if(!h)return"";try{const l=Intl.DateTimeFormat().resolvedOptions().timeZone||le.tz.guess();return le.utc(h).tz(l).format("D MMMM YYYY, HH:mm")}catch{return h}});function N(){var h,n,l,x,y;try{const i=(h=window==null?void 0:window.Telegram)==null?void 0:h.WebApp;(l=(n=i==null?void 0:i.BackButton)==null?void 0:n.show)==null||l.call(n),(y=(x=i==null?void 0:i.BackButton)==null?void 0:x.onClick)==null||y.call(x,F)}catch{}}function I(){var h,n,l,x,y;try{const i=(h=window==null?void 0:window.Telegram)==null?void 0:h.WebApp;(l=(n=i==null?void 0:i.BackButton)==null?void 0:n.hide)==null||l.call(n),(y=(x=i==null?void 0:i.BackButton)==null?void 0:x.offClick)==null||y.call(x,F)}catch{}}function F(){U("close")}$t(()=>{try{document.body.style.overflow="hidden"}catch{}N();try{Mt(()=>{const h=document.querySelector("[data-user-anchor]"),n=h?Math.max(0,Math.round(h.getBoundingClientRect().top)):0;C.value=Math.max(0,n+20)})}catch{}}),St(()=>{I();try{document.body.style.overflow=""}catch{}});const C=oe(16);return(h,n)=>(r(),Fe(Xe,{to:"body"},[Z.dream?(r(),a("div",Un,[s("div",{class:"absolute inset-0 overflow-y-auto",onClick:n[1]||(n[1]=ie(l=>U("close"),["self"]))},[s("div",{class:"pb-6",style:Be({paddingTop:C.value+"px"}),onClick:n[0]||(n[0]=ie(()=>{},["stop"]))},[Oe(Re,{dream:Z.dream,active:!0,overlayMode:!0},null,8,["dream"])],4)])])):z("",!0)]))}}),En={class:"flex items-center gap-8 mb-6 border-b border-white/10"},Pn={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white rounded-full"},Zn={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white rounded-full"},Rn={key:0,class:"flex flex-col gap-4 pb-[5vh]"},Vn={key:1,class:"text-center text-red-400 py-8"},qn={key:2},Gn={key:0,class:"text-center text-white/60 py-8"},Jn={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Xn={key:3},Kn={key:0,class:"text-center text-white/60 py-8"},Qn={key:1,class:"flex flex-col gap-4 pb-[5vh]"},ei=Ne({__name:"AnalysisHistoryList",props:["userStore"],setup(Z){const q=Z,u=oe(null),U=oe(5),G=oe(5),B=oe("history"),_=b(()=>{var y;return(y=q.userStore)!=null&&y.history?q.userStore.history.filter(i=>!i.is_deep_analysis):[]}),W=b(()=>{var y;return(y=q.userStore)!=null&&y.history?q.userStore.history.filter(i=>i.is_deep_analysis):[]}),D=b(()=>_.value.slice(0,U.value)),N=b(()=>W.value.slice(0,G.value)),I=b(()=>_.value.length>U.value),F=b(()=>W.value.length>G.value),C=()=>{window.triggerHaptic&&window.triggerHaptic("light"),U.value+=5},h=()=>{window.triggerHaptic&&window.triggerHaptic("light"),G.value+=5},n=y=>{window.triggerHaptic&&window.triggerHaptic("light"),B.value=y,u.value=null},l=y=>{var i,w,k,g,j;u.value=y;try{const O=(i=window==null?void 0:window.Telegram)==null?void 0:i.WebApp;(k=(w=O==null?void 0:O.BackButton)==null?void 0:w.onClick)==null||k.call(w,()=>x()),(j=(g=O==null?void 0:O.BackButton)==null?void 0:g.show)==null||j.call(g)}catch{}},x=()=>{var y,i,w;try{const k=(y=window==null?void 0:window.Telegram)==null?void 0:y.WebApp;(w=(i=k==null?void 0:k.BackButton)==null?void 0:i.hide)==null||w.call(i)}catch{}u.value=null};return(y,i)=>{var w,k,g,j;return r(),a("div",null,[s("div",En,[s("button",{onClick:i[0]||(i[0]=O=>n("history")),class:fe(["relative pb-3 text-lg font-semibold transition-all duration-200",[B.value==="history"?"text-white":"text-white/40 hover:text-white/60"]])},[i[2]||(i[2]=be(" Дневник снов ",-1)),B.value==="history"?(r(),a("div",Pn)):z("",!0)],2),s("button",{onClick:i[1]||(i[1]=O=>n("deep")),class:fe(["relative pb-3 text-lg font-semibold transition-all duration-200",[B.value==="deep"?"text-white":"text-white/40 hover:text-white/60"]])},[i[3]||(i[3]=be(" Глубокий анализ ",-1)),B.value==="deep"?(r(),a("div",Zn)):z("",!0)],2)]),(w=Z.userStore)!=null&&w.isLoadingHistory?(r(),a("div",Rn,[(r(),a(Q,null,re(3,O=>s("div",{key:O,class:"rounded-xl bg-white/10 px-8 md:px-16 py-6"},[...i[4]||(i[4]=[Dt('<div class="flex justify-between items-center py-2 min-h-[2.5rem]" data-v-73686d16><div class="shimmer h-4 w-32 rounded" data-v-73686d16></div><div class="shimmer h-4 w-12 rounded" data-v-73686d16></div></div><div class="mt-4 space-y-2" data-v-73686d16><div class="shimmer h-3 w-full rounded" data-v-73686d16></div><div class="shimmer h-3 w-5/6 rounded" data-v-73686d16></div><div class="shimmer h-3 w-2/3 rounded" data-v-73686d16></div></div><div class="mt-4 grid grid-cols-3 gap-2" data-v-73686d16><div class="shimmer h-6 rounded-full" data-v-73686d16></div><div class="shimmer h-6 rounded-full" data-v-73686d16></div><div class="shimmer h-6 rounded-full" data-v-73686d16></div></div>',3)])])),64))])):(k=Z.userStore)!=null&&k.errorHistory?(r(),a("div",Vn," Ошибка загрузки: "+S(Z.userStore.errorHistory),1)):B.value==="history"?(r(),a("div",qn,[(g=_.value)!=null&&g.length?(r(),a("div",Jn,[(r(!0),a(Q,null,re(D.value,O=>(r(),Fe(Re,{key:O.id,dream:O,onOpen:V=>l(O)},null,8,["dream","onOpen"]))),128)),I.value?(r(),a("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:C}," Загрузить ещё ")):z("",!0)])):(r(),a("div",Gn," У вас пока нет сохраненных анализов "))])):B.value==="deep"?(r(),a("div",Xn,[(j=W.value)!=null&&j.length?(r(),a("div",Qn,[(r(!0),a(Q,null,re(N.value,O=>(r(),Fe(Re,{key:O.id,dream:O,onOpen:V=>l(O)},null,8,["dream","onOpen"]))),128)),F.value?(r(),a("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:h}," Загрузить ещё ")):z("",!0)])):(r(),a("div",Kn," Пока нет глубоких анализов "))])):z("",!0),Oe(Wn,{dream:u.value,onClose:x},null,8,["dream"])])}}}),ii=Ve(ei,[["__scopeId","data-v-73686d16"]]);export{ii as default};

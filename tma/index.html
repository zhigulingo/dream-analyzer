<!-- tma/index.html -->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ viewport –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ fullscreen -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no" />

    <!-- –ú–æ–±–∏–ª—å–Ω—ã–µ web app –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-touch-fullscreen" content="yes" />

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ fullscreen –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="theme-color" content="#121a12" />
    <title>Dream Analyzer - –õ–∏—á–Ω—ã–π –ö–∞–±–∏–Ω–µ—Ç</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∫—Ä–∏–ø—Ç Telegram WebApp –±–µ–∑ defer, —á—Ç–æ–±—ã –æ–Ω –±—ã–ª –¥–æ—Å—Ç—É–ø–µ–Ω –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- –≠–ö–°–¢–†–ï–ù–ù–´–ï CSS –°–¢–ò–õ–ò –î–õ–Ø –ó–ê–©–ò–¢–´ –û–¢ FULLSCREEN -->
    <style>
      /* –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –ó–ê–©–ò–¢–ê: –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ —Å—Ä–∞–∑—É */
      @media (min-width: 1025px) {
        html, body {
          max-height: 600px !important;
          height: 600px !important;
          overflow: hidden !important;
        }

        #app {
          max-height: 600px !important;
          height: 600px !important;
        }

        /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ª—é–±—ã–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
        html, body, #app {
          transform: none !important;
          -webkit-transform: none !important;
        }
      }

      /* –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - —Ä–∞–∑—Ä–µ—à–∞–µ–º fullscreen */
      @media (max-width: 1024px) {
        html, body, #app {
          min-height: 100vh;
          height: 100vh;
        }
      }
    </style>

    <!-- –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –ó–ê–©–ò–¢–ê –û–¢ FULLSCREEN –ù–ê –î–ï–°–ö–¢–û–ü–ï -->
    <script>
      (function() {
        console.log('üö® [EMERGENCY] Emergency desktop protection activated');

        // –ë–õ–û–ö–ò–†–£–ï–ú FULLSCREEN –ù–ï–ó–ê–í–ò–°–ò–ú–û –û–¢ –í–°–ï–ì–û
        function emergencyDesktopProtection() {
          try {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ
            const isDesktop = window.innerWidth > 1024 && window.innerHeight > 768 &&
                             !/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i.test(navigator.userAgent);

            if (isDesktop) {
              console.log('üö® [EMERGENCY] Desktop detected - EMERGENCY PROTECTION ACTIVATED');

              // –ë–õ–û–ö–ò–†–£–ï–ú –í–°–ï –ú–ï–¢–û–î–´ TELEGRAM WEBAPP
              if (window.Telegram?.WebApp) {
                const tg = window.Telegram.WebApp;

                // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ä–∞–∑–º–µ—Ä–æ–º
                const methodsToBlock = ['expand', 'requestFullscreen', 'openPopup', 'showPopup'];
                methodsToBlock.forEach(method => {
                  if (tg[method]) {
                    const originalMethod = tg[method];
                    tg[method] = function(...args) {
                      console.log('üö® [EMERGENCY] BLOCKED:', method, 'on desktop');
                      return false;
                    };
                  }
                });

                // –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô –†–ê–ó–ú–ï–† –°–†–ê–ó–£
                setTimeout(() => {
                  document.documentElement.style.height = '600px';
                  document.documentElement.style.maxHeight = '600px';
                  document.body.style.height = '600px';
                  document.body.style.maxHeight = '600px';
                  console.log('üö® [EMERGENCY] Desktop size limited to 600px');
                }, 100);

                // –î–û–ë–ê–í–õ–Ø–ï–ú CSS –°–¢–ò–õ–ò –°–†–ê–ó–£
                const emergencyCSS = document.createElement('style');
                emergencyCSS.textContent = `
                  html, body {
                    max-height: 600px !important;
                    height: 600px !important;
                    overflow: hidden !important;
                  }
                  #app {
                    max-height: 600px !important;
                    height: 600px !important;
                  }
                `;
                document.head.appendChild(emergencyCSS);
                console.log('üö® [EMERGENCY] Emergency CSS applied');
              }
            } else {
              console.log('üö® [EMERGENCY] Mobile device detected - no emergency protection needed');
            }
          } catch (error) {
            console.error('üö® [EMERGENCY] Error in emergency protection:', error);
          }
        }

        // –ó–ê–ü–£–°–ö–ê–ï–ú –°–†–ê–ó–£
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', emergencyDesktopProtection);
        } else {
          emergencyDesktopProtection();
        }

        // –ó–ê–ü–£–°–ö–ê–ï–ú –ß–ï–†–ï–ó –ù–ï–ë–û–õ–¨–®–£–Æ –ó–ê–î–ï–†–ñ–ö–£
        setTimeout(emergencyDesktopProtection, 50);
        setTimeout(emergencyDesktopProtection, 200);
      })();
    </script>

    <!-- –†–∞–Ω–Ω—è—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è fullscreen –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <script>
      (function() {
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
        const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i.test(navigator.userAgent) ||
                        (window.innerWidth <= 768 && window.innerHeight <= 1024) ||
                        ('ontouchstart' in window);

        if (isMobile) {
          console.log('üì± Mobile device detected, preparing early fullscreen setup');

          // –§—É–Ω–∫—Ü–∏—è —Ä–∞–Ω–Ω–µ–≥–æ fullscreen —Å Telegram API
          const earlyFullscreenSetup = function() {
            try {
              console.log('üöÄ [HTML] Early fullscreen setup starting...');
              console.log('üöÄ [HTML] Telegram available:', !!window.Telegram);
              console.log('üöÄ [HTML] Telegram WebApp:', !!window.Telegram?.WebApp);
              console.log('üöÄ [HTML] Telegram requestFullscreen:', !!window.Telegram?.WebApp?.requestFullscreen);

              // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
              const isMobile = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini|mobile|tablet/i.test(navigator.userAgent) ||
                             (window.innerWidth <= 768 && window.innerHeight <= 1024) ||
                             ('ontouchstart' in window);

              console.log('üöÄ [HTML] Early device detection - Mobile:', isMobile);

              // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö - –ø—Ä–æ–±—É–µ–º Telegram WebApp fullscreen
              if (isMobile && window.Telegram?.WebApp?.requestFullscreen) {
                console.log('üéØ [HTML] Trying early Telegram fullscreen for mobile...');
                window.Telegram.WebApp.requestFullscreen();
                console.log('‚úÖ [HTML] Early Telegram fullscreen called');
                return;
              }

              // –î–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞ - –ê–ì–†–ï–°–°–ò–í–ù–û –ü–†–ï–î–û–¢–í–†–ê–©–ê–ï–ú –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï
              if (!isMobile) {
                console.log('üíª [HTML] Desktop detected - preventing expansion');

                // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥—ã Telegram WebApp –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
                if (window.Telegram?.WebApp) {
                  const originalExpand = window.Telegram.WebApp.expand;
                  const originalRequestFullscreen = window.Telegram.WebApp.requestFullscreen;

                  // –ë–ª–æ–∫–∏—Ä—É–µ–º expand
                  window.Telegram.WebApp.expand = function() {
                    console.log('üíª [HTML] Desktop expand blocked');
                    return false;
                  };

                  // –ë–ª–æ–∫–∏—Ä—É–µ–º requestFullscreen
                  window.Telegram.WebApp.requestFullscreen = function() {
                    console.log('üíª [HTML] Desktop requestFullscreen blocked');
                    return false;
                  };

                  console.log('üíª [HTML] Desktop expansion methods blocked');
                }

                return;
              }

              // –ï—Å–ª–∏ Telegram –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–±—É–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π API
              const doc = document.documentElement;

              if (doc.requestFullscreen) {
                doc.requestFullscreen().then(function() {
                  console.log('üéØ Early browser fullscreen activated');
                }).catch(function(err) {
                  console.log('Early browser fullscreen failed:', err);
                });
              } else if (doc.webkitRequestFullscreen) {
                doc.webkitRequestFullscreen();
                console.log('üéØ Early webkit fullscreen activated');
              }

              // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
              const retryFullscreen = function() {
                console.log('üîÑ Retrying fullscreen...');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —É–∂–µ fullscreen
                if (document.fullscreenElement || document.webkitFullscreenElement) {
                  console.log('‚úÖ Fullscreen already active');
                  return;
                }

                // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É Telegram
                if (window.Telegram?.WebApp?.requestFullscreen) {
                  window.Telegram.WebApp.requestFullscreen();
                  console.log('üîÑ Telegram fullscreen retried');
                  return;
                }

                // –ü–æ–≤—Ç–æ—Ä—è–µ–º –±—Ä–∞—É–∑–µ—Ä–Ω—É—é –ø–æ–ø—ã—Ç–∫—É
                if (doc.requestFullscreen) {
                  doc.requestFullscreen().catch(function() {
                    console.log('Browser fullscreen retry failed');
                  });
                } else if (doc.webkitRequestFullscreen) {
                  doc.webkitRequestFullscreen();
                  console.log('üîÑ Webkit fullscreen retried');
                }
              };

              // –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
              document.addEventListener('touchstart', retryFullscreen, { once: true });
              document.addEventListener('click', retryFullscreen, { once: true });
              document.addEventListener('DOMContentLoaded', retryFullscreen);

              console.log('üéØ Early fullscreen setup completed');

            } catch (error) {
              console.log('‚ùå Early fullscreen setup failed:', error);
            }
          };

          // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–∞–Ω–Ω—é—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', earlyFullscreenSetup);
          } else {
            earlyFullscreenSetup();
          }

          // –¢–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
          setTimeout(earlyFullscreenSetup, 100);
        } else {
          console.log('üíª Desktop device, skipping early fullscreen setup');
        }
      })();
    </script>
  </head>
  <body>
    <!-- –ö–æ—Ä–Ω–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç, –∫—É–¥–∞ –±—É–¥–µ—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è Vue –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="app"></div>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –≤–∞—à–µ–≥–æ Vue –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <!-- type="module" –≤–∞–∂–µ–Ω –¥–ª—è Vite -->
    <script type="module" src="/src/main.js"></script>
  </body>
</html>

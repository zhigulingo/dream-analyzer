import{d as Ne,r as re,c as b,a as v,o as f,b as i,s as Pe,M as st,w as nt,t as X,F as ee,A as ae,n as ve,m as it,u as rt,N as at,e as te,k as Fe,C as fe,l as Me,f as Be,D as ot,z as Ae,O as lt,P as ct,j as ut}from"./main-DRaeNWrR.js";import{g as Oe,c as De}from"./_commonjsHelpers-Cpj98o6Y.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Ve={exports:{}};(function(Z,ne){(function(o,N){Z.exports=N()})(De,function(){var o=1e3,N=6e4,E=36e5,A="millisecond",g="second",j="minute",x="hour",_="day",D="week",z="month",T="quarter",H="year",u="date",n="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,M={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(y){var c=["th","st","nd","rd"],a=y%100;return"["+y+(c[(a-20)%10]||c[a]||c[0])+"]"}},Y=function(y,c,a){var h=String(y);return!h||h.length>=c?y:""+Array(c+1-h.length).join(a)+y},I={s:Y,z:function(y){var c=-y.utcOffset(),a=Math.abs(c),h=Math.floor(a/60),l=a%60;return(c<=0?"+":"-")+Y(h,2,"0")+":"+Y(l,2,"0")},m:function y(c,a){if(c.date()<a.date())return-y(a,c);var h=12*(a.year()-c.year())+(a.month()-c.month()),l=c.clone().add(h,z),w=a-l<0,$=c.clone().add(h+(w?-1:1),z);return+(-(h+(a-l)/(w?l-$:$-l))||0)},a:function(y){return y<0?Math.ceil(y)||0:Math.floor(y)},p:function(y){return{M:z,y:H,w:D,d:_,D:u,h:x,m:j,s:g,ms:A,Q:T}[y]||String(y||"").toLowerCase().replace(/s$/,"")},u:function(y){return y===void 0}},O="en",S={};S[O]=M;var R="$isDayjsObject",K=function(y){return y instanceof we||!(!y||!y[R])},se=function y(c,a,h){var l;if(!c)return O;if(typeof c=="string"){var w=c.toLowerCase();S[w]&&(l=w),a&&(S[w]=a,l=w);var $=c.split("-");if(!l&&$.length>1)return y($[0])}else{var U=c.name;S[U]=c,l=U}return!h&&l&&(O=l),l||!h&&O},B=function(y,c){if(K(y))return y.clone();var a=typeof c=="object"?c:{};return a.date=y,a.args=arguments,new we(a)},L=I;L.l=se,L.i=K,L.w=function(y,c){return B(y,{locale:c.$L,utc:c.$u,x:c.$x,$offset:c.$offset})};var we=function(){function y(a){this.$L=se(a.locale,null,!0),this.parse(a),this.$x=this.$x||a.x||{},this[R]=!0}var c=y.prototype;return c.parse=function(a){this.$d=function(h){var l=h.date,w=h.utc;if(l===null)return new Date(NaN);if(L.u(l))return new Date;if(l instanceof Date)return new Date(l);if(typeof l=="string"&&!/Z$/i.test(l)){var $=l.match(m);if($){var U=$[2]-1||0,P=($[7]||"0").substring(0,3);return w?new Date(Date.UTC($[1],U,$[3]||1,$[4]||0,$[5]||0,$[6]||0,P)):new Date($[1],U,$[3]||1,$[4]||0,$[5]||0,$[6]||0,P)}}return new Date(l)}(a),this.init()},c.init=function(){var a=this.$d;this.$y=a.getFullYear(),this.$M=a.getMonth(),this.$D=a.getDate(),this.$W=a.getDay(),this.$H=a.getHours(),this.$m=a.getMinutes(),this.$s=a.getSeconds(),this.$ms=a.getMilliseconds()},c.$utils=function(){return L},c.isValid=function(){return this.$d.toString()!==n},c.isSame=function(a,h){var l=B(a);return this.startOf(h)<=l&&l<=this.endOf(h)},c.isAfter=function(a,h){return B(a)<this.startOf(h)},c.isBefore=function(a,h){return this.endOf(h)<B(a)},c.$g=function(a,h,l){return L.u(a)?this[h]:this.set(l,a)},c.unix=function(){return Math.floor(this.valueOf()/1e3)},c.valueOf=function(){return this.$d.getTime()},c.startOf=function(a,h){var l=this,w=!!L.u(h)||h,$=L.p(a),U=function(pe,Q){var ce=L.w(l.$u?Date.UTC(l.$y,Q,pe):new Date(l.$y,Q,pe),l);return w?ce:ce.endOf(_)},P=function(pe,Q){return L.w(l.toDate()[pe].apply(l.toDate("s"),(w?[0,0,0,0]:[23,59,59,999]).slice(Q)),l)},q=this.$W,G=this.$M,ie=this.$D,ye="set"+(this.$u?"UTC":"");switch($){case H:return w?U(1,0):U(31,11);case z:return w?U(1,G):U(0,G+1);case D:var he=this.$locale().weekStart||0,le=(q<he?q+7:q)-he;return U(w?ie-le:ie+(6-le),G);case _:case u:return P(ye+"Hours",0);case x:return P(ye+"Minutes",1);case j:return P(ye+"Seconds",2);case g:return P(ye+"Milliseconds",3);default:return this.clone()}},c.endOf=function(a){return this.startOf(a,!1)},c.$set=function(a,h){var l,w=L.p(a),$="set"+(this.$u?"UTC":""),U=(l={},l[_]=$+"Date",l[u]=$+"Date",l[z]=$+"Month",l[H]=$+"FullYear",l[x]=$+"Hours",l[j]=$+"Minutes",l[g]=$+"Seconds",l[A]=$+"Milliseconds",l)[w],P=w===_?this.$D+(h-this.$W):h;if(w===z||w===H){var q=this.clone().set(u,1);q.$d[U](P),q.init(),this.$d=q.set(u,Math.min(this.$D,q.daysInMonth())).$d}else U&&this.$d[U](P);return this.init(),this},c.set=function(a,h){return this.clone().$set(a,h)},c.get=function(a){return this[L.p(a)]()},c.add=function(a,h){var l,w=this;a=Number(a);var $=L.p(h),U=function(G){var ie=B(w);return L.w(ie.date(ie.date()+Math.round(G*a)),w)};if($===z)return this.set(z,this.$M+a);if($===H)return this.set(H,this.$y+a);if($===_)return U(1);if($===D)return U(7);var P=(l={},l[j]=N,l[x]=E,l[g]=o,l)[$]||1,q=this.$d.getTime()+a*P;return L.w(q,this)},c.subtract=function(a,h){return this.add(-1*a,h)},c.format=function(a){var h=this,l=this.$locale();if(!this.isValid())return l.invalidDate||n;var w=a||"YYYY-MM-DDTHH:mm:ssZ",$=L.z(this),U=this.$H,P=this.$m,q=this.$M,G=l.weekdays,ie=l.months,ye=l.meridiem,he=function(Q,ce,xe,ge){return Q&&(Q[ce]||Q(h,w))||xe[ce].slice(0,ge)},le=function(Q){return L.s(U%12||12,Q,"0")},pe=ye||function(Q,ce,xe){var ge=Q<12?"AM":"PM";return xe?ge.toLowerCase():ge};return w.replace(p,function(Q,ce){return ce||function(xe){switch(xe){case"YY":return String(h.$y).slice(-2);case"YYYY":return L.s(h.$y,4,"0");case"M":return q+1;case"MM":return L.s(q+1,2,"0");case"MMM":return he(l.monthsShort,q,ie,3);case"MMMM":return he(ie,q);case"D":return h.$D;case"DD":return L.s(h.$D,2,"0");case"d":return String(h.$W);case"dd":return he(l.weekdaysMin,h.$W,G,2);case"ddd":return he(l.weekdaysShort,h.$W,G,3);case"dddd":return G[h.$W];case"H":return String(U);case"HH":return L.s(U,2,"0");case"h":return le(1);case"hh":return le(2);case"a":return pe(U,P,!0);case"A":return pe(U,P,!1);case"m":return String(P);case"mm":return L.s(P,2,"0");case"s":return String(h.$s);case"ss":return L.s(h.$s,2,"0");case"SSS":return L.s(h.$ms,3,"0");case"Z":return $}return null}(Q)||$.replace(":","")})},c.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},c.diff=function(a,h,l){var w,$=this,U=L.p(h),P=B(a),q=(P.utcOffset()-this.utcOffset())*N,G=this-P,ie=function(){return L.m($,P)};switch(U){case H:w=ie()/12;break;case z:w=ie();break;case T:w=ie()/3;break;case D:w=(G-q)/6048e5;break;case _:w=(G-q)/864e5;break;case x:w=G/E;break;case j:w=G/N;break;case g:w=G/o;break;default:w=G}return l?w:L.a(w)},c.daysInMonth=function(){return this.endOf(z).$D},c.$locale=function(){return S[this.$L]},c.locale=function(a,h){if(!a)return this.$L;var l=this.clone(),w=se(a,h,!0);return w&&(l.$L=w),l},c.clone=function(){return L.w(this.$d,this)},c.toDate=function(){return new Date(this.valueOf())},c.toJSON=function(){return this.isValid()?this.toISOString():null},c.toISOString=function(){return this.$d.toISOString()},c.toString=function(){return this.$d.toUTCString()},y}(),Se=we.prototype;return B.prototype=Se,[["$ms",A],["$s",g],["$m",j],["$H",x],["$W",_],["$M",z],["$y",H],["$D",u]].forEach(function(y){Se[y[1]]=function(c){return this.$g(c,y[0],y[1])}}),B.extend=function(y,c){return y.$i||(y(c,we,B),y.$i=!0),B},B.locale=se,B.isDayjs=K,B.unix=function(y){return B(1e3*y)},B.en=S[O],B.Ls=S,B.p={},B})})(Ve);var Ze=Ve.exports;const be=Oe(Ze);var Ee={exports:{}};(function(Z,ne){(function(o,N){Z.exports=N()})(De,function(){return function(o,N,E){o=o||{};var A=N.prototype,g={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function j(_,D,z,T){return A.fromToBase(_,D,z,T)}E.en.relativeTime=g,A.fromToBase=function(_,D,z,T,H){for(var u,n,m,p=z.$locale().relativeTime||g,M=o.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],Y=M.length,I=0;I<Y;I+=1){var O=M[I];O.d&&(u=T?E(_).diff(z,O.d,!0):z.diff(_,O.d,!0));var S=(o.rounding||Math.round)(Math.abs(u));if(m=u>0,S<=O.r||!O.r){S<=1&&I>0&&(O=M[I-1]);var R=p[O.l];H&&(S=H(""+S)),n=typeof R=="string"?R.replace("%d",S):R(S,D,O.l,m);break}}if(D)return n;var K=m?p.future:p.past;return typeof K=="function"?K(n):K.replace("%s",n)},A.to=function(_,D){return j(_,D,this,!0)},A.from=function(_,D){return j(_,D,this)};var x=function(_){return _.$u?E.utc():E()};A.toNow=function(_){return this.to(x(this),_)},A.fromNow=function(_){return this.from(x(this),_)}}})})(Ee);var dt=Ee.exports;const ft=Oe(dt);var Re={exports:{}};(function(Z,ne){(function(o,N){Z.exports=N()})(De,function(){var o="minute",N=/[+-]\d\d(?::?\d\d)?/g,E=/([+-]|\d\d)/g;return function(A,g,j){var x=g.prototype;j.utc=function(n){var m={date:n,utc:!0,args:arguments};return new g(m)},x.utc=function(n){var m=j(this.toDate(),{locale:this.$L,utc:!0});return n?m.add(this.utcOffset(),o):m},x.local=function(){return j(this.toDate(),{locale:this.$L,utc:!1})};var _=x.parse;x.parse=function(n){n.utc&&(this.$u=!0),this.$utils().u(n.$offset)||(this.$offset=n.$offset),_.call(this,n)};var D=x.init;x.init=function(){if(this.$u){var n=this.$d;this.$y=n.getUTCFullYear(),this.$M=n.getUTCMonth(),this.$D=n.getUTCDate(),this.$W=n.getUTCDay(),this.$H=n.getUTCHours(),this.$m=n.getUTCMinutes(),this.$s=n.getUTCSeconds(),this.$ms=n.getUTCMilliseconds()}else D.call(this)};var z=x.utcOffset;x.utcOffset=function(n,m){var p=this.$utils().u;if(p(n))return this.$u?0:p(this.$offset)?z.call(this):this.$offset;if(typeof n=="string"&&(n=function(O){O===void 0&&(O="");var S=O.match(N);if(!S)return null;var R=(""+S[0]).match(E)||["-",0,0],K=R[0],se=60*+R[1]+ +R[2];return se===0?0:K==="+"?se:-se}(n),n===null))return this;var M=Math.abs(n)<=16?60*n:n;if(M===0)return this.utc(m);var Y=this.clone();if(m)return Y.$offset=M,Y.$u=!1,Y;var I=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(Y=this.local().add(M+I,o)).$offset=M,Y.$x.$localOffset=I,Y};var T=x.format;x.format=function(n){var m=n||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return T.call(this,m)},x.valueOf=function(){var n=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*n},x.isUTC=function(){return!!this.$u},x.toISOString=function(){return this.toDate().toISOString()},x.toString=function(){return this.toDate().toUTCString()};var H=x.toDate;x.toDate=function(n){return n==="s"&&this.$offset?j(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():H.call(this)};var u=x.diff;x.diff=function(n,m,p){if(n&&this.$u===n.$u)return u.call(this,n,m,p);var M=this.local(),Y=j(n).local();return u.call(M,Y,m,p)}}})})(Re);var ht=Re.exports;const pt=Oe(ht);var Je={exports:{}};(function(Z,ne){(function(o,N){Z.exports=N()})(De,function(){var o={year:0,month:1,day:2,hour:3,minute:4,second:5},N={};return function(E,A,g){var j,x=function(T,H,u){u===void 0&&(u={});var n=new Date(T),m=function(p,M){M===void 0&&(M={});var Y=M.timeZoneName||"short",I=p+"|"+Y,O=N[I];return O||(O=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:p,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:Y}),N[I]=O),O}(H,u);return m.formatToParts(n)},_=function(T,H){for(var u=x(T,H),n=[],m=0;m<u.length;m+=1){var p=u[m],M=p.type,Y=p.value,I=o[M];I>=0&&(n[I]=parseInt(Y,10))}var O=n[3],S=O===24?0:O,R=n[0]+"-"+n[1]+"-"+n[2]+" "+S+":"+n[4]+":"+n[5]+":000",K=+T;return(g.utc(R).valueOf()-(K-=K%1e3))/6e4},D=A.prototype;D.tz=function(T,H){T===void 0&&(T=j);var u,n=this.utcOffset(),m=this.toDate(),p=m.toLocaleString("en-US",{timeZone:T}),M=Math.round((m-new Date(p))/1e3/60),Y=15*-Math.round(m.getTimezoneOffset()/15)-M;if(!Number(Y))u=this.utcOffset(0,H);else if(u=g(p,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(Y,!0),H){var I=u.utcOffset();u=u.add(n-I,"minute")}return u.$x.$timezone=T,u},D.offsetName=function(T){var H=this.$x.$timezone||g.tz.guess(),u=x(this.valueOf(),H,{timeZoneName:T}).find(function(n){return n.type.toLowerCase()==="timezonename"});return u&&u.value};var z=D.startOf;D.startOf=function(T,H){if(!this.$x||!this.$x.$timezone)return z.call(this,T,H);var u=g(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return z.call(u,T,H).tz(this.$x.$timezone,!0)},g.tz=function(T,H,u){var n=u&&H,m=u||H||j,p=_(+g(),m);if(typeof T!="string")return g(T).tz(m);var M=function(S,R,K){var se=S-60*R*1e3,B=_(se,K);if(R===B)return[se,R];var L=_(se-=60*(B-R)*1e3,K);return B===L?[se,B]:[S-60*Math.min(B,L)*1e3,Math.max(B,L)]}(g.utc(T,n).valueOf(),p,m),Y=M[0],I=M[1],O=g(Y).utcOffset(I);return O.$x.$timezone=m,O},g.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},g.tz.setDefault=function(T){j=T}}})})(Je);var mt=Je.exports;const vt=Oe(mt);var yt={exports:{}};(function(Z,ne){(function(o,N){Z.exports=N(Ze)})(De,function(o){function N(u){return u&&typeof u=="object"&&"default"in u?u:{default:u}}var E=N(o),A="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),g="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),j="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),x="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),_=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function D(u,n,m){var p,M;return m==="m"?n?"минута":"минуту":u+" "+(p=+u,M={mm:n?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[m].split("_"),p%10==1&&p%100!=11?M[0]:p%10>=2&&p%10<=4&&(p%100<10||p%100>=20)?M[1]:M[2])}var z=function(u,n){return _.test(n)?A[u.month()]:g[u.month()]};z.s=g,z.f=A;var T=function(u,n){return _.test(n)?j[u.month()]:x[u.month()]};T.s=x,T.f=j;var H={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:z,monthsShort:T,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:D,mm:D,h:"час",hh:D,d:"день",dd:D,M:"месяц",MM:D,y:"год",yy:D},ordinal:function(u){return u},meridiem:function(u){return u<4?"ночи":u<12?"утра":u<17?"дня":"вечера"}};return E.default.locale(H,null,!0),H})})(yt);const gt={class:"dynamics-chart-container"},xt={class:"text-sm font-semibold mb-2 flex items-center justify-between"},_t={class:"text-xs opacity-70"},bt={class:"chart-svg-container"},wt={class:"chart-svg-wrapper"},$t=["viewBox"],kt=["y1","y2"],Mt=["points"],Dt=["cx","cy"],St={class:"mt-3 text-xs opacity-80 leading-relaxed"},Tt={class:"pagination-dots"},Ct=["onClick"],ze=300,Ce=80,He=6,Ht=Ne({__name:"DynamicsChart",props:{dynamics:{}},setup(Z){const ne=Z,o=re(0),N=re(0),E=re(0),A=re("slide-left"),g=b(()=>ne.dynamics[o.value]||{metric:"",values:[],interpretation:""}),j=b(()=>g.value.values||[]),x=b(()=>{const n=j.value;if(n.length===0)return[];const m=ze-He*2,p=Ce-He*2,M=n.length>1?m/(n.length-1):0;return n.map((Y,I)=>({x:He+I*M,y:He+p-Y/10*p}))}),_=b(()=>x.value.map(n=>`${n.x},${n.y}`).join(" "));function D(n){N.value=n.touches[0].clientX}function z(n){E.value=n.touches[0].clientX}function T(){const n=N.value-E.value;Math.abs(n)>50&&(n>0&&o.value<ne.dynamics.length-1?(A.value="slide-left",o.value++,u()):n<0&&o.value>0&&(A.value="slide-right",o.value--,u())),N.value=0,E.value=0}function H(n){n!==o.value&&(A.value=n>o.value?"slide-left":"slide-right",o.value=n,u())}function u(){window.triggerHaptic&&window.triggerHaptic("light")}return(n,m)=>(f(),v("div",gt,[i("div",{class:"chart-wrapper",onTouchstart:D,onTouchmove:z,onTouchend:T},[Pe(st,{name:A.value,mode:"out-in"},{default:nt(()=>[(f(),v("div",{key:o.value,class:"chart-content"},[i("div",xt,[i("span",null,X(g.value.metric),1),i("span",_t,X(j.value[j.value.length-1])+"/10",1)]),i("div",bt,[m[0]||(m[0]=i("div",{class:"y-axis-labels"},[i("span",{class:"y-label"},"10"),i("span",{class:"y-label"},"5"),i("span",{class:"y-label"},"0")],-1)),i("div",wt,[(f(),v("svg",{viewBox:`0 0 ${ze} ${Ce}`,class:"chart-svg",preserveAspectRatio:"xMidYMid meet"},[(f(),v(ee,null,ae(3,p=>i("line",{key:`grid-${p}`,x1:0,x2:ze,y1:Ce/2*(p-1),y2:Ce/2*(p-1),stroke:"white","stroke-opacity":"0.15","stroke-width":"1"},null,8,kt)),64)),i("polyline",{points:_.value,fill:"none",stroke:"white","stroke-width":"2.5","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Mt),(f(!0),v(ee,null,ae(x.value,(p,M)=>(f(),v("circle",{key:`point-${M}`,cx:p.x,cy:p.y,r:"4",fill:"white","vector-effect":"non-scaling-stroke"},null,8,Dt))),128))],8,$t))])]),i("div",St,X(g.value.interpretation),1)]))]),_:1},8,["name"])],32),i("div",Tt,[(f(!0),v(ee,null,ae(Z.dynamics,(p,M)=>(f(),v("button",{key:`dot-${M}`,class:ve(["dot",{active:M===o.value}]),onClick:Y=>H(M)},null,10,Ct))),128))])]))}}),Ot=Ue(Ht,[["__scopeId","data-v-6967313e"]]),Lt={class:"flex justify-between items-center py-2 min-h-[2.5rem]"},jt={class:"truncate"},Yt={class:"bg-white/10 rounded-full px-2 py-1 text-sm min-w-[3rem] text-center whitespace-nowrap"},At={key:0,class:"mt-4 space-y-4 text-sm fade-seq is-open"},zt={key:0,class:"flex flex-wrap gap-2"},Ft={class:"rounded-lg bg-white/10"},Nt={class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},Ut=["innerHTML"],It={key:0,class:"pt-2"},Bt={class:"flex flex-wrap gap-2"},Wt={key:0,class:"rounded-lg bg-white/10"},Pt={class:"px-3 pb-3 text-white/90 leading-snug"},Vt={key:1,class:"rounded-lg bg-white/10"},Zt={class:"px-3 pb-3 text-white/90 leading-snug"},Et={class:"list-disc pl-5 space-y-1"},Rt={key:2,class:"rounded-lg bg-white/10"},Jt={class:"px-3 pb-3 text-white/90 leading-snug"},qt={class:"list-disc pl-5 space-y-1"},Xt={class:"rounded-lg bg-white/10 border-l-4 border-pink-400"},Gt={class:"px-3 pb-3 text-white/90 leading-snug"},Kt={class:"mt-2 flex justify-end"},Qt={class:"space-y-2"},es=["onClick"],ts={class:"opacity-80 inline-block",style:{fontSize:"130%"}},ss={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},ns=["innerHTML"],is={key:0,class:"space-y-2"},rs={class:"flex justify-between text-xs opacity-80"},as={class:"relative h-2 w-full bg-white/10 rounded overflow-hidden"},os={class:"pt-2 text-xs opacity-80 flex flex-wrap items-center gap-4"},ls={class:"inline-flex items-center gap-2"},cs={class:"mt-4 flex gap-2"},us={key:3,class:"mt-3 text-xs bg-black/20 rounded-lg p-2 font-mono whitespace-pre-wrap break-words"},ds={class:"mt-2 flex justify-end"},fs={key:0,class:"space-y-3"},hs={class:"grid grid-cols-2 gap-2"},ps=["onClick"],ms={class:"flex justify-end gap-2 pt-2"},vs=["disabled"],ys={key:1,class:"space-y-3"},gs={class:"grid grid-cols-2 gap-2"},xs={class:"flex justify-end gap-2 pt-2"},_s=["disabled"],bs=48,ws=Ne({__name:"DreamCard",props:{dream:{},active:{type:Boolean}},emits:["toggle"],setup(Z,{emit:ne}){be.extend(ft),be.locale("ru"),be.extend(pt),be.extend(vt);const o=Z,N=ne,E=()=>{N("toggle"),window.triggerHaptic&&window.triggerHaptic("light")},A=it(),g=rt(),j=re(!0),x=b(()=>{var e;return!!((e=o.dream)!=null&&e.is_deep_analysis)}),_=b({get:()=>{var e,t,s;return((e=o.dream)==null?void 0:e.user_feedback)??((s=(t=o.dream)==null?void 0:t.deep_source)==null?void 0:s.user_feedback)??0},set:e=>{o.dream&&(o.dream.user_feedback=e,o.dream.deep_source||(o.dream.deep_source={}),o.dream.deep_source.user_feedback=e)}}),D={like:!1,dislike:!1,delete:!1},z=async e=>{if(D.like||D.dislike)return;const t=e===1?_.value===1?0:1:_.value===2?0:2,s=_.value;_.value=t;try{window.triggerHaptic&&window.triggerHaptic("medium"),e===1?D.like=!0:D.dislike=!0,await Ae.postAnalysisFeedback(o.dream.id,t),t===0?g.info("Оценка снята"):t===1?g.success("Добавлено: нравится"):t===2&&g.success("Добавлено: не нравится")}catch(r){_.value=s,console.error("Feedback error",r),g.error("Не удалось сохранить оценку")}finally{D.like=D.dislike=!1}},T=()=>z(1),H=()=>z(2),u=async()=>{var s;if(D.delete)return;const e=(s=window.Telegram)==null?void 0:s.WebApp;if(await new Promise(r=>{e!=null&&e.showPopup?e.showPopup({title:"Удалить запись?",message:"Действие необратимо",buttons:[{id:"yes",type:"destructive",text:"Удалить"},{id:"no",type:"cancel",text:"Отмена"}]},d=>r(d==="yes")):r(window.confirm("Удалить запись?"))}))try{D.delete=!0,window.triggerHaptic&&window.triggerHaptic("heavy"),await Ae.deleteAnalysis(o.dream.id);const r=A.history.findIndex(d=>d.id===o.dream.id);r>-1&&A.history.splice(r,1),A.fetchProfile(),g.success("Запись удалена")}catch(r){console.error("Delete error",r),g.error("Не удалось удалить запись")}finally{D.delete=!1}},n=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]);function m(e){return e.replace(/\s+/g," ").trim().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function p(e){if(!e)return"";const t=String(e).split(/[.!?\n]/)[0],r=t.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(d=>d&&!n.has(d)&&d.length>3).slice(0,3);return r.length===0?t.slice(0,40):m(r.join(" "))}function M(e){if(!e)return"";let t=String(e).toLowerCase().replace(/["'«»]/g,"").trim();t=t.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),t=t.replace(/\s+/g," ").trim();const s=t.split(" ").filter(Boolean).slice(0,3);return s.length?s.join(" "):""}function Y(e){if(!e)return"";const t=String(e).toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}const I=b(()=>{var k,F,C,W,J;const e=M((F=(k=o.dream)==null?void 0:k.deep_source)==null?void 0:F.title);if(e)return Y(e);const t=(((W=(C=o.dream)==null?void 0:C.deep_source)==null?void 0:W.tags)||[]).filter(Boolean),s=ue=>{var de;let oe=String(ue||"").trim();return oe=((de=oe.split(/[\\/,(;:—–-]/)[0])==null?void 0:de.trim())||"",oe?oe.charAt(0).toUpperCase()+oe.slice(1).toLowerCase():""},r=t.map(s).filter(Boolean);if(r.length){const ue=r.slice(0,2).join(" и ");return Y(ue||"Без названия")}const d=M(p((J=o.dream)==null?void 0:J.dream_text));return Y(d||"Без названия")}),O=b(()=>{var s,r;const e=(r=(s=o.dream)==null?void 0:s.deep_source)==null?void 0:r.tags;if(!Array.isArray(e))return[];const t=d=>{var F;let k=String(d||"").trim();return k=((F=k.split(/[\\/,(;:—–-]/)[0])==null?void 0:F.trim())||"",k?k.charAt(0).toUpperCase()+k.slice(1).toLowerCase():""};return e.map(t).filter(Boolean).slice(0,5)});function S(e){return String(e||"").replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").replace(/\(\s*\d+\s*\)/g,"").replace(/\s\[\s*\d+\s*\]/g,"").replace(/[\u00B9\u00B2\u00B3\u2070-\u2079]/g,"")}re("context");const R=b(()=>{var e;return S(((e=o.dream)==null?void 0:e.analysis)||"")}),K=b(()=>{var e,t;return((t=(e=o.dream)==null?void 0:e.deep_source)==null?void 0:t.overallContext)||{}});b(()=>{const e=K.value;return!!(e!=null&&e.narrative||e!=null&&e.psychologicalFunction||e!=null&&e.emotionalJourney)}),b(()=>{var t,s;const e=(s=(t=o.dream)==null?void 0:t.deep_source)==null?void 0:s.recurringSymbols;return Array.isArray(e)?e:[]});const se=b(()=>{var t,s;const e=(s=(t=o.dream)==null?void 0:t.deep_source)==null?void 0:s.dynamics;return Array.isArray(e)&&e.length>0?e:[]});b(()=>se.value.length>0);const B=b(()=>{var t,s;const e=(s=(t=o.dream)==null?void 0:t.deep_source)==null?void 0:s.conclusions;return Array.isArray(e)&&e.length>0?e:[]});b(()=>B.value.length>0);const L=b(()=>{var F,C;const e=(C=(F=o.dream)==null?void 0:F.deep_source)==null?void 0:C.recommendations;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="object")return e;if(Array.isArray(e)&&e.length>0)return e.map((W,J)=>({title:`Рекомендация ${J+1}`,description:String(W),rationale:""}));const t=a.value;if(t.length===0)return[];const s=[0,0,0,0];for(const W of t)for(let J=0;J<4;J++)s[J]+=W[J];const r=Math.max(1,t.length);for(let W=0;W<4;W++)s[W]=Math.round(s[W]/r);const d=[["Персонажи","Обрати внимание на отношения и роли; практикуй честную коммуникацию."],["Эмоции","Добавь ежедневную регуляцию эмоций (дыхание, дневник, прогулка)."],["Действия","Определи 1 маленький шаг на неделю и заверши его."],["Сцены","Проверь границы и режим: место/время, где тебе спокойнее."]],k=s.map((W,J)=>({i:J,v:W})).sort((W,J)=>J.v-W.v).map(W=>W.i);return[{title:d[k[0]][0],description:d[k[0]][1],rationale:""},{title:d[k[1]][0],description:d[k[1]][1],rationale:""}]});b(()=>L.value.length>0);function we(e,t){var s;try{let r=e;const d=Array.from(new Set((t||[]).filter(Boolean))).sort((k,F)=>F.length-k.length);for(const k of d){const F=(s=String(k).split(/[\\/,(;:—–-]/)[0])==null?void 0:s.trim();if(!F)continue;const C=new RegExp(`(\b${F.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\b)`,"gi");r=r.replace(C,'<mark class="bg-white/20 px-1 rounded">$1</mark>')}return r.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1")}catch{return e}}const Se=b(()=>{var e,t;return we(R.value,((t=(e=o.dream)==null?void 0:e.deep_source)==null?void 0:t.tags)||[])});function y(e){try{return new Date(e).getTime()||0}catch{return 0}}const c=b(()=>(A.history||[]).filter(e=>{var t;return!e.is_deep_analysis&&((t=e==null?void 0:e.deep_source)==null?void 0:t.hvdc)&&(e==null?void 0:e.created_at)}).sort((e,t)=>y(e.created_at)>y(t.created_at)?-1:1)),a=b(()=>{var r;const e=y(((r=o.dream)==null?void 0:r.created_at)||""),t=c.value.filter(d=>!x.value||(e?y(d.created_at)<=e:!0)).slice(0,5).reverse(),s=["characters","emotions","actions","settings"];return t.map(d=>s.map(k=>{var F,C;return Number(((C=(F=d.deep_source.hvdc)==null?void 0:F.distribution)==null?void 0:C[k])||0)}))}),h=b(()=>a.value.length),l=b(()=>h.value>=2),w=b(()=>Math.max(60,(h.value-1)*28+8));function $(e){const t=e.length,s=w.value,r=bs,d=t>1?(s-8)/(t-1):0,k=[];for(let C=0;C<t;C++){const W=C*d,J=r-Math.round(e[C]/100*r);k.push({x:W,y:J})}return{str:k.map(C=>`${C.x},${C.y}`).join(" "),pts:k}}b(()=>{const e=[{key:"characters",label:"Персонажи",idx:0,opacity:.95},{key:"emotions",label:"Эмоции",idx:1,opacity:.75},{key:"actions",label:"Действия",idx:2,opacity:.55},{key:"settings",label:"Сцены",idx:3,opacity:.35}],t=[],s=a.value;for(const r of e){const d=s.map(C=>C[r.idx]),{str:k,pts:F}=$(d);t.push({key:r.key,label:r.label,values:d,points:k,pointList:F,opacity:r.opacity})}return t});const U=b(()=>{if(!l.value)return[];const e=[{key:"characters",label:"Персонажи",idx:0},{key:"emotions",label:"Эмоции",idx:1},{key:"actions",label:"Действия",idx:2},{key:"settings",label:"Сцены",idx:3}],t=a.value;return e.map(s=>({metric:s.label,values:t.map(r=>r[s.idx]),interpretation:`Динамика "${s.label}" по последним ${h.value} снам`}))});function P(e){const s=e.split(/\n+/).map(r=>r.trim()).filter(Boolean).filter(r=>/^\d+\./.test(r)).map(r=>r.replace(/^\d+\.\s*/,"")).slice(0,3);return s.length?s:e.split(/[.!?]\s+/).map(r=>r.trim()).filter(Boolean).slice(0,3)}const q=b(()=>P(R.value));function G(e){try{const t=String(e||"").toLowerCase(),s=_e=>_e.reduce((Ye,tt)=>Ye+(t.includes(tt)?1:0),0),r=["страх","ужас","паник","тревог","стыд","гнев","плак","слез","кошмар","тоска","грусть"],d=["экзам","выступл","собесед","защит","проект","подготов","завтра","ожидан","волнен","поездк","путешеств","нов","интервью"],k=["вчера","сегодня","работ","школ","универ","дом","улиц","друг","родител","коллег","город"],F=s(r),C=s(d),W=s(k);let J=F>0?Math.min(1,F/3):0,ue=C>0?Math.min(1,C/3):0,oe=W>0?Math.min(1,.5+W/5):0;J===0&&ue===0&&oe===0&&(oe=.6,J=.2,ue=.2);const de={schema:"dream_type_v1",scores:{memory:+oe.toFixed(2),emotion:+J.toFixed(2),anticipation:+ue.toFixed(2)}},V=[["memory",de.scores.memory],["emotion",de.scores.emotion],["anticipation",de.scores.anticipation]];V.sort((_e,Ye)=>Ye[1]-_e[1]);const me=+Math.max(0,V[0][1]-V[1][1]).toFixed(2);return{...de,dominant:V[0][0],confidence:me}}catch{return null}}const ie=b(()=>{var e,t,s;return((t=(e=o.dream)==null?void 0:e.deep_source)==null?void 0:t.dream_type)||G((s=o.dream)==null?void 0:s.dream_text)||null});function ye(){const e=ie.value;if(!e||!e.dominant)return['<div class="space-y-2">','<div class="font-semibold">🛠 Небольшая работа со сном</div>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Заметь:</span> Какие 2–3 образа из сна самые сильные? Запиши их коротко.</li>','<li><span class="font-semibold">Шаг:</span> Выбери один маленький шаг в реальности, который поддержит тебя по теме сна.</li>',"</ol>","</div>"].join("");const t=String(e.dominant).toLowerCase();return t==="memory"?['<div class="space-y-2">','<div class="font-semibold">🌙 Сон-Память</div>','<p class="opacity-90">Переработка недавнего опыта, соединение нового с прошлым.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Отрази:</span> Вспомни, что происходило последние 1–2 дня. Какие события могли попасть в сон?</li>','<li><span class="font-semibold">Соедини:</span> Отметь, какие элементы сна перекликаются с реальностью — это завершает «архивацию» опыта.</li>',"</ol>","</div>"].join(""):t==="emotion"?['<div class="space-y-2">','<div class="font-semibold">⚡️ Сон-Эмоция</div>','<p class="opacity-90">Проживание и нейтрализация сильных чувств.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Почувствуй:</span> Определи, какая эмоция была самой сильной во сне. Где она чувствуется в теле сейчас?</li>','<li><span class="font-semibold">Услышь:</span> Представь, что главный персонаж сна говорит тебе что-то. Что он хочет, чтобы ты понял?</li>',"</ol>","</div>"].join(""):['<div class="space-y-2">','<div class="font-semibold">🔮 Сон-Предвосхищение</div>','<p class="opacity-90">Тренировка будущих ситуаций и реакций.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Представь:</span> Как бы ты хотел повести себя, если бы это произошло в реальности?</li>','<li><span class="font-semibold">Расшифруй:</span> Какой символ кажется ключевым? Что он может говорить о твоих страхах или намерениях?</li>',"</ol>","</div>"].join("")}const he=b(()=>{var ue,oe,de;const e=S(((ue=o.dream)==null?void 0:ue.analysis)||"");if(!e)return[];const t={arch:{key:"arch",title:"Архетипическая история",text:""},func:{key:"func",title:"Возможная функция сна",text:""},freud:{key:"freud",title:"По Фрейду",text:""},jung:{key:"jung",title:"По Юнгу",text:""}},s=[],r=/\*\*([^*]+)\*\*/g;let d;for(;d=r.exec(e);)s.push({title:d[1].trim(),start:d.index,end:d.index+d[0].length});const k=((oe=s[0])==null?void 0:oe.start)??e.length;t.arch.text=e.slice(0,k).trim();for(let V=0;V<s.length;V++){const me=s[V].title.toLowerCase(),_e=e.slice(s[V].end,((de=s[V+1])==null?void 0:de.start)??e.length).trim();me.includes("возможная функция")?t.func.text=_e:me.includes("по фрейду")?t.freud.text=_e:me.includes("по юнгу")&&(t.jung.text=_e)}const F=V=>V.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1"),C=Object.values(t).map(V=>({...V,html:F(V.text||"")}));C.some(V=>V.key==="func")||C.push({key:"func",title:"Возможная функция сна",text:"",html:""});const W=C.findIndex(V=>V.key==="arch");W!==-1&&C.splice(W+1,0,{key:"hvdc",title:"Контент анализ",text:"",html:""});const J=ye();if(J){const V=C.findIndex(me=>me.key==="func");if(V!==-1){const me=['<div class="mt-3 pt-2 border-t border-white/10 space-y-1">','<div class="font-semibold">Функциональное упражнение</div>',J,"</div>"].join("");C[V].html=(C[V].html||"")+me}}return C}),le=at({arch:!0,hvdc:!1,func:!1,freud:!1,jung:!1});function pe(e){le[e]=!le[e]}const Q=b(()=>{try{return new URLSearchParams(window.location.search).get("debug")==="1"||localStorage.getItem("da_debug")==="1"}catch{return!1}});function ce(){var e,t,s,r,d;try{const k=JSON.stringify(ge.value,null,2);(e=navigator.clipboard)==null||e.writeText(k),(t=g==null?void 0:g.success)==null||t.call(g,"Скопировано")}catch{try{(d=(r=(s=window.Telegram)==null?void 0:s.WebApp)==null?void 0:r.showPopup)==null||d.call(r,{title:"Debug",message:"Скопируйте из блока ниже вручную",buttons:[{id:"ok",type:"default",text:"OK"}]})}catch{}}}function xe(e){var s;let t=String(e||"").trim();return t=((s=t.split(/[\\/,(;:—–-]/)[0])==null?void 0:s.trim())||"",t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}const ge=b(()=>{var s,r,d,k;if(!Q.value)return null;const e=o.dream||{},t=Array.isArray((s=e==null?void 0:e.deep_source)==null?void 0:s.tags)?e.deep_source.tags:[];return{id:e.id,created_at:e.created_at,is_deep_analysis:!!e.is_deep_analysis,title_raw:((r=e==null?void 0:e.deep_source)==null?void 0:r.title)||null,tags_raw:t,tags_norm:t.map(xe),dream_type:((d=e==null?void 0:e.deep_source)==null?void 0:d.dream_type)||null,hvdc_present:!!((k=e==null?void 0:e.deep_source)!=null&&k.hvdc)}}),Le=re(!1),Ie=re(1),qe=["0-20","20-30","30-40","40-50","50+"],Te=re(""),$e=re("");function je(){Le.value=!1}async function Xe(){try{await Ae.setDemographics(Te.value,$e.value);try{await A.fetchProfile()}catch{}g.success("Готово! Дальнейшие анализы будут учитывать эти данные"),Le.value=!1}catch{g.error("Не удалось сохранить")}}b(()=>{const e=A.profile||{};return!!(e.age_range&&e.gender)});const ke=b(()=>{var e,t;return((t=(e=o.dream)==null?void 0:e.deep_source)==null?void 0:t.hvdc)||null}),Ge=b(()=>{var d,k,F;const e=[{key:"characters",label:"Персонажи"},{key:"emotions",label:"Эмоции"},{key:"actions",label:"Действия"},{key:"settings",label:"Сцены"}],t=((d=ke.value)==null?void 0:d.distribution)||{},s=((k=ke.value)==null?void 0:k.norm)||null,r=((F=ke.value)==null?void 0:F.comparison)||null;return e.map(C=>({key:C.key,label:C.label,value:Number(t[C.key]??0),norm:s?Number(s[C.key]??0):null,delta:r?Number(r[C.key]??0):null}))}),Ke=b(()=>{var F;const e=((F=ke.value)==null?void 0:F.norm_group)||null;if(!e)return"общая статистика";const t=String(e.gender||"").toLowerCase(),s=t==="male"?"муж.":t==="female"?"жен.":"",r=e.age_range||"",d=r?`${r} лет`:"",k=[s,d].filter(Boolean).join(" ");return k?`общая статистика* для ${k}`:"общая статистика"}),Qe=b(()=>{if(!o.dream.created_at)return"";try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone||be.tz.guess(),t=be.utc(o.dream.created_at).tz(e).startOf("day"),r=be().tz(e).startOf("day").diff(t,"day"),d=Math.floor(r/7),k=Math.floor(r/30),F=Math.floor(r/365);return r===0?"сегодня":r===1?"вчера":r<7?`${r} д`:r<30?`${d} н`:r<365?`${k} м`:`${F} г`}catch{return o.dream.created_at}}),et=b(()=>{var e;return(e=o.dream)!=null&&e.is_deep_analysis?"from-[#9C41FF] to-[#C03AFF]":"from-[#4A58FF] to-[#5664FF]"});return(e,t)=>(f(),v("article",{class:ve(["rounded-xl bg-gradient-to-br text-white px-8 md:px-16 transition-all overflow-hidden cursor-pointer py-6",[Z.active?"":"min-h-[4.5rem]",et.value]]),onClick:E},[i("div",Lt,[i("h3",jt,X(I.value),1),i("span",Yt,X(Qe.value),1)]),Z.active?(f(),v("div",At,[O.value.length&&!x.value?(f(),v("div",zt,[(f(!0),v(ee,null,ae(O.value,s=>(f(),v("span",{key:s,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},X(s),1))),128))])):te("",!0),x.value?(f(),v(ee,{key:1},[i("div",Ft,[t[8]||(t[8]=i("div",{class:"px-3 py-2 font-semibold"},"Общий контекст серии",-1)),i("div",Nt,[i("div",{innerHTML:Se.value},null,8,Ut),O.value.length?(f(),v("div",It,[t[7]||(t[7]=i("div",{class:"text-xs opacity-80 mb-1"},"Повторяющиеся символы",-1)),i("div",Bt,[(f(!0),v(ee,null,ae(O.value,s=>(f(),v("span",{key:"deep-"+s,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},X(s),1))),128))])])):te("",!0)])]),l.value?(f(),v("div",Wt,[t[9]||(t[9]=i("div",{class:"px-3 py-2 font-semibold"},"Динамика",-1)),i("div",Pt,[Pe(Ot,{dynamics:U.value},null,8,["dynamics"])])])):te("",!0),q.value.length?(f(),v("div",Vt,[t[10]||(t[10]=i("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),i("div",Zt,[i("ul",Et,[(f(!0),v(ee,null,ae(q.value,(s,r)=>(f(),v("li",{key:"in"+r,class:"text-xs"},X(s),1))),128))])])])):te("",!0),L.value.length?(f(),v("div",Rt,[t[11]||(t[11]=i("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),i("div",Jt,[i("ul",qt,[(f(!0),v(ee,null,ae(L.value,(s,r)=>(f(),v("li",{key:"rec"+r,class:"text-xs"},X(typeof s=="string"?s:s.title),1))),128))])])])):te("",!0)],64)):(f(),v(ee,{key:2},[i("div",Xt,[t[12]||(t[12]=i("div",{class:"px-3 py-2 font-semibold flex items-center justify-between"},[i("span",null,"Сон"),i("span",{class:"opacity-80 text-pink-400",style:{"font-size":"130%","font-family":"ui-rounded, -apple-system, system-ui, 'SF Pro Rounded', 'Segoe UI', Roboto, Arial"}},"“")],-1)),i("div",Gt,[i("p",{class:ve(["opacity-90",j.value?"clamp-5":""])},X(Z.dream.dream_text),3),i("div",Kt,[i("button",{class:"text-sm font-semibold opacity-80 hover:opacity-100",onClick:t[0]||(t[0]=fe(s=>j.value=!j.value,["stop"]))},X(j.value?"+":"−"),1)])])]),i("div",Qt,[(f(!0),v(ee,null,ae(he.value,(s,r)=>(f(),v("div",{key:s.key,class:"rounded-lg bg-white/10"},[i("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:fe(d=>pe(s.key),["stop"])},[i("span",null,X(s.title),1),i("span",ts,X(le[s.key]?"−":"+"),1)],8,es),le[s.key]?(f(),v("div",ss,[s.key!=="hvdc"?(f(),v("div",{key:0,innerHTML:s.html},null,8,ns)):(f(),v(ee,{key:1},[ke.value?(f(),v("div",is,[(f(!0),v(ee,null,ae(Ge.value,d=>(f(),v("div",{key:d.key},[i("div",rs,[i("span",null,X(d.label),1),i("span",null,[Me(X(d.value)+"% ",1),d.norm!==null?(f(),v(ee,{key:0},[Me(" / "+X(d.norm)+"%",1)],64)):te("",!0),d.delta!==null?(f(),v("span",{key:1,class:ve(d.delta>0?"text-green-300":d.delta<0?"text-red-300":"text-white/70")}," ("+X(d.delta>0?"+"+d.delta:d.delta)+"pp) ",3)):te("",!0)])]),i("div",as,[d.norm!==null?(f(),v("div",{key:0,class:"absolute inset-y-0 left-0 bg-white/20",style:Be({width:d.norm+"%"})},null,4)):te("",!0),i("div",{class:"relative h-full bg-white/70",style:Be({width:d.value+"%"})},null,4)])]))),128)),i("div",os,[t[14]||(t[14]=i("span",{class:"inline-flex items-center gap-2"},[i("span",{class:"w-2 h-2 rounded-full inline-block bg-white/70 shrink-0"}),Me(" ваш сон")],-1)),i("span",ls,[t[13]||(t[13]=i("span",{class:"w-2 h-2 rounded-full inline-block bg-white/20 shrink-0"},null,-1)),Me(" "+X(Ke.value),1)])]),t[15]||(t[15]=i("div",{class:"text-xs opacity-70 flex items-start gap-2"},[i("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-white/20 text-white text-[10px]"},"i"),i("span",null,"Контент‑анализ по схеме HVdC; сравнение с демографическими нормами (DreamBank, SDDB).")],-1))])):te("",!0)],64))])):te("",!0)]))),128))])],64)),i("div",cs,[i("button",{class:ve(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",_.value===1?"bg-green-500/30 text-white ring-2 ring-green-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:fe(T,["stop"])}," 👍 ",2),i("button",{class:ve(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",_.value===2?"bg-red-500/30 text-white ring-2 ring-red-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:fe(H,["stop"])}," 👎 ",2),i("button",{class:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-white rounded-xl py-2 text-sm font-medium text-center transition-colors",onClick:fe(u,["stop"])}," 🗑️ ")]),Q.value&&ge.value?(f(),v("div",us,[t[16]||(t[16]=i("div",{class:"mb-2 opacity-80"},"Debug payload",-1)),Me(" "+X(JSON.stringify(ge.value,null,2))+" ",1),i("div",ds,[i("button",{class:"px-3 py-1 rounded bg-white/10 hover:bg-white/20",onClick:fe(ce,["stop"])},"Скопировать")])])):te("",!0),(f(),Fe(ot,{to:"body"},[Le.value?(f(),v("div",{key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70",onClick:fe(je,["self"]),onWheel:t[5]||(t[5]=fe(()=>{},["prevent"])),onTouchmove:t[6]||(t[6]=fe(()=>{},["prevent"]))},[i("div",{class:"w-[92vw] max-w-[440px] rounded-2xl bg-[var(--tg-theme-secondary-bg-color,#0c110c)] text-white p-4 shadow-2xl border border-white/10",onClick:t[4]||(t[4]=fe(()=>{},["stop"]))},[t[19]||(t[19]=i("h3",{class:"text-lg font-semibold mb-2"},"Уточнить данные",-1)),Ie.value===1?(f(),v("div",fs,[t[17]||(t[17]=i("p",{class:"opacity-90"},"Ваш возрастной диапазон:",-1)),i("div",hs,[(f(),v(ee,null,ae(qe,s=>i("button",{key:s,class:ve(["px-4 py-3 rounded-xl text-sm",Te.value===s?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:r=>Te.value=s},X(s),11,ps)),64))]),i("div",ms,[i("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:je},"Отмена"),i("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Te.value,onClick:t[1]||(t[1]=s=>Ie.value=2)},"Далее",8,vs)])])):(f(),v("div",ys,[t[18]||(t[18]=i("p",{class:"opacity-90"},"Ваш пол:",-1)),i("div",gs,[i("button",{class:ve(["px-4 py-3 rounded-xl text-sm",$e.value==="male"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[2]||(t[2]=s=>$e.value="male")},"Мужской",2),i("button",{class:ve(["px-4 py-3 rounded-xl text-sm",$e.value==="female"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[3]||(t[3]=s=>$e.value="female")},"Женский",2)]),i("div",xs,[i("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:je},"Отмена"),i("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!$e.value,onClick:Xe},"Сохранить",8,_s)])]))])],32)):te("",!0)]))])):te("",!0)],2))}}),We=Ue(ws,[["__scopeId","data-v-6af21dc9"]]),$s={class:"flex items-center justify-between mb-4"},ks={class:"inline-flex items-center gap-2 rounded-full px-3 py-1 themed-badge"},Ms={key:0,class:"flex flex-col gap-4 pb-[5vh]"},Ds={key:1,class:"text-center text-red-400 py-8"},Ss={key:2},Ts={key:0,class:"text-center text-white/60 py-8"},Cs={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Hs={key:3},Os={key:0,class:"text-center text-white/60 py-8"},Ls={key:1,class:"flex flex-col gap-4 pb-[5vh]"},js=Ne({__name:"AnalysisHistoryList",props:["userStore"],setup(Z){const ne=Z,o=re(null),N=re(5),E=re(5),A=re("history"),g=b({get:()=>A.value,set:m=>n(m)}),j=b(()=>{var m;return(m=ne.userStore)!=null&&m.history?ne.userStore.history.filter(p=>!p.is_deep_analysis):[]}),x=b(()=>{var m;return(m=ne.userStore)!=null&&m.history?ne.userStore.history.filter(p=>p.is_deep_analysis):[]}),_=b(()=>j.value.slice(0,N.value)),D=b(()=>x.value.slice(0,E.value)),z=b(()=>j.value.length>N.value),T=b(()=>x.value.length>E.value),H=()=>{window.triggerHaptic&&window.triggerHaptic("light"),N.value+=5},u=()=>{window.triggerHaptic&&window.triggerHaptic("light"),E.value+=5},n=m=>{window.triggerHaptic&&window.triggerHaptic("light"),A.value=m,o.value=null};return(m,p)=>{var M,Y,I,O;return f(),v("div",null,[i("div",$s,[p[2]||(p[2]=i("h2",{class:"text-3xl font-bold"},"История",-1)),i("div",ks,[lt(i("select",{"aria-label":"Режим истории","onUpdate:modelValue":p[0]||(p[0]=S=>g.value=S),class:"bg-transparent focus:outline-none themed-select"},[...p[1]||(p[1]=[i("option",{value:"history"},"Дневник снов",-1),i("option",{value:"deep"},"Глубокий анализ",-1)])],512),[[ct,g.value]])])]),(M=Z.userStore)!=null&&M.isLoadingHistory?(f(),v("div",Ms,[(f(),v(ee,null,ae(3,S=>i("div",{key:S,class:"rounded-xl bg-white/10 px-8 md:px-16 py-6"},[...p[3]||(p[3]=[ut('<div class="flex justify-between items-center py-2 min-h-[2.5rem]" data-v-14de94bb><div class="shimmer h-4 w-32 rounded" data-v-14de94bb></div><div class="shimmer h-4 w-12 rounded" data-v-14de94bb></div></div><div class="mt-4 space-y-2" data-v-14de94bb><div class="shimmer h-3 w-full rounded" data-v-14de94bb></div><div class="shimmer h-3 w-5/6 rounded" data-v-14de94bb></div><div class="shimmer h-3 w-2/3 rounded" data-v-14de94bb></div></div><div class="mt-4 grid grid-cols-3 gap-2" data-v-14de94bb><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div></div>',3)])])),64))])):(Y=Z.userStore)!=null&&Y.errorHistory?(f(),v("div",Ds," Ошибка загрузки: "+X(Z.userStore.errorHistory),1)):A.value==="history"?(f(),v("div",Ss,[(I=j.value)!=null&&I.length?(f(),v("div",Cs,[(f(!0),v(ee,null,ae(_.value,S=>(f(),Fe(We,{key:S.id,dream:S,active:o.value===S.id,onToggle:R=>o.value=o.value===S.id?null:S.id},null,8,["dream","active","onToggle"]))),128)),z.value?(f(),v("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:H}," Загрузить ещё ")):te("",!0)])):(f(),v("div",Ts," У вас пока нет сохраненных анализов "))])):A.value==="deep"?(f(),v("div",Hs,[(O=x.value)!=null&&O.length?(f(),v("div",Ls,[(f(!0),v(ee,null,ae(D.value,S=>(f(),Fe(We,{key:S.id,dream:S,active:o.value===S.id,onToggle:R=>o.value=o.value===S.id?null:S.id},null,8,["dream","active","onToggle"]))),128)),T.value?(f(),v("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:u}," Загрузить ещё ")):te("",!0)])):(f(),v("div",Os," Пока нет глубоких анализов "))])):te("",!0)])}}}),Fs=Ue(js,[["__scopeId","data-v-14de94bb"]]);export{Fs as default};

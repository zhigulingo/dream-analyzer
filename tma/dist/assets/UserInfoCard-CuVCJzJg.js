import{d as H,c as k,a as n,o as s,n as p,i as E,b as a,j as W,F as b,A as P,r as O,k as B,e as x,t as v,s as w,w as j,l as D,C as R}from"./main-BDeUuytG.js";import{_ as q}from"./Badge.vue_vue_type_script_setup_true_lang-2x4QSOJb.js";import{L as N}from"./PersonalAccount-glE-VA81.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={key:0,class:"flex items-center space-x-4 p-4"},J={key:1,class:"space-y-4 p-4"},K={key:2,class:"space-y-3"},Q={key:3,class:"space-y-2"},X=H({__name:"SkeletonLoader",props:{type:{default:"line"},width:{},height:{},size:{},lines:{},count:{},animated:{type:Boolean,default:!0},rounded:{type:Boolean,default:!0}},setup(i){const l=i,r={xs:"w-4 h-4",sm:"w-6 h-6",md:"w-8 h-8",lg:"w-12 h-12",xl:"w-16 h-16"},F=k(()=>{const f=["skeleton-container"];return l.animated&&f.push("animate-pulse"),f.join(" ")}),_=k(()=>l.size?r[l.size]:""),z=k(()=>l.height?typeof l.height=="number"?`h-${l.height}`:l.height.startsWith("h-")?l.height:`h-[${l.height}]`:"h-4"),M=k(()=>l.width?typeof l.width=="number"?`w-${l.width}`:l.width.startsWith("w-")?l.width:`w-[${l.width}]`:"w-full"),U=(f,t)=>{const e=["w-full","w-5/6","w-4/5","w-3/4","w-2/3"];return f===t?e[Math.min(f+1,e.length-1)]:e[f%e.length]||"w-full"};return(f,t)=>(s(),n("div",{class:p(["skeleton-loader",F.value])},[i.type==="user-card"?(s(),n("div",G,[...t[0]||(t[0]=[a("div",{class:"skeleton-circle w-10 h-10"},null,-1),a("div",{class:"flex-1 space-y-2"},[a("div",{class:"skeleton-line h-4 w-3/4"}),a("div",{class:"skeleton-line h-3 w-1/2"})],-1)])])):i.type==="dream-card"?(s(),n("div",J,[...t[1]||(t[1]=[W('<div class="flex justify-between items-center" data-v-2d56e570><div class="skeleton-line h-4 w-1/4" data-v-2d56e570></div><div class="skeleton-line h-3 w-16" data-v-2d56e570></div></div><div class="space-y-2" data-v-2d56e570><div class="skeleton-line h-3 w-full" data-v-2d56e570></div><div class="skeleton-line h-3 w-5/6" data-v-2d56e570></div><div class="skeleton-line h-3 w-4/5" data-v-2d56e570></div></div><div class="skeleton-line h-6 w-1/3" data-v-2d56e570></div>',3)])])):i.type==="history-list"?(s(),n("div",K,[(s(!0),n(b,null,P(i.count||3,e=>(s(),n("div",{key:e,class:"border rounded-lg p-3"},[...t[2]||(t[2]=[W('<div class="flex justify-between items-center mb-2" data-v-2d56e570><div class="skeleton-line h-4 w-24" data-v-2d56e570></div><div class="skeleton-line h-3 w-8" data-v-2d56e570></div></div><div class="skeleton-line h-3 w-full" data-v-2d56e570></div><div class="skeleton-line h-3 w-3/4 mt-1" data-v-2d56e570></div>',3)])]))),128))])):i.type==="text-block"?(s(),n("div",Q,[(s(!0),n(b,null,P(i.lines||3,e=>(s(),n("div",{key:e,class:p(["skeleton-line h-4",U(e,i.lines||3)])},null,2))),128))])):i.type==="custom"?E(f.$slots,"default",{key:4},void 0,!0):(s(),n(b,{key:5},[i.type==="circle"?(s(),n("div",{key:0,class:p(["skeleton-circle",_.value])},null,2)):i.type==="square"?(s(),n("div",{key:1,class:p(["skeleton-square",_.value])},null,2)):(s(),n("div",{key:2,class:p(["skeleton-line",[z.value,M.value]])},null,2))],64))],2))}}),S=I(X,[["__scopeId","data-v-2d56e570"]]),Y={class:"relative"},Z=["src"],ee={class:"ml-4 truncate"},te={key:0,class:"mb-4 flex gap-2 flex-wrap"},se={key:1,class:"flex flex-col gap-2 ml-auto"},ie={key:0,class:"mb-4 flex gap-2 flex-wrap fade-seq is-open seq-offset-0"},ae={key:1,class:"flex flex-col gap-1 ml-auto items-end"},ne={key:2,class:"space-y-2 text-sm fade-seq is-open seq-offset-160"},le={class:"flex justify-between"},oe={class:"flex justify-between"},re={class:"flex justify-between"},de={class:"flex justify-between"},ce=["disabled"],ue=H({__name:"UserInfoCard",props:["userStore"],setup(i){const l=i,r=O(!1),F=k(()=>{var e,d,c;const t=(e=window.Telegram)==null?void 0:e.WebApp;return(c=(d=t==null?void 0:t.initDataUnsafe)==null?void 0:d.user)!=null&&c.photo_url?t.initDataUnsafe.user.photo_url:"https://via.placeholder.com/40/5461FF/ffffff?text=U"}),_=k(()=>{var e,d;const t=(e=window.Telegram)==null?void 0:e.WebApp;if((d=t==null?void 0:t.initDataUnsafe)!=null&&d.user){const c=t.initDataUnsafe.user;return c.first_name+(c.last_name?` ${c.last_name}`:"")}return"Пользователь"}),z=()=>{r.value=!r.value,window.triggerHaptic&&window.triggerHaptic("light")},M=k(()=>{var e,d,c,y;const t=((d=(e=l.userStore)==null?void 0:e.profile)==null?void 0:d.subscription_type)||"Free";if((y=(c=l.userStore)==null?void 0:c.profile)!=null&&y.subscription_end){const g=new Date(l.userStore.profile.subscription_end).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit"});return`${t} до ${g}`}return t}),U=k(()=>{var g;const t=(g=l.userStore)==null?void 0:g.history;if(!t||t.length===0)return"недавно";const e=t.reduce((o,$)=>{const C=new Date($.created_at),L=new Date(o.created_at);return C<L?$:o}),d=new Date(e.created_at),y=Math.abs(new Date-d),u=Math.ceil(y/(1e3*60*60*24));if(u<7)return`${u} дн${u===1?"ень":u<5?"я":"ей"}`;if(u<30){const o=Math.floor(u/7);return`${o} недел${o===1?"ю":o<5?"и":"ь"}`}else if(u<365){const o=Math.floor(u/30);return`${o} месяц${o===1?"":o<5?"а":"ев"}`}else{const o=Math.floor(u/365);return`${o} год${o===1?"":o<5?"а":"ов"}`}}),f=()=>{var t;window.triggerHaptic&&window.triggerHaptic("medium"),(t=l.userStore)==null||t.openSubscriptionModal()};return(t,e)=>{var d,c,y,u,g,o,$,C,L,T,A,V;return s(),n("article",{class:p(["relative rounded-xl bg-gradient-to-br from-[#5461FF] to-[#4857FF] text-white overflow-hidden transition-all duration-500",[r.value?"pb-32":"min-h-[4.5rem]"]]),onClick:z},[(d=i.userStore)!=null&&d.isLoadingProfile&&!r.value?(s(),B(N,{key:0,overlay:"",variant:"white",size:"sm",label:"Загрузка профиля..."})):x("",!0),a("div",{class:p(["px-8 md:px-16 py-4",[r.value?"fade-seq is-open seq-offset-0":"flex items-center justify-between"]])},[a("div",{class:p(["flex items-center",[r.value?"mb-4":"mb-0 flex-1"]])},[a("div",Y,[a("img",{class:"w-10 h-10 rounded-full object-cover",src:F.value},null,8,Z),(c=i.userStore)!=null&&c.isLoadingProfile?(s(),B(N,{key:0,class:"absolute inset-0",size:"sm",variant:"white"})):x("",!0)]),a("span",ee,v(_.value),1)],2),(y=i.userStore)!=null&&y.isLoadingProfile?(s(),n(b,{key:0},[r.value?(s(),n("div",te,[w(S,{type:"line",width:"w-20",height:"h-6"}),w(S,{type:"line",width:"w-24",height:"h-6"})])):x("",!0),r.value?x("",!0):(s(),n("div",se,[w(S,{type:"line",width:"w-16",height:"h-5"}),w(S,{type:"line",width:"w-12",height:"h-5"})]))],64)):(s(),n(b,{key:1},[r.value?(s(),n("div",ie,[w(q,{class:"whitespace-nowrap"},{default:j(()=>{var h,m;return[D(v(`Токенов: ${((m=(h=i.userStore)==null?void 0:h.profile)==null?void 0:m.tokens)||0}`),1)]}),_:1}),w(q,{class:"whitespace-nowrap"},{default:j(()=>[D(v(M.value),1)]),_:1})])):(s(),n("div",ae,[w(q,{class:"whitespace-nowrap"},{default:j(()=>{var h,m;return[D(v(`Токенов: ${((m=(h=i.userStore)==null?void 0:h.profile)==null?void 0:m.tokens)||0}`),1)]}),_:1}),w(q,{class:"whitespace-nowrap"},{default:j(()=>{var h,m;return[D(v(((m=(h=i.userStore)==null?void 0:h.profile)==null?void 0:m.subscription_type)||"Free"),1)]}),_:1})]))],64)),r.value?(s(),n("div",ne,[(u=i.userStore)!=null&&u.isLoadingProfile?(s(),n(b,{key:0},P(4,h=>a("div",{key:h,class:"flex justify-between"},[w(S,{type:"line",width:"w-24",height:"h-4"}),w(S,{type:"line",width:"w-8",height:"h-4"})])),64)):(s(),n(b,{key:1},[a("div",le,[e[0]||(e[0]=a("span",{class:"opacity-80"},"Пользователь уже:",-1)),a("span",null,v(U.value),1)]),a("div",oe,[e[1]||(e[1]=a("span",{class:"opacity-80"},"Проанализировано снов:",-1)),a("span",null,v(((o=(g=i.userStore)==null?void 0:g.profile)==null?void 0:o.total_dreams_count)||0),1)]),a("div",re,[e[2]||(e[2]=a("span",{class:"opacity-80"},"Глубоких анализов:",-1)),a("span",null,v(((C=($=i.userStore)==null?void 0:$.profile)==null?void 0:C.deep_analyses_count)||0),1)]),a("div",de,[e[3]||(e[3]=a("span",{class:"opacity-80"},"Приглашено друзей:",-1)),a("span",null,v(((T=(L=i.userStore)==null?void 0:L.profile)==null?void 0:T.invited_friends_count)||0),1)])],64))])):x("",!0)],2),a("div",{class:p(["absolute left-4 right-4 bottom-4 space-y-2 transition-opacity duration-200 ease-out fade-seq is-open seq-offset-320",r.value?"opacity-100":"opacity-0 pointer-events-none"])},[a("button",{class:"w-full bg-white/20 hover:bg-white/30 text-white rounded-xl py-3 font-semibold transition-colors flex items-center justify-center",onClick:R(f,["stop"]),disabled:(A=i.userStore)==null?void 0:A.isLoadingProfile},[(V=i.userStore)!=null&&V.isLoadingProfile?(s(),B(N,{key:0,size:"xs",variant:"white",class:"mr-2"})):x("",!0),e[4]||(e[4]=D(" Сменить тариф ",-1))],8,ce),e[5]||(e[5]=a("button",{class:"w-full bg-white/10 text-white/60 rounded-xl py-3 font-semibold cursor-not-allowed",disabled:""}," Получить токены ",-1))],2)],2)}}}),pe=I(ue,[["__scopeId","data-v-c4daf457"]]);export{pe as default};

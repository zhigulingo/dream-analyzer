import{d as Ne,r as re,c as w,a,o as r,b as s,s as Oe,M as xt,w as _t,e as Y,t as M,F as ee,A as ie,n as fe,m as bt,u as wt,N as kt,C as oe,f as ze,k as Fe,q as Be,l as be,D as Xe,z as Re,h as $t,E as Mt,H as St,G as Dt,j as Ct}from"./main-D_E1EY4h.js";import{g as Ie,c as Ae}from"./_commonjsHelpers-Cpj98o6Y.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Ke={exports:{}};(function(Z,V){(function(c,U){Z.exports=U()})(Ae,function(){var c=1e3,U=6e4,G=36e5,B="millisecond",b="second",W="minute",S="hour",F="day",N="week",z="month",D="quarter",I="year",v="date",n="Invalid Date",u=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(C){var h=["th","st","nd","rd"],f=C%100;return"["+C+(h[(f-20)%10]||h[f]||h[0])+"]"}},x=function(C,h,f){var g=String(C);return!g||g.length>=h?C:""+Array(h+1-g.length).join(f)+C},p={s:x,z:function(C){var h=-C.utcOffset(),f=Math.abs(h),g=Math.floor(f/60),m=f%60;return(h<=0?"+":"-")+x(g,2,"0")+":"+x(m,2,"0")},m:function C(h,f){if(h.date()<f.date())return-C(f,h);var g=12*(f.year()-h.year())+(f.month()-h.month()),m=h.clone().add(g,z),H=f-m<0,L=h.clone().add(g+(H?-1:1),z);return+(-(g+(f-m)/(H?m-L:L-m))||0)},a:function(C){return C<0?Math.ceil(C)||0:Math.floor(C)},p:function(C){return{M:z,y:I,w:N,d:F,D:v,h:S,m:W,s:b,ms:B,Q:D}[C]||String(C||"").toLowerCase().replace(/s$/,"")},u:function(C){return C===void 0}},_="en",T={};T[_]=i;var A="$isDayjsObject",q=function(C){return C instanceof $e||!(!C||!C[A])},K=function C(h,f,g){var m;if(!h)return _;if(typeof h=="string"){var H=h.toLowerCase();T[H]&&(m=H),f&&(T[H]=f,m=H);var L=h.split("-");if(!m&&L.length>1)return C(L[0])}else{var R=h.name;T[R]=h,m=R}return!g&&m&&(_=m),m||!g&&_},P=function(C,h){if(q(C))return C.clone();var f=typeof h=="object"?h:{};return f.date=C,f.args=arguments,new $e(f)},E=p;E.l=K,E.i=q,E.w=function(C,h){return P(C,{locale:h.$L,utc:h.$u,x:h.$x,$offset:h.$offset})};var $e=function(){function C(f){this.$L=K(f.locale,null,!0),this.parse(f),this.$x=this.$x||f.x||{},this[A]=!0}var h=C.prototype;return h.parse=function(f){this.$d=function(g){var m=g.date,H=g.utc;if(m===null)return new Date(NaN);if(E.u(m))return new Date;if(m instanceof Date)return new Date(m);if(typeof m=="string"&&!/Z$/i.test(m)){var L=m.match(u);if(L){var R=L[2]-1||0,J=(L[7]||"0").substring(0,3);return H?new Date(Date.UTC(L[1],R,L[3]||1,L[4]||0,L[5]||0,L[6]||0,J)):new Date(L[1],R,L[3]||1,L[4]||0,L[5]||0,L[6]||0,J)}}return new Date(m)}(f),this.init()},h.init=function(){var f=this.$d;this.$y=f.getFullYear(),this.$M=f.getMonth(),this.$D=f.getDate(),this.$W=f.getDay(),this.$H=f.getHours(),this.$m=f.getMinutes(),this.$s=f.getSeconds(),this.$ms=f.getMilliseconds()},h.$utils=function(){return E},h.isValid=function(){return this.$d.toString()!==n},h.isSame=function(f,g){var m=P(f);return this.startOf(g)<=m&&m<=this.endOf(g)},h.isAfter=function(f,g){return P(f)<this.startOf(g)},h.isBefore=function(f,g){return this.endOf(g)<P(f)},h.$g=function(f,g,m){return E.u(f)?this[g]:this.set(m,f)},h.unix=function(){return Math.floor(this.valueOf()/1e3)},h.valueOf=function(){return this.$d.getTime()},h.startOf=function(f,g){var m=this,H=!!E.u(g)||g,L=E.p(f),R=function(ye,ne){var me=E.w(m.$u?Date.UTC(m.$y,ne,ye):new Date(m.$y,ne,ye),m);return H?me:me.endOf(F)},J=function(ye,ne){return E.w(m.toDate()[ye].apply(m.toDate("s"),(H?[0,0,0,0]:[23,59,59,999]).slice(ne)),m)},se=this.$W,te=this.$M,ae=this.$D,ue="set"+(this.$u?"UTC":"");switch(L){case I:return H?R(1,0):R(31,11);case z:return H?R(1,te):R(0,te+1);case N:var de=this.$locale().weekStart||0,_e=(se<de?se+7:se)-de;return R(H?ae-_e:ae+(6-_e),te);case F:case v:return J(ue+"Hours",0);case S:return J(ue+"Minutes",1);case W:return J(ue+"Seconds",2);case b:return J(ue+"Milliseconds",3);default:return this.clone()}},h.endOf=function(f){return this.startOf(f,!1)},h.$set=function(f,g){var m,H=E.p(f),L="set"+(this.$u?"UTC":""),R=(m={},m[F]=L+"Date",m[v]=L+"Date",m[z]=L+"Month",m[I]=L+"FullYear",m[S]=L+"Hours",m[W]=L+"Minutes",m[b]=L+"Seconds",m[B]=L+"Milliseconds",m)[H],J=H===F?this.$D+(g-this.$W):g;if(H===z||H===I){var se=this.clone().set(v,1);se.$d[R](J),se.init(),this.$d=se.set(v,Math.min(this.$D,se.daysInMonth())).$d}else R&&this.$d[R](J);return this.init(),this},h.set=function(f,g){return this.clone().$set(f,g)},h.get=function(f){return this[E.p(f)]()},h.add=function(f,g){var m,H=this;f=Number(f);var L=E.p(g),R=function(te){var ae=P(H);return E.w(ae.date(ae.date()+Math.round(te*f)),H)};if(L===z)return this.set(z,this.$M+f);if(L===I)return this.set(I,this.$y+f);if(L===F)return R(1);if(L===N)return R(7);var J=(m={},m[W]=U,m[S]=G,m[b]=c,m)[L]||1,se=this.$d.getTime()+f*J;return E.w(se,this)},h.subtract=function(f,g){return this.add(-1*f,g)},h.format=function(f){var g=this,m=this.$locale();if(!this.isValid())return m.invalidDate||n;var H=f||"YYYY-MM-DDTHH:mm:ssZ",L=E.z(this),R=this.$H,J=this.$m,se=this.$M,te=m.weekdays,ae=m.months,ue=m.meridiem,de=function(ne,me,we,ge){return ne&&(ne[me]||ne(g,H))||we[me].slice(0,ge)},_e=function(ne){return E.s(R%12||12,ne,"0")},ye=ue||function(ne,me,we){var ge=ne<12?"AM":"PM";return we?ge.toLowerCase():ge};return H.replace(y,function(ne,me){return me||function(we){switch(we){case"YY":return String(g.$y).slice(-2);case"YYYY":return E.s(g.$y,4,"0");case"M":return se+1;case"MM":return E.s(se+1,2,"0");case"MMM":return de(m.monthsShort,se,ae,3);case"MMMM":return de(ae,se);case"D":return g.$D;case"DD":return E.s(g.$D,2,"0");case"d":return String(g.$W);case"dd":return de(m.weekdaysMin,g.$W,te,2);case"ddd":return de(m.weekdaysShort,g.$W,te,3);case"dddd":return te[g.$W];case"H":return String(R);case"HH":return E.s(R,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return ye(R,J,!0);case"A":return ye(R,J,!1);case"m":return String(J);case"mm":return E.s(J,2,"0");case"s":return String(g.$s);case"ss":return E.s(g.$s,2,"0");case"SSS":return E.s(g.$ms,3,"0");case"Z":return L}return null}(ne)||L.replace(":","")})},h.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},h.diff=function(f,g,m){var H,L=this,R=E.p(g),J=P(f),se=(J.utcOffset()-this.utcOffset())*U,te=this-J,ae=function(){return E.m(L,J)};switch(R){case I:H=ae()/12;break;case z:H=ae();break;case D:H=ae()/3;break;case N:H=(te-se)/6048e5;break;case F:H=(te-se)/864e5;break;case S:H=te/G;break;case W:H=te/U;break;case b:H=te/c;break;default:H=te}return m?H:E.a(H)},h.daysInMonth=function(){return this.endOf(z).$D},h.$locale=function(){return T[this.$L]},h.locale=function(f,g){if(!f)return this.$L;var m=this.clone(),H=K(f,g,!0);return H&&(m.$L=H),m},h.clone=function(){return E.w(this.$d,this)},h.toDate=function(){return new Date(this.valueOf())},h.toJSON=function(){return this.isValid()?this.toISOString():null},h.toISOString=function(){return this.$d.toISOString()},h.toString=function(){return this.$d.toUTCString()},C}(),De=$e.prototype;return P.prototype=De,[["$ms",B],["$s",b],["$m",W],["$H",S],["$W",F],["$M",z],["$y",I],["$D",v]].forEach(function(C){De[C[1]]=function(h){return this.$g(h,C[0],C[1])}}),P.extend=function(C,h){return C.$i||(C(h,$e,P),C.$i=!0),P},P.locale=K,P.isDayjs=q,P.unix=function(C){return P(1e3*C)},P.en=T[_],P.Ls=T,P.p={},P})})(Ke);var Qe=Ke.exports;const le=Ie(Qe);var et={exports:{}};(function(Z,V){(function(c,U){Z.exports=U()})(Ae,function(){return function(c,U,G){c=c||{};var B=U.prototype,b={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function W(F,N,z,D){return B.fromToBase(F,N,z,D)}G.en.relativeTime=b,B.fromToBase=function(F,N,z,D,I){for(var v,n,u,y=z.$locale().relativeTime||b,i=c.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],x=i.length,p=0;p<x;p+=1){var _=i[p];_.d&&(v=D?G(F).diff(z,_.d,!0):z.diff(F,_.d,!0));var T=(c.rounding||Math.round)(Math.abs(v));if(u=v>0,T<=_.r||!_.r){T<=1&&p>0&&(_=i[p-1]);var A=y[_.l];I&&(T=I(""+T)),n=typeof A=="string"?A.replace("%d",T):A(T,N,_.l,u);break}}if(N)return n;var q=u?y.future:y.past;return typeof q=="function"?q(n):q.replace("%s",n)},B.to=function(F,N){return W(F,N,this,!0)},B.from=function(F,N){return W(F,N,this)};var S=function(F){return F.$u?G.utc():G()};B.toNow=function(F){return this.to(S(this),F)},B.fromNow=function(F){return this.from(S(this),F)}}})})(et);var Tt=et.exports;const jt=Ie(Tt);var tt={exports:{}};(function(Z,V){(function(c,U){Z.exports=U()})(Ae,function(){var c="minute",U=/[+-]\d\d(?::?\d\d)?/g,G=/([+-]|\d\d)/g;return function(B,b,W){var S=b.prototype;W.utc=function(n){var u={date:n,utc:!0,args:arguments};return new b(u)},S.utc=function(n){var u=W(this.toDate(),{locale:this.$L,utc:!0});return n?u.add(this.utcOffset(),c):u},S.local=function(){return W(this.toDate(),{locale:this.$L,utc:!1})};var F=S.parse;S.parse=function(n){n.utc&&(this.$u=!0),this.$utils().u(n.$offset)||(this.$offset=n.$offset),F.call(this,n)};var N=S.init;S.init=function(){if(this.$u){var n=this.$d;this.$y=n.getUTCFullYear(),this.$M=n.getUTCMonth(),this.$D=n.getUTCDate(),this.$W=n.getUTCDay(),this.$H=n.getUTCHours(),this.$m=n.getUTCMinutes(),this.$s=n.getUTCSeconds(),this.$ms=n.getUTCMilliseconds()}else N.call(this)};var z=S.utcOffset;S.utcOffset=function(n,u){var y=this.$utils().u;if(y(n))return this.$u?0:y(this.$offset)?z.call(this):this.$offset;if(typeof n=="string"&&(n=function(_){_===void 0&&(_="");var T=_.match(U);if(!T)return null;var A=(""+T[0]).match(G)||["-",0,0],q=A[0],K=60*+A[1]+ +A[2];return K===0?0:q==="+"?K:-K}(n),n===null))return this;var i=Math.abs(n)<=16?60*n:n;if(i===0)return this.utc(u);var x=this.clone();if(u)return x.$offset=i,x.$u=!1,x;var p=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(x=this.local().add(i+p,c)).$offset=i,x.$x.$localOffset=p,x};var D=S.format;S.format=function(n){var u=n||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return D.call(this,u)},S.valueOf=function(){var n=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*n},S.isUTC=function(){return!!this.$u},S.toISOString=function(){return this.toDate().toISOString()},S.toString=function(){return this.toDate().toUTCString()};var I=S.toDate;S.toDate=function(n){return n==="s"&&this.$offset?W(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():I.call(this)};var v=S.diff;S.diff=function(n,u,y){if(n&&this.$u===n.$u)return v.call(this,n,u,y);var i=this.local(),x=W(n).local();return v.call(i,x,u,y)}}})})(tt);var Ot=tt.exports;const st=Ie(Ot);var nt={exports:{}};(function(Z,V){(function(c,U){Z.exports=U()})(Ae,function(){var c={year:0,month:1,day:2,hour:3,minute:4,second:5},U={};return function(G,B,b){var W,S=function(D,I,v){v===void 0&&(v={});var n=new Date(D),u=function(y,i){i===void 0&&(i={});var x=i.timeZoneName||"short",p=y+"|"+x,_=U[p];return _||(_=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:y,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:x}),U[p]=_),_}(I,v);return u.formatToParts(n)},F=function(D,I){for(var v=S(D,I),n=[],u=0;u<v.length;u+=1){var y=v[u],i=y.type,x=y.value,p=c[i];p>=0&&(n[p]=parseInt(x,10))}var _=n[3],T=_===24?0:_,A=n[0]+"-"+n[1]+"-"+n[2]+" "+T+":"+n[4]+":"+n[5]+":000",q=+D;return(b.utc(A).valueOf()-(q-=q%1e3))/6e4},N=B.prototype;N.tz=function(D,I){D===void 0&&(D=W);var v,n=this.utcOffset(),u=this.toDate(),y=u.toLocaleString("en-US",{timeZone:D}),i=Math.round((u-new Date(y))/1e3/60),x=15*-Math.round(u.getTimezoneOffset()/15)-i;if(!Number(x))v=this.utcOffset(0,I);else if(v=b(y,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(x,!0),I){var p=v.utcOffset();v=v.add(n-p,"minute")}return v.$x.$timezone=D,v},N.offsetName=function(D){var I=this.$x.$timezone||b.tz.guess(),v=S(this.valueOf(),I,{timeZoneName:D}).find(function(n){return n.type.toLowerCase()==="timezonename"});return v&&v.value};var z=N.startOf;N.startOf=function(D,I){if(!this.$x||!this.$x.$timezone)return z.call(this,D,I);var v=b(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return z.call(v,D,I).tz(this.$x.$timezone,!0)},b.tz=function(D,I,v){var n=v&&I,u=v||I||W,y=F(+b(),u);if(typeof D!="string")return b(D).tz(u);var i=function(T,A,q){var K=T-60*A*1e3,P=F(K,q);if(A===P)return[K,A];var E=F(K-=60*(P-A)*1e3,q);return P===E?[K,P]:[T-60*Math.min(P,E)*1e3,Math.max(P,E)]}(b.utc(D,n).valueOf(),y,u),x=i[0],p=i[1],_=b(x).utcOffset(p);return _.$x.$timezone=u,_},b.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},b.tz.setDefault=function(D){W=D}}})})(nt);var At=nt.exports;const it=Ie(At);var Ht={exports:{}};(function(Z,V){(function(c,U){Z.exports=U(Qe)})(Ae,function(c){function U(v){return v&&typeof v=="object"&&"default"in v?v:{default:v}}var G=U(c),B="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),b="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),W="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),S="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),F=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function N(v,n,u){var y,i;return u==="m"?n?"минута":"минуту":v+" "+(y=+v,i={mm:n?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[u].split("_"),y%10==1&&y%100!=11?i[0]:y%10>=2&&y%10<=4&&(y%100<10||y%100>=20)?i[1]:i[2])}var z=function(v,n){return F.test(n)?B[v.month()]:b[v.month()]};z.s=b,z.f=B;var D=function(v,n){return F.test(n)?W[v.month()]:S[v.month()]};D.s=S,D.f=W;var I={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:z,monthsShort:D,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:N,mm:N,h:"час",hh:N,d:"день",dd:N,M:"месяц",MM:N,y:"год",yy:N},ordinal:function(v){return v},meridiem:function(v){return v<4?"ночи":v<12?"утра":v<17?"дня":"вечера"}};return G.default.locale(I,null,!0),I})})(Ht);const Lt={class:"dynamics-chart-container"},Yt={class:"text-sm font-semibold mb-2 flex items-center justify-between"},Bt={class:"text-xs opacity-70"},zt={class:"chart-svg-container"},Ft={class:"y-axis-labels"},Nt={class:"y-label"},It={class:"y-label"},Ut={class:"y-label"},Wt={class:"chart-svg-wrapper"},Et=["viewBox"],Pt=["y1","y2"],Rt=["y"],Zt=["y1","y2"],Vt=["points"],qt=["cx","cy"],Gt={key:0,class:"mt-4"},Jt={class:"dynamics-analysis"},Xt={class:"analysis-text"},Kt={key:0,class:"insight-box"},Qt={class:"insight-text"},es={key:1,class:"mt-3 text-xs opacity-80 leading-relaxed"},ts={class:"pagination-dots"},ss=["onClick"],Te=300,je=80,Se=6,ns=Ne({__name:"DynamicsChart",props:{dynamics:{},userAge:{},userGender:{}},setup(Z){const V=Z,c=re(0),U=re(0),G=re(0),B=re("slide-left"),b=w(()=>V.dynamics[c.value]||{metric:"",values:[],interpretation:""}),W=w(()=>b.value.values||[]),S=w(()=>{if(!V.dynamics||V.dynamics.length===0)return{min:0,max:10,labels:[10,5,0]};const i=[];if(V.dynamics.forEach(T=>{Array.isArray(T.values)&&i.push(...T.values)}),i.length===0)return{min:0,max:10,labels:[10,5,0]};const x=Math.floor(Math.min(...i)),p=Math.ceil(Math.max(...i)),_=[p,Math.round((p+x)/2),x];return{min:x,max:p,labels:_}}),F=w(()=>{var T;const i=b.value.metric;if(!V.userAge||!V.userGender)return null;const p=(T={Персонажи:{"18-24":{male:6.5,female:7},"25-34":{male:6,female:6.5},"35-44":{male:5.5,female:6},"45+":{male:5,female:5.5}},Эмоции:{"18-24":{male:6,female:7},"25-34":{male:5.5,female:6.5},"35-44":{male:5,female:6},"45+":{male:4.5,female:5.5}},Действия:{"18-24":{male:7,female:6.5},"25-34":{male:6.5,female:6},"35-44":{male:6,female:5.5},"45+":{male:5.5,female:5}},Сцены:{"18-24":{male:6.5,female:6.5},"25-34":{male:6,female:6},"35-44":{male:5.5,female:5.5},"45+":{male:5,female:5}}}[i])==null?void 0:T[V.userAge];if(!p)return null;const _=p[V.userGender];return _===void 0?null:_}),N=w(()=>{const i=F.value;if(i===null)return null;const{min:x,max:p}=S.value,_=je-Se*2,T=(i-x)/(p-x);return Se+_-T*_}),z=w(()=>{const i=W.value;if(i.length===0)return[];const{min:x,max:p}=S.value,_=Te-Se*2,T=je-Se*2,A=i.length>1?_/(i.length-1):0;return i.map((q,K)=>{const P=(q-x)/(p-x);return{x:Se+K*A,y:Se+T-P*T}})}),D=w(()=>z.value.map(i=>`${i.x},${i.y}`).join(" "));function I(i){U.value=i.touches[0].clientX}function v(i){G.value=i.touches[0].clientX}function n(){const i=U.value-G.value;Math.abs(i)>50&&(i>0&&c.value<V.dynamics.length-1?(B.value="slide-left",c.value++,y()):i<0&&c.value>0&&(B.value="slide-right",c.value--,y())),U.value=0,G.value=0}function u(i){i!==c.value&&(B.value=i>c.value?"slide-left":"slide-right",c.value=i,y())}function y(){window.triggerHaptic&&window.triggerHaptic("light")}return(i,x)=>(r(),a("div",Lt,[s("div",{class:"chart-wrapper",onTouchstart:I,onTouchmove:v,onTouchend:n},[Oe(xt,{name:B.value,mode:"out-in"},{default:_t(()=>[(r(),a("div",{key:c.value,class:"chart-content"},[s("div",Yt,[s("span",null,M(b.value.category||b.value.metric),1),s("span",Bt,M(W.value[W.value.length-1]),1)]),s("div",zt,[s("div",Ft,[s("span",Nt,M(S.value.labels[0]),1),s("span",It,M(S.value.labels[1]),1),s("span",Ut,M(S.value.labels[2]),1)]),s("div",Wt,[(r(),a("svg",{viewBox:`0 0 ${Te} ${je}`,class:"chart-svg",preserveAspectRatio:"xMidYMid meet"},[(r(),a(ee,null,ie(3,p=>s("line",{key:`grid-${p}`,x1:0,x2:Te,y1:je/2*(p-1),y2:je/2*(p-1),stroke:"white","stroke-opacity":"0.15","stroke-width":"1"},null,8,Pt)),64)),N.value!==null?(r(),a("rect",{key:0,x:0,y:N.value-8,width:Te,height:16,fill:"yellow",opacity:"0.15"},null,8,Rt)):Y("",!0),N.value!==null?(r(),a("line",{key:1,x1:0,x2:Te,y1:N.value,y2:N.value,stroke:"yellow","stroke-opacity":"0.6","stroke-width":"1.5","stroke-dasharray":"4,3"},null,8,Zt)):Y("",!0),s("polyline",{points:D.value,fill:"none",stroke:"white","stroke-width":"2.5","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Vt),(r(!0),a(ee,null,ie(z.value,(p,_)=>(r(),a("circle",{key:`point-${_}`,cx:p.x,cy:p.y,r:"4",fill:"white","vector-effect":"non-scaling-stroke"},null,8,qt))),128))],8,Et))])]),b.value.analysis?(r(),a("div",Gt,[s("div",Jt,[s("p",Xt,M(b.value.analysis),1),b.value.insight?(r(),a("div",Kt,[x[0]||(x[0]=s("span",{class:"insight-icon"},"💡",-1)),s("p",Qt,M(b.value.insight),1)])):Y("",!0)])])):b.value.interpretation?(r(),a("div",es,M(b.value.interpretation),1)):Y("",!0)]))]),_:1},8,["name"])],32),s("div",ts,[(r(!0),a(ee,null,ie(Z.dynamics,(p,_)=>(r(),a("button",{key:`dot-${_}`,class:fe(["dot",{active:_===c.value}]),onClick:T=>u(_)},null,10,ss))),128))])]))}}),Je=Ve(ns,[["__scopeId","data-v-ac484404"]]),is=[{keys:["вода","море","река","волна","дожд","океан"],emoji:"🌊"},{keys:["лет","полет","полетать","летать","небо","птиц","самолет"],emoji:"🕊️"},{keys:["погон","убег","догон","преслед"],emoji:"🏃‍♂️"},{keys:["экзам","контрол","тест","урок","школ","учеб","универ"],emoji:"📝"},{keys:["деньг","кошелек","кошель","кошелёк","банк","кредит"],emoji:"💰"},{keys:["любов","поцел","роман","пар","серд"],emoji:"❤️"},{keys:["дом","квартир","комнат","двор","жиль"],emoji:"🏠"},{keys:["работ","офис","началь","коллег"],emoji:"💼"},{keys:["школ","класс","урок"],emoji:"🏫"},{keys:["кот","кошка"],emoji:"🐱"},{keys:["собак","пёс","пес"],emoji:"🐶"},{keys:["зуб","зубы"],emoji:"🦷"},{keys:["темнот","ноч","тьма"],emoji:"🌑"},{keys:["смерт","похорон","кладбищ"],emoji:"🕯️"},{keys:["рожд","младен","ребен","малыш","дет"],emoji:"👶"},{keys:["лес","дерев","парк","природ"],emoji:"🌲"},{keys:["огонь","пожар","жар"],emoji:"🔥"},{keys:["зме","дракон"],emoji:"🐍"},{keys:["путешеств","дорог","путь","троп"],emoji:"🧭"}];function rs(Z){try{const V=String(Z||"").toLowerCase();for(const c of is)if(c.keys.some(U=>V.includes(U)))return c.emoji;return"💤"}catch{return"💤"}}const os={key:0,class:"flex items-center gap-3 py-1 min-h-[2.5rem]"},as={class:"text-2xl shrink-0"},ls={class:"flex-1 min-w-0"},cs={class:"truncate font-semibold leading-tight"},us={class:"text-xs opacity-80 leading-tight"},ds={key:1,class:"mt-4 space-y-4 text-sm fade-seq is-open"},fs={key:0,class:"space-y-1"},ms={class:"text-2xl font-semibold leading-tight"},ps={class:"text-sm opacity-80"},hs={key:1,class:"flex flex-wrap gap-2"},vs={key:0,class:"rounded-lg bg-white/10"},ys={class:"opacity-80 inline-block",style:{fontSize:"130%"}},gs={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-4"},xs={key:0,class:"text-sm opacity-90 leading-relaxed pb-2 border-b border-white/10"},_s={class:"flex items-baseline gap-2"},bs={class:"font-semibold text-sm"},ws={class:"text-xs opacity-70 bg-white/15 px-2 py-0.5 rounded-full"},ks={class:"text-xs opacity-90 leading-relaxed"},$s={class:"text-xs opacity-75 italic leading-relaxed bg-white/5 rounded px-2 py-1"},Ms={key:1,class:"rounded-lg bg-white/10"},Ss={class:"opacity-80 inline-block",style:{fontSize:"130%"}},Ds={key:0,class:"px-3 pb-3 text-white/90 leading-snug"},Cs={key:2,class:"rounded-lg bg-white/10"},Ts={class:"opacity-80 inline-block",style:{fontSize:"130%"}},js={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-3"},Os={key:0,class:"text-sm opacity-90 leading-relaxed"},As={key:1,class:"text-sm opacity-90 leading-relaxed"},Hs={key:2,class:"text-sm opacity-90 leading-relaxed"},Ls={key:3,class:"bg-white/10 rounded-lg p-3 space-y-2 mt-4"},Ys={class:"font-semibold opacity-95 flex items-center gap-2"},Bs={class:"text-sm opacity-90 leading-relaxed"},zs={key:0,class:"text-xs opacity-75 italic leading-relaxed"},Fs={class:"rounded-lg bg-white/10"},Ns={class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},Is=["innerHTML"],Us={key:0,class:"rounded-lg bg-white/10"},Ws={class:"px-3 pb-3"},Es={class:"flex flex-wrap gap-2"},Ps={key:1,class:"rounded-lg bg-white/10"},Rs={class:"px-3 pb-3 text-white/90 leading-snug"},Zs={key:2,class:"rounded-lg bg-white/10"},Vs={class:"px-3 pb-3 text-white/90 leading-snug"},qs={class:"list-decimal pl-5 space-y-2"},Gs={key:3,class:"rounded-lg bg-white/10"},Js={class:"px-3 pb-3 text-white/90 leading-snug"},Xs={class:"list-decimal pl-5 space-y-3"},Ks={key:0},Qs={class:"font-semibold mb-1"},en={class:"opacity-90"},tn={key:0,class:"opacity-80 mt-1 italic"},sn={key:1},nn={key:0,class:"rounded-lg bg-white/10"},rn={class:"px-3 pb-3 text-white/90 leading-snug"},on={class:"list-decimal pl-5 space-y-2"},an={key:1,class:"rounded-lg bg-white/10"},ln={class:"px-3 pb-3 text-white/90 leading-snug"},cn={class:"list-decimal pl-5 space-y-3"},un={key:0},dn={class:"font-semibold mb-1"},fn={class:"opacity-90"},mn={key:0,class:"opacity-80 mt-1 italic"},pn={key:1},hn={class:"rounded-lg bg-white/10 border-l-4 border-pink-400"},vn={class:"px-3 pb-3 text-white/90 leading-snug"},yn={class:"mt-2 flex justify-end"},gn={class:"space-y-2"},xn=["onClick"],_n={class:"opacity-80 inline-block",style:{fontSize:"130%"}},bn={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},wn=["innerHTML"],kn={key:0,class:"space-y-2"},$n={class:"flex justify-between text-xs opacity-80"},Mn={class:"relative h-2 w-full bg-white/10 rounded overflow-hidden"},Sn={class:"pt-2 text-xs opacity-80 flex flex-wrap items-center gap-4"},Dn={class:"inline-flex items-center gap-2"},Cn={class:"mt-4 flex gap-2"},Tn={key:4,class:"mt-3 text-xs bg-black/20 rounded-lg p-2 font-mono whitespace-pre-wrap break-words"},jn={class:"mt-2 flex justify-end"},On={key:0,class:"space-y-3"},An={class:"grid grid-cols-2 gap-2"},Hn=["onClick"],Ln={class:"flex justify-end gap-2 pt-2"},Yn=["disabled"],Bn={key:1,class:"space-y-3"},zn={class:"grid grid-cols-2 gap-2"},Fn={class:"flex justify-end gap-2 pt-2"},Nn=["disabled"],In=48,Un=Ne({__name:"DreamCard",props:{dream:{},active:{type:Boolean},overlayMode:{type:Boolean}},emits:["toggle","open"],setup(Z,{emit:V}){le.extend(jt),le.locale("ru"),le.extend(st),le.extend(it);const c=Z,U=V,G=()=>{c.overlayMode||(U("open"),window.triggerHaptic&&window.triggerHaptic("light"))},B=bt(),b=wt(),W=re(!0),S=w(()=>{var e;return!!((e=c.dream)!=null&&e.is_deep_analysis)}),F=w(()=>rs(T.value)),N=w(()=>({backgroundColor:"currentColor",WebkitMask:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M9 6l6 6-6 6"/></svg>') no-repeat center / contain`,mask:`url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="black" d="M9 6l6 6-6 6"/></svg>') no-repeat center / contain`})),z=w({get:()=>{var e,t,o;return((e=c.dream)==null?void 0:e.user_feedback)??((o=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:o.user_feedback)??0},set:e=>{c.dream&&(c.dream.user_feedback=e,c.dream.deep_source||(c.dream.deep_source={}),c.dream.deep_source.user_feedback=e)}}),D={like:!1,dislike:!1,delete:!1},I=async e=>{if(D.like||D.dislike)return;const t=e===1?z.value===1?0:1:z.value===2?0:2,o=z.value;z.value=t;try{window.triggerHaptic&&window.triggerHaptic("medium"),e===1?D.like=!0:D.dislike=!0,await Re.postAnalysisFeedback(c.dream.id,t),t===0?b.info("Оценка снята"):t===1?b.success("Добавлено: нравится"):t===2&&b.success("Добавлено: не нравится")}catch(d){z.value=o,console.error("Feedback error",d),b.error("Не удалось сохранить оценку")}finally{D.like=D.dislike=!1}},v=()=>I(1),n=()=>I(2),u=async()=>{var o;if(D.delete)return;const e=(o=window.Telegram)==null?void 0:o.WebApp;if(await new Promise(d=>{e!=null&&e.showPopup?e.showPopup({title:"Удалить запись?",message:"Действие необратимо",buttons:[{id:"yes",type:"destructive",text:"Удалить"},{id:"no",type:"cancel",text:"Отмена"}]},k=>d(k==="yes")):d(window.confirm("Удалить запись?"))}))try{D.delete=!0,window.triggerHaptic&&window.triggerHaptic("heavy"),await Re.deleteAnalysis(c.dream.id);const d=B.history.findIndex(k=>k.id===c.dream.id);d>-1&&B.history.splice(d,1),B.fetchProfile(),b.success("Запись удалена")}catch(d){console.error("Delete error",d),b.error("Не удалось удалить запись")}finally{D.delete=!1}},y=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]);function i(e){return e.replace(/\s+/g," ").trim().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function x(e){if(!e)return"";const t=String(e).split(/[.!?\n]/)[0],d=t.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(k=>k&&!y.has(k)&&k.length>3).slice(0,3);return d.length===0?t.slice(0,40):i(d.join(" "))}function p(e){if(!e)return"";let t=String(e).toLowerCase().replace(/["'«»]/g,"").trim();t=t.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),t=t.replace(/\s+/g," ").trim();const o=t.split(" ").filter(Boolean).slice(0,3);return o.length?o.join(" "):""}function _(e){if(!e)return"";const t=String(e).toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}const T=w(()=>{var j,l,$,O,Q;const e=p((l=(j=c.dream)==null?void 0:j.deep_source)==null?void 0:l.title);if(e)return _(e);const t=(((O=($=c.dream)==null?void 0:$.deep_source)==null?void 0:O.tags)||[]).filter(Boolean),o=he=>{var ve;let ce=String(he||"").trim();return ce=((ve=ce.split(/[\\/,(;:—–-]/)[0])==null?void 0:ve.trim())||"",ce?ce.charAt(0).toUpperCase()+ce.slice(1).toLowerCase():""},d=t.map(o).filter(Boolean);if(d.length){const he=d.slice(0,2).join(" и ");return _(he||"Без названия")}const k=p(x((Q=c.dream)==null?void 0:Q.dream_text));return _(k||"Без названия")}),A=w(()=>{var o,d;const e=(d=(o=c.dream)==null?void 0:o.deep_source)==null?void 0:d.tags;if(!Array.isArray(e))return[];const t=k=>{var l;let j=String(k||"").trim();return j=((l=j.split(/[\\/,(;:—–-]/)[0])==null?void 0:l.trim())||"",j?j.charAt(0).toUpperCase()+j.slice(1).toLowerCase():""};return e.map(t).filter(Boolean).slice(0,5)});function q(e){return String(e||"").replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").replace(/\(\s*\d+\s*\)/g,"").replace(/\s\[\s*\d+\s*\]/g,"").replace(/[\u00B9\u00B2\u00B3\u2070-\u2079]/g,"")}re("context");const K=w(()=>{var e;return q(((e=c.dream)==null?void 0:e.analysis)||"")}),P=w(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.overallContext)||{}});w(()=>{const e=P.value;return!!(e!=null&&e.narrative||e!=null&&e.psychologicalFunction||e!=null&&e.emotionalJourney)});const E=w(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.symbolsIntro)||""}),$e=w(()=>{var t,o;const e=(o=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:o.recurringSymbols;return Array.isArray(e)?e:[]}),De=w(()=>$e.value.filter(e=>e.frequency>=2)),C=w(()=>De.value.length>0),h=w(()=>{var t,o;const e=(o=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:o.dynamicsContext;return Array.isArray(e)?e:[]}),f=w(()=>h.value.length>0),g=w(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.conclusion)||{}}),m=w(()=>{const e=g.value;return!!(e!=null&&e.periodThemes||e!=null&&e.dreamFunctionsAnalysis||e!=null&&e.psychologicalSupport||e!=null&&e.integrationExercise)}),H=w(()=>{var t,o;const e=(o=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:o.dynamics;return Array.isArray(e)&&e.length>0?e:[]});w(()=>H.value.length>0);const L=w(()=>{var t,o;const e=(o=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:o.conclusions;return Array.isArray(e)&&e.length>0?e:[]});w(()=>L.value.length>0);const R=w(()=>{var l,$;const e=($=(l=c.dream)==null?void 0:l.deep_source)==null?void 0:$.recommendations;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="object")return e;if(Array.isArray(e)&&e.length>0)return e.map((O,Q)=>({title:`Рекомендация ${Q+1}`,description:String(O),rationale:""}));const t=ue.value;if(t.length===0)return[];const o=[0,0,0,0];for(const O of t)for(let Q=0;Q<4;Q++)o[Q]+=O[Q];const d=Math.max(1,t.length);for(let O=0;O<4;O++)o[O]=Math.round(o[O]/d);const k=[["Персонажи","Обрати внимание на отношения и роли; практикуй честную коммуникацию."],["Эмоции","Добавь ежедневную регуляцию эмоций (дыхание, дневник, прогулка)."],["Действия","Определи 1 маленький шаг на неделю и заверши его."],["Сцены","Проверь границы и режим: место/время, где тебе спокойнее."]],j=o.map((O,Q)=>({i:Q,v:O})).sort((O,Q)=>Q.v-O.v).map(O=>O.i);return[{title:k[j[0]][0],description:k[j[0]][1],rationale:""},{title:k[j[1]][0],description:k[j[1]][1],rationale:""}]});w(()=>R.value.length>0);function J(e,t){var o;try{let d=e;const k=Array.from(new Set((t||[]).filter(Boolean))).sort((j,l)=>l.length-j.length);for(const j of k){const l=(o=String(j).split(/[\\/,(;:—–-]/)[0])==null?void 0:o.trim();if(!l)continue;const $=new RegExp(`(\b${l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\b)`,"gi");d=d.replace($,'<mark class="bg-white/20 px-1 rounded">$1</mark>')}return d.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1")}catch{return e}}const se=w(()=>{var e,t;return J(K.value,((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.tags)||[])});function te(e){try{return new Date(e).getTime()||0}catch{return 0}}const ae=w(()=>(B.history||[]).filter(e=>{var t;return!e.is_deep_analysis&&((t=e==null?void 0:e.deep_source)==null?void 0:t.hvdc)&&(e==null?void 0:e.created_at)}).sort((e,t)=>te(e.created_at)>te(t.created_at)?-1:1)),ue=w(()=>{var d;const e=te(((d=c.dream)==null?void 0:d.created_at)||""),t=ae.value.filter(k=>!S.value||(e?te(k.created_at)<=e:!0)).slice(0,5).reverse(),o=["characters","emotions","actions","settings"];return t.map(k=>o.map(j=>{var l,$;return Number((($=(l=k.deep_source.hvdc)==null?void 0:l.distribution)==null?void 0:$[j])||0)}))}),de=w(()=>ue.value.length),_e=w(()=>de.value>=2),ye=w(()=>Math.max(60,(de.value-1)*28+8));function ne(e){const t=e.length,o=ye.value,d=In,k=t>1?(o-8)/(t-1):0,j=[];for(let $=0;$<t;$++){const O=$*k,Q=d-Math.round(e[$]/100*d);j.push({x:O,y:Q})}return{str:j.map($=>`${$.x},${$.y}`).join(" "),pts:j}}w(()=>{const e=[{key:"characters",label:"Персонажи",idx:0,opacity:.95},{key:"emotions",label:"Эмоции",idx:1,opacity:.75},{key:"actions",label:"Действия",idx:2,opacity:.55},{key:"settings",label:"Сцены",idx:3,opacity:.35}],t=[],o=ue.value;for(const d of e){const k=o.map($=>$[d.idx]),{str:j,pts:l}=ne(k);t.push({key:d.key,label:d.label,values:k,points:j,pointList:l,opacity:d.opacity})}return t});const me=w(()=>{if(!_e.value)return[];if(f.value)return h.value.map(o=>({metric:o.category||o.metric,values:o.values||[],interpretation:o.analysis||o.interpretation||"",insight:o.insight||""}));const e=[{key:"characters",label:"Персонажи",idx:0},{key:"emotions",label:"Эмоции",idx:1},{key:"actions",label:"Действия",idx:2},{key:"settings",label:"Сцены",idx:3}],t=ue.value;return e.map(o=>({metric:o.label,values:t.map(d=>d[o.idx]),interpretation:`Динамика "${o.label}" по последним ${de.value} снам`}))});function we(e){const o=e.split(/\n+/).map(d=>d.trim()).filter(Boolean).filter(d=>/^\d+\./.test(d)).map(d=>d.replace(/^\d+\.\s*/,"")).slice(0,3);return o.length?o:e.split(/[.!?]\s+/).map(d=>d.trim()).filter(Boolean).slice(0,3)}const ge=w(()=>we(K.value));function rt(e){try{const t=String(e||"").toLowerCase(),o=ke=>ke.reduce((Pe,gt)=>Pe+(t.includes(gt)?1:0),0),d=["страх","ужас","паник","тревог","стыд","гнев","плак","слез","кошмар","тоска","грусть"],k=["экзам","выступл","собесед","защит","проект","подготов","завтра","ожидан","волнен","поездк","путешеств","нов","интервью"],j=["вчера","сегодня","работ","школ","универ","дом","улиц","друг","родител","коллег","город"],l=o(d),$=o(k),O=o(j);let Q=l>0?Math.min(1,l/3):0,he=$>0?Math.min(1,$/3):0,ce=O>0?Math.min(1,.5+O/5):0;Q===0&&he===0&&ce===0&&(ce=.6,Q=.2,he=.2);const ve={schema:"dream_type_v1",scores:{memory:+ce.toFixed(2),emotion:+Q.toFixed(2),anticipation:+he.toFixed(2)}},X=[["memory",ve.scores.memory],["emotion",ve.scores.emotion],["anticipation",ve.scores.anticipation]];X.sort((ke,Pe)=>Pe[1]-ke[1]);const xe=+Math.max(0,X[0][1]-X[1][1]).toFixed(2);return{...ve,dominant:X[0][0],confidence:xe}}catch{return null}}const ot=w(()=>{var e,t,o;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.dream_type)||rt((o=c.dream)==null?void 0:o.dream_text)||null});function at(){const e=ot.value;if(!e||!e.dominant)return['<div class="space-y-2">','<div class="font-semibold">🛠 Небольшая работа со сном</div>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Заметь:</span> Какие 2–3 образа из сна самые сильные? Запиши их коротко.</li>','<li><span class="font-semibold">Шаг:</span> Выбери один маленький шаг в реальности, который поддержит тебя по теме сна.</li>',"</ol>","</div>"].join("");const t=String(e.dominant).toLowerCase();return t==="memory"?['<div class="space-y-2">','<div class="font-semibold">🌙 Сон-Память</div>','<p class="opacity-90">Переработка недавнего опыта, соединение нового с прошлым.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Отрази:</span> Вспомни, что происходило последние 1–2 дня. Какие события могли попасть в сон?</li>','<li><span class="font-semibold">Соедини:</span> Отметь, какие элементы сна перекликаются с реальностью — это завершает «архивацию» опыта.</li>',"</ol>","</div>"].join(""):t==="emotion"?['<div class="space-y-2">','<div class="font-semibold">⚡️ Сон-Эмоция</div>','<p class="opacity-90">Проживание и нейтрализация сильных чувств.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Почувствуй:</span> Определи, какая эмоция была самой сильной во сне. Где она чувствуется в теле сейчас?</li>','<li><span class="font-semibold">Услышь:</span> Представь, что главный персонаж сна говорит тебе что-то. Что он хочет, чтобы ты понял?</li>',"</ol>","</div>"].join(""):['<div class="space-y-2">','<div class="font-semibold">🔮 Сон-Предвосхищение</div>','<p class="opacity-90">Тренировка будущих ситуаций и реакций.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Представь:</span> Как бы ты хотел повести себя, если бы это произошло в реальности?</li>','<li><span class="font-semibold">Расшифруй:</span> Какой символ кажется ключевым? Что он может говорить о твоих страхах или намерениях?</li>',"</ol>","</div>"].join("")}const lt=w(()=>{var he,ce,ve;const e=q(((he=c.dream)==null?void 0:he.analysis)||"");if(!e)return[];const t={arch:{key:"arch",title:"Архетипическая история",text:""},func:{key:"func",title:"Возможная функция сна",text:""},freud:{key:"freud",title:"По Фрейду",text:""},jung:{key:"jung",title:"По Юнгу",text:""}},o=[],d=/\*\*([^*]+)\*\*/g;let k;for(;k=d.exec(e);)o.push({title:k[1].trim(),start:k.index,end:k.index+k[0].length});const j=((ce=o[0])==null?void 0:ce.start)??e.length;t.arch.text=e.slice(0,j).trim();for(let X=0;X<o.length;X++){const xe=o[X].title.toLowerCase(),ke=e.slice(o[X].end,((ve=o[X+1])==null?void 0:ve.start)??e.length).trim();xe.includes("возможная функция")?t.func.text=ke:xe.includes("по фрейду")?t.freud.text=ke:xe.includes("по юнгу")&&(t.jung.text=ke)}const l=X=>X.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1"),$=Object.values(t).map(X=>({...X,html:l(X.text||"")}));$.some(X=>X.key==="func")||$.push({key:"func",title:"Возможная функция сна",text:"",html:""});const O=$.findIndex(X=>X.key==="arch");O!==-1&&$.splice(O+1,0,{key:"hvdc",title:"Контент анализ",text:"",html:""});const Q=at();if(Q){const X=$.findIndex(xe=>xe.key==="func");if(X!==-1){const xe=['<div class="mt-3 pt-2 border-t border-white/10 space-y-1">','<div class="font-semibold">Функциональное упражнение</div>',Q,"</div>"].join("");$[X].html=($[X].html||"")+xe}}return $}),pe=kt({arch:!0,hvdc:!1,func:!1,freud:!1,jung:!1,symbols:!0,dynamics:!0,conclusion:!0});function He(e){pe[e]=!pe[e]}const qe=w(()=>{try{return new URLSearchParams(window.location.search).get("debug")==="1"||localStorage.getItem("da_debug")==="1"}catch{return!1}});function ct(){var e,t,o,d,k;try{const j=JSON.stringify(Ue.value,null,2);(e=navigator.clipboard)==null||e.writeText(j),(t=b==null?void 0:b.success)==null||t.call(b,"Скопировано")}catch{try{(k=(d=(o=window.Telegram)==null?void 0:o.WebApp)==null?void 0:d.showPopup)==null||k.call(d,{title:"Debug",message:"Скопируйте из блока ниже вручную",buttons:[{id:"ok",type:"default",text:"OK"}]})}catch{}}}function ut(e){var o;let t=String(e||"").trim();return t=((o=t.split(/[\\/,(;:—–-]/)[0])==null?void 0:o.trim())||"",t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}const Ue=w(()=>{var o,d,k,j;if(!qe.value)return null;const e=c.dream||{},t=Array.isArray((o=e==null?void 0:e.deep_source)==null?void 0:o.tags)?e.deep_source.tags:[];return{id:e.id,created_at:e.created_at,is_deep_analysis:!!e.is_deep_analysis,title_raw:((d=e==null?void 0:e.deep_source)==null?void 0:d.title)||null,tags_raw:t,tags_norm:t.map(ut),dream_type:((k=e==null?void 0:e.deep_source)==null?void 0:k.dream_type)||null,hvdc_present:!!((j=e==null?void 0:e.deep_source)!=null&&j.hvdc)}}),We=re(!1),Ge=re(1),dt=["0-20","20-30","30-40","40-50","50+"],Le=re(""),Me=re("");function Ee(){We.value=!1}async function ft(){try{await Re.setDemographics(Le.value,Me.value);try{await B.fetchProfile()}catch{}b.success("Готово! Дальнейшие анализы будут учитывать эти данные"),We.value=!1}catch{b.error("Не удалось сохранить")}}w(()=>{const e=B.profile||{};return!!(e.age_range&&e.gender)});const Ce=w(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.hvdc)||null}),mt=w(()=>{var k,j,l;const e=[{key:"characters",label:"Персонажи"},{key:"emotions",label:"Эмоции"},{key:"actions",label:"Действия"},{key:"settings",label:"Сцены"}],t=((k=Ce.value)==null?void 0:k.distribution)||{},o=((j=Ce.value)==null?void 0:j.norm)||null,d=((l=Ce.value)==null?void 0:l.comparison)||null;return e.map($=>({key:$.key,label:$.label,value:Number(t[$.key]??0),norm:o?Number(o[$.key]??0):null,delta:d?Number(d[$.key]??0):null}))}),pt=w(()=>{var l;const e=((l=Ce.value)==null?void 0:l.norm_group)||null;if(!e)return"общая статистика";const t=String(e.gender||"").toLowerCase(),o=t==="male"?"муж.":t==="female"?"жен.":"",d=e.age_range||"",k=d?`${d} лет`:"",j=[o,k].filter(Boolean).join(" ");return j?`общая статистика* для ${j}`:"общая статистика"});function Ye(e,t){const o=Math.abs(e)%100,d=o%10;return o>10&&o<20?t[2]:d>1&&d<5?t[1]:d===1?t[0]:t[2]}const ht=w(()=>{if(!c.dream.created_at)return"";try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone||le.tz.guess(),t=le.utc(c.dream.created_at).tz(e).startOf("day"),d=le().tz(e).startOf("day").diff(t,"day");if(d===0)return"сегодня";if(d===1)return"вчера";if(d<7){const O=Ye(d,["день","дня","дней"]);return`${d} ${O} назад`}const k=Math.floor(d/7);if(d<30){const O=Ye(k,["неделя","недели","недель"]);return`${k} ${O} назад`}const j=Math.floor(d/30);if(d<365){const O=Ye(j,["месяц","месяца","месяцев"]);return`${j} ${O} назад`}const l=Math.floor(d/365),$=Ye(l,["год","года","лет"]);return`${l} ${$} назад`}catch{return c.dream.created_at}}),vt=w(()=>{var t;const e=(t=c.dream)==null?void 0:t.created_at;if(!e)return"";try{const o=Intl.DateTimeFormat().resolvedOptions().timeZone||le.tz.guess();return le.utc(e).tz(o).format("D MMMM YYYY, HH:mm")}catch{return e}}),yt=w(()=>{var e;return(e=c.dream)!=null&&e.is_deep_analysis?"from-[#9C41FF] to-[#C03AFF]":"from-[#4A58FF] to-[#5664FF]"});return(e,t)=>{var o,d,k,j;return r(),a("article",{class:fe(["rounded-xl bg-gradient-to-br text-white px-8 md:px-16 transition-all overflow-hidden py-4",[yt.value,Z.overlayMode?"":"cursor-pointer min-h-[4.5rem]"]]),onClick:G},[Z.overlayMode?Y("",!0):(r(),a("div",os,[s("div",as,M(F.value),1),s("div",ls,[s("div",cs,M(T.value),1),s("div",us,M(ht.value),1)]),s("button",{class:"shrink-0 w-6 h-6 opacity-80 hover:opacity-100",onClick:t[0]||(t[0]=oe(l=>U("open"),["stop"])),"aria-label":"Открыть"},[s("span",{class:"inline-block w-6 h-6",style:ze(N.value)},null,4)])])),Z.active?(r(),a("div",ds,[Z.overlayMode?(r(),a("div",fs,[s("h2",ms,M(T.value),1),s("div",ps,M(vt.value),1)])):Y("",!0),A.value.length&&!S.value?(r(),a("div",hs,[(r(!0),a(ee,null,ie(A.value,l=>(r(),a("span",{key:l,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},M(l),1))),128))])):Y("",!0),S.value?(r(),a(ee,{key:2},[C.value?(r(),a("div",vs,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[1]||(t[1]=oe(l=>He("symbols"),["stop"]))},[t[11]||(t[11]=s("span",null,"Повторяющиеся символы",-1)),s("span",ys,M(pe.symbols?"−":"+"),1)]),pe.symbols?(r(),a("div",gs,[E.value?(r(),a("p",xs,M(E.value),1)):Y("",!0),(r(!0),a(ee,null,ie(De.value,(l,$)=>(r(),a("div",{key:`symbol-${$}`,class:"space-y-1"},[s("div",_s,[s("h4",bs,M(l.symbol),1),s("span",ws,"×"+M(l.frequency),1)]),s("p",ks,M(l.description),1),s("div",$s,[t[12]||(t[12]=s("span",{class:"font-medium"},"В ваших снах:",-1)),be(" "+M(l.userContext),1)])]))),128))])):Y("",!0)])):Y("",!0),f.value?(r(),a("div",Ms,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[2]||(t[2]=oe(l=>He("dynamics"),["stop"]))},[t[13]||(t[13]=s("span",null,"Динамика контекста",-1)),s("span",Ss,M(pe.dynamics?"−":"+"),1)]),pe.dynamics?(r(),a("div",Ds,[Oe(Je,{dynamics:h.value,userAge:(o=Be(B).profile)==null?void 0:o.age_range,userGender:(d=Be(B).profile)==null?void 0:d.gender},null,8,["dynamics","userAge","userGender"])])):Y("",!0)])):Y("",!0),m.value?(r(),a("div",Cs,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[3]||(t[3]=oe(l=>He("conclusion"),["stop"]))},[t[14]||(t[14]=s("span",null,"Заключение",-1)),s("span",Ts,M(pe.conclusion?"−":"+"),1)]),pe.conclusion?(r(),a("div",js,[g.value.periodThemes?(r(),a("p",Os,M(g.value.periodThemes),1)):Y("",!0),g.value.dreamFunctionsAnalysis?(r(),a("p",As,M(g.value.dreamFunctionsAnalysis),1)):Y("",!0),g.value.psychologicalSupport?(r(),a("p",Hs,M(g.value.psychologicalSupport),1)):Y("",!0),g.value.integrationExercise?(r(),a("div",Ls,[s("h4",Ys,[t[15]||(t[15]=s("span",null,"💫",-1)),s("span",null,M(g.value.integrationExercise.title||"Практическое упражнение"),1)]),s("p",Bs,M(g.value.integrationExercise.description),1),g.value.integrationExercise.rationale?(r(),a("p",zs,M(g.value.integrationExercise.rationale),1)):Y("",!0)])):Y("",!0)])):Y("",!0)])):Y("",!0),!C.value&&!f.value&&!m.value?(r(),a(ee,{key:3},[s("div",Fs,[t[16]||(t[16]=s("div",{class:"px-3 py-2 font-semibold"},"Общий контекст серии",-1)),s("div",Ns,[s("div",{innerHTML:se.value},null,8,Is)])]),A.value.length?(r(),a("div",Us,[t[17]||(t[17]=s("div",{class:"px-3 py-2 font-semibold"},"Повторяющиеся символы",-1)),s("div",Ws,[s("div",Es,[(r(!0),a(ee,null,ie(A.value,l=>(r(),a("span",{key:"deep-"+l,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},M(l),1))),128))])])])):Y("",!0),_e.value?(r(),a("div",Ps,[t[18]||(t[18]=s("div",{class:"px-3 py-2 font-semibold"},"Динамика",-1)),s("div",Rs,[Oe(Je,{dynamics:me.value,userAge:(k=Be(B).profile)==null?void 0:k.age_range,userGender:(j=Be(B).profile)==null?void 0:j.gender},null,8,["dynamics","userAge","userGender"])])])):Y("",!0),ge.value.length?(r(),a("div",Zs,[t[19]||(t[19]=s("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),s("div",Vs,[s("ol",qs,[(r(!0),a(ee,null,ie(ge.value,(l,$)=>(r(),a("li",{key:"in"+$,class:"text-xs leading-relaxed"},M(l),1))),128))])])])):Y("",!0),R.value.length?(r(),a("div",Gs,[t[20]||(t[20]=s("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),s("div",Js,[s("ol",Xs,[(r(!0),a(ee,null,ie(R.value,(l,$)=>(r(),a("li",{key:"rec"+$,class:"text-xs leading-relaxed"},[typeof l=="object"&&l.title?(r(),a("div",Ks,[s("div",Qs,M(l.title),1),s("div",en,M(l.description),1),l.rationale?(r(),a("div",tn,M(l.rationale),1)):Y("",!0)])):(r(),a("div",sn,M(typeof l=="string"?l:l.title),1))]))),128))])])])):Y("",!0)],64)):Y("",!0),(C.value||f.value)&&!m.value?(r(),a(ee,{key:4},[ge.value.length?(r(),a("div",nn,[t[21]||(t[21]=s("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),s("div",rn,[s("ol",on,[(r(!0),a(ee,null,ie(ge.value,(l,$)=>(r(),a("li",{key:"in"+$,class:"text-xs leading-relaxed"},M(l),1))),128))])])])):Y("",!0),R.value.length?(r(),a("div",an,[t[22]||(t[22]=s("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),s("div",ln,[s("ol",cn,[(r(!0),a(ee,null,ie(R.value,(l,$)=>(r(),a("li",{key:"rec"+$,class:"text-xs leading-relaxed"},[typeof l=="object"&&l.title?(r(),a("div",un,[s("div",dn,M(l.title),1),s("div",fn,M(l.description),1),l.rationale?(r(),a("div",mn,M(l.rationale),1)):Y("",!0)])):(r(),a("div",pn,M(typeof l=="string"?l:l.title),1))]))),128))])])])):Y("",!0)],64)):Y("",!0)],64)):(r(),a(ee,{key:3},[s("div",hn,[t[23]||(t[23]=s("div",{class:"px-3 py-2 font-semibold flex items-center justify-between"},[s("span",null,"Сон"),s("span",{class:"opacity-80 text-pink-400",style:{"font-size":"130%","font-family":"ui-rounded, -apple-system, system-ui, 'SF Pro Rounded', 'Segoe UI', Roboto, Arial"}},"“")],-1)),s("div",vn,[s("p",{class:fe(["opacity-90",W.value?"clamp-5":""])},M(Z.dream.dream_text),3),s("div",yn,[s("button",{class:"text-sm font-semibold opacity-80 hover:opacity-100",onClick:t[4]||(t[4]=oe(l=>W.value=!W.value,["stop"]))},M(W.value?"+":"−"),1)])])]),s("div",gn,[(r(!0),a(ee,null,ie(lt.value,(l,$)=>(r(),a("div",{key:l.key,class:"rounded-lg bg-white/10"},[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:oe(O=>He(l.key),["stop"])},[s("span",null,M(l.title),1),s("span",_n,M(pe[l.key]?"−":"+"),1)],8,xn),pe[l.key]?(r(),a("div",bn,[l.key!=="hvdc"?(r(),a("div",{key:0,innerHTML:l.html},null,8,wn)):(r(),a(ee,{key:1},[Ce.value?(r(),a("div",kn,[(r(!0),a(ee,null,ie(mt.value,O=>(r(),a("div",{key:O.key},[s("div",$n,[s("span",null,M(O.label),1),s("span",null,[be(M(O.value)+"% ",1),O.norm!==null?(r(),a(ee,{key:0},[be(" / "+M(O.norm)+"%",1)],64)):Y("",!0),O.delta!==null?(r(),a("span",{key:1,class:fe(O.delta>0?"text-green-300":O.delta<0?"text-red-300":"text-white/70")}," ("+M(O.delta>0?"+"+O.delta:O.delta)+"pp) ",3)):Y("",!0)])]),s("div",Mn,[O.norm!==null?(r(),a("div",{key:0,class:"absolute inset-y-0 left-0 bg-white/20",style:ze({width:O.norm+"%"})},null,4)):Y("",!0),s("div",{class:"relative h-full bg-white/70",style:ze({width:O.value+"%"})},null,4)])]))),128)),s("div",Sn,[t[25]||(t[25]=s("span",{class:"inline-flex items-center gap-2"},[s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/70 shrink-0"}),be(" ваш сон")],-1)),s("span",Dn,[t[24]||(t[24]=s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/20 shrink-0"},null,-1)),be(" "+M(pt.value),1)])]),t[26]||(t[26]=s("div",{class:"text-xs opacity-70 flex items-start gap-2"},[s("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-white/20 text-white text-[10px]"},"i"),s("span",null,"Контент‑анализ по схеме HVdC; сравнение с демографическими нормами (DreamBank, SDDB).")],-1))])):Y("",!0)],64))])):Y("",!0)]))),128))])],64)),s("div",Cn,[s("button",{class:fe(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",z.value===1?"bg-green-500/30 text-white ring-2 ring-green-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:oe(v,["stop"])}," 👍 ",2),s("button",{class:fe(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",z.value===2?"bg-red-500/30 text-white ring-2 ring-red-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:oe(n,["stop"])}," 👎 ",2),s("button",{class:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-white rounded-xl py-2 text-sm font-medium text-center transition-colors",onClick:oe(u,["stop"])}," 🗑️ ")]),qe.value&&Ue.value?(r(),a("div",Tn,[t[27]||(t[27]=s("div",{class:"mb-2 opacity-80"},"Debug payload",-1)),be(" "+M(JSON.stringify(Ue.value,null,2))+" ",1),s("div",jn,[s("button",{class:"px-3 py-1 rounded bg-white/10 hover:bg-white/20",onClick:oe(ct,["stop"])},"Скопировать")])])):Y("",!0),(r(),Fe(Xe,{to:"body"},[We.value?(r(),a("div",{key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70",onClick:oe(Ee,["self"]),onWheel:t[9]||(t[9]=oe(()=>{},["prevent"])),onTouchmove:t[10]||(t[10]=oe(()=>{},["prevent"]))},[s("div",{class:"w-[92vw] max-w-[440px] rounded-2xl bg-[var(--tg-theme-secondary-bg-color,#0c110c)] text-white p-4 shadow-2xl border border-white/10",onClick:t[8]||(t[8]=oe(()=>{},["stop"]))},[t[30]||(t[30]=s("h3",{class:"text-lg font-semibold mb-2"},"Уточнить данные",-1)),Ge.value===1?(r(),a("div",On,[t[28]||(t[28]=s("p",{class:"opacity-90"},"Ваш возрастной диапазон:",-1)),s("div",An,[(r(),a(ee,null,ie(dt,l=>s("button",{key:l,class:fe(["px-4 py-3 rounded-xl text-sm",Le.value===l?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:$=>Le.value=l},M(l),11,Hn)),64))]),s("div",Ln,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:Ee},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Le.value,onClick:t[5]||(t[5]=l=>Ge.value=2)},"Далее",8,Yn)])])):(r(),a("div",Bn,[t[29]||(t[29]=s("p",{class:"opacity-90"},"Ваш пол:",-1)),s("div",zn,[s("button",{class:fe(["px-4 py-3 rounded-xl text-sm",Me.value==="male"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[6]||(t[6]=l=>Me.value="male")},"Мужской",2),s("button",{class:fe(["px-4 py-3 rounded-xl text-sm",Me.value==="female"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[7]||(t[7]=l=>Me.value="female")},"Женский",2)]),s("div",Fn,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:Ee},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Me.value,onClick:ft},"Сохранить",8,Nn)])]))])],32)):Y("",!0)]))])):Y("",!0)],2)}}}),Ze=Ve(Un,[["__scopeId","data-v-d9b89be8"]]),Wn={class:"absolute inset-0 overflow-y-auto"},En=Ne({__name:"DreamOverlay",props:{dream:{}},emits:["close"],setup(Z,{emit:V}){le.locale("ru"),le.extend(st),le.extend(it);const c=Z,U=V,G=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]),B=n=>String(n||"").replace(/\s+/g," ").trim().split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" "),b=n=>{if(!n)return"";const u=String(n).split(/[.!?\n]/)[0],i=u.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(x=>x&&!G.has(x)&&x.length>3).slice(0,3);return i.length===0?u.slice(0,40):B(i.join(" "))},W=n=>{if(!n)return"";let u=String(n).toLowerCase().replace(/["'«»]/g,"").trim();u=u.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),u=u.replace(/\s+/g," ").trim();const y=u.split(" ").filter(Boolean).slice(0,3);return y.length?y.join(" "):""},S=n=>{if(!n)return"";const u=String(n).toLowerCase();return u.charAt(0).toUpperCase()+u.slice(1)};w(()=>{var p,_,T,A,q;const n=W(String(((_=(p=c.dream)==null?void 0:p.deep_source)==null?void 0:_.title)||""));if(n)return S(n);const u=(((A=(T=c.dream)==null?void 0:T.deep_source)==null?void 0:A.tags)||[]).filter(Boolean),y=K=>{var E;let P=String(K||"").trim();return P=((E=P.split(/[\\/,(;:—–-]/)[0])==null?void 0:E.trim())||"",P?P.charAt(0).toUpperCase()+P.slice(1).toLowerCase():""},i=u.map(y).filter(Boolean);if(i.length){const K=i.slice(0,2).join(" и ");return S(K||"Без названия")}const x=W(b(String(((q=c.dream)==null?void 0:q.dream_text)||"")));return S(x||"Без названия")}),w(()=>{var u;const n=(u=c.dream)==null?void 0:u.created_at;if(!n)return"";try{const y=Intl.DateTimeFormat().resolvedOptions().timeZone||le.tz.guess();return le.utc(n).tz(y).format("D MMMM YYYY, HH:mm")}catch{return n}});function F(){var n,u,y,i,x;try{const p=(n=window==null?void 0:window.Telegram)==null?void 0:n.WebApp;(y=(u=p==null?void 0:p.BackButton)==null?void 0:u.show)==null||y.call(u),(x=(i=p==null?void 0:p.BackButton)==null?void 0:i.onClick)==null||x.call(i,z)}catch{}}function N(){var n,u,y,i,x;try{const p=(n=window==null?void 0:window.Telegram)==null?void 0:n.WebApp;(y=(u=p==null?void 0:p.BackButton)==null?void 0:u.hide)==null||y.call(u),(x=(i=p==null?void 0:p.BackButton)==null?void 0:i.offClick)==null||x.call(i,z)}catch{}}function z(){U("close")}const D=re(null);function I(n){const u=D.value;u&&u.contains(n.target)||U("close")}$t(()=>{Mt(()=>c.dream,n=>{if(n){try{document.body.style.overflow="hidden"}catch{}F();try{St(()=>{const u=document.querySelector("[data-user-anchor]"),y=u?Math.max(0,Math.round(u.getBoundingClientRect().top)):0;v.value=Math.max(0,y+20)})}catch{}}else{N();try{document.body.style.overflow=""}catch{}}},{immediate:!0})}),Dt(()=>{N();try{document.body.style.overflow=""}catch{}});const v=re(16);return(n,u)=>(r(),Fe(Xe,{to:"body"},[Z.dream?(r(),a("div",{key:0,class:"fixed inset-0 z-[9998] bg-black/70",onClick:I},[s("div",Wn,[s("div",{class:"pb-6",style:ze({paddingTop:v.value+"px"})},[s("div",{ref_key:"cardRef",ref:D,onClick:u[0]||(u[0]=oe(()=>{},["stop"]))},[Oe(Ze,{dream:Z.dream,active:!0,overlayMode:!0},null,8,["dream"])],512)],4)])])):Y("",!0)]))}}),Pn={class:"flex items-center gap-8 mb-6 border-b border-white/10"},Rn={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white rounded-full"},Zn={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white rounded-full"},Vn={key:0,class:"flex flex-col gap-4 pb-[5vh]"},qn={key:1,class:"text-center text-red-400 py-8"},Gn={key:2},Jn={key:0,class:"text-center text-white/60 py-8"},Xn={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Kn={key:3},Qn={key:0,class:"text-center text-white/60 py-8"},ei={key:1,class:"flex flex-col gap-4 pb-[5vh]"},ti=Ne({__name:"AnalysisHistoryList",props:["userStore"],setup(Z){const V=Z,c=re(null),U=re(5),G=re(5),B=re("history"),b=w(()=>{var y;return(y=V.userStore)!=null&&y.history?V.userStore.history.filter(i=>!i.is_deep_analysis):[]}),W=w(()=>{var y;return(y=V.userStore)!=null&&y.history?V.userStore.history.filter(i=>i.is_deep_analysis):[]}),S=w(()=>b.value.slice(0,U.value)),F=w(()=>W.value.slice(0,G.value)),N=w(()=>b.value.length>U.value),z=w(()=>W.value.length>G.value),D=()=>{window.triggerHaptic&&window.triggerHaptic("light"),U.value+=5},I=()=>{window.triggerHaptic&&window.triggerHaptic("light"),G.value+=5},v=y=>{window.triggerHaptic&&window.triggerHaptic("light"),B.value=y,c.value=null},n=y=>{var i,x,p,_,T;c.value=y;try{const A=(i=window==null?void 0:window.Telegram)==null?void 0:i.WebApp;(p=(x=A==null?void 0:A.BackButton)==null?void 0:x.onClick)==null||p.call(x,()=>u()),(T=(_=A==null?void 0:A.BackButton)==null?void 0:_.show)==null||T.call(_)}catch{}},u=()=>{var y,i,x;try{const p=(y=window==null?void 0:window.Telegram)==null?void 0:y.WebApp;(x=(i=p==null?void 0:p.BackButton)==null?void 0:i.hide)==null||x.call(i)}catch{}c.value=null};return(y,i)=>{var x,p,_,T;return r(),a("div",null,[s("div",Pn,[s("button",{onClick:i[0]||(i[0]=A=>v("history")),class:fe(["relative pb-3 text-lg font-semibold transition-all duration-200",[B.value==="history"?"text-white":"text-white/40 hover:text-white/60"]])},[i[2]||(i[2]=be(" Дневник снов ",-1)),B.value==="history"?(r(),a("div",Rn)):Y("",!0)],2),s("button",{onClick:i[1]||(i[1]=A=>v("deep")),class:fe(["relative pb-3 text-lg font-semibold transition-all duration-200",[B.value==="deep"?"text-white":"text-white/40 hover:text-white/60"]])},[i[3]||(i[3]=be(" Глубокий анализ ",-1)),B.value==="deep"?(r(),a("div",Zn)):Y("",!0)],2)]),(x=Z.userStore)!=null&&x.isLoadingHistory?(r(),a("div",Vn,[(r(),a(ee,null,ie(3,A=>s("div",{key:A,class:"rounded-xl bg-white/10 px-8 md:px-16 py-6"},[...i[4]||(i[4]=[Ct('<div class="flex justify-between items-center py-2 min-h-[2.5rem]" data-v-73686d16><div class="shimmer h-4 w-32 rounded" data-v-73686d16></div><div class="shimmer h-4 w-12 rounded" data-v-73686d16></div></div><div class="mt-4 space-y-2" data-v-73686d16><div class="shimmer h-3 w-full rounded" data-v-73686d16></div><div class="shimmer h-3 w-5/6 rounded" data-v-73686d16></div><div class="shimmer h-3 w-2/3 rounded" data-v-73686d16></div></div><div class="mt-4 grid grid-cols-3 gap-2" data-v-73686d16><div class="shimmer h-6 rounded-full" data-v-73686d16></div><div class="shimmer h-6 rounded-full" data-v-73686d16></div><div class="shimmer h-6 rounded-full" data-v-73686d16></div></div>',3)])])),64))])):(p=Z.userStore)!=null&&p.errorHistory?(r(),a("div",qn," Ошибка загрузки: "+M(Z.userStore.errorHistory),1)):B.value==="history"?(r(),a("div",Gn,[(_=b.value)!=null&&_.length?(r(),a("div",Xn,[(r(!0),a(ee,null,ie(S.value,A=>(r(),Fe(Ze,{key:A.id,dream:A,onOpen:q=>n(A)},null,8,["dream","onOpen"]))),128)),N.value?(r(),a("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:D}," Загрузить ещё ")):Y("",!0)])):(r(),a("div",Jn," У вас пока нет сохраненных анализов "))])):B.value==="deep"?(r(),a("div",Kn,[(T=W.value)!=null&&T.length?(r(),a("div",ei,[(r(!0),a(ee,null,ie(F.value,A=>(r(),Fe(Ze,{key:A.id,dream:A,onOpen:q=>n(A)},null,8,["dream","onOpen"]))),128)),z.value?(r(),a("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:I}," Загрузить ещё ")):Y("",!0)])):(r(),a("div",Qn," Пока нет глубоких анализов "))])):Y("",!0),Oe(En,{dream:c.value,onClose:u},null,8,["dream"])])}}}),ri=Ve(ti,[["__scopeId","data-v-73686d16"]]);export{ri as default};

import{d as Ne,r as re,c as M,a as m,o as h,b as s,s as Ve,M as nt,w as it,t as P,e as K,F as ne,A as ae,n as ve,m as rt,u as at,N as ot,k as Fe,q as Be,C as fe,l as De,f as We,D as lt,z as ze,O as ct,P as ut,j as dt}from"./main-Zfg8tELx.js";import{g as Le,c as Ce}from"./_commonjsHelpers-Cpj98o6Y.js";import{_ as Ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Ze={exports:{}};(function(R,Q){(function(l,U){R.exports=U()})(Ce,function(){var l=1e3,U=6e4,J=36e5,F="millisecond",_="second",Y="minute",k="hour",S="day",D="week",N="month",L="quarter",j="year",f="date",o="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,x=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(b){var u=["th","st","nd","rd"],r=b%100;return"["+b+(u[(r-20)%10]||u[r]||u[0])+"]"}},T=function(b,u,r){var p=String(b);return!p||p.length>=u?b:""+Array(u+1-p.length).join(r)+b},C={s:T,z:function(b){var u=-b.utcOffset(),r=Math.abs(u),p=Math.floor(r/60),c=r%60;return(u<=0?"+":"-")+T(p,2,"0")+":"+T(c,2,"0")},m:function b(u,r){if(u.date()<r.date())return-b(r,u);var p=12*(r.year()-u.year())+(r.month()-u.month()),c=u.clone().add(p,N),H=r-c<0,O=u.clone().add(p+(H?-1:1),N);return+(-(p+(r-c)/(H?c-O:O-c))||0)},a:function(b){return b<0?Math.ceil(b)||0:Math.floor(b)},p:function(b){return{M:N,y:j,w:D,d:S,D:f,h:k,m:Y,s:_,ms:F,Q:L}[b]||String(b||"").toLowerCase().replace(/s$/,"")},u:function(b){return b===void 0}},v="en",y={};y[v]=d;var B="$isDayjsObject",G=function(b){return b instanceof we||!(!b||!b[B])},te=function b(u,r,p){var c;if(!u)return v;if(typeof u=="string"){var H=u.toLowerCase();y[H]&&(c=H),r&&(y[H]=r,c=H);var O=u.split("-");if(!c&&O.length>1)return b(O[0])}else{var W=u.name;y[W]=u,c=W}return!p&&c&&(v=c),c||!p&&v},I=function(b,u){if(G(b))return b.clone();var r=typeof u=="object"?u:{};return r.date=b,r.args=arguments,new we(r)},z=C;z.l=te,z.i=G,z.w=function(b,u){return I(b,{locale:u.$L,utc:u.$u,x:u.$x,$offset:u.$offset})};var we=function(){function b(r){this.$L=te(r.locale,null,!0),this.parse(r),this.$x=this.$x||r.x||{},this[B]=!0}var u=b.prototype;return u.parse=function(r){this.$d=function(p){var c=p.date,H=p.utc;if(c===null)return new Date(NaN);if(z.u(c))return new Date;if(c instanceof Date)return new Date(c);if(typeof c=="string"&&!/Z$/i.test(c)){var O=c.match(g);if(O){var W=O[2]-1||0,Z=(O[7]||"0").substring(0,3);return H?new Date(Date.UTC(O[1],W,O[3]||1,O[4]||0,O[5]||0,O[6]||0,Z)):new Date(O[1],W,O[3]||1,O[4]||0,O[5]||0,O[6]||0,Z)}}return new Date(c)}(r),this.init()},u.init=function(){var r=this.$d;this.$y=r.getFullYear(),this.$M=r.getMonth(),this.$D=r.getDate(),this.$W=r.getDay(),this.$H=r.getHours(),this.$m=r.getMinutes(),this.$s=r.getSeconds(),this.$ms=r.getMilliseconds()},u.$utils=function(){return z},u.isValid=function(){return this.$d.toString()!==o},u.isSame=function(r,p){var c=I(r);return this.startOf(p)<=c&&c<=this.endOf(p)},u.isAfter=function(r,p){return I(r)<this.startOf(p)},u.isBefore=function(r,p){return this.endOf(p)<I(r)},u.$g=function(r,p,c){return z.u(r)?this[p]:this.set(c,r)},u.unix=function(){return Math.floor(this.valueOf()/1e3)},u.valueOf=function(){return this.$d.getTime()},u.startOf=function(r,p){var c=this,H=!!z.u(p)||p,O=z.p(r),W=function(me,se){var ce=z.w(c.$u?Date.UTC(c.$y,se,me):new Date(c.$y,se,me),c);return H?ce:ce.endOf(S)},Z=function(me,se){return z.w(c.toDate()[me].apply(c.toDate("s"),(H?[0,0,0,0]:[23,59,59,999]).slice(se)),c)},X=this.$W,ee=this.$M,ie=this.$D,ye="set"+(this.$u?"UTC":"");switch(O){case j:return H?W(1,0):W(31,11);case N:return H?W(1,ee):W(0,ee+1);case D:var he=this.$locale().weekStart||0,le=(X<he?X+7:X)-he;return W(H?ie-le:ie+(6-le),ee);case S:case f:return Z(ye+"Hours",0);case k:return Z(ye+"Minutes",1);case Y:return Z(ye+"Seconds",2);case _:return Z(ye+"Milliseconds",3);default:return this.clone()}},u.endOf=function(r){return this.startOf(r,!1)},u.$set=function(r,p){var c,H=z.p(r),O="set"+(this.$u?"UTC":""),W=(c={},c[S]=O+"Date",c[f]=O+"Date",c[N]=O+"Month",c[j]=O+"FullYear",c[k]=O+"Hours",c[Y]=O+"Minutes",c[_]=O+"Seconds",c[F]=O+"Milliseconds",c)[H],Z=H===S?this.$D+(p-this.$W):p;if(H===N||H===j){var X=this.clone().set(f,1);X.$d[W](Z),X.init(),this.$d=X.set(f,Math.min(this.$D,X.daysInMonth())).$d}else W&&this.$d[W](Z);return this.init(),this},u.set=function(r,p){return this.clone().$set(r,p)},u.get=function(r){return this[z.p(r)]()},u.add=function(r,p){var c,H=this;r=Number(r);var O=z.p(p),W=function(ee){var ie=I(H);return z.w(ie.date(ie.date()+Math.round(ee*r)),H)};if(O===N)return this.set(N,this.$M+r);if(O===j)return this.set(j,this.$y+r);if(O===S)return W(1);if(O===D)return W(7);var Z=(c={},c[Y]=U,c[k]=J,c[_]=l,c)[O]||1,X=this.$d.getTime()+r*Z;return z.w(X,this)},u.subtract=function(r,p){return this.add(-1*r,p)},u.format=function(r){var p=this,c=this.$locale();if(!this.isValid())return c.invalidDate||o;var H=r||"YYYY-MM-DDTHH:mm:ssZ",O=z.z(this),W=this.$H,Z=this.$m,X=this.$M,ee=c.weekdays,ie=c.months,ye=c.meridiem,he=function(se,ce,_e,ge){return se&&(se[ce]||se(p,H))||_e[ce].slice(0,ge)},le=function(se){return z.s(W%12||12,se,"0")},me=ye||function(se,ce,_e){var ge=se<12?"AM":"PM";return _e?ge.toLowerCase():ge};return H.replace(x,function(se,ce){return ce||function(_e){switch(_e){case"YY":return String(p.$y).slice(-2);case"YYYY":return z.s(p.$y,4,"0");case"M":return X+1;case"MM":return z.s(X+1,2,"0");case"MMM":return he(c.monthsShort,X,ie,3);case"MMMM":return he(ie,X);case"D":return p.$D;case"DD":return z.s(p.$D,2,"0");case"d":return String(p.$W);case"dd":return he(c.weekdaysMin,p.$W,ee,2);case"ddd":return he(c.weekdaysShort,p.$W,ee,3);case"dddd":return ee[p.$W];case"H":return String(W);case"HH":return z.s(W,2,"0");case"h":return le(1);case"hh":return le(2);case"a":return me(W,Z,!0);case"A":return me(W,Z,!1);case"m":return String(Z);case"mm":return z.s(Z,2,"0");case"s":return String(p.$s);case"ss":return z.s(p.$s,2,"0");case"SSS":return z.s(p.$ms,3,"0");case"Z":return O}return null}(se)||O.replace(":","")})},u.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},u.diff=function(r,p,c){var H,O=this,W=z.p(p),Z=I(r),X=(Z.utcOffset()-this.utcOffset())*U,ee=this-Z,ie=function(){return z.m(O,Z)};switch(W){case j:H=ie()/12;break;case N:H=ie();break;case L:H=ie()/3;break;case D:H=(ee-X)/6048e5;break;case S:H=(ee-X)/864e5;break;case k:H=ee/J;break;case Y:H=ee/U;break;case _:H=ee/l;break;default:H=ee}return c?H:z.a(H)},u.daysInMonth=function(){return this.endOf(N).$D},u.$locale=function(){return y[this.$L]},u.locale=function(r,p){if(!r)return this.$L;var c=this.clone(),H=te(r,p,!0);return H&&(c.$L=H),c},u.clone=function(){return z.w(this.$d,this)},u.toDate=function(){return new Date(this.valueOf())},u.toJSON=function(){return this.isValid()?this.toISOString():null},u.toISOString=function(){return this.$d.toISOString()},u.toString=function(){return this.$d.toUTCString()},b}(),He=we.prototype;return I.prototype=He,[["$ms",F],["$s",_],["$m",Y],["$H",k],["$W",S],["$M",N],["$y",j],["$D",f]].forEach(function(b){He[b[1]]=function(u){return this.$g(u,b[0],b[1])}}),I.extend=function(b,u){return b.$i||(b(u,we,I),b.$i=!0),I},I.locale=te,I.isDayjs=G,I.unix=function(b){return I(1e3*b)},I.en=y[v],I.Ls=y,I.p={},I})})(Ze);var Ee=Ze.exports;const be=Le(Ee);var Re={exports:{}};(function(R,Q){(function(l,U){R.exports=U()})(Ce,function(){return function(l,U,J){l=l||{};var F=U.prototype,_={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function Y(S,D,N,L){return F.fromToBase(S,D,N,L)}J.en.relativeTime=_,F.fromToBase=function(S,D,N,L,j){for(var f,o,g,x=N.$locale().relativeTime||_,d=l.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],T=d.length,C=0;C<T;C+=1){var v=d[C];v.d&&(f=L?J(S).diff(N,v.d,!0):N.diff(S,v.d,!0));var y=(l.rounding||Math.round)(Math.abs(f));if(g=f>0,y<=v.r||!v.r){y<=1&&C>0&&(v=d[C-1]);var B=x[v.l];j&&(y=j(""+y)),o=typeof B=="string"?B.replace("%d",y):B(y,D,v.l,g);break}}if(D)return o;var G=g?x.future:x.past;return typeof G=="function"?G(o):G.replace("%s",o)},F.to=function(S,D){return Y(S,D,this,!0)},F.from=function(S,D){return Y(S,D,this)};var k=function(S){return S.$u?J.utc():J()};F.toNow=function(S){return this.to(k(this),S)},F.fromNow=function(S){return this.from(k(this),S)}}})})(Re);var ft=Re.exports;const ht=Le(ft);var Je={exports:{}};(function(R,Q){(function(l,U){R.exports=U()})(Ce,function(){var l="minute",U=/[+-]\d\d(?::?\d\d)?/g,J=/([+-]|\d\d)/g;return function(F,_,Y){var k=_.prototype;Y.utc=function(o){var g={date:o,utc:!0,args:arguments};return new _(g)},k.utc=function(o){var g=Y(this.toDate(),{locale:this.$L,utc:!0});return o?g.add(this.utcOffset(),l):g},k.local=function(){return Y(this.toDate(),{locale:this.$L,utc:!1})};var S=k.parse;k.parse=function(o){o.utc&&(this.$u=!0),this.$utils().u(o.$offset)||(this.$offset=o.$offset),S.call(this,o)};var D=k.init;k.init=function(){if(this.$u){var o=this.$d;this.$y=o.getUTCFullYear(),this.$M=o.getUTCMonth(),this.$D=o.getUTCDate(),this.$W=o.getUTCDay(),this.$H=o.getUTCHours(),this.$m=o.getUTCMinutes(),this.$s=o.getUTCSeconds(),this.$ms=o.getUTCMilliseconds()}else D.call(this)};var N=k.utcOffset;k.utcOffset=function(o,g){var x=this.$utils().u;if(x(o))return this.$u?0:x(this.$offset)?N.call(this):this.$offset;if(typeof o=="string"&&(o=function(v){v===void 0&&(v="");var y=v.match(U);if(!y)return null;var B=(""+y[0]).match(J)||["-",0,0],G=B[0],te=60*+B[1]+ +B[2];return te===0?0:G==="+"?te:-te}(o),o===null))return this;var d=Math.abs(o)<=16?60*o:o;if(d===0)return this.utc(g);var T=this.clone();if(g)return T.$offset=d,T.$u=!1,T;var C=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(T=this.local().add(d+C,l)).$offset=d,T.$x.$localOffset=C,T};var L=k.format;k.format=function(o){var g=o||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return L.call(this,g)},k.valueOf=function(){var o=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*o},k.isUTC=function(){return!!this.$u},k.toISOString=function(){return this.toDate().toISOString()},k.toString=function(){return this.toDate().toUTCString()};var j=k.toDate;k.toDate=function(o){return o==="s"&&this.$offset?Y(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():j.call(this)};var f=k.diff;k.diff=function(o,g,x){if(o&&this.$u===o.$u)return f.call(this,o,g,x);var d=this.local(),T=Y(o).local();return f.call(d,T,g,x)}}})})(Je);var mt=Je.exports;const pt=Le(mt);var qe={exports:{}};(function(R,Q){(function(l,U){R.exports=U()})(Ce,function(){var l={year:0,month:1,day:2,hour:3,minute:4,second:5},U={};return function(J,F,_){var Y,k=function(L,j,f){f===void 0&&(f={});var o=new Date(L),g=function(x,d){d===void 0&&(d={});var T=d.timeZoneName||"short",C=x+"|"+T,v=U[C];return v||(v=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:x,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:T}),U[C]=v),v}(j,f);return g.formatToParts(o)},S=function(L,j){for(var f=k(L,j),o=[],g=0;g<f.length;g+=1){var x=f[g],d=x.type,T=x.value,C=l[d];C>=0&&(o[C]=parseInt(T,10))}var v=o[3],y=v===24?0:v,B=o[0]+"-"+o[1]+"-"+o[2]+" "+y+":"+o[4]+":"+o[5]+":000",G=+L;return(_.utc(B).valueOf()-(G-=G%1e3))/6e4},D=F.prototype;D.tz=function(L,j){L===void 0&&(L=Y);var f,o=this.utcOffset(),g=this.toDate(),x=g.toLocaleString("en-US",{timeZone:L}),d=Math.round((g-new Date(x))/1e3/60),T=15*-Math.round(g.getTimezoneOffset()/15)-d;if(!Number(T))f=this.utcOffset(0,j);else if(f=_(x,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(T,!0),j){var C=f.utcOffset();f=f.add(o-C,"minute")}return f.$x.$timezone=L,f},D.offsetName=function(L){var j=this.$x.$timezone||_.tz.guess(),f=k(this.valueOf(),j,{timeZoneName:L}).find(function(o){return o.type.toLowerCase()==="timezonename"});return f&&f.value};var N=D.startOf;D.startOf=function(L,j){if(!this.$x||!this.$x.$timezone)return N.call(this,L,j);var f=_(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return N.call(f,L,j).tz(this.$x.$timezone,!0)},_.tz=function(L,j,f){var o=f&&j,g=f||j||Y,x=S(+_(),g);if(typeof L!="string")return _(L).tz(g);var d=function(y,B,G){var te=y-60*B*1e3,I=S(te,G);if(B===I)return[te,B];var z=S(te-=60*(I-B)*1e3,G);return I===z?[te,I]:[y-60*Math.min(I,z)*1e3,Math.max(I,z)]}(_.utc(L,o).valueOf(),x,g),T=d[0],C=d[1],v=_(T).utcOffset(C);return v.$x.$timezone=g,v},_.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},_.tz.setDefault=function(L){Y=L}}})})(qe);var vt=qe.exports;const yt=Le(vt);var gt={exports:{}};(function(R,Q){(function(l,U){R.exports=U(Ee)})(Ce,function(l){function U(f){return f&&typeof f=="object"&&"default"in f?f:{default:f}}var J=U(l),F="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),_="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),Y="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),k="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),S=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function D(f,o,g){var x,d;return g==="m"?o?"минута":"минуту":f+" "+(x=+f,d={mm:o?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[g].split("_"),x%10==1&&x%100!=11?d[0]:x%10>=2&&x%10<=4&&(x%100<10||x%100>=20)?d[1]:d[2])}var N=function(f,o){return S.test(o)?F[f.month()]:_[f.month()]};N.s=_,N.f=F;var L=function(f,o){return S.test(o)?Y[f.month()]:k[f.month()]};L.s=k,L.f=Y;var j={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:N,monthsShort:L,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:D,mm:D,h:"час",hh:D,d:"день",dd:D,M:"месяц",MM:D,y:"год",yy:D},ordinal:function(f){return f},meridiem:function(f){return f<4?"ночи":f<12?"утра":f<17?"дня":"вечера"}};return J.default.locale(j,null,!0),j})})(gt);const _t={class:"dynamics-chart-container"},xt={class:"text-sm font-semibold mb-2 flex items-center justify-between"},bt={class:"text-xs opacity-70"},wt={class:"chart-svg-container"},$t={class:"y-axis-labels"},kt={class:"y-label"},Mt={class:"y-label"},Dt={class:"y-label"},St={class:"chart-svg-wrapper"},Tt=["viewBox"],Ct=["y1","y2"],Ht=["y"],Ot=["y1","y2"],Lt=["points"],At=["cx","cy"],jt={class:"mt-3 text-xs opacity-80 leading-relaxed"},Yt={class:"pagination-dots"},zt=["onClick"],Se=300,Te=80,ke=6,Ft=Ne({__name:"DynamicsChart",props:{dynamics:{},userAge:{},userGender:{}},setup(R){const Q=R,l=re(0),U=re(0),J=re(0),F=re("slide-left"),_=M(()=>Q.dynamics[l.value]||{metric:"",values:[],interpretation:""}),Y=M(()=>_.value.values||[]),k=M(()=>{const d=Y.value;if(d.length===0)return{min:0,max:10,labels:[10,5,0]};const T=Math.floor(Math.min(...d)),C=Math.ceil(Math.max(...d)),v=C-T,y=v<2?Math.max(0,T-1):T,B=v<2?Math.min(10,C+1):C,G=[B,Math.round((B+y)/2),y];return{min:y,max:B,labels:G}}),S=M(()=>{var y;const d=_.value.metric;if(!Q.userAge||!Q.userGender)return null;const C=(y={Персонажи:{"18-24":{male:6.5,female:7},"25-34":{male:6,female:6.5},"35-44":{male:5.5,female:6},"45+":{male:5,female:5.5}},Эмоции:{"18-24":{male:6,female:7},"25-34":{male:5.5,female:6.5},"35-44":{male:5,female:6},"45+":{male:4.5,female:5.5}},Действия:{"18-24":{male:7,female:6.5},"25-34":{male:6.5,female:6},"35-44":{male:6,female:5.5},"45+":{male:5.5,female:5}},Сцены:{"18-24":{male:6.5,female:6.5},"25-34":{male:6,female:6},"35-44":{male:5.5,female:5.5},"45+":{male:5,female:5}}}[d])==null?void 0:y[Q.userAge];if(!C)return null;const v=C[Q.userGender];return v===void 0?null:v}),D=M(()=>{const d=S.value;if(d===null)return null;const{min:T,max:C}=k.value,v=Te-ke*2,y=(d-T)/(C-T);return ke+v-y*v}),N=M(()=>{const d=Y.value;if(d.length===0)return[];const{min:T,max:C}=k.value,v=Se-ke*2,y=Te-ke*2,B=d.length>1?v/(d.length-1):0;return d.map((G,te)=>{const I=(G-T)/(C-T);return{x:ke+te*B,y:ke+y-I*y}})}),L=M(()=>N.value.map(d=>`${d.x},${d.y}`).join(" "));function j(d){U.value=d.touches[0].clientX}function f(d){J.value=d.touches[0].clientX}function o(){const d=U.value-J.value;Math.abs(d)>50&&(d>0&&l.value<Q.dynamics.length-1?(F.value="slide-left",l.value++,x()):d<0&&l.value>0&&(F.value="slide-right",l.value--,x())),U.value=0,J.value=0}function g(d){d!==l.value&&(F.value=d>l.value?"slide-left":"slide-right",l.value=d,x())}function x(){window.triggerHaptic&&window.triggerHaptic("light")}return(d,T)=>(h(),m("div",_t,[s("div",{class:"chart-wrapper",onTouchstart:j,onTouchmove:f,onTouchend:o},[Ve(nt,{name:F.value,mode:"out-in"},{default:it(()=>[(h(),m("div",{key:l.value,class:"chart-content"},[s("div",xt,[s("span",null,P(_.value.metric),1),s("span",bt,P(Y.value[Y.value.length-1]),1)]),s("div",wt,[s("div",$t,[s("span",kt,P(k.value.labels[0]),1),s("span",Mt,P(k.value.labels[1]),1),s("span",Dt,P(k.value.labels[2]),1)]),s("div",St,[(h(),m("svg",{viewBox:`0 0 ${Se} ${Te}`,class:"chart-svg",preserveAspectRatio:"xMidYMid meet"},[(h(),m(ne,null,ae(3,C=>s("line",{key:`grid-${C}`,x1:0,x2:Se,y1:Te/2*(C-1),y2:Te/2*(C-1),stroke:"white","stroke-opacity":"0.15","stroke-width":"1"},null,8,Ct)),64)),D.value!==null?(h(),m("rect",{key:0,x:0,y:D.value-8,width:Se,height:16,fill:"yellow",opacity:"0.15"},null,8,Ht)):K("",!0),D.value!==null?(h(),m("line",{key:1,x1:0,x2:Se,y1:D.value,y2:D.value,stroke:"yellow","stroke-opacity":"0.6","stroke-width":"1.5","stroke-dasharray":"4,3"},null,8,Ot)):K("",!0),s("polyline",{points:L.value,fill:"none",stroke:"white","stroke-width":"2.5","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Lt),(h(!0),m(ne,null,ae(N.value,(C,v)=>(h(),m("circle",{key:`point-${v}`,cx:C.x,cy:C.y,r:"4",fill:"white","vector-effect":"non-scaling-stroke"},null,8,At))),128))],8,Tt))])]),s("div",jt,P(_.value.interpretation),1)]))]),_:1},8,["name"])],32),s("div",Yt,[(h(!0),m(ne,null,ae(R.dynamics,(C,v)=>(h(),m("button",{key:`dot-${v}`,class:ve(["dot",{active:v===l.value}]),onClick:y=>g(v)},null,10,zt))),128))])]))}}),Nt=Ue(Ft,[["__scopeId","data-v-53baabee"]]),Ut={class:"flex justify-between items-center py-2 min-h-[2.5rem]"},It={class:"truncate"},Bt={class:"bg-white/10 rounded-full px-2 py-1 text-sm min-w-[3rem] text-center whitespace-nowrap"},Wt={key:0,class:"mt-4 space-y-4 text-sm fade-seq is-open"},Pt={key:0,class:"flex flex-wrap gap-2"},Vt={class:"rounded-lg bg-white/10"},Zt={class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},Et=["innerHTML"],Rt={key:0,class:"pt-2"},Jt={class:"flex flex-wrap gap-2"},qt={key:0,class:"rounded-lg bg-white/10"},Gt={class:"px-3 pb-3 text-white/90 leading-snug"},Xt={key:1,class:"rounded-lg bg-white/10"},Kt={class:"px-3 pb-3 text-white/90 leading-snug"},Qt={class:"list-decimal pl-5 space-y-2"},es={key:2,class:"rounded-lg bg-white/10"},ts={class:"px-3 pb-3 text-white/90 leading-snug"},ss={class:"list-decimal pl-5 space-y-3"},ns={key:0},is={class:"font-semibold mb-1"},rs={class:"opacity-90"},as={key:0,class:"opacity-80 mt-1 italic"},os={key:1},ls={class:"rounded-lg bg-white/10 border-l-4 border-pink-400"},cs={class:"px-3 pb-3 text-white/90 leading-snug"},us={class:"mt-2 flex justify-end"},ds={class:"space-y-2"},fs=["onClick"],hs={class:"opacity-80 inline-block",style:{fontSize:"130%"}},ms={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},ps=["innerHTML"],vs={key:0,class:"space-y-2"},ys={class:"flex justify-between text-xs opacity-80"},gs={class:"relative h-2 w-full bg-white/10 rounded overflow-hidden"},_s={class:"pt-2 text-xs opacity-80 flex flex-wrap items-center gap-4"},xs={class:"inline-flex items-center gap-2"},bs={class:"mt-4 flex gap-2"},ws={key:3,class:"mt-3 text-xs bg-black/20 rounded-lg p-2 font-mono whitespace-pre-wrap break-words"},$s={class:"mt-2 flex justify-end"},ks={key:0,class:"space-y-3"},Ms={class:"grid grid-cols-2 gap-2"},Ds=["onClick"],Ss={class:"flex justify-end gap-2 pt-2"},Ts=["disabled"],Cs={key:1,class:"space-y-3"},Hs={class:"grid grid-cols-2 gap-2"},Os={class:"flex justify-end gap-2 pt-2"},Ls=["disabled"],As=48,js=Ne({__name:"DreamCard",props:{dream:{},active:{type:Boolean}},emits:["toggle"],setup(R,{emit:Q}){be.extend(ht),be.locale("ru"),be.extend(pt),be.extend(yt);const l=R,U=Q,J=()=>{U("toggle"),window.triggerHaptic&&window.triggerHaptic("light")},F=rt(),_=at(),Y=re(!0),k=M(()=>{var e;return!!((e=l.dream)!=null&&e.is_deep_analysis)}),S=M({get:()=>{var e,t,i;return((e=l.dream)==null?void 0:e.user_feedback)??((i=(t=l.dream)==null?void 0:t.deep_source)==null?void 0:i.user_feedback)??0},set:e=>{l.dream&&(l.dream.user_feedback=e,l.dream.deep_source||(l.dream.deep_source={}),l.dream.deep_source.user_feedback=e)}}),D={like:!1,dislike:!1,delete:!1},N=async e=>{if(D.like||D.dislike)return;const t=e===1?S.value===1?0:1:S.value===2?0:2,i=S.value;S.value=t;try{window.triggerHaptic&&window.triggerHaptic("medium"),e===1?D.like=!0:D.dislike=!0,await ze.postAnalysisFeedback(l.dream.id,t),t===0?_.info("Оценка снята"):t===1?_.success("Добавлено: нравится"):t===2&&_.success("Добавлено: не нравится")}catch(a){S.value=i,console.error("Feedback error",a),_.error("Не удалось сохранить оценку")}finally{D.like=D.dislike=!1}},L=()=>N(1),j=()=>N(2),f=async()=>{var i;if(D.delete)return;const e=(i=window.Telegram)==null?void 0:i.WebApp;if(await new Promise(a=>{e!=null&&e.showPopup?e.showPopup({title:"Удалить запись?",message:"Действие необратимо",buttons:[{id:"yes",type:"destructive",text:"Удалить"},{id:"no",type:"cancel",text:"Отмена"}]},n=>a(n==="yes")):a(window.confirm("Удалить запись?"))}))try{D.delete=!0,window.triggerHaptic&&window.triggerHaptic("heavy"),await ze.deleteAnalysis(l.dream.id);const a=F.history.findIndex(n=>n.id===l.dream.id);a>-1&&F.history.splice(a,1),F.fetchProfile(),_.success("Запись удалена")}catch(a){console.error("Delete error",a),_.error("Не удалось удалить запись")}finally{D.delete=!1}},o=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]);function g(e){return e.replace(/\s+/g," ").trim().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function x(e){if(!e)return"";const t=String(e).split(/[.!?\n]/)[0],a=t.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(n=>n&&!o.has(n)&&n.length>3).slice(0,3);return a.length===0?t.slice(0,40):g(a.join(" "))}function d(e){if(!e)return"";let t=String(e).toLowerCase().replace(/["'«»]/g,"").trim();t=t.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),t=t.replace(/\s+/g," ").trim();const i=t.split(" ").filter(Boolean).slice(0,3);return i.length?i.join(" "):""}function T(e){if(!e)return"";const t=String(e).toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}const C=M(()=>{var w,$,A,V,q;const e=d(($=(w=l.dream)==null?void 0:w.deep_source)==null?void 0:$.title);if(e)return T(e);const t=(((V=(A=l.dream)==null?void 0:A.deep_source)==null?void 0:V.tags)||[]).filter(Boolean),i=ue=>{var de;let oe=String(ue||"").trim();return oe=((de=oe.split(/[\\/,(;:—–-]/)[0])==null?void 0:de.trim())||"",oe?oe.charAt(0).toUpperCase()+oe.slice(1).toLowerCase():""},a=t.map(i).filter(Boolean);if(a.length){const ue=a.slice(0,2).join(" и ");return T(ue||"Без названия")}const n=d(x((q=l.dream)==null?void 0:q.dream_text));return T(n||"Без названия")}),v=M(()=>{var i,a;const e=(a=(i=l.dream)==null?void 0:i.deep_source)==null?void 0:a.tags;if(!Array.isArray(e))return[];const t=n=>{var $;let w=String(n||"").trim();return w=(($=w.split(/[\\/,(;:—–-]/)[0])==null?void 0:$.trim())||"",w?w.charAt(0).toUpperCase()+w.slice(1).toLowerCase():""};return e.map(t).filter(Boolean).slice(0,5)});function y(e){return String(e||"").replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").replace(/\(\s*\d+\s*\)/g,"").replace(/\s\[\s*\d+\s*\]/g,"").replace(/[\u00B9\u00B2\u00B3\u2070-\u2079]/g,"")}re("context");const B=M(()=>{var e;return y(((e=l.dream)==null?void 0:e.analysis)||"")}),G=M(()=>{var e,t;return((t=(e=l.dream)==null?void 0:e.deep_source)==null?void 0:t.overallContext)||{}});M(()=>{const e=G.value;return!!(e!=null&&e.narrative||e!=null&&e.psychologicalFunction||e!=null&&e.emotionalJourney)}),M(()=>{var t,i;const e=(i=(t=l.dream)==null?void 0:t.deep_source)==null?void 0:i.recurringSymbols;return Array.isArray(e)?e:[]});const te=M(()=>{var t,i;const e=(i=(t=l.dream)==null?void 0:t.deep_source)==null?void 0:i.dynamics;return Array.isArray(e)&&e.length>0?e:[]});M(()=>te.value.length>0);const I=M(()=>{var t,i;const e=(i=(t=l.dream)==null?void 0:t.deep_source)==null?void 0:i.conclusions;return Array.isArray(e)&&e.length>0?e:[]});M(()=>I.value.length>0);const z=M(()=>{var $,A;const e=(A=($=l.dream)==null?void 0:$.deep_source)==null?void 0:A.recommendations;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="object")return e;if(Array.isArray(e)&&e.length>0)return e.map((V,q)=>({title:`Рекомендация ${q+1}`,description:String(V),rationale:""}));const t=r.value;if(t.length===0)return[];const i=[0,0,0,0];for(const V of t)for(let q=0;q<4;q++)i[q]+=V[q];const a=Math.max(1,t.length);for(let V=0;V<4;V++)i[V]=Math.round(i[V]/a);const n=[["Персонажи","Обрати внимание на отношения и роли; практикуй честную коммуникацию."],["Эмоции","Добавь ежедневную регуляцию эмоций (дыхание, дневник, прогулка)."],["Действия","Определи 1 маленький шаг на неделю и заверши его."],["Сцены","Проверь границы и режим: место/время, где тебе спокойнее."]],w=i.map((V,q)=>({i:q,v:V})).sort((V,q)=>q.v-V.v).map(V=>V.i);return[{title:n[w[0]][0],description:n[w[0]][1],rationale:""},{title:n[w[1]][0],description:n[w[1]][1],rationale:""}]});M(()=>z.value.length>0);function we(e,t){var i;try{let a=e;const n=Array.from(new Set((t||[]).filter(Boolean))).sort((w,$)=>$.length-w.length);for(const w of n){const $=(i=String(w).split(/[\\/,(;:—–-]/)[0])==null?void 0:i.trim();if(!$)continue;const A=new RegExp(`(\b${$.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\b)`,"gi");a=a.replace(A,'<mark class="bg-white/20 px-1 rounded">$1</mark>')}return a.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1")}catch{return e}}const He=M(()=>{var e,t;return we(B.value,((t=(e=l.dream)==null?void 0:e.deep_source)==null?void 0:t.tags)||[])});function b(e){try{return new Date(e).getTime()||0}catch{return 0}}const u=M(()=>(F.history||[]).filter(e=>{var t;return!e.is_deep_analysis&&((t=e==null?void 0:e.deep_source)==null?void 0:t.hvdc)&&(e==null?void 0:e.created_at)}).sort((e,t)=>b(e.created_at)>b(t.created_at)?-1:1)),r=M(()=>{var a;const e=b(((a=l.dream)==null?void 0:a.created_at)||""),t=u.value.filter(n=>!k.value||(e?b(n.created_at)<=e:!0)).slice(0,5).reverse(),i=["characters","emotions","actions","settings"];return t.map(n=>i.map(w=>{var $,A;return Number(((A=($=n.deep_source.hvdc)==null?void 0:$.distribution)==null?void 0:A[w])||0)}))}),p=M(()=>r.value.length),c=M(()=>p.value>=2),H=M(()=>Math.max(60,(p.value-1)*28+8));function O(e){const t=e.length,i=H.value,a=As,n=t>1?(i-8)/(t-1):0,w=[];for(let A=0;A<t;A++){const V=A*n,q=a-Math.round(e[A]/100*a);w.push({x:V,y:q})}return{str:w.map(A=>`${A.x},${A.y}`).join(" "),pts:w}}M(()=>{const e=[{key:"characters",label:"Персонажи",idx:0,opacity:.95},{key:"emotions",label:"Эмоции",idx:1,opacity:.75},{key:"actions",label:"Действия",idx:2,opacity:.55},{key:"settings",label:"Сцены",idx:3,opacity:.35}],t=[],i=r.value;for(const a of e){const n=i.map(A=>A[a.idx]),{str:w,pts:$}=O(n);t.push({key:a.key,label:a.label,values:n,points:w,pointList:$,opacity:a.opacity})}return t});const W=M(()=>{if(!c.value)return[];const e=[{key:"characters",label:"Персонажи",idx:0},{key:"emotions",label:"Эмоции",idx:1},{key:"actions",label:"Действия",idx:2},{key:"settings",label:"Сцены",idx:3}],t=r.value;return e.map(i=>({metric:i.label,values:t.map(a=>a[i.idx]),interpretation:`Динамика "${i.label}" по последним ${p.value} снам`}))});function Z(e){const i=e.split(/\n+/).map(a=>a.trim()).filter(Boolean).filter(a=>/^\d+\./.test(a)).map(a=>a.replace(/^\d+\.\s*/,"")).slice(0,3);return i.length?i:e.split(/[.!?]\s+/).map(a=>a.trim()).filter(Boolean).slice(0,3)}const X=M(()=>Z(B.value));function ee(e){try{const t=String(e||"").toLowerCase(),i=xe=>xe.reduce((Ye,st)=>Ye+(t.includes(st)?1:0),0),a=["страх","ужас","паник","тревог","стыд","гнев","плак","слез","кошмар","тоска","грусть"],n=["экзам","выступл","собесед","защит","проект","подготов","завтра","ожидан","волнен","поездк","путешеств","нов","интервью"],w=["вчера","сегодня","работ","школ","универ","дом","улиц","друг","родител","коллег","город"],$=i(a),A=i(n),V=i(w);let q=$>0?Math.min(1,$/3):0,ue=A>0?Math.min(1,A/3):0,oe=V>0?Math.min(1,.5+V/5):0;q===0&&ue===0&&oe===0&&(oe=.6,q=.2,ue=.2);const de={schema:"dream_type_v1",scores:{memory:+oe.toFixed(2),emotion:+q.toFixed(2),anticipation:+ue.toFixed(2)}},E=[["memory",de.scores.memory],["emotion",de.scores.emotion],["anticipation",de.scores.anticipation]];E.sort((xe,Ye)=>Ye[1]-xe[1]);const pe=+Math.max(0,E[0][1]-E[1][1]).toFixed(2);return{...de,dominant:E[0][0],confidence:pe}}catch{return null}}const ie=M(()=>{var e,t,i;return((t=(e=l.dream)==null?void 0:e.deep_source)==null?void 0:t.dream_type)||ee((i=l.dream)==null?void 0:i.dream_text)||null});function ye(){const e=ie.value;if(!e||!e.dominant)return['<div class="space-y-2">','<div class="font-semibold">🛠 Небольшая работа со сном</div>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Заметь:</span> Какие 2–3 образа из сна самые сильные? Запиши их коротко.</li>','<li><span class="font-semibold">Шаг:</span> Выбери один маленький шаг в реальности, который поддержит тебя по теме сна.</li>',"</ol>","</div>"].join("");const t=String(e.dominant).toLowerCase();return t==="memory"?['<div class="space-y-2">','<div class="font-semibold">🌙 Сон-Память</div>','<p class="opacity-90">Переработка недавнего опыта, соединение нового с прошлым.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Отрази:</span> Вспомни, что происходило последние 1–2 дня. Какие события могли попасть в сон?</li>','<li><span class="font-semibold">Соедини:</span> Отметь, какие элементы сна перекликаются с реальностью — это завершает «архивацию» опыта.</li>',"</ol>","</div>"].join(""):t==="emotion"?['<div class="space-y-2">','<div class="font-semibold">⚡️ Сон-Эмоция</div>','<p class="opacity-90">Проживание и нейтрализация сильных чувств.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Почувствуй:</span> Определи, какая эмоция была самой сильной во сне. Где она чувствуется в теле сейчас?</li>','<li><span class="font-semibold">Услышь:</span> Представь, что главный персонаж сна говорит тебе что-то. Что он хочет, чтобы ты понял?</li>',"</ol>","</div>"].join(""):['<div class="space-y-2">','<div class="font-semibold">🔮 Сон-Предвосхищение</div>','<p class="opacity-90">Тренировка будущих ситуаций и реакций.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Представь:</span> Как бы ты хотел повести себя, если бы это произошло в реальности?</li>','<li><span class="font-semibold">Расшифруй:</span> Какой символ кажется ключевым? Что он может говорить о твоих страхах или намерениях?</li>',"</ol>","</div>"].join("")}const he=M(()=>{var ue,oe,de;const e=y(((ue=l.dream)==null?void 0:ue.analysis)||"");if(!e)return[];const t={arch:{key:"arch",title:"Архетипическая история",text:""},func:{key:"func",title:"Возможная функция сна",text:""},freud:{key:"freud",title:"По Фрейду",text:""},jung:{key:"jung",title:"По Юнгу",text:""}},i=[],a=/\*\*([^*]+)\*\*/g;let n;for(;n=a.exec(e);)i.push({title:n[1].trim(),start:n.index,end:n.index+n[0].length});const w=((oe=i[0])==null?void 0:oe.start)??e.length;t.arch.text=e.slice(0,w).trim();for(let E=0;E<i.length;E++){const pe=i[E].title.toLowerCase(),xe=e.slice(i[E].end,((de=i[E+1])==null?void 0:de.start)??e.length).trim();pe.includes("возможная функция")?t.func.text=xe:pe.includes("по фрейду")?t.freud.text=xe:pe.includes("по юнгу")&&(t.jung.text=xe)}const $=E=>E.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1"),A=Object.values(t).map(E=>({...E,html:$(E.text||"")}));A.some(E=>E.key==="func")||A.push({key:"func",title:"Возможная функция сна",text:"",html:""});const V=A.findIndex(E=>E.key==="arch");V!==-1&&A.splice(V+1,0,{key:"hvdc",title:"Контент анализ",text:"",html:""});const q=ye();if(q){const E=A.findIndex(pe=>pe.key==="func");if(E!==-1){const pe=['<div class="mt-3 pt-2 border-t border-white/10 space-y-1">','<div class="font-semibold">Функциональное упражнение</div>',q,"</div>"].join("");A[E].html=(A[E].html||"")+pe}}return A}),le=ot({arch:!0,hvdc:!1,func:!1,freud:!1,jung:!1});function me(e){le[e]=!le[e]}const se=M(()=>{try{return new URLSearchParams(window.location.search).get("debug")==="1"||localStorage.getItem("da_debug")==="1"}catch{return!1}});function ce(){var e,t,i,a,n;try{const w=JSON.stringify(ge.value,null,2);(e=navigator.clipboard)==null||e.writeText(w),(t=_==null?void 0:_.success)==null||t.call(_,"Скопировано")}catch{try{(n=(a=(i=window.Telegram)==null?void 0:i.WebApp)==null?void 0:a.showPopup)==null||n.call(a,{title:"Debug",message:"Скопируйте из блока ниже вручную",buttons:[{id:"ok",type:"default",text:"OK"}]})}catch{}}}function _e(e){var i;let t=String(e||"").trim();return t=((i=t.split(/[\\/,(;:—–-]/)[0])==null?void 0:i.trim())||"",t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}const ge=M(()=>{var i,a,n,w;if(!se.value)return null;const e=l.dream||{},t=Array.isArray((i=e==null?void 0:e.deep_source)==null?void 0:i.tags)?e.deep_source.tags:[];return{id:e.id,created_at:e.created_at,is_deep_analysis:!!e.is_deep_analysis,title_raw:((a=e==null?void 0:e.deep_source)==null?void 0:a.title)||null,tags_raw:t,tags_norm:t.map(_e),dream_type:((n=e==null?void 0:e.deep_source)==null?void 0:n.dream_type)||null,hvdc_present:!!((w=e==null?void 0:e.deep_source)!=null&&w.hvdc)}}),Ae=re(!1),Ie=re(1),Ge=["0-20","20-30","30-40","40-50","50+"],Oe=re(""),$e=re("");function je(){Ae.value=!1}async function Xe(){try{await ze.setDemographics(Oe.value,$e.value);try{await F.fetchProfile()}catch{}_.success("Готово! Дальнейшие анализы будут учитывать эти данные"),Ae.value=!1}catch{_.error("Не удалось сохранить")}}M(()=>{const e=F.profile||{};return!!(e.age_range&&e.gender)});const Me=M(()=>{var e,t;return((t=(e=l.dream)==null?void 0:e.deep_source)==null?void 0:t.hvdc)||null}),Ke=M(()=>{var n,w,$;const e=[{key:"characters",label:"Персонажи"},{key:"emotions",label:"Эмоции"},{key:"actions",label:"Действия"},{key:"settings",label:"Сцены"}],t=((n=Me.value)==null?void 0:n.distribution)||{},i=((w=Me.value)==null?void 0:w.norm)||null,a=(($=Me.value)==null?void 0:$.comparison)||null;return e.map(A=>({key:A.key,label:A.label,value:Number(t[A.key]??0),norm:i?Number(i[A.key]??0):null,delta:a?Number(a[A.key]??0):null}))}),Qe=M(()=>{var $;const e=(($=Me.value)==null?void 0:$.norm_group)||null;if(!e)return"общая статистика";const t=String(e.gender||"").toLowerCase(),i=t==="male"?"муж.":t==="female"?"жен.":"",a=e.age_range||"",n=a?`${a} лет`:"",w=[i,n].filter(Boolean).join(" ");return w?`общая статистика* для ${w}`:"общая статистика"}),et=M(()=>{if(!l.dream.created_at)return"";try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone||be.tz.guess(),t=be.utc(l.dream.created_at).tz(e).startOf("day"),a=be().tz(e).startOf("day").diff(t,"day"),n=Math.floor(a/7),w=Math.floor(a/30),$=Math.floor(a/365);return a===0?"сегодня":a===1?"вчера":a<7?`${a} д`:a<30?`${n} н`:a<365?`${w} м`:`${$} г`}catch{return l.dream.created_at}}),tt=M(()=>{var e;return(e=l.dream)!=null&&e.is_deep_analysis?"from-[#9C41FF] to-[#C03AFF]":"from-[#4A58FF] to-[#5664FF]"});return(e,t)=>{var i,a;return h(),m("article",{class:ve(["rounded-xl bg-gradient-to-br text-white px-8 md:px-16 transition-all overflow-hidden cursor-pointer py-6",[R.active?"":"min-h-[4.5rem]",tt.value]]),onClick:J},[s("div",Ut,[s("h3",It,P(C.value),1),s("span",Bt,P(et.value),1)]),R.active?(h(),m("div",Wt,[v.value.length&&!k.value?(h(),m("div",Pt,[(h(!0),m(ne,null,ae(v.value,n=>(h(),m("span",{key:n,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},P(n),1))),128))])):K("",!0),k.value?(h(),m(ne,{key:1},[s("div",Vt,[t[8]||(t[8]=s("div",{class:"px-3 py-2 font-semibold"},"Общий контекст серии",-1)),s("div",Zt,[s("div",{innerHTML:He.value},null,8,Et),v.value.length?(h(),m("div",Rt,[t[7]||(t[7]=s("div",{class:"text-xs opacity-80 mb-1"},"Повторяющиеся символы",-1)),s("div",Jt,[(h(!0),m(ne,null,ae(v.value,n=>(h(),m("span",{key:"deep-"+n,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},P(n),1))),128))])])):K("",!0)])]),c.value?(h(),m("div",qt,[t[9]||(t[9]=s("div",{class:"px-3 py-2 font-semibold"},"Динамика",-1)),s("div",Gt,[Ve(Nt,{dynamics:W.value,userAge:(i=Be(F).user)==null?void 0:i.age_range,userGender:(a=Be(F).user)==null?void 0:a.gender},null,8,["dynamics","userAge","userGender"])])])):K("",!0),X.value.length?(h(),m("div",Xt,[t[10]||(t[10]=s("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),s("div",Kt,[s("ol",Qt,[(h(!0),m(ne,null,ae(X.value,(n,w)=>(h(),m("li",{key:"in"+w,class:"text-xs leading-relaxed"},P(n),1))),128))])])])):K("",!0),z.value.length?(h(),m("div",es,[t[11]||(t[11]=s("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),s("div",ts,[s("ol",ss,[(h(!0),m(ne,null,ae(z.value,(n,w)=>(h(),m("li",{key:"rec"+w,class:"text-xs leading-relaxed"},[typeof n=="object"&&n.title?(h(),m("div",ns,[s("div",is,P(n.title),1),s("div",rs,P(n.description),1),n.rationale?(h(),m("div",as,P(n.rationale),1)):K("",!0)])):(h(),m("div",os,P(typeof n=="string"?n:n.title),1))]))),128))])])])):K("",!0)],64)):(h(),m(ne,{key:2},[s("div",ls,[t[12]||(t[12]=s("div",{class:"px-3 py-2 font-semibold flex items-center justify-between"},[s("span",null,"Сон"),s("span",{class:"opacity-80 text-pink-400",style:{"font-size":"130%","font-family":"ui-rounded, -apple-system, system-ui, 'SF Pro Rounded', 'Segoe UI', Roboto, Arial"}},"“")],-1)),s("div",cs,[s("p",{class:ve(["opacity-90",Y.value?"clamp-5":""])},P(R.dream.dream_text),3),s("div",us,[s("button",{class:"text-sm font-semibold opacity-80 hover:opacity-100",onClick:t[0]||(t[0]=fe(n=>Y.value=!Y.value,["stop"]))},P(Y.value?"+":"−"),1)])])]),s("div",ds,[(h(!0),m(ne,null,ae(he.value,(n,w)=>(h(),m("div",{key:n.key,class:"rounded-lg bg-white/10"},[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:fe($=>me(n.key),["stop"])},[s("span",null,P(n.title),1),s("span",hs,P(le[n.key]?"−":"+"),1)],8,fs),le[n.key]?(h(),m("div",ms,[n.key!=="hvdc"?(h(),m("div",{key:0,innerHTML:n.html},null,8,ps)):(h(),m(ne,{key:1},[Me.value?(h(),m("div",vs,[(h(!0),m(ne,null,ae(Ke.value,$=>(h(),m("div",{key:$.key},[s("div",ys,[s("span",null,P($.label),1),s("span",null,[De(P($.value)+"% ",1),$.norm!==null?(h(),m(ne,{key:0},[De(" / "+P($.norm)+"%",1)],64)):K("",!0),$.delta!==null?(h(),m("span",{key:1,class:ve($.delta>0?"text-green-300":$.delta<0?"text-red-300":"text-white/70")}," ("+P($.delta>0?"+"+$.delta:$.delta)+"pp) ",3)):K("",!0)])]),s("div",gs,[$.norm!==null?(h(),m("div",{key:0,class:"absolute inset-y-0 left-0 bg-white/20",style:We({width:$.norm+"%"})},null,4)):K("",!0),s("div",{class:"relative h-full bg-white/70",style:We({width:$.value+"%"})},null,4)])]))),128)),s("div",_s,[t[14]||(t[14]=s("span",{class:"inline-flex items-center gap-2"},[s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/70 shrink-0"}),De(" ваш сон")],-1)),s("span",xs,[t[13]||(t[13]=s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/20 shrink-0"},null,-1)),De(" "+P(Qe.value),1)])]),t[15]||(t[15]=s("div",{class:"text-xs opacity-70 flex items-start gap-2"},[s("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-white/20 text-white text-[10px]"},"i"),s("span",null,"Контент‑анализ по схеме HVdC; сравнение с демографическими нормами (DreamBank, SDDB).")],-1))])):K("",!0)],64))])):K("",!0)]))),128))])],64)),s("div",bs,[s("button",{class:ve(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",S.value===1?"bg-green-500/30 text-white ring-2 ring-green-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:fe(L,["stop"])}," 👍 ",2),s("button",{class:ve(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",S.value===2?"bg-red-500/30 text-white ring-2 ring-red-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:fe(j,["stop"])}," 👎 ",2),s("button",{class:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-white rounded-xl py-2 text-sm font-medium text-center transition-colors",onClick:fe(f,["stop"])}," 🗑️ ")]),se.value&&ge.value?(h(),m("div",ws,[t[16]||(t[16]=s("div",{class:"mb-2 opacity-80"},"Debug payload",-1)),De(" "+P(JSON.stringify(ge.value,null,2))+" ",1),s("div",$s,[s("button",{class:"px-3 py-1 rounded bg-white/10 hover:bg-white/20",onClick:fe(ce,["stop"])},"Скопировать")])])):K("",!0),(h(),Fe(lt,{to:"body"},[Ae.value?(h(),m("div",{key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70",onClick:fe(je,["self"]),onWheel:t[5]||(t[5]=fe(()=>{},["prevent"])),onTouchmove:t[6]||(t[6]=fe(()=>{},["prevent"]))},[s("div",{class:"w-[92vw] max-w-[440px] rounded-2xl bg-[var(--tg-theme-secondary-bg-color,#0c110c)] text-white p-4 shadow-2xl border border-white/10",onClick:t[4]||(t[4]=fe(()=>{},["stop"]))},[t[19]||(t[19]=s("h3",{class:"text-lg font-semibold mb-2"},"Уточнить данные",-1)),Ie.value===1?(h(),m("div",ks,[t[17]||(t[17]=s("p",{class:"opacity-90"},"Ваш возрастной диапазон:",-1)),s("div",Ms,[(h(),m(ne,null,ae(Ge,n=>s("button",{key:n,class:ve(["px-4 py-3 rounded-xl text-sm",Oe.value===n?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:w=>Oe.value=n},P(n),11,Ds)),64))]),s("div",Ss,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:je},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Oe.value,onClick:t[1]||(t[1]=n=>Ie.value=2)},"Далее",8,Ts)])])):(h(),m("div",Cs,[t[18]||(t[18]=s("p",{class:"opacity-90"},"Ваш пол:",-1)),s("div",Hs,[s("button",{class:ve(["px-4 py-3 rounded-xl text-sm",$e.value==="male"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[2]||(t[2]=n=>$e.value="male")},"Мужской",2),s("button",{class:ve(["px-4 py-3 rounded-xl text-sm",$e.value==="female"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[3]||(t[3]=n=>$e.value="female")},"Женский",2)]),s("div",Os,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:je},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!$e.value,onClick:Xe},"Сохранить",8,Ls)])]))])],32)):K("",!0)]))])):K("",!0)],2)}}}),Pe=Ue(js,[["__scopeId","data-v-eb1de4c7"]]),Ys={class:"flex items-center justify-between mb-4"},zs={class:"inline-flex items-center gap-2 rounded-full px-3 py-1 themed-badge"},Fs={key:0,class:"flex flex-col gap-4 pb-[5vh]"},Ns={key:1,class:"text-center text-red-400 py-8"},Us={key:2},Is={key:0,class:"text-center text-white/60 py-8"},Bs={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Ws={key:3},Ps={key:0,class:"text-center text-white/60 py-8"},Vs={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Zs=Ne({__name:"AnalysisHistoryList",props:["userStore"],setup(R){const Q=R,l=re(null),U=re(5),J=re(5),F=re("history"),_=M({get:()=>F.value,set:g=>o(g)}),Y=M(()=>{var g;return(g=Q.userStore)!=null&&g.history?Q.userStore.history.filter(x=>!x.is_deep_analysis):[]}),k=M(()=>{var g;return(g=Q.userStore)!=null&&g.history?Q.userStore.history.filter(x=>x.is_deep_analysis):[]}),S=M(()=>Y.value.slice(0,U.value)),D=M(()=>k.value.slice(0,J.value)),N=M(()=>Y.value.length>U.value),L=M(()=>k.value.length>J.value),j=()=>{window.triggerHaptic&&window.triggerHaptic("light"),U.value+=5},f=()=>{window.triggerHaptic&&window.triggerHaptic("light"),J.value+=5},o=g=>{window.triggerHaptic&&window.triggerHaptic("light"),F.value=g,l.value=null};return(g,x)=>{var d,T,C,v;return h(),m("div",null,[s("div",Ys,[x[2]||(x[2]=s("h2",{class:"text-3xl font-bold"},"История",-1)),s("div",zs,[ct(s("select",{"aria-label":"Режим истории","onUpdate:modelValue":x[0]||(x[0]=y=>_.value=y),class:"bg-transparent focus:outline-none themed-select"},[...x[1]||(x[1]=[s("option",{value:"history"},"Дневник снов",-1),s("option",{value:"deep"},"Глубокий анализ",-1)])],512),[[ut,_.value]])])]),(d=R.userStore)!=null&&d.isLoadingHistory?(h(),m("div",Fs,[(h(),m(ne,null,ae(3,y=>s("div",{key:y,class:"rounded-xl bg-white/10 px-8 md:px-16 py-6"},[...x[3]||(x[3]=[dt('<div class="flex justify-between items-center py-2 min-h-[2.5rem]" data-v-14de94bb><div class="shimmer h-4 w-32 rounded" data-v-14de94bb></div><div class="shimmer h-4 w-12 rounded" data-v-14de94bb></div></div><div class="mt-4 space-y-2" data-v-14de94bb><div class="shimmer h-3 w-full rounded" data-v-14de94bb></div><div class="shimmer h-3 w-5/6 rounded" data-v-14de94bb></div><div class="shimmer h-3 w-2/3 rounded" data-v-14de94bb></div></div><div class="mt-4 grid grid-cols-3 gap-2" data-v-14de94bb><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div></div>',3)])])),64))])):(T=R.userStore)!=null&&T.errorHistory?(h(),m("div",Ns," Ошибка загрузки: "+P(R.userStore.errorHistory),1)):F.value==="history"?(h(),m("div",Us,[(C=Y.value)!=null&&C.length?(h(),m("div",Bs,[(h(!0),m(ne,null,ae(S.value,y=>(h(),Fe(Pe,{key:y.id,dream:y,active:l.value===y.id,onToggle:B=>l.value=l.value===y.id?null:y.id},null,8,["dream","active","onToggle"]))),128)),N.value?(h(),m("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:j}," Загрузить ещё ")):K("",!0)])):(h(),m("div",Is," У вас пока нет сохраненных анализов "))])):F.value==="deep"?(h(),m("div",Ws,[(v=k.value)!=null&&v.length?(h(),m("div",Vs,[(h(!0),m(ne,null,ae(D.value,y=>(h(),Fe(Pe,{key:y.id,dream:y,active:l.value===y.id,onToggle:B=>l.value=l.value===y.id?null:y.id},null,8,["dream","active","onToggle"]))),128)),L.value?(h(),m("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:f}," Загрузить ещё ")):K("",!0)])):(h(),m("div",Ps," Пока нет глубоких анализов "))])):K("",!0)])}}}),qs=Ue(Zs,[["__scopeId","data-v-14de94bb"]]);export{qs as default};

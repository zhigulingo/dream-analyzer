# Dream Analyzer - –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ

### –î–∞—Ç–∞: $(date "+%Y-%m-%d %H:%M:%S")

## üéØ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. TMA (Telegram Mini App) - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞", "–æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É–∂–µ –±—ã–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**URL:** https://tourmaline-eclair-9d40ea.netlify.app

### 2. Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–ü—Ä–æ–±–ª–µ–º–∞:** "Load failed" –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ
**–ü—Ä–∏—á–∏–Ω—ã:** 
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª `web/src/stores/user.js`
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π CORS origin –≤ bot —Ñ—É–Ω–∫—Ü–∏—è—Ö
**–î–µ–π—Å—Ç–≤–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞–Ω `web/src/stores/user.js` store
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω ALLOWED_WEB_ORIGIN —Å `https://dream-analyzer-web.netlify.app` –Ω–∞ `https://bot.dreamstalk.ru`
**URL:** https://bot.dreamstalk.ru

### 3. Bot API (Backend) - ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
**–ü—Ä–æ–±–ª–µ–º–∞:** CORS –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –≤–µ–±-—Å–∞–π—Ç–∞
**–î–µ–π—Å—Ç–≤–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è ALLOWED_WEB_ORIGIN
**URL:** https://sparkling-cupcake-940504.netlify.app

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –°–∞–π—Ç—ã Netlify:
1. **sparkling-cupcake-940504** - Bot Functions (API —Å–µ—Ä–≤–µ—Ä)
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏: user-profile, analyses-history, web-login, etc.
   - Environment variables: BOT_TOKEN, GEMINI_API_KEY, JWT_SECRET, SUPABASE_*
   - CORS: –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è TMA –∏ Web

2. **tourmaline-eclair-9d40ea** - TMA (Telegram Mini App)
   - VITE_API_BASE_URL ‚Üí sparkling-cupcake-940504
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: Telegram WebApp InitData

3. **dream-analyzer-web** (https://bot.dreamstalk.ru) - Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - VITE_API_BASE_URL ‚Üí sparkling-cupcake-940504
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: JWT —Ç–æ–∫–µ–Ω—ã
   - User Store: —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## üìä –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### Bot Functions Site
```
‚úÖ Deploy: 6894b35b919ce968d99288de
URL: https://sparkling-cupcake-940504.netlify.app
Functions: 17 —Ñ—É–Ω–∫—Ü–∏–π —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã
CORS: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–ª—è –æ–±–æ–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
```

### TMA Site  
```
‚úÖ Deploy: 6894b3a4b404bf39feb8c887
URL: https://tourmaline-eclair-9d40ea.netlify.app
Build: Vite —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω (165 –º–æ–¥—É–ª–µ–π)
API: –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π bot site
```

### Web Site
```
‚úÖ Deploy: 6894b3cb8e3ec57405a3deed
URL: https://bot.dreamstalk.ru
Build: Vite —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω (44 –º–æ–¥—É–ª—è)
Store: user.js —Å–æ–∑–¥–∞–Ω –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –°–æ–∑–¥–∞–Ω—ã —Ñ–∞–π–ª—ã:
- ‚úÖ `web/src/stores/user.js` - Pinia store –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ `ARCHITECTURE.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚úÖ `DIAGNOSTICS.md` - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- ‚úÖ `FIX_PLAN.md` - –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- ‚úÖ `ALLOWED_WEB_ORIGIN` = `https://bot.dreamstalk.ru` (–±—ã–ª–æ: `https://dream-analyzer-web.netlify.app`)

### Git commit:
```
commit: 8fd2fd1
message: "fix: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å TMA –∏ Web –≤–µ—Ä—Å–∏—è–º–∏"
files: 4 files changed, 897 insertions(+)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

#### TMA (https://tourmaline-eclair-9d40ea.netlify.app)
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Å–Ω–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ "–ø—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞"
- [ ] Debug –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API URL

#### Web (https://bot.dreamstalk.ru)  
- [ ] –§–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- [ ] –ò—Å—Ç–æ—Ä–∏—è —Å–Ω–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ "Load failed"

#### API Functions (https://sparkling-cupcake-940504.netlify.app)
- [ ] CORS headers —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –æ–±–æ–∏—Ö origin
- [ ] –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–≤–µ—á–∞—é—Ç –±–µ–∑ 403/500 –æ—à–∏–±–æ–∫

## üì± –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### TMA –≤–µ—Ä—Å–∏—è:
1. –û—Ç–∫—Ä–æ–π—Ç–µ TMA –≤ Telegram
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ—Ñ–∏–ª—è –∏ –∏—Å—Ç–æ—Ä–∏–∏
3. –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö - –≤–∫–ª—é—á–∏—Ç–µ Debug Info –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### Web –≤–µ—Ä—Å–∏—è:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://bot.dreamstalk.ru  
2. –í–≤–µ–¥–∏—Ç–µ Telegram ID –∏ –ø–∞—Ä–æ–ª—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É

## üîç –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. **Browser Console** - –æ—à–∏–±–∫–∏ JavaScript/Network
2. **Network Tab** - —Å—Ç–∞—Ç—É—Å—ã HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (200/403/500)
3. **Netlify Function Logs** - —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏
4. **Environment Variables** - –≤—Å–µ –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

### –ö–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∞–π—Ç–æ–≤
netlify sites:list

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
netlify env:list --context production

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Ñ—É–Ω–∫—Ü–∏–π
curl -X POST https://sparkling-cupcake-940504.netlify.app/.netlify/functions/user-profile
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´ –ò –†–ê–ó–í–ï–†–ù–£–¢–´  
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~90 –º–∏–Ω—É—Ç  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
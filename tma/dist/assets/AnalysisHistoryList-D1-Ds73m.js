import{d as Ee,r as oe,c as x,a as r,o as n,b as s,s as Be,M as ut,w as dt,e as N,t as S,F as K,A as ie,n as ye,m as ft,u as pt,N as ht,k as We,C as le,l as Se,q as je,f as Re,D as mt,z as Ie,O as vt,P as yt,j as gt}from"./main-DbR3RC8E.js";import{g as Ye,c as Oe}from"./_commonjsHelpers-Cpj98o6Y.js";import{_ as Pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";var Je={exports:{}};(function(G,Q){(function(c,W){G.exports=W()})(Oe,function(){var c=1e3,W=6e4,q=36e5,z="millisecond",v="second",U="minute",k="hour",O="day",H="week",B="month",Y="quarter",F="year",h="date",l="Invalid Date",_=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,$=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(M){var f=["th","st","nd","rd"],u=M%100;return"["+M+(f[(u-20)%10]||f[u]||f[0])+"]"}},D=function(M,f,u){var m=String(M);return!m||m.length>=f?M:""+Array(f+1-m.length).join(u)+M},A={s:D,z:function(M){var f=-M.utcOffset(),u=Math.abs(f),m=Math.floor(u/60),d=u%60;return(f<=0?"+":"-")+D(m,2,"0")+":"+D(d,2,"0")},m:function M(f,u){if(f.date()<u.date())return-M(u,f);var m=12*(u.year()-f.year())+(u.month()-f.month()),d=f.clone().add(m,B),L=u-d<0,C=f.clone().add(m+(L?-1:1),B);return+(-(m+(u-d)/(L?d-C:C-d))||0)},a:function(M){return M<0?Math.ceil(M)||0:Math.floor(M)},p:function(M){return{M:B,y:F,w:H,d:O,D:h,h:k,m:U,s:v,ms:z,Q:Y}[M]||String(M||"").toLowerCase().replace(/s$/,"")},u:function(M){return M===void 0}},y="en",g={};g[y]=p;var Z="$isDayjsObject",ee=function(M){return M instanceof ge||!(!M||!M[Z])},se=function M(f,u,m){var d;if(!f)return y;if(typeof f=="string"){var L=f.toLowerCase();g[L]&&(d=L),u&&(g[L]=u,d=L);var C=f.split("-");if(!d&&C.length>1)return M(C[0])}else{var P=f.name;g[P]=f,d=P}return!m&&d&&(y=d),d||!m&&y},E=function(M,f){if(ee(M))return M.clone();var u=typeof f=="object"?f:{};return u.date=M,u.args=arguments,new ge(u)},I=A;I.l=se,I.i=ee,I.w=function(M,f){return E(M,{locale:f.$L,utc:f.$u,x:f.$x,$offset:f.$offset})};var ge=function(){function M(u){this.$L=se(u.locale,null,!0),this.parse(u),this.$x=this.$x||u.x||{},this[Z]=!0}var f=M.prototype;return f.parse=function(u){this.$d=function(m){var d=m.date,L=m.utc;if(d===null)return new Date(NaN);if(I.u(d))return new Date;if(d instanceof Date)return new Date(d);if(typeof d=="string"&&!/Z$/i.test(d)){var C=d.match(_);if(C){var P=C[2]-1||0,V=(C[7]||"0").substring(0,3);return L?new Date(Date.UTC(C[1],P,C[3]||1,C[4]||0,C[5]||0,C[6]||0,V)):new Date(C[1],P,C[3]||1,C[4]||0,C[5]||0,C[6]||0,V)}}return new Date(d)}(u),this.init()},f.init=function(){var u=this.$d;this.$y=u.getFullYear(),this.$M=u.getMonth(),this.$D=u.getDate(),this.$W=u.getDay(),this.$H=u.getHours(),this.$m=u.getMinutes(),this.$s=u.getSeconds(),this.$ms=u.getMilliseconds()},f.$utils=function(){return I},f.isValid=function(){return this.$d.toString()!==l},f.isSame=function(u,m){var d=E(u);return this.startOf(m)<=d&&d<=this.endOf(m)},f.isAfter=function(u,m){return E(u)<this.startOf(m)},f.isBefore=function(u,m){return this.endOf(m)<E(u)},f.$g=function(u,m,d){return I.u(u)?this[m]:this.set(d,u)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(u,m){var d=this,L=!!I.u(m)||m,C=I.p(u),P=function(ce,ne){var de=I.w(d.$u?Date.UTC(d.$y,ne,ce):new Date(d.$y,ne,ce),d);return L?de:de.endOf(O)},V=function(ce,ne){return I.w(d.toDate()[ce].apply(d.toDate("s"),(L?[0,0,0,0]:[23,59,59,999]).slice(ne)),d)},J=this.$W,te=this.$M,ae=this.$D,xe="set"+(this.$u?"UTC":"");switch(C){case F:return L?P(1,0):P(31,11);case B:return L?P(1,te):P(0,te+1);case H:var me=this.$locale().weekStart||0,_e=(J<me?J+7:J)-me;return P(L?ae-_e:ae+(6-_e),te);case O:case h:return V(xe+"Hours",0);case k:return V(xe+"Minutes",1);case U:return V(xe+"Seconds",2);case v:return V(xe+"Milliseconds",3);default:return this.clone()}},f.endOf=function(u){return this.startOf(u,!1)},f.$set=function(u,m){var d,L=I.p(u),C="set"+(this.$u?"UTC":""),P=(d={},d[O]=C+"Date",d[h]=C+"Date",d[B]=C+"Month",d[F]=C+"FullYear",d[k]=C+"Hours",d[U]=C+"Minutes",d[v]=C+"Seconds",d[z]=C+"Milliseconds",d)[L],V=L===O?this.$D+(m-this.$W):m;if(L===B||L===F){var J=this.clone().set(h,1);J.$d[P](V),J.init(),this.$d=J.set(h,Math.min(this.$D,J.daysInMonth())).$d}else P&&this.$d[P](V);return this.init(),this},f.set=function(u,m){return this.clone().$set(u,m)},f.get=function(u){return this[I.p(u)]()},f.add=function(u,m){var d,L=this;u=Number(u);var C=I.p(m),P=function(te){var ae=E(L);return I.w(ae.date(ae.date()+Math.round(te*u)),L)};if(C===B)return this.set(B,this.$M+u);if(C===F)return this.set(F,this.$y+u);if(C===O)return P(1);if(C===H)return P(7);var V=(d={},d[U]=W,d[k]=q,d[v]=c,d)[C]||1,J=this.$d.getTime()+u*V;return I.w(J,this)},f.subtract=function(u,m){return this.add(-1*u,m)},f.format=function(u){var m=this,d=this.$locale();if(!this.isValid())return d.invalidDate||l;var L=u||"YYYY-MM-DDTHH:mm:ssZ",C=I.z(this),P=this.$H,V=this.$m,J=this.$M,te=d.weekdays,ae=d.months,xe=d.meridiem,me=function(ne,de,be,ke){return ne&&(ne[de]||ne(m,L))||be[de].slice(0,ke)},_e=function(ne){return I.s(P%12||12,ne,"0")},ce=xe||function(ne,de,be){var ke=ne<12?"AM":"PM";return be?ke.toLowerCase():ke};return L.replace($,function(ne,de){return de||function(be){switch(be){case"YY":return String(m.$y).slice(-2);case"YYYY":return I.s(m.$y,4,"0");case"M":return J+1;case"MM":return I.s(J+1,2,"0");case"MMM":return me(d.monthsShort,J,ae,3);case"MMMM":return me(ae,J);case"D":return m.$D;case"DD":return I.s(m.$D,2,"0");case"d":return String(m.$W);case"dd":return me(d.weekdaysMin,m.$W,te,2);case"ddd":return me(d.weekdaysShort,m.$W,te,3);case"dddd":return te[m.$W];case"H":return String(P);case"HH":return I.s(P,2,"0");case"h":return _e(1);case"hh":return _e(2);case"a":return ce(P,V,!0);case"A":return ce(P,V,!1);case"m":return String(V);case"mm":return I.s(V,2,"0");case"s":return String(m.$s);case"ss":return I.s(m.$s,2,"0");case"SSS":return I.s(m.$ms,3,"0");case"Z":return C}return null}(ne)||C.replace(":","")})},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(u,m,d){var L,C=this,P=I.p(m),V=E(u),J=(V.utcOffset()-this.utcOffset())*W,te=this-V,ae=function(){return I.m(C,V)};switch(P){case F:L=ae()/12;break;case B:L=ae();break;case Y:L=ae()/3;break;case H:L=(te-J)/6048e5;break;case O:L=(te-J)/864e5;break;case k:L=te/q;break;case U:L=te/W;break;case v:L=te/c;break;default:L=te}return d?L:I.a(L)},f.daysInMonth=function(){return this.endOf(B).$D},f.$locale=function(){return g[this.$L]},f.locale=function(u,m){if(!u)return this.$L;var d=this.clone(),L=se(u,m,!0);return L&&(d.$L=L),d},f.clone=function(){return I.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},M}(),re=ge.prototype;return E.prototype=re,[["$ms",z],["$s",v],["$m",U],["$H",k],["$W",O],["$M",B],["$y",F],["$D",h]].forEach(function(M){re[M[1]]=function(f){return this.$g(f,M[0],M[1])}}),E.extend=function(M,f){return M.$i||(M(f,ge,E),M.$i=!0),E},E.locale=se,E.isDayjs=ee,E.unix=function(M){return E(1e3*M)},E.en=g[y],E.Ls=g,E.p={},E})})(Je);var Xe=Je.exports;const $e=Ye(Xe);var Ke={exports:{}};(function(G,Q){(function(c,W){G.exports=W()})(Oe,function(){return function(c,W,q){c=c||{};var z=W.prototype,v={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function U(O,H,B,Y){return z.fromToBase(O,H,B,Y)}q.en.relativeTime=v,z.fromToBase=function(O,H,B,Y,F){for(var h,l,_,$=B.$locale().relativeTime||v,p=c.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],D=p.length,A=0;A<D;A+=1){var y=p[A];y.d&&(h=Y?q(O).diff(B,y.d,!0):B.diff(O,y.d,!0));var g=(c.rounding||Math.round)(Math.abs(h));if(_=h>0,g<=y.r||!y.r){g<=1&&A>0&&(y=p[A-1]);var Z=$[y.l];F&&(g=F(""+g)),l=typeof Z=="string"?Z.replace("%d",g):Z(g,H,y.l,_);break}}if(H)return l;var ee=_?$.future:$.past;return typeof ee=="function"?ee(l):ee.replace("%s",l)},z.to=function(O,H){return U(O,H,this,!0)},z.from=function(O,H){return U(O,H,this)};var k=function(O){return O.$u?q.utc():q()};z.toNow=function(O){return this.to(k(this),O)},z.fromNow=function(O){return this.from(k(this),O)}}})})(Ke);var xt=Ke.exports;const _t=Ye(xt);var Qe={exports:{}};(function(G,Q){(function(c,W){G.exports=W()})(Oe,function(){var c="minute",W=/[+-]\d\d(?::?\d\d)?/g,q=/([+-]|\d\d)/g;return function(z,v,U){var k=v.prototype;U.utc=function(l){var _={date:l,utc:!0,args:arguments};return new v(_)},k.utc=function(l){var _=U(this.toDate(),{locale:this.$L,utc:!0});return l?_.add(this.utcOffset(),c):_},k.local=function(){return U(this.toDate(),{locale:this.$L,utc:!1})};var O=k.parse;k.parse=function(l){l.utc&&(this.$u=!0),this.$utils().u(l.$offset)||(this.$offset=l.$offset),O.call(this,l)};var H=k.init;k.init=function(){if(this.$u){var l=this.$d;this.$y=l.getUTCFullYear(),this.$M=l.getUTCMonth(),this.$D=l.getUTCDate(),this.$W=l.getUTCDay(),this.$H=l.getUTCHours(),this.$m=l.getUTCMinutes(),this.$s=l.getUTCSeconds(),this.$ms=l.getUTCMilliseconds()}else H.call(this)};var B=k.utcOffset;k.utcOffset=function(l,_){var $=this.$utils().u;if($(l))return this.$u?0:$(this.$offset)?B.call(this):this.$offset;if(typeof l=="string"&&(l=function(y){y===void 0&&(y="");var g=y.match(W);if(!g)return null;var Z=(""+g[0]).match(q)||["-",0,0],ee=Z[0],se=60*+Z[1]+ +Z[2];return se===0?0:ee==="+"?se:-se}(l),l===null))return this;var p=Math.abs(l)<=16?60*l:l;if(p===0)return this.utc(_);var D=this.clone();if(_)return D.$offset=p,D.$u=!1,D;var A=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(D=this.local().add(p+A,c)).$offset=p,D.$x.$localOffset=A,D};var Y=k.format;k.format=function(l){var _=l||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return Y.call(this,_)},k.valueOf=function(){var l=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*l},k.isUTC=function(){return!!this.$u},k.toISOString=function(){return this.toDate().toISOString()},k.toString=function(){return this.toDate().toUTCString()};var F=k.toDate;k.toDate=function(l){return l==="s"&&this.$offset?U(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():F.call(this)};var h=k.diff;k.diff=function(l,_,$){if(l&&this.$u===l.$u)return h.call(this,l,_,$);var p=this.local(),D=U(l).local();return h.call(p,D,_,$)}}})})(Qe);var bt=Qe.exports;const wt=Ye(bt);var et={exports:{}};(function(G,Q){(function(c,W){G.exports=W()})(Oe,function(){var c={year:0,month:1,day:2,hour:3,minute:4,second:5},W={};return function(q,z,v){var U,k=function(Y,F,h){h===void 0&&(h={});var l=new Date(Y),_=function($,p){p===void 0&&(p={});var D=p.timeZoneName||"short",A=$+"|"+D,y=W[A];return y||(y=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:$,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:D}),W[A]=y),y}(F,h);return _.formatToParts(l)},O=function(Y,F){for(var h=k(Y,F),l=[],_=0;_<h.length;_+=1){var $=h[_],p=$.type,D=$.value,A=c[p];A>=0&&(l[A]=parseInt(D,10))}var y=l[3],g=y===24?0:y,Z=l[0]+"-"+l[1]+"-"+l[2]+" "+g+":"+l[4]+":"+l[5]+":000",ee=+Y;return(v.utc(Z).valueOf()-(ee-=ee%1e3))/6e4},H=z.prototype;H.tz=function(Y,F){Y===void 0&&(Y=U);var h,l=this.utcOffset(),_=this.toDate(),$=_.toLocaleString("en-US",{timeZone:Y}),p=Math.round((_-new Date($))/1e3/60),D=15*-Math.round(_.getTimezoneOffset()/15)-p;if(!Number(D))h=this.utcOffset(0,F);else if(h=v($,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(D,!0),F){var A=h.utcOffset();h=h.add(l-A,"minute")}return h.$x.$timezone=Y,h},H.offsetName=function(Y){var F=this.$x.$timezone||v.tz.guess(),h=k(this.valueOf(),F,{timeZoneName:Y}).find(function(l){return l.type.toLowerCase()==="timezonename"});return h&&h.value};var B=H.startOf;H.startOf=function(Y,F){if(!this.$x||!this.$x.$timezone)return B.call(this,Y,F);var h=v(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return B.call(h,Y,F).tz(this.$x.$timezone,!0)},v.tz=function(Y,F,h){var l=h&&F,_=h||F||U,$=O(+v(),_);if(typeof Y!="string")return v(Y).tz(_);var p=function(g,Z,ee){var se=g-60*Z*1e3,E=O(se,ee);if(Z===E)return[se,Z];var I=O(se-=60*(E-Z)*1e3,ee);return E===I?[se,E]:[g-60*Math.min(E,I)*1e3,Math.max(E,I)]}(v.utc(Y,l).valueOf(),$,_),D=p[0],A=p[1],y=v(D).utcOffset(A);return y.$x.$timezone=_,y},v.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},v.tz.setDefault=function(Y){U=Y}}})})(et);var $t=et.exports;const kt=Ye($t);var Mt={exports:{}};(function(G,Q){(function(c,W){G.exports=W(Xe)})(Oe,function(c){function W(h){return h&&typeof h=="object"&&"default"in h?h:{default:h}}var q=W(c),z="января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_"),v="январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),U="янв._февр._мар._апр._мая_июня_июля_авг._сент._окт._нояб._дек.".split("_"),k="янв._февр._март_апр._май_июнь_июль_авг._сент._окт._нояб._дек.".split("_"),O=/D[oD]?(\[[^[\]]*\]|\s)+MMMM?/;function H(h,l,_){var $,p;return _==="m"?l?"минута":"минуту":h+" "+($=+h,p={mm:l?"минута_минуты_минут":"минуту_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[_].split("_"),$%10==1&&$%100!=11?p[0]:$%10>=2&&$%10<=4&&($%100<10||$%100>=20)?p[1]:p[2])}var B=function(h,l){return O.test(l)?z[h.month()]:v[h.month()]};B.s=v,B.f=z;var Y=function(h,l){return O.test(l)?U[h.month()]:k[h.month()]};Y.s=k,Y.f=U;var F={name:"ru",weekdays:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),weekdaysShort:"вск_пнд_втр_срд_чтв_птн_сбт".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),months:B,monthsShort:Y,weekStart:1,yearStart:4,formats:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., H:mm",LLLL:"dddd, D MMMM YYYY г., H:mm"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:H,mm:H,h:"час",hh:H,d:"день",dd:H,M:"месяц",MM:H,y:"год",yy:H},ordinal:function(h){return h},meridiem:function(h){return h<4?"ночи":h<12?"утра":h<17?"дня":"вечера"}};return q.default.locale(F,null,!0),F})})(Mt);const St={class:"dynamics-chart-container"},Dt={class:"text-sm font-semibold mb-2 flex items-center justify-between"},Ct={class:"text-xs opacity-70"},Tt={class:"chart-svg-container"},Ht={class:"y-axis-labels"},Ot={class:"y-label"},At={class:"y-label"},Lt={class:"y-label"},jt={class:"chart-svg-wrapper"},Yt=["viewBox"],zt=["y1","y2"],Ft=["y"],Nt=["y1","y2"],Ut=["points"],It=["cx","cy"],Bt={key:0,class:"mt-4"},Wt={class:"dynamics-analysis"},Et={class:"analysis-text"},Pt={key:0,class:"insight-box"},Vt={class:"insight-text"},Zt={key:1,class:"mt-3 text-xs opacity-80 leading-relaxed"},Rt={class:"pagination-dots"},Gt=["onClick"],Te=300,He=80,De=6,qt=Ee({__name:"DynamicsChart",props:{dynamics:{},userAge:{},userGender:{}},setup(G){const Q=G,c=oe(0),W=oe(0),q=oe(0),z=oe("slide-left"),v=x(()=>Q.dynamics[c.value]||{metric:"",values:[],interpretation:""}),U=x(()=>v.value.values||[]),k=x(()=>{if(!Q.dynamics||Q.dynamics.length===0)return{min:0,max:10,labels:[10,5,0]};const p=[];if(Q.dynamics.forEach(g=>{Array.isArray(g.values)&&p.push(...g.values)}),p.length===0)return{min:0,max:10,labels:[10,5,0]};const D=Math.floor(Math.min(...p)),A=Math.ceil(Math.max(...p)),y=[A,Math.round((A+D)/2),D];return{min:D,max:A,labels:y}}),O=x(()=>{var g;const p=v.value.metric;if(!Q.userAge||!Q.userGender)return null;const A=(g={Персонажи:{"18-24":{male:6.5,female:7},"25-34":{male:6,female:6.5},"35-44":{male:5.5,female:6},"45+":{male:5,female:5.5}},Эмоции:{"18-24":{male:6,female:7},"25-34":{male:5.5,female:6.5},"35-44":{male:5,female:6},"45+":{male:4.5,female:5.5}},Действия:{"18-24":{male:7,female:6.5},"25-34":{male:6.5,female:6},"35-44":{male:6,female:5.5},"45+":{male:5.5,female:5}},Сцены:{"18-24":{male:6.5,female:6.5},"25-34":{male:6,female:6},"35-44":{male:5.5,female:5.5},"45+":{male:5,female:5}}}[p])==null?void 0:g[Q.userAge];if(!A)return null;const y=A[Q.userGender];return y===void 0?null:y}),H=x(()=>{const p=O.value;if(p===null)return null;const{min:D,max:A}=k.value,y=He-De*2,g=(p-D)/(A-D);return De+y-g*y}),B=x(()=>{const p=U.value;if(p.length===0)return[];const{min:D,max:A}=k.value,y=Te-De*2,g=He-De*2,Z=p.length>1?y/(p.length-1):0;return p.map((ee,se)=>{const E=(ee-D)/(A-D);return{x:De+se*Z,y:De+g-E*g}})}),Y=x(()=>B.value.map(p=>`${p.x},${p.y}`).join(" "));function F(p){W.value=p.touches[0].clientX}function h(p){q.value=p.touches[0].clientX}function l(){const p=W.value-q.value;Math.abs(p)>50&&(p>0&&c.value<Q.dynamics.length-1?(z.value="slide-left",c.value++,$()):p<0&&c.value>0&&(z.value="slide-right",c.value--,$())),W.value=0,q.value=0}function _(p){p!==c.value&&(z.value=p>c.value?"slide-left":"slide-right",c.value=p,$())}function $(){window.triggerHaptic&&window.triggerHaptic("light")}return(p,D)=>(n(),r("div",St,[s("div",{class:"chart-wrapper",onTouchstart:F,onTouchmove:h,onTouchend:l},[Be(ut,{name:z.value,mode:"out-in"},{default:dt(()=>[(n(),r("div",{key:c.value,class:"chart-content"},[s("div",Dt,[s("span",null,S(v.value.category||v.value.metric),1),s("span",Ct,S(U.value[U.value.length-1]),1)]),s("div",Tt,[s("div",Ht,[s("span",Ot,S(k.value.labels[0]),1),s("span",At,S(k.value.labels[1]),1),s("span",Lt,S(k.value.labels[2]),1)]),s("div",jt,[(n(),r("svg",{viewBox:`0 0 ${Te} ${He}`,class:"chart-svg",preserveAspectRatio:"xMidYMid meet"},[(n(),r(K,null,ie(3,A=>s("line",{key:`grid-${A}`,x1:0,x2:Te,y1:He/2*(A-1),y2:He/2*(A-1),stroke:"white","stroke-opacity":"0.15","stroke-width":"1"},null,8,zt)),64)),H.value!==null?(n(),r("rect",{key:0,x:0,y:H.value-8,width:Te,height:16,fill:"yellow",opacity:"0.15"},null,8,Ft)):N("",!0),H.value!==null?(n(),r("line",{key:1,x1:0,x2:Te,y1:H.value,y2:H.value,stroke:"yellow","stroke-opacity":"0.6","stroke-width":"1.5","stroke-dasharray":"4,3"},null,8,Nt)):N("",!0),s("polyline",{points:Y.value,fill:"none",stroke:"white","stroke-width":"2.5","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Ut),(n(!0),r(K,null,ie(B.value,(A,y)=>(n(),r("circle",{key:`point-${y}`,cx:A.x,cy:A.y,r:"4",fill:"white","vector-effect":"non-scaling-stroke"},null,8,It))),128))],8,Yt))])]),v.value.analysis?(n(),r("div",Bt,[s("div",Wt,[s("p",Et,S(v.value.analysis),1),v.value.insight?(n(),r("div",Pt,[D[0]||(D[0]=s("span",{class:"insight-icon"},"💡",-1)),s("p",Vt,S(v.value.insight),1)])):N("",!0)])])):v.value.interpretation?(n(),r("div",Zt,S(v.value.interpretation),1)):N("",!0)]))]),_:1},8,["name"])],32),s("div",Rt,[(n(!0),r(K,null,ie(G.dynamics,(A,y)=>(n(),r("button",{key:`dot-${y}`,class:ye(["dot",{active:y===c.value}]),onClick:g=>_(y)},null,10,Gt))),128))])]))}}),Ge=Pe(qt,[["__scopeId","data-v-ac484404"]]),Jt={class:"flex justify-between items-center py-2 min-h-[2.5rem]"},Xt={class:"truncate"},Kt={class:"bg-white/10 rounded-full px-2 py-1 text-sm min-w-[3rem] text-center whitespace-nowrap"},Qt={key:0,class:"mt-4 space-y-4 text-sm fade-seq is-open"},es={key:0,class:"flex flex-wrap gap-2"},ts={key:0,class:"rounded-lg bg-white/10"},ss={class:"opacity-80 inline-block",style:{fontSize:"130%"}},ns={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-4"},is={class:"flex items-baseline gap-2"},rs={class:"font-semibold text-sm"},as={class:"text-xs opacity-70 bg-white/15 px-2 py-0.5 rounded-full"},os={class:"text-xs opacity-90 leading-relaxed"},ls={class:"text-xs opacity-75 italic leading-relaxed bg-white/5 rounded px-2 py-1"},cs={key:1,class:"rounded-lg bg-white/10"},us={class:"opacity-80 inline-block",style:{fontSize:"130%"}},ds={key:0,class:"px-3 pb-3 text-white/90 leading-snug"},fs={key:2,class:"rounded-lg bg-white/10"},ps={class:"opacity-80 inline-block",style:{fontSize:"130%"}},hs={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-3"},ms={key:0,class:"text-sm opacity-90 leading-relaxed"},vs={key:1,class:"text-sm opacity-90 leading-relaxed"},ys={key:2,class:"text-sm opacity-90 leading-relaxed"},gs={key:3,class:"bg-white/10 rounded-lg p-3 space-y-2 mt-4"},xs={class:"font-semibold opacity-95 flex items-center gap-2"},_s={class:"text-sm opacity-90 leading-relaxed"},bs={key:0,class:"text-xs opacity-75 italic leading-relaxed"},ws={class:"rounded-lg bg-white/10"},$s={class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},ks=["innerHTML"],Ms={key:0,class:"rounded-lg bg-white/10"},Ss={class:"px-3 pb-3"},Ds={class:"flex flex-wrap gap-2"},Cs={key:1,class:"rounded-lg bg-white/10"},Ts={class:"px-3 pb-3 text-white/90 leading-snug"},Hs={key:2,class:"rounded-lg bg-white/10"},Os={class:"px-3 pb-3 text-white/90 leading-snug"},As={class:"list-decimal pl-5 space-y-2"},Ls={key:3,class:"rounded-lg bg-white/10"},js={class:"px-3 pb-3 text-white/90 leading-snug"},Ys={class:"list-decimal pl-5 space-y-3"},zs={key:0},Fs={class:"font-semibold mb-1"},Ns={class:"opacity-90"},Us={key:0,class:"opacity-80 mt-1 italic"},Is={key:1},Bs={key:0,class:"rounded-lg bg-white/10"},Ws={class:"px-3 pb-3 text-white/90 leading-snug"},Es={class:"list-decimal pl-5 space-y-2"},Ps={key:1,class:"rounded-lg bg-white/10"},Vs={class:"px-3 pb-3 text-white/90 leading-snug"},Zs={class:"list-decimal pl-5 space-y-3"},Rs={key:0},Gs={class:"font-semibold mb-1"},qs={class:"opacity-90"},Js={key:0,class:"opacity-80 mt-1 italic"},Xs={key:1},Ks={class:"rounded-lg bg-white/10 border-l-4 border-pink-400"},Qs={class:"px-3 pb-3 text-white/90 leading-snug"},en={class:"mt-2 flex justify-end"},tn={class:"space-y-2"},sn=["onClick"],nn={class:"opacity-80 inline-block",style:{fontSize:"130%"}},rn={key:0,class:"px-3 pb-3 text-white/90 leading-snug space-y-2"},an=["innerHTML"],on={key:0,class:"space-y-2"},ln={class:"flex justify-between text-xs opacity-80"},cn={class:"relative h-2 w-full bg-white/10 rounded overflow-hidden"},un={class:"pt-2 text-xs opacity-80 flex flex-wrap items-center gap-4"},dn={class:"inline-flex items-center gap-2"},fn={class:"mt-4 flex gap-2"},pn={key:3,class:"mt-3 text-xs bg-black/20 rounded-lg p-2 font-mono whitespace-pre-wrap break-words"},hn={class:"mt-2 flex justify-end"},mn={key:0,class:"space-y-3"},vn={class:"grid grid-cols-2 gap-2"},yn=["onClick"],gn={class:"flex justify-end gap-2 pt-2"},xn=["disabled"],_n={key:1,class:"space-y-3"},bn={class:"grid grid-cols-2 gap-2"},wn={class:"flex justify-end gap-2 pt-2"},$n=["disabled"],kn=48,Mn=Ee({__name:"DreamCard",props:{dream:{},active:{type:Boolean}},emits:["toggle"],setup(G,{emit:Q}){$e.extend(_t),$e.locale("ru"),$e.extend(wt),$e.extend(kt);const c=G,W=Q,q=()=>{W("toggle"),window.triggerHaptic&&window.triggerHaptic("light")},z=ft(),v=pt(),U=oe(!0),k=x(()=>{var e;return!!((e=c.dream)!=null&&e.is_deep_analysis)}),O=x({get:()=>{var e,t,a;return((e=c.dream)==null?void 0:e.user_feedback)??((a=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:a.user_feedback)??0},set:e=>{c.dream&&(c.dream.user_feedback=e,c.dream.deep_source||(c.dream.deep_source={}),c.dream.deep_source.user_feedback=e)}}),H={like:!1,dislike:!1,delete:!1},B=async e=>{if(H.like||H.dislike)return;const t=e===1?O.value===1?0:1:O.value===2?0:2,a=O.value;O.value=t;try{window.triggerHaptic&&window.triggerHaptic("medium"),e===1?H.like=!0:H.dislike=!0,await Ie.postAnalysisFeedback(c.dream.id,t),t===0?v.info("Оценка снята"):t===1?v.success("Добавлено: нравится"):t===2&&v.success("Добавлено: не нравится")}catch(o){O.value=a,console.error("Feedback error",o),v.error("Не удалось сохранить оценку")}finally{H.like=H.dislike=!1}},Y=()=>B(1),F=()=>B(2),h=async()=>{var a;if(H.delete)return;const e=(a=window.Telegram)==null?void 0:a.WebApp;if(await new Promise(o=>{e!=null&&e.showPopup?e.showPopup({title:"Удалить запись?",message:"Действие необратимо",buttons:[{id:"yes",type:"destructive",text:"Удалить"},{id:"no",type:"cancel",text:"Отмена"}]},b=>o(b==="yes")):o(window.confirm("Удалить запись?"))}))try{H.delete=!0,window.triggerHaptic&&window.triggerHaptic("heavy"),await Ie.deleteAnalysis(c.dream.id);const o=z.history.findIndex(b=>b.id===c.dream.id);o>-1&&z.history.splice(o,1),z.fetchProfile(),v.success("Запись удалена")}catch(o){console.error("Delete error",o),v.error("Не удалось удалить запись")}finally{H.delete=!1}},l=new Set(["и","в","во","не","что","он","на","я","с","со","как","а","то","все","она","так","его","но","да","ты","к","у","же","вы","за","бы","по","ее","мне","было","вот","от","меня","еще","нет","о","из","ему","теперь","когда","даже","ну","вдруг","ли","если","уже","или","ни","быть","был","него","до","вас","нибудь","опять","уж","вам","ведь","там","потом","себя","ничего","ей","может","они","тут","где","есть","надо","ней","для","мы","тебя","их","чем","была","сам","чтоб","без","будто","чего","раз","тоже","себе","под","будет","ж","тогда","кто","этот","того","потому","этого","какой","совсем","ним","здесь","этом","один","почти","мой","тем","чтобы","нее","кажется","сейчас","были","куда","зачем","всех","никогда","можно","при","наконец","два","об","другой","хоть","после","над","больше","тот","через","эти","нас","про","всего","них","какая","много","разве","три","эту","моя","впрочем","хорошо","свою","этой","перед","иногда","лучше","чуть","том","нельзя","такой","им","более","всегда","конечно","всю","между"]);function _(e){return e.replace(/\s+/g," ").trim().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function $(e){if(!e)return"";const t=String(e).split(/[.!?\n]/)[0],o=t.toLowerCase().replace(/[^\p{L}\p{N}\s-]/gu,"").split(/\s+/).filter(b=>b&&!l.has(b)&&b.length>3).slice(0,3);return o.length===0?t.slice(0,40):_(o.join(" "))}function p(e){if(!e)return"";let t=String(e).toLowerCase().replace(/["'«»]/g,"").trim();t=t.replace(/^(приснилось|снилось|сон о|сон про|сон|мне снится|мне приснилось)\s+/i,""),t=t.replace(/\s+/g," ").trim();const a=t.split(" ").filter(Boolean).slice(0,3);return a.length?a.join(" "):""}function D(e){if(!e)return"";const t=String(e).toLowerCase();return t.charAt(0).toUpperCase()+t.slice(1)}const A=x(()=>{var T,i,w,j,X;const e=p((i=(T=c.dream)==null?void 0:T.deep_source)==null?void 0:i.title);if(e)return D(e);const t=(((j=(w=c.dream)==null?void 0:w.deep_source)==null?void 0:j.tags)||[]).filter(Boolean),a=pe=>{var he;let ue=String(pe||"").trim();return ue=((he=ue.split(/[\\/,(;:—–-]/)[0])==null?void 0:he.trim())||"",ue?ue.charAt(0).toUpperCase()+ue.slice(1).toLowerCase():""},o=t.map(a).filter(Boolean);if(o.length){const pe=o.slice(0,2).join(" и ");return D(pe||"Без названия")}const b=p($((X=c.dream)==null?void 0:X.dream_text));return D(b||"Без названия")}),y=x(()=>{var a,o;const e=(o=(a=c.dream)==null?void 0:a.deep_source)==null?void 0:o.tags;if(!Array.isArray(e))return[];const t=b=>{var i;let T=String(b||"").trim();return T=((i=T.split(/[\\/,(;:—–-]/)[0])==null?void 0:i.trim())||"",T?T.charAt(0).toUpperCase()+T.slice(1).toLowerCase():""};return e.map(t).filter(Boolean).slice(0,5)});function g(e){return String(e||"").replace(/^```[\s\S]*?\n/,"").replace(/```$/,"").replace(/\(\s*\d+\s*\)/g,"").replace(/\s\[\s*\d+\s*\]/g,"").replace(/[\u00B9\u00B2\u00B3\u2070-\u2079]/g,"")}oe("context");const Z=x(()=>{var e;return g(((e=c.dream)==null?void 0:e.analysis)||"")}),ee=x(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.overallContext)||{}});x(()=>{const e=ee.value;return!!(e!=null&&e.narrative||e!=null&&e.psychologicalFunction||e!=null&&e.emotionalJourney)});const se=x(()=>{var t,a;const e=(a=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:a.recurringSymbols;return Array.isArray(e)?e:[]}),E=x(()=>se.value.length>0),I=x(()=>{var t,a;const e=(a=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:a.dynamicsContext;return Array.isArray(e)?e:[]}),ge=x(()=>I.value.length>0),re=x(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.conclusion)||{}}),M=x(()=>{const e=re.value;return!!(e!=null&&e.periodThemes||e!=null&&e.dreamFunctionsAnalysis||e!=null&&e.psychologicalSupport||e!=null&&e.integrationExercise)}),f=x(()=>{var t,a;const e=(a=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:a.dynamics;return Array.isArray(e)&&e.length>0?e:[]});x(()=>f.value.length>0);const u=x(()=>{var t,a;const e=(a=(t=c.dream)==null?void 0:t.deep_source)==null?void 0:a.conclusions;return Array.isArray(e)&&e.length>0?e:[]});x(()=>u.value.length>0);const m=x(()=>{var i,w;const e=(w=(i=c.dream)==null?void 0:i.deep_source)==null?void 0:w.recommendations;if(Array.isArray(e)&&e.length>0&&typeof e[0]=="object")return e;if(Array.isArray(e)&&e.length>0)return e.map((j,X)=>({title:`Рекомендация ${X+1}`,description:String(j),rationale:""}));const t=V.value;if(t.length===0)return[];const a=[0,0,0,0];for(const j of t)for(let X=0;X<4;X++)a[X]+=j[X];const o=Math.max(1,t.length);for(let j=0;j<4;j++)a[j]=Math.round(a[j]/o);const b=[["Персонажи","Обрати внимание на отношения и роли; практикуй честную коммуникацию."],["Эмоции","Добавь ежедневную регуляцию эмоций (дыхание, дневник, прогулка)."],["Действия","Определи 1 маленький шаг на неделю и заверши его."],["Сцены","Проверь границы и режим: место/время, где тебе спокойнее."]],T=a.map((j,X)=>({i:X,v:j})).sort((j,X)=>X.v-j.v).map(j=>j.i);return[{title:b[T[0]][0],description:b[T[0]][1],rationale:""},{title:b[T[1]][0],description:b[T[1]][1],rationale:""}]});x(()=>m.value.length>0);function d(e,t){var a;try{let o=e;const b=Array.from(new Set((t||[]).filter(Boolean))).sort((T,i)=>i.length-T.length);for(const T of b){const i=(a=String(T).split(/[\\/,(;:—–-]/)[0])==null?void 0:a.trim();if(!i)continue;const w=new RegExp(`(\b${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\b)`,"gi");o=o.replace(w,'<mark class="bg-white/20 px-1 rounded">$1</mark>')}return o.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1")}catch{return e}}const L=x(()=>{var e,t;return d(Z.value,((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.tags)||[])});function C(e){try{return new Date(e).getTime()||0}catch{return 0}}const P=x(()=>(z.history||[]).filter(e=>{var t;return!e.is_deep_analysis&&((t=e==null?void 0:e.deep_source)==null?void 0:t.hvdc)&&(e==null?void 0:e.created_at)}).sort((e,t)=>C(e.created_at)>C(t.created_at)?-1:1)),V=x(()=>{var o;const e=C(((o=c.dream)==null?void 0:o.created_at)||""),t=P.value.filter(b=>!k.value||(e?C(b.created_at)<=e:!0)).slice(0,5).reverse(),a=["characters","emotions","actions","settings"];return t.map(b=>a.map(T=>{var i,w;return Number(((w=(i=b.deep_source.hvdc)==null?void 0:i.distribution)==null?void 0:w[T])||0)}))}),J=x(()=>V.value.length),te=x(()=>J.value>=2),ae=x(()=>Math.max(60,(J.value-1)*28+8));function xe(e){const t=e.length,a=ae.value,o=kn,b=t>1?(a-8)/(t-1):0,T=[];for(let w=0;w<t;w++){const j=w*b,X=o-Math.round(e[w]/100*o);T.push({x:j,y:X})}return{str:T.map(w=>`${w.x},${w.y}`).join(" "),pts:T}}x(()=>{const e=[{key:"characters",label:"Персонажи",idx:0,opacity:.95},{key:"emotions",label:"Эмоции",idx:1,opacity:.75},{key:"actions",label:"Действия",idx:2,opacity:.55},{key:"settings",label:"Сцены",idx:3,opacity:.35}],t=[],a=V.value;for(const o of e){const b=a.map(w=>w[o.idx]),{str:T,pts:i}=xe(b);t.push({key:o.key,label:o.label,values:b,points:T,pointList:i,opacity:o.opacity})}return t});const me=x(()=>{if(!te.value)return[];const e=[{key:"characters",label:"Персонажи",idx:0},{key:"emotions",label:"Эмоции",idx:1},{key:"actions",label:"Действия",idx:2},{key:"settings",label:"Сцены",idx:3}],t=V.value;return e.map(a=>({metric:a.label,values:t.map(o=>o[a.idx]),interpretation:`Динамика "${a.label}" по последним ${J.value} снам`}))});function _e(e){const a=e.split(/\n+/).map(o=>o.trim()).filter(Boolean).filter(o=>/^\d+\./.test(o)).map(o=>o.replace(/^\d+\.\s*/,"")).slice(0,3);return a.length?a:e.split(/[.!?]\s+/).map(o=>o.trim()).filter(Boolean).slice(0,3)}const ce=x(()=>_e(Z.value));function ne(e){try{const t=String(e||"").toLowerCase(),a=we=>we.reduce((Ue,ct)=>Ue+(t.includes(ct)?1:0),0),o=["страх","ужас","паник","тревог","стыд","гнев","плак","слез","кошмар","тоска","грусть"],b=["экзам","выступл","собесед","защит","проект","подготов","завтра","ожидан","волнен","поездк","путешеств","нов","интервью"],T=["вчера","сегодня","работ","школ","универ","дом","улиц","друг","родител","коллег","город"],i=a(o),w=a(b),j=a(T);let X=i>0?Math.min(1,i/3):0,pe=w>0?Math.min(1,w/3):0,ue=j>0?Math.min(1,.5+j/5):0;X===0&&pe===0&&ue===0&&(ue=.6,X=.2,pe=.2);const he={schema:"dream_type_v1",scores:{memory:+ue.toFixed(2),emotion:+X.toFixed(2),anticipation:+pe.toFixed(2)}},R=[["memory",he.scores.memory],["emotion",he.scores.emotion],["anticipation",he.scores.anticipation]];R.sort((we,Ue)=>Ue[1]-we[1]);const ve=+Math.max(0,R[0][1]-R[1][1]).toFixed(2);return{...he,dominant:R[0][0],confidence:ve}}catch{return null}}const de=x(()=>{var e,t,a;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.dream_type)||ne((a=c.dream)==null?void 0:a.dream_text)||null});function be(){const e=de.value;if(!e||!e.dominant)return['<div class="space-y-2">','<div class="font-semibold">🛠 Небольшая работа со сном</div>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Заметь:</span> Какие 2–3 образа из сна самые сильные? Запиши их коротко.</li>','<li><span class="font-semibold">Шаг:</span> Выбери один маленький шаг в реальности, который поддержит тебя по теме сна.</li>',"</ol>","</div>"].join("");const t=String(e.dominant).toLowerCase();return t==="memory"?['<div class="space-y-2">','<div class="font-semibold">🌙 Сон-Память</div>','<p class="opacity-90">Переработка недавнего опыта, соединение нового с прошлым.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Отрази:</span> Вспомни, что происходило последние 1–2 дня. Какие события могли попасть в сон?</li>','<li><span class="font-semibold">Соедини:</span> Отметь, какие элементы сна перекликаются с реальностью — это завершает «архивацию» опыта.</li>',"</ol>","</div>"].join(""):t==="emotion"?['<div class="space-y-2">','<div class="font-semibold">⚡️ Сон-Эмоция</div>','<p class="opacity-90">Проживание и нейтрализация сильных чувств.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Почувствуй:</span> Определи, какая эмоция была самой сильной во сне. Где она чувствуется в теле сейчас?</li>','<li><span class="font-semibold">Услышь:</span> Представь, что главный персонаж сна говорит тебе что-то. Что он хочет, чтобы ты понял?</li>',"</ol>","</div>"].join(""):['<div class="space-y-2">','<div class="font-semibold">🔮 Сон-Предвосхищение</div>','<p class="opacity-90">Тренировка будущих ситуаций и реакций.</p>','<ol class="list-decimal pl-5 space-y-1">','<li><span class="font-semibold">Представь:</span> Как бы ты хотел повести себя, если бы это произошло в реальности?</li>','<li><span class="font-semibold">Расшифруй:</span> Какой символ кажется ключевым? Что он может говорить о твоих страхах или намерениях?</li>',"</ol>","</div>"].join("")}const ke=x(()=>{var pe,ue,he;const e=g(((pe=c.dream)==null?void 0:pe.analysis)||"");if(!e)return[];const t={arch:{key:"arch",title:"Архетипическая история",text:""},func:{key:"func",title:"Возможная функция сна",text:""},freud:{key:"freud",title:"По Фрейду",text:""},jung:{key:"jung",title:"По Юнгу",text:""}},a=[],o=/\*\*([^*]+)\*\*/g;let b;for(;b=o.exec(e);)a.push({title:b[1].trim(),start:b.index,end:b.index+b[0].length});const T=((ue=a[0])==null?void 0:ue.start)??e.length;t.arch.text=e.slice(0,T).trim();for(let R=0;R<a.length;R++){const ve=a[R].title.toLowerCase(),we=e.slice(a[R].end,((he=a[R+1])==null?void 0:he.start)??e.length).trim();ve.includes("возможная функция")?t.func.text=we:ve.includes("по фрейду")?t.freud.text=we:ve.includes("по юнгу")&&(t.jung.text=we)}const i=R=>R.replace(/\n\n+/g,'</p><p class="mt-2">').replace(/\n/g,"<br>").replace(/^(.+)$/,"<p>$1"),w=Object.values(t).map(R=>({...R,html:i(R.text||"")}));w.some(R=>R.key==="func")||w.push({key:"func",title:"Возможная функция сна",text:"",html:""});const j=w.findIndex(R=>R.key==="arch");j!==-1&&w.splice(j+1,0,{key:"hvdc",title:"Контент анализ",text:"",html:""});const X=be();if(X){const R=w.findIndex(ve=>ve.key==="func");if(R!==-1){const ve=['<div class="mt-3 pt-2 border-t border-white/10 space-y-1">','<div class="font-semibold">Функциональное упражнение</div>',X,"</div>"].join("");w[R].html=(w[R].html||"")+ve}}return w}),fe=ht({arch:!0,hvdc:!1,func:!1,freud:!1,jung:!1,symbols:!0,dynamics:!0,conclusion:!0});function Ae(e){fe[e]=!fe[e]}const Ve=x(()=>{try{return new URLSearchParams(window.location.search).get("debug")==="1"||localStorage.getItem("da_debug")==="1"}catch{return!1}});function tt(){var e,t,a,o,b;try{const T=JSON.stringify(ze.value,null,2);(e=navigator.clipboard)==null||e.writeText(T),(t=v==null?void 0:v.success)==null||t.call(v,"Скопировано")}catch{try{(b=(o=(a=window.Telegram)==null?void 0:a.WebApp)==null?void 0:o.showPopup)==null||b.call(o,{title:"Debug",message:"Скопируйте из блока ниже вручную",buttons:[{id:"ok",type:"default",text:"OK"}]})}catch{}}}function st(e){var a;let t=String(e||"").trim();return t=((a=t.split(/[\\/,(;:—–-]/)[0])==null?void 0:a.trim())||"",t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}const ze=x(()=>{var a,o,b,T;if(!Ve.value)return null;const e=c.dream||{},t=Array.isArray((a=e==null?void 0:e.deep_source)==null?void 0:a.tags)?e.deep_source.tags:[];return{id:e.id,created_at:e.created_at,is_deep_analysis:!!e.is_deep_analysis,title_raw:((o=e==null?void 0:e.deep_source)==null?void 0:o.title)||null,tags_raw:t,tags_norm:t.map(st),dream_type:((b=e==null?void 0:e.deep_source)==null?void 0:b.dream_type)||null,hvdc_present:!!((T=e==null?void 0:e.deep_source)!=null&&T.hvdc)}}),Fe=oe(!1),Ze=oe(1),nt=["0-20","20-30","30-40","40-50","50+"],Le=oe(""),Me=oe("");function Ne(){Fe.value=!1}async function it(){try{await Ie.setDemographics(Le.value,Me.value);try{await z.fetchProfile()}catch{}v.success("Готово! Дальнейшие анализы будут учитывать эти данные"),Fe.value=!1}catch{v.error("Не удалось сохранить")}}x(()=>{const e=z.profile||{};return!!(e.age_range&&e.gender)});const Ce=x(()=>{var e,t;return((t=(e=c.dream)==null?void 0:e.deep_source)==null?void 0:t.hvdc)||null}),rt=x(()=>{var b,T,i;const e=[{key:"characters",label:"Персонажи"},{key:"emotions",label:"Эмоции"},{key:"actions",label:"Действия"},{key:"settings",label:"Сцены"}],t=((b=Ce.value)==null?void 0:b.distribution)||{},a=((T=Ce.value)==null?void 0:T.norm)||null,o=((i=Ce.value)==null?void 0:i.comparison)||null;return e.map(w=>({key:w.key,label:w.label,value:Number(t[w.key]??0),norm:a?Number(a[w.key]??0):null,delta:o?Number(o[w.key]??0):null}))}),at=x(()=>{var i;const e=((i=Ce.value)==null?void 0:i.norm_group)||null;if(!e)return"общая статистика";const t=String(e.gender||"").toLowerCase(),a=t==="male"?"муж.":t==="female"?"жен.":"",o=e.age_range||"",b=o?`${o} лет`:"",T=[a,b].filter(Boolean).join(" ");return T?`общая статистика* для ${T}`:"общая статистика"}),ot=x(()=>{if(!c.dream.created_at)return"";try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone||$e.tz.guess(),t=$e.utc(c.dream.created_at).tz(e).startOf("day"),o=$e().tz(e).startOf("day").diff(t,"day"),b=Math.floor(o/7),T=Math.floor(o/30),i=Math.floor(o/365);return o===0?"сегодня":o===1?"вчера":o<7?`${o} д`:o<30?`${b} н`:o<365?`${T} м`:`${i} г`}catch{return c.dream.created_at}}),lt=x(()=>{var e;return(e=c.dream)!=null&&e.is_deep_analysis?"from-[#9C41FF] to-[#C03AFF]":"from-[#4A58FF] to-[#5664FF]"});return(e,t)=>{var a,o,b,T;return n(),r("article",{class:ye(["rounded-xl bg-gradient-to-br text-white px-8 md:px-16 transition-all overflow-hidden cursor-pointer py-6",[G.active?"":"min-h-[4.5rem]",lt.value]]),onClick:q},[s("div",Jt,[s("h3",Xt,S(A.value),1),s("span",Kt,S(ot.value),1)]),G.active?(n(),r("div",Qt,[y.value.length&&!k.value?(n(),r("div",es,[(n(!0),r(K,null,ie(y.value,i=>(n(),r("span",{key:i,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},S(i),1))),128))])):N("",!0),k.value?(n(),r(K,{key:1},[E.value?(n(),r("div",ts,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[0]||(t[0]=le(i=>Ae("symbols"),["stop"]))},[t[10]||(t[10]=s("span",null,"Повторяющиеся символы",-1)),s("span",ss,S(fe.symbols?"−":"+"),1)]),fe.symbols?(n(),r("div",ns,[(n(!0),r(K,null,ie(se.value,(i,w)=>(n(),r("div",{key:`symbol-${w}`,class:"space-y-1"},[s("div",is,[s("h4",rs,S(i.symbol),1),s("span",as,"×"+S(i.frequency),1)]),s("p",os,S(i.description),1),s("div",ls,[t[11]||(t[11]=s("span",{class:"font-medium"},"В ваших снах:",-1)),Se(" "+S(i.userContext),1)])]))),128))])):N("",!0)])):N("",!0),ge.value?(n(),r("div",cs,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[1]||(t[1]=le(i=>Ae("dynamics"),["stop"]))},[t[12]||(t[12]=s("span",null,"Динамика контекста",-1)),s("span",us,S(fe.dynamics?"−":"+"),1)]),fe.dynamics?(n(),r("div",ds,[Be(Ge,{dynamics:I.value,userAge:(a=je(z).profile)==null?void 0:a.age_range,userGender:(o=je(z).profile)==null?void 0:o.gender},null,8,["dynamics","userAge","userGender"])])):N("",!0)])):N("",!0),M.value?(n(),r("div",fs,[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:t[2]||(t[2]=le(i=>Ae("conclusion"),["stop"]))},[t[13]||(t[13]=s("span",null,"Заключение",-1)),s("span",ps,S(fe.conclusion?"−":"+"),1)]),fe.conclusion?(n(),r("div",hs,[re.value.periodThemes?(n(),r("p",ms,S(re.value.periodThemes),1)):N("",!0),re.value.dreamFunctionsAnalysis?(n(),r("p",vs,S(re.value.dreamFunctionsAnalysis),1)):N("",!0),re.value.psychologicalSupport?(n(),r("p",ys,S(re.value.psychologicalSupport),1)):N("",!0),re.value.integrationExercise?(n(),r("div",gs,[s("h4",xs,[t[14]||(t[14]=s("span",null,"💫",-1)),s("span",null,S(re.value.integrationExercise.title||"Практическое упражнение"),1)]),s("p",_s,S(re.value.integrationExercise.description),1),re.value.integrationExercise.rationale?(n(),r("p",bs,S(re.value.integrationExercise.rationale),1)):N("",!0)])):N("",!0)])):N("",!0)])):N("",!0),!E.value&&!ge.value&&!M.value?(n(),r(K,{key:3},[s("div",ws,[t[15]||(t[15]=s("div",{class:"px-3 py-2 font-semibold"},"Общий контекст серии",-1)),s("div",$s,[s("div",{innerHTML:L.value},null,8,ks)])]),y.value.length?(n(),r("div",Ms,[t[16]||(t[16]=s("div",{class:"px-3 py-2 font-semibold"},"Повторяющиеся символы",-1)),s("div",Ss,[s("div",Ds,[(n(!0),r(K,null,ie(y.value,i=>(n(),r("span",{key:"deep-"+i,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-white/15 text-white"},S(i),1))),128))])])])):N("",!0),te.value?(n(),r("div",Cs,[t[17]||(t[17]=s("div",{class:"px-3 py-2 font-semibold"},"Динамика",-1)),s("div",Ts,[Be(Ge,{dynamics:me.value,userAge:(b=je(z).profile)==null?void 0:b.age_range,userGender:(T=je(z).profile)==null?void 0:T.gender},null,8,["dynamics","userAge","userGender"])])])):N("",!0),ce.value.length?(n(),r("div",Hs,[t[18]||(t[18]=s("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),s("div",Os,[s("ol",As,[(n(!0),r(K,null,ie(ce.value,(i,w)=>(n(),r("li",{key:"in"+w,class:"text-xs leading-relaxed"},S(i),1))),128))])])])):N("",!0),m.value.length?(n(),r("div",Ls,[t[19]||(t[19]=s("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),s("div",js,[s("ol",Ys,[(n(!0),r(K,null,ie(m.value,(i,w)=>(n(),r("li",{key:"rec"+w,class:"text-xs leading-relaxed"},[typeof i=="object"&&i.title?(n(),r("div",zs,[s("div",Fs,S(i.title),1),s("div",Ns,S(i.description),1),i.rationale?(n(),r("div",Us,S(i.rationale),1)):N("",!0)])):(n(),r("div",Is,S(typeof i=="string"?i:i.title),1))]))),128))])])])):N("",!0)],64)):N("",!0),(E.value||ge.value)&&!M.value?(n(),r(K,{key:4},[ce.value.length?(n(),r("div",Bs,[t[20]||(t[20]=s("div",{class:"px-3 py-2 font-semibold"},"Ключевые инсайты",-1)),s("div",Ws,[s("ol",Es,[(n(!0),r(K,null,ie(ce.value,(i,w)=>(n(),r("li",{key:"in"+w,class:"text-xs leading-relaxed"},S(i),1))),128))])])])):N("",!0),m.value.length?(n(),r("div",Ps,[t[21]||(t[21]=s("div",{class:"px-3 py-2 font-semibold"},"Рекомендации",-1)),s("div",Vs,[s("ol",Zs,[(n(!0),r(K,null,ie(m.value,(i,w)=>(n(),r("li",{key:"rec"+w,class:"text-xs leading-relaxed"},[typeof i=="object"&&i.title?(n(),r("div",Rs,[s("div",Gs,S(i.title),1),s("div",qs,S(i.description),1),i.rationale?(n(),r("div",Js,S(i.rationale),1)):N("",!0)])):(n(),r("div",Xs,S(typeof i=="string"?i:i.title),1))]))),128))])])])):N("",!0)],64)):N("",!0)],64)):(n(),r(K,{key:2},[s("div",Ks,[t[22]||(t[22]=s("div",{class:"px-3 py-2 font-semibold flex items-center justify-between"},[s("span",null,"Сон"),s("span",{class:"opacity-80 text-pink-400",style:{"font-size":"130%","font-family":"ui-rounded, -apple-system, system-ui, 'SF Pro Rounded', 'Segoe UI', Roboto, Arial"}},"“")],-1)),s("div",Qs,[s("p",{class:ye(["opacity-90",U.value?"clamp-5":""])},S(G.dream.dream_text),3),s("div",en,[s("button",{class:"text-sm font-semibold opacity-80 hover:opacity-100",onClick:t[3]||(t[3]=le(i=>U.value=!U.value,["stop"]))},S(U.value?"+":"−"),1)])])]),s("div",tn,[(n(!0),r(K,null,ie(ke.value,(i,w)=>(n(),r("div",{key:i.key,class:"rounded-lg bg-white/10"},[s("button",{class:"w-full text-left px-3 py-2 font-semibold flex items-center justify-between",onClick:le(j=>Ae(i.key),["stop"])},[s("span",null,S(i.title),1),s("span",nn,S(fe[i.key]?"−":"+"),1)],8,sn),fe[i.key]?(n(),r("div",rn,[i.key!=="hvdc"?(n(),r("div",{key:0,innerHTML:i.html},null,8,an)):(n(),r(K,{key:1},[Ce.value?(n(),r("div",on,[(n(!0),r(K,null,ie(rt.value,j=>(n(),r("div",{key:j.key},[s("div",ln,[s("span",null,S(j.label),1),s("span",null,[Se(S(j.value)+"% ",1),j.norm!==null?(n(),r(K,{key:0},[Se(" / "+S(j.norm)+"%",1)],64)):N("",!0),j.delta!==null?(n(),r("span",{key:1,class:ye(j.delta>0?"text-green-300":j.delta<0?"text-red-300":"text-white/70")}," ("+S(j.delta>0?"+"+j.delta:j.delta)+"pp) ",3)):N("",!0)])]),s("div",cn,[j.norm!==null?(n(),r("div",{key:0,class:"absolute inset-y-0 left-0 bg-white/20",style:Re({width:j.norm+"%"})},null,4)):N("",!0),s("div",{class:"relative h-full bg-white/70",style:Re({width:j.value+"%"})},null,4)])]))),128)),s("div",un,[t[24]||(t[24]=s("span",{class:"inline-flex items-center gap-2"},[s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/70 shrink-0"}),Se(" ваш сон")],-1)),s("span",dn,[t[23]||(t[23]=s("span",{class:"w-2 h-2 rounded-full inline-block bg-white/20 shrink-0"},null,-1)),Se(" "+S(at.value),1)])]),t[25]||(t[25]=s("div",{class:"text-xs opacity-70 flex items-start gap-2"},[s("span",{class:"inline-flex items-center justify-center w-4 h-4 rounded-full bg-white/20 text-white text-[10px]"},"i"),s("span",null,"Контент‑анализ по схеме HVdC; сравнение с демографическими нормами (DreamBank, SDDB).")],-1))])):N("",!0)],64))])):N("",!0)]))),128))])],64)),s("div",fn,[s("button",{class:ye(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",O.value===1?"bg-green-500/30 text-white ring-2 ring-green-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:le(Y,["stop"])}," 👍 ",2),s("button",{class:ye(["flex-1 rounded-xl py-2 text-sm font-medium text-center transition-colors",O.value===2?"bg-red-500/30 text-white ring-2 ring-red-400/60":"bg-white/20 hover:bg-white/30 text-white"]),onClick:le(F,["stop"])}," 👎 ",2),s("button",{class:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-white rounded-xl py-2 text-sm font-medium text-center transition-colors",onClick:le(h,["stop"])}," 🗑️ ")]),Ve.value&&ze.value?(n(),r("div",pn,[t[26]||(t[26]=s("div",{class:"mb-2 opacity-80"},"Debug payload",-1)),Se(" "+S(JSON.stringify(ze.value,null,2))+" ",1),s("div",hn,[s("button",{class:"px-3 py-1 rounded bg-white/10 hover:bg-white/20",onClick:le(tt,["stop"])},"Скопировать")])])):N("",!0),(n(),We(mt,{to:"body"},[Fe.value?(n(),r("div",{key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70",onClick:le(Ne,["self"]),onWheel:t[8]||(t[8]=le(()=>{},["prevent"])),onTouchmove:t[9]||(t[9]=le(()=>{},["prevent"]))},[s("div",{class:"w-[92vw] max-w-[440px] rounded-2xl bg-[var(--tg-theme-secondary-bg-color,#0c110c)] text-white p-4 shadow-2xl border border-white/10",onClick:t[7]||(t[7]=le(()=>{},["stop"]))},[t[29]||(t[29]=s("h3",{class:"text-lg font-semibold mb-2"},"Уточнить данные",-1)),Ze.value===1?(n(),r("div",mn,[t[27]||(t[27]=s("p",{class:"opacity-90"},"Ваш возрастной диапазон:",-1)),s("div",vn,[(n(),r(K,null,ie(nt,i=>s("button",{key:i,class:ye(["px-4 py-3 rounded-xl text-sm",Le.value===i?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:w=>Le.value=i},S(i),11,yn)),64))]),s("div",gn,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:Ne},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Le.value,onClick:t[4]||(t[4]=i=>Ze.value=2)},"Далее",8,xn)])])):(n(),r("div",_n,[t[28]||(t[28]=s("p",{class:"opacity-90"},"Ваш пол:",-1)),s("div",bn,[s("button",{class:ye(["px-4 py-3 rounded-xl text-sm",Me.value==="male"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[5]||(t[5]=i=>Me.value="male")},"Мужской",2),s("button",{class:ye(["px-4 py-3 rounded-xl text-sm",Me.value==="female"?"bg-white/25":"bg-white/10 hover:bg-white/15"]),onClick:t[6]||(t[6]=i=>Me.value="female")},"Женский",2)]),s("div",wn,[s("button",{class:"px-4 py-2 rounded-xl bg-white/10",onClick:Ne},"Отмена"),s("button",{class:"px-4 py-2 rounded-xl bg-white/20",disabled:!Me.value,onClick:it},"Сохранить",8,$n)])]))])],32)):N("",!0)]))])):N("",!0)],2)}}}),qe=Pe(Mn,[["__scopeId","data-v-f4a12084"]]),Sn={class:"flex items-center justify-between mb-4"},Dn={class:"inline-flex items-center gap-2 rounded-full px-3 py-1 themed-badge"},Cn={key:0,class:"flex flex-col gap-4 pb-[5vh]"},Tn={key:1,class:"text-center text-red-400 py-8"},Hn={key:2},On={key:0,class:"text-center text-white/60 py-8"},An={key:1,class:"flex flex-col gap-4 pb-[5vh]"},Ln={key:3},jn={key:0,class:"text-center text-white/60 py-8"},Yn={key:1,class:"flex flex-col gap-4 pb-[5vh]"},zn=Ee({__name:"AnalysisHistoryList",props:["userStore"],setup(G){const Q=G,c=oe(null),W=oe(5),q=oe(5),z=oe("history"),v=x({get:()=>z.value,set:_=>l(_)}),U=x(()=>{var _;return(_=Q.userStore)!=null&&_.history?Q.userStore.history.filter($=>!$.is_deep_analysis):[]}),k=x(()=>{var _;return(_=Q.userStore)!=null&&_.history?Q.userStore.history.filter($=>$.is_deep_analysis):[]}),O=x(()=>U.value.slice(0,W.value)),H=x(()=>k.value.slice(0,q.value)),B=x(()=>U.value.length>W.value),Y=x(()=>k.value.length>q.value),F=()=>{window.triggerHaptic&&window.triggerHaptic("light"),W.value+=5},h=()=>{window.triggerHaptic&&window.triggerHaptic("light"),q.value+=5},l=_=>{window.triggerHaptic&&window.triggerHaptic("light"),z.value=_,c.value=null};return(_,$)=>{var p,D,A,y;return n(),r("div",null,[s("div",Sn,[$[2]||($[2]=s("h2",{class:"text-3xl font-bold"},"История",-1)),s("div",Dn,[vt(s("select",{"aria-label":"Режим истории","onUpdate:modelValue":$[0]||($[0]=g=>v.value=g),class:"bg-transparent focus:outline-none themed-select"},[...$[1]||($[1]=[s("option",{value:"history"},"Дневник снов",-1),s("option",{value:"deep"},"Глубокий анализ",-1)])],512),[[yt,v.value]])])]),(p=G.userStore)!=null&&p.isLoadingHistory?(n(),r("div",Cn,[(n(),r(K,null,ie(3,g=>s("div",{key:g,class:"rounded-xl bg-white/10 px-8 md:px-16 py-6"},[...$[3]||($[3]=[gt('<div class="flex justify-between items-center py-2 min-h-[2.5rem]" data-v-14de94bb><div class="shimmer h-4 w-32 rounded" data-v-14de94bb></div><div class="shimmer h-4 w-12 rounded" data-v-14de94bb></div></div><div class="mt-4 space-y-2" data-v-14de94bb><div class="shimmer h-3 w-full rounded" data-v-14de94bb></div><div class="shimmer h-3 w-5/6 rounded" data-v-14de94bb></div><div class="shimmer h-3 w-2/3 rounded" data-v-14de94bb></div></div><div class="mt-4 grid grid-cols-3 gap-2" data-v-14de94bb><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div><div class="shimmer h-6 rounded-full" data-v-14de94bb></div></div>',3)])])),64))])):(D=G.userStore)!=null&&D.errorHistory?(n(),r("div",Tn," Ошибка загрузки: "+S(G.userStore.errorHistory),1)):z.value==="history"?(n(),r("div",Hn,[(A=U.value)!=null&&A.length?(n(),r("div",An,[(n(!0),r(K,null,ie(O.value,g=>(n(),We(qe,{key:g.id,dream:g,active:c.value===g.id,onToggle:Z=>c.value=c.value===g.id?null:g.id},null,8,["dream","active","onToggle"]))),128)),B.value?(n(),r("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:F}," Загрузить ещё ")):N("",!0)])):(n(),r("div",On," У вас пока нет сохраненных анализов "))])):z.value==="deep"?(n(),r("div",Ln,[(y=k.value)!=null&&y.length?(n(),r("div",Yn,[(n(!0),r(K,null,ie(H.value,g=>(n(),We(qe,{key:g.id,dream:g,active:c.value===g.id,onToggle:Z=>c.value=c.value===g.id?null:g.id},null,8,["dream","active","onToggle"]))),128)),Y.value?(n(),r("button",{key:0,class:"self-center rounded-full px-4 py-2 text-sm font-medium transition-colors my-2 themed-button",onClick:h}," Загрузить ещё ")):N("",!0)])):(n(),r("div",jn," Пока нет глубоких анализов "))])):N("",!0)])}}}),In=Pe(zn,[["__scopeId","data-v-14de94bb"]]);export{In as default};

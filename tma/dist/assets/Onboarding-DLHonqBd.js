import{S as m,a as x,A as ae,b as te,K as ne}from"./autoplay-BHurXnBm.js";import{d as re,c as u,m as oe,r as F,E as k,z as f,h as ie,G as se,a as le,e as O,o as C,k as L,w as b,s as c,q as d,b as n,l as g}from"./main-DKMttAis.js";import{S as p}from"./StickerPlayer-D3sIMDMb.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";const de={key:0,class:"onboarding-overlay opaque"},ue={class:"onboarding-media media-top"},fe={class:"onboarding-media media-top"},be={class:"onboarding-media media-top"},ge={class:"onboarding-media media-top"},he={class:"onboarding-media media-top"},ve={class:"onboarding-media media-top"},_e={class:"onboarding-media media-bottom"},me=["src"],ye={class:"onboarding-media media-bottom"},pe=["src"],we={class:"onboarding-media media-bottom"},ke=["src"],Se=re({__name:"Onboarding",emits:["visible-change"],setup(Oe,{emit:U}){const z=new URL("/assets/Onboarding%20Frame-1-DvJ94vXK.png",import.meta.url).href,K=new URL("/assets/Onboarding%20Frame-2-DBUhkLII.png",import.meta.url).href,V=new URL("/assets/Onboarding%20Frame-3-egw2KtYZ.png",import.meta.url).href,B=[ae,te,ne],M={delay:8e3,disableOnInteraction:!1,stopOnLastSlide:!0},h=u(()=>{var e;return typeof window<"u"?(e=window.Telegram)==null?void 0:e.WebApp:null}),w=U,r=oe(),s=F("none"),l=F(1),E=u(()=>s.value!=="none"),q=u(()=>s.value==="new"),W=u(()=>s.value==="free"),N=u(()=>s.value==="post_claim"),G=u(()=>r!=null&&r.profile?(r.profile.subscription_type||"").toLowerCase()==="onboarding1":!1),H=u(()=>{var a;return(((a=r.profile)==null?void 0:a.subscription_type)||"").toLowerCase()==="onboarding2"}),J=()=>{var e,a,t;if(H.value)s.value="free",l.value=1;else if(G.value){const o=!!((e=r.profile)!=null&&e.channel_reward_claimed),i=(((a=r.profile)==null?void 0:a.total_dreams_count)||((t=r.history)==null?void 0:t.length)||0)>0;if(o&&!i){s.value="post_claim",l.value=1;return}s.value="new",l.value=1}else s.value="none"};k(()=>{var e,a,t;return[(e=r.profile)==null?void 0:e.channel_reward_claimed,(a=r.history)==null?void 0:a.length,(t=r.profile)==null?void 0:t.subscription_type]},()=>J(),{immediate:!0}),k(E,e=>{w("visible-change",e),e||v()},{immediate:!0});const v=()=>{try{const e=h.value;e!=null&&e.MainButton&&(e.MainButton.hide(),e.MainButton.offClick(P))}catch{}},y=(e,a)=>{var o,i;const t=h.value;if(t!=null&&t.MainButton){t.MainButton.setParams({text:e,color:((o=t.themeParams)==null?void 0:o.button_color)||"#2481CC",text_color:((i=t.themeParams)==null?void 0:i.button_text_color)||"#ffffff",is_active:!0,is_visible:!0}),t.MainButton.offClick(P),t.MainButton.onClick(P),S.value=a;try{t.MainButton.show()}catch{}}},S=F(()=>{}),P=()=>{var e;try{(e=S.value)==null||e.call(S)}catch(a){console.error(a)}},I=e=>{try{((e==null?void 0:e.slides)||[]).forEach((t,o)=>{const i=o===((e==null?void 0:e.activeIndex)||0);t.style.transform=i?"scale(1.0)":"scale(0.92)",t.style.transition="transform .25s ease"})}catch{}},X=e=>I(e),Y=e=>I(e),Z=e=>I(e);k(N,e=>{if(e)try{y("Написать сон",()=>{var a;f.trackOnboarding("post_claim_open_chat_click");try{(a=h.value)==null||a.close()}catch{}v()})}catch{}}),ie(()=>{}),se(()=>{v()});const D=()=>{var a,t;const e="https://t.me/thedreamshub";try{localStorage.setItem("visited_channel","1")}catch{}try{if((a=h.value)!=null&&a.openLink){h.value.openLink(e);return}}catch{}try{if((t=h.value)!=null&&t.openTelegramLink){h.value.openTelegramLink(e);return}}catch{}window.open(e,"_blank")},A=async()=>{var e,a,t;if(f.trackOnboarding("onboarding1_step4_verify_click"),await r.claimChannelReward(),r.rewardAlreadyClaimed){(e=r.notificationStore)==null||e.info("Награда уже получена. Отправьте свой сон в чате с ботом."),f.trackOnboarding("onboarding1_reward_already"),s.value="post_claim",l.value=1,w("visible-change",!0);return}if(r.claimRewardError){(a=r.notificationStore)==null||a.warning(r.claimRewardError||"Не удалось подтвердить подписку."),f.trackOnboarding("onboarding1_verify_failed",{reason:r.claimRewardError});return}(t=r.notificationStore)==null||t.success("Подписка подтверждена! Теперь отправьте свой сон в чате с ботом."),f.trackOnboarding("onboarding1_reward_granted"),s.value="post_claim",l.value=1,w("visible-change",!0)},R=async()=>{try{await f.setOnboardingStage("stage3"),s.value="none",w("visible-change",!1),v();try{await r.fetchProfile()}catch{}r.profile.onboarding_stage="stage3"}catch{}},j=async()=>{await R()},Q=async e=>{var a;l.value=((e==null?void 0:e.activeIndex)||0)+1;try{((e==null?void 0:e.slides)||[]).forEach((o,i)=>{const _=i===e.activeIndex;o.style.transform=_?"scale(1.0)":"scale(0.92)",o.style.transition="transform .25s ease"})}catch{}if(l.value===4){v(),f.trackOnboarding("onboarding1_step4_enter");const t=(()=>{try{return localStorage.getItem("visited_channel")==="1"}catch{return!1}})();(a=r.profile)!=null&&a.channel_reward_claimed?y("Открыть чат",()=>{var o,i;try{(i=(o=h.value)==null?void 0:o.close)==null||i.call(o)}catch{}}):t?(y("Проверить подписку",async()=>{var o,i,_;await A();try{await r.fetchProfile()}catch{}if((o=r.profile)!=null&&o.channel_reward_claimed)try{(_=(i=h.value)==null?void 0:i.close)==null||_.call(i)}catch{}}),(async()=>{var o;try{await A();try{await r.fetchProfile()}catch{}(o=r.profile)!=null&&o.channel_reward_claimed&&y("Открыть чат",()=>{var i,_;try{(_=(i=h.value)==null?void 0:i.close)==null||_.call(i)}catch{}})}catch{}})()):(f.trackOnboarding("onboarding1_step4_need_subscribe"),y("Перейти и подписаться",D))}else v()},$=async e=>{l.value=((e==null?void 0:e.activeIndex)||0)+1;try{((e==null?void 0:e.slides)||[]).forEach((t,o)=>{const i=o===e.activeIndex;t.style.transform=i?"scale(1.0)":"scale(0.92)",t.style.transition="transform .25s ease"})}catch{}l.value===4?y("Открыть историю",async()=>{f.trackOnboarding("onboarding2_step4_open_history_click"),await j();try{await r.fetchProfile()}catch{}}):v()},ee=async e=>{l.value=((e==null?void 0:e.activeIndex)||0)+1;try{((e==null?void 0:e.slides)||[]).forEach((t,o)=>{const i=o===e.activeIndex;t.style.transform=i?"scale(1.0)":"scale(0.92)",t.style.transition="transform .25s ease"})}catch{}l.value===1?y("Написать сон",()=>{var a,t;f.trackOnboarding("post_claim_open_chat_click");try{(t=(a=h.value)==null?void 0:a.close)==null||t.call(a)}catch{}v()}):v()};return u(()=>s.value==="new"?l.value===1?"Добро пожаловать в Dream Analyzer":l.value===2?"Получите стартовый токен":l.value===3?"Как использовать токен":"Завершите шаг":(s.value==="free","")),u(()=>s.value==="new"?l.value===1?"Как это работает и с чего начать":l.value===2?"Подпишитесь на канал — и мы начислим 1 токен":l.value===3?"Отправьте сон боту — получите анализ":"Нажмите — чтобы завершить шаг":(s.value==="free","")),u(()=>s.value==="new"?l.value===1?["Приложение помогает осмыслять сны и находить в них повторяющиеся символы.","Отправьте свой первый сон — получите быстрый анализ ИИ."]:["Подписка на наш канал — это стартовый бонус: мы начислим 1 токен.","После этого можно сразу отправить свой первый сон в чат с ботом."]:s.value==="free"?["Вы получили базовый доступ. Продолжайте отправлять сны — так AI лучше поймёт ваш контекст.","Открывайте историю и изучайте теги‑символы."]:[]),u(()=>s.value==="new"?l.value===1?"wizard-happy.tgs":"telegram-star.tgs":s.value==="free"?"chat.tgs":"thinking.tgs"),u(()=>s.value==="new"?l.value===1?{label:"Перейти и подписаться",handler:D}:l.value===4?{label:"Проверить подписку",handler:A}:null:s.value==="free"&&l.value===4?{label:"Продолжить",handler:R}:null),u(()=>null),k(()=>{var e,a;return[(e=r.profile)==null?void 0:e.onboarding_stage,(a=r.profile)==null?void 0:a.subscription_type]},([e,a])=>{(e==="stage3"||a&&!String(a).toLowerCase().startsWith("onboarding"))&&(s.value="none",w("visible-change",!1),v(),f.trackOnboarding("onboarding_closed",{subscription:a,stage:e}))}),k(()=>{var e,a;return[(e=r.history)==null?void 0:e.length,(a=r.profile)==null?void 0:a.subscription_type]},async([e,a])=>{try{if((Number(e)||0)>0&&String(a||"").toLowerCase()==="onboarding1"){f.trackOnboarding("auto_transition_to_onboarding2"),await f.setOnboardingStage("stage2");try{await r.fetchProfile()}catch{}}}catch{}}),(e,a)=>E.value?(C(),le("div",de,[q.value?(C(),L(d(x),{key:0,modules:B,direction:"vertical",spaceBetween:18,slidesOffsetBefore:32,slidesOffsetAfter:32,"slides-per-view":"auto",centeredSlides:!0,autoplay:M,keyboard:{enabled:!0},a11y:{enabled:!0},observer:!0,"observe-parents":!0,"watch-overflow":!0,onInit:X,onSlideChange:Q,class:"w-full h-full onboarding-swiper"},{default:b(()=>[c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[n("div",ue,[c(p,{src:"wizard-thining.tgs",width:220,height:220})]),a[0]||(a[0]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline centered"},[g("Сюжеты снов часто отражают эмоции,"),n("br"),g("а не реальные события.")])],-1))]),_:1}),c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[n("div",fe,[c(p,{src:"thinking.tgs",width:220,height:220})]),a[1]||(a[1]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline centered"},[g("DreamsTalk поможет сохранить"),n("br"),g("и исследовать сны, чтобы лучше"),n("br"),g("понимать себя и свои эмоции.")])],-1))]),_:1}),c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[n("div",be,[c(p,{src:"chat.tgs",width:220,height:220})]),a[2]||(a[2]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline centered"},"Чтобы описать сон — просто отправь его в чат.")],-1))]),_:1}),c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[n("div",ge,[c(p,{src:"telegram-star.tgs",width:220,height:220})]),a[3]||(a[3]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline centered"},[g("Получи первый токен для анализа сна"),n("br"),g("за подписку на канал @TheDreamsHub")])],-1))]),_:1})]),_:1})):O("",!0),N.value?(C(),L(d(x),{key:1,modules:B,direction:"vertical",spaceBetween:18,slidesOffsetBefore:32,slidesOffsetAfter:32,"slides-per-view":"auto",centeredSlides:!0,keyboard:{enabled:!0},a11y:{enabled:!0},observer:!0,"observe-parents":!0,"watch-overflow":!0,onInit:Z,onSlideChange:ee,class:"w-full h-full onboarding-swiper"},{default:b(()=>[c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[n("div",he,[c(p,{src:"chat.tgs",width:220,height:220})]),a[4]||(a[4]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline centered"},"Чтобы описать сон — просто отправь его в чат.")],-1))]),_:1})]),_:1})):O("",!0),W.value?(C(),L(d(x),{key:2,modules:B,direction:"vertical",spaceBetween:18,slidesOffsetBefore:32,slidesOffsetAfter:32,"slides-per-view":"auto",centeredSlides:!0,autoplay:M,keyboard:{enabled:!0},a11y:{enabled:!0},observer:!0,"observe-parents":!0,"watch-overflow":!0,onInit:Y,onSlideChange:$,class:"w-full h-full onboarding-swiper"},{default:b(()=>[c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[n("div",ve,[c(p,{src:"wizard-happy.tgs",width:220,height:220})]),a[5]||(a[5]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline centered"},[g("Ура!"),n("br"),g("Твой первый сон проанализирован."),n("br"),n("br"),g("Все сны твои сны"),n("br"),g("в одном месте – личный кабинет."),n("br"),n("br"),g("Давай покажу его!")])],-1))]),_:1}),c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[a[6]||(a[6]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline-24 centered"},"Удобный доступ")],-1)),n("div",_e,[n("img",{class:"onboarding-media-img",src:d(z),alt:"onboarding-2"},null,8,me)])]),_:1}),c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[a[7]||(a[7]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline-24 centered"},"Полезные факты")],-1)),n("div",ye,[n("img",{class:"onboarding-media-img",src:d(K),alt:"onboarding-3"},null,8,pe)])]),_:1}),c(d(m),{class:"onboarding-card slidePeek center-card"},{default:b(()=>[a[8]||(a[8]=n("div",{class:"onboarding-body"},[n("h2",{class:"headline-24 centered"},"История снов и анализ")],-1)),n("div",we,[n("img",{class:"onboarding-media-img",src:d(V),alt:"onboarding-4"},null,8,ke)])]),_:1})]),_:1})):O("",!0)])):O("",!0)}}),xe=ce(Se,[["__scopeId","data-v-8bbab396"]]);export{xe as default};
